{
  "version": 3,
  "sources": ["../../../../three.js/Three.jscad.js", "../../../../three.js/src/constants.js", "../../../../three.js/src/math/MathUtils.js", "../../../../three.js/src/math/Quaternion.js", "../../../../three.js/src/math/Vector3.js", "../../../../three.js/src/math/Matrix4.js", "../../../../three.js/src/core/EventDispatcher.js", "../../../../three.js/src/math/Euler.js", "../../../../three.js/src/core/Layers.js", "../../../../three.js/src/math/Matrix3.js", "../../../../three.js/src/core/Object3D.js", "../../../../three.js/src/cameras/Camera.js", "../../../../three.js/src/cameras/PerspectiveCamera.js", "../../../../three.js/src/cameras/StereoCamera.js", "../../../../three.js/src/scenes/Scene.js", "../../../../three.js/src/math/Color.js", "../../../../three.js/src/lights/Light.js", "../../../../three.js/src/lights/HemisphereLight.js", "../../../../three.js/src/math/Vector2.js", "../../../../three.js/src/math/Vector4.js", "../../../../three.js/src/math/Box3.js", "../../../../three.js/src/math/Sphere.js", "../../../../three.js/src/math/Plane.js", "../../../../three.js/src/math/Frustum.js", "../../../../three.js/src/lights/LightShadow.js", "../../../../three.js/src/cameras/OrthographicCamera.js", "../../../../three.js/src/lights/DirectionalLightShadow.js", "../../../../three.js/src/lights/DirectionalLight.js", "../../../../three.js/src/core/BufferAttribute.js", "../../../../three.js/src/utils.js", "../../../../three.js/src/core/BufferGeometry.js", "../../../../three.js/src/geometries/PlaneGeometry.js", "../../../../three.js/src/materials/Material.js", "../../../../three.js/src/materials/MeshPhongMaterial.js", "../../../../three.js/src/materials/LineBasicMaterial.js", "../../../../three.js/src/renderers/webgl/WebGLAnimation.js", "../../../../three.js/src/renderers/webgl/WebGLAttributes.js", "../../../../three.js/src/geometries/BoxGeometry.js", "../../../../three.js/src/renderers/shaders/UniformsUtils.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/default_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/default_fragment.glsl.js", "../../../../three.js/src/materials/ShaderMaterial.js", "../../../../three.js/src/math/Ray.js", "../../../../three.js/src/math/Triangle.js", "../../../../three.js/src/materials/MeshBasicMaterial.js", "../../../../three.js/src/objects/Mesh.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/alphamap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/alphamap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/alphatest_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/aomap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/aomap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/begin_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/beginnormal_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/bsdfs.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/bumpmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clipping_planes_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clipping_planes_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clipping_planes_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clipping_planes_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/color_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/color_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/color_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/color_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/common.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/cube_uv_reflection_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/defaultnormal_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/displacementmap_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/displacementmap_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/emissivemap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/emissivemap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/encodings_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/encodings_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_common_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/fog_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/fog_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/fog_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/fog_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/gradientmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lightmap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lightmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_lambert_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_pars_begin.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/envmap_physical_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_toon_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_toon_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_phong_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_phong_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_physical_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_physical_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_fragment_begin.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_fragment_maps.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/lights_fragment_end.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/logdepthbuf_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/logdepthbuf_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/logdepthbuf_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/logdepthbuf_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/map_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/map_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/map_particle_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/map_particle_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/metalnessmap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/metalnessmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/morphnormal_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/morphtarget_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/morphtarget_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normal_fragment_begin.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normal_fragment_maps.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normal_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normal_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normal_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clearcoat_normal_fragment_begin.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clearcoat_normal_fragment_maps.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/clearcoat_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/packing.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/premultiplied_alpha_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/project_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/dithering_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/dithering_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/roughnessmap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/roughnessmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/shadowmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/shadowmap_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/shadowmap_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/shadowmask_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/skinbase_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/skinning_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/skinning_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/skinnormal_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/specularmap_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/specularmap_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/tonemapping_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/tonemapping_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/transmission_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/transmission_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv2_pars_fragment.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv2_pars_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/uv2_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk/worldpos_vertex.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/background_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/background_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/cube_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/cube_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/depth_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/depth_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/distanceRGBA_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/distanceRGBA_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/equirect_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/equirect_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/linedashed_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/linedashed_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshbasic_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshbasic_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshlambert_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshlambert_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshmatcap_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshmatcap_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshnormal_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshnormal_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshphong_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshphong_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshphysical_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshphysical_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshtoon_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/meshtoon_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/points_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/points_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/shadow_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/shadow_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/sprite_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/sprite_vert.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderChunk.js", "../../../../three.js/src/renderers/shaders/UniformsLib.js", "../../../../three.js/src/renderers/shaders/ShaderLib.js", "../../../../three.js/src/renderers/webgl/WebGLBackground.js", "../../../../three.js/src/renderers/webgl/WebGLBindingStates.js", "../../../../three.js/src/renderers/webgl/WebGLBufferRenderer.js", "../../../../three.js/src/renderers/webgl/WebGLCapabilities.js", "../../../../three.js/src/renderers/webgl/WebGLClipping.js", "../../../../three.js/src/extras/ImageUtils.js", "../../../../three.js/src/textures/Texture.js", "../../../../three.js/src/renderers/WebGLRenderTarget.js", "../../../../three.js/src/cameras/CubeCamera.js", "../../../../three.js/src/textures/CubeTexture.js", "../../../../three.js/src/renderers/WebGLCubeRenderTarget.js", "../../../../three.js/src/renderers/webgl/WebGLCubeMaps.js", "../../../../three.js/src/materials/RawShaderMaterial.js", "../../../../three.js/src/extras/PMREMGenerator.js", "../../../../three.js/src/renderers/webgl/WebGLCubeUVMaps.js", "../../../../three.js/src/renderers/webgl/WebGLExtensions.js", "../../../../three.js/src/renderers/webgl/WebGLGeometries.js", "../../../../three.js/src/renderers/webgl/WebGLIndexedBufferRenderer.js", "../../../../three.js/src/renderers/webgl/WebGLInfo.js", "../../../../three.js/src/renderers/webgl/WebGLMorphtargets.js", "../../../../three.js/src/renderers/WebGLMultisampleRenderTarget.js", "../../../../three.js/src/renderers/webgl/WebGLObjects.js", "../../../../three.js/src/textures/DataTexture2DArray.js", "../../../../three.js/src/textures/DataTexture3D.js", "../../../../three.js/src/renderers/webgl/WebGLUniforms.js", "../../../../three.js/src/renderers/webgl/WebGLShader.js", "../../../../three.js/src/renderers/webgl/WebGLProgram.js", "../../../../three.js/src/renderers/webgl/WebGLPrograms.js", "../../../../three.js/src/renderers/webgl/WebGLProperties.js", "../../../../three.js/src/renderers/webgl/WebGLRenderLists.js", "../../../../three.js/src/renderers/webgl/WebGLLights.js", "../../../../three.js/src/renderers/webgl/WebGLRenderStates.js", "../../../../three.js/src/materials/MeshDepthMaterial.js", "../../../../three.js/src/materials/MeshDistanceMaterial.js", "../../../../three.js/src/renderers/shaders/ShaderLib/vsm_frag.glsl.js", "../../../../three.js/src/renderers/shaders/ShaderLib/vsm_vert.glsl.js", "../../../../three.js/src/renderers/webgl/WebGLShadowMap.js", "../../../../three.js/src/renderers/webgl/WebGLState.js", "../../../../three.js/src/renderers/webgl/WebGLTextures.js", "../../../../three.js/src/renderers/webgl/WebGLUtils.js", "../../../../three.js/src/cameras/ArrayCamera.js", "../../../../three.js/src/objects/Group.js", "../../../../three.js/src/renderers/webxr/WebXRController.js", "../../../../three.js/src/renderers/webxr/WebXRManager.js", "../../../../three.js/src/renderers/webgl/WebGLMaterials.js", "../../../../three.js/src/renderers/WebGLRenderer.js", "../../../../three.js/src/objects/Line.js", "../../../../three.js/src/objects/LineSegments.js", "../../../../three.js/src/helpers/GridHelper.js", "../../../../three.js/src/helpers/AxesHelper.js", "../../../../three.js/src/core/InstancedBufferGeometry.js", "../../../../three.js/src/objects/InstancedMesh.js", "../../../../three.js/src/math/Spherical.js", "../../../../three.js/src/Three.js", "../../../../three.js/examples/jsm/controls/OrbitControls.js", "../../../../three.js/examples/jsm/exporters/STLExporter.js", "../../../../three.js/examples/jsm/effects/AnaglyphEffect.js", "../../../../three.js/examples/jsm/effects/StereoEffect.js", "../../../../three.js/examples/jsm/effects/ParallaxBarrierEffect.js"],
  "sourcesContent": ["\r\nexport * from './src/Three.jscad.js';\r\n\r\nexport * from './examples/jsm/controls/OrbitControls.js';\r\nexport * from './examples/jsm/exporters/STLExporter.js';\r\nexport * from './examples/jsm/effects/AnaglyphEffect.js';\r\nexport * from './examples/jsm/effects/StereoEffect.js';\r\nexport * from './examples/jsm/effects/ParallaxBarrierEffect.js';\r\n", "export const REVISION = '132dev';\r\nexport const MOUSE = { LEFT: 0, MIDDLE: 1, RIGHT: 2, ROTATE: 0, DOLLY: 1, PAN: 2 };\r\nexport const TOUCH = { ROTATE: 0, PAN: 1, DOLLY_PAN: 2, DOLLY_ROTATE: 3 };\r\nexport const CullFaceNone = 0;\r\nexport const CullFaceBack = 1;\r\nexport const CullFaceFront = 2;\r\nexport const CullFaceFrontBack = 3;\r\nexport const BasicShadowMap = 0;\r\nexport const PCFShadowMap = 1;\r\nexport const PCFSoftShadowMap = 2;\r\nexport const VSMShadowMap = 3;\r\nexport const FrontSide = 0;\r\nexport const BackSide = 1;\r\nexport const DoubleSide = 2;\r\nexport const FlatShading = 1;\r\nexport const SmoothShading = 2;\r\nexport const NoBlending = 0;\r\nexport const NormalBlending = 1;\r\nexport const AdditiveBlending = 2;\r\nexport const SubtractiveBlending = 3;\r\nexport const MultiplyBlending = 4;\r\nexport const CustomBlending = 5;\r\nexport const AddEquation = 100;\r\nexport const SubtractEquation = 101;\r\nexport const ReverseSubtractEquation = 102;\r\nexport const MinEquation = 103;\r\nexport const MaxEquation = 104;\r\nexport const ZeroFactor = 200;\r\nexport const OneFactor = 201;\r\nexport const SrcColorFactor = 202;\r\nexport const OneMinusSrcColorFactor = 203;\r\nexport const SrcAlphaFactor = 204;\r\nexport const OneMinusSrcAlphaFactor = 205;\r\nexport const DstAlphaFactor = 206;\r\nexport const OneMinusDstAlphaFactor = 207;\r\nexport const DstColorFactor = 208;\r\nexport const OneMinusDstColorFactor = 209;\r\nexport const SrcAlphaSaturateFactor = 210;\r\nexport const NeverDepth = 0;\r\nexport const AlwaysDepth = 1;\r\nexport const LessDepth = 2;\r\nexport const LessEqualDepth = 3;\r\nexport const EqualDepth = 4;\r\nexport const GreaterEqualDepth = 5;\r\nexport const GreaterDepth = 6;\r\nexport const NotEqualDepth = 7;\r\nexport const MultiplyOperation = 0;\r\nexport const MixOperation = 1;\r\nexport const AddOperation = 2;\r\nexport const NoToneMapping = 0;\r\nexport const LinearToneMapping = 1;\r\nexport const ReinhardToneMapping = 2;\r\nexport const CineonToneMapping = 3;\r\nexport const ACESFilmicToneMapping = 4;\r\nexport const CustomToneMapping = 5;\r\n\r\nexport const UVMapping = 300;\r\nexport const CubeReflectionMapping = 301;\r\nexport const CubeRefractionMapping = 302;\r\nexport const EquirectangularReflectionMapping = 303;\r\nexport const EquirectangularRefractionMapping = 304;\r\nexport const CubeUVReflectionMapping = 306;\r\nexport const CubeUVRefractionMapping = 307;\r\nexport const RepeatWrapping = 1000;\r\nexport const ClampToEdgeWrapping = 1001;\r\nexport const MirroredRepeatWrapping = 1002;\r\nexport const NearestFilter = 1003;\r\nexport const NearestMipmapNearestFilter = 1004;\r\nexport const NearestMipMapNearestFilter = 1004;\r\nexport const NearestMipmapLinearFilter = 1005;\r\nexport const NearestMipMapLinearFilter = 1005;\r\nexport const LinearFilter = 1006;\r\nexport const LinearMipmapNearestFilter = 1007;\r\nexport const LinearMipMapNearestFilter = 1007;\r\nexport const LinearMipmapLinearFilter = 1008;\r\nexport const LinearMipMapLinearFilter = 1008;\r\nexport const UnsignedByteType = 1009;\r\nexport const ByteType = 1010;\r\nexport const ShortType = 1011;\r\nexport const UnsignedShortType = 1012;\r\nexport const IntType = 1013;\r\nexport const UnsignedIntType = 1014;\r\nexport const FloatType = 1015;\r\nexport const HalfFloatType = 1016;\r\nexport const UnsignedShort4444Type = 1017;\r\nexport const UnsignedShort5551Type = 1018;\r\nexport const UnsignedShort565Type = 1019;\r\nexport const UnsignedInt248Type = 1020;\r\nexport const AlphaFormat = 1021;\r\nexport const RGBFormat = 1022;\r\nexport const RGBAFormat = 1023;\r\nexport const LuminanceFormat = 1024;\r\nexport const LuminanceAlphaFormat = 1025;\r\nexport const RGBEFormat = RGBAFormat;\r\nexport const DepthFormat = 1026;\r\nexport const DepthStencilFormat = 1027;\r\nexport const RedFormat = 1028;\r\nexport const RedIntegerFormat = 1029;\r\nexport const RGFormat = 1030;\r\nexport const RGIntegerFormat = 1031;\r\nexport const RGBIntegerFormat = 1032;\r\nexport const RGBAIntegerFormat = 1033;\r\n\r\nexport const RGB_S3TC_DXT1_Format = 33776;\r\nexport const RGBA_S3TC_DXT1_Format = 33777;\r\nexport const RGBA_S3TC_DXT3_Format = 33778;\r\nexport const RGBA_S3TC_DXT5_Format = 33779;\r\nexport const RGB_PVRTC_4BPPV1_Format = 35840;\r\nexport const RGB_PVRTC_2BPPV1_Format = 35841;\r\nexport const RGBA_PVRTC_4BPPV1_Format = 35842;\r\nexport const RGBA_PVRTC_2BPPV1_Format = 35843;\r\nexport const RGB_ETC1_Format = 36196;\r\nexport const RGB_ETC2_Format = 37492;\r\nexport const RGBA_ETC2_EAC_Format = 37496;\r\nexport const RGBA_ASTC_4x4_Format = 37808;\r\nexport const RGBA_ASTC_5x4_Format = 37809;\r\nexport const RGBA_ASTC_5x5_Format = 37810;\r\nexport const RGBA_ASTC_6x5_Format = 37811;\r\nexport const RGBA_ASTC_6x6_Format = 37812;\r\nexport const RGBA_ASTC_8x5_Format = 37813;\r\nexport const RGBA_ASTC_8x6_Format = 37814;\r\nexport const RGBA_ASTC_8x8_Format = 37815;\r\nexport const RGBA_ASTC_10x5_Format = 37816;\r\nexport const RGBA_ASTC_10x6_Format = 37817;\r\nexport const RGBA_ASTC_10x8_Format = 37818;\r\nexport const RGBA_ASTC_10x10_Format = 37819;\r\nexport const RGBA_ASTC_12x10_Format = 37820;\r\nexport const RGBA_ASTC_12x12_Format = 37821;\r\nexport const RGBA_BPTC_Format = 36492;\r\nexport const SRGB8_ALPHA8_ASTC_4x4_Format = 37840;\r\nexport const SRGB8_ALPHA8_ASTC_5x4_Format = 37841;\r\nexport const SRGB8_ALPHA8_ASTC_5x5_Format = 37842;\r\nexport const SRGB8_ALPHA8_ASTC_6x5_Format = 37843;\r\nexport const SRGB8_ALPHA8_ASTC_6x6_Format = 37844;\r\nexport const SRGB8_ALPHA8_ASTC_8x5_Format = 37845;\r\nexport const SRGB8_ALPHA8_ASTC_8x6_Format = 37846;\r\nexport const SRGB8_ALPHA8_ASTC_8x8_Format = 37847;\r\nexport const SRGB8_ALPHA8_ASTC_10x5_Format = 37848;\r\nexport const SRGB8_ALPHA8_ASTC_10x6_Format = 37849;\r\nexport const SRGB8_ALPHA8_ASTC_10x8_Format = 37850;\r\nexport const SRGB8_ALPHA8_ASTC_10x10_Format = 37851;\r\nexport const SRGB8_ALPHA8_ASTC_12x10_Format = 37852;\r\nexport const SRGB8_ALPHA8_ASTC_12x12_Format = 37853;\r\nexport const LoopOnce = 2200;\r\nexport const LoopRepeat = 2201;\r\nexport const LoopPingPong = 2202;\r\nexport const InterpolateDiscrete = 2300;\r\nexport const InterpolateLinear = 2301;\r\nexport const InterpolateSmooth = 2302;\r\nexport const ZeroCurvatureEnding = 2400;\r\nexport const ZeroSlopeEnding = 2401;\r\nexport const WrapAroundEnding = 2402;\r\nexport const NormalAnimationBlendMode = 2500;\r\nexport const AdditiveAnimationBlendMode = 2501;\r\nexport const TrianglesDrawMode = 0;\r\nexport const TriangleStripDrawMode = 1;\r\nexport const TriangleFanDrawMode = 2;\r\nexport const LinearEncoding = 3000;\r\nexport const sRGBEncoding = 3001;\r\nexport const GammaEncoding = 3007;\r\nexport const RGBEEncoding = 3002;\r\nexport const LogLuvEncoding = 3003;\r\nexport const RGBM7Encoding = 3004;\r\nexport const RGBM16Encoding = 3005;\r\nexport const RGBDEncoding = 3006;\r\nexport const BasicDepthPacking = 3200;\r\nexport const RGBADepthPacking = 3201;\r\nexport const TangentSpaceNormalMap = 0;\r\nexport const ObjectSpaceNormalMap = 1;\r\n\r\nexport const ZeroStencilOp = 0;\r\nexport const KeepStencilOp = 7680;\r\nexport const ReplaceStencilOp = 7681;\r\nexport const IncrementStencilOp = 7682;\r\nexport const DecrementStencilOp = 7683;\r\nexport const IncrementWrapStencilOp = 34055;\r\nexport const DecrementWrapStencilOp = 34056;\r\nexport const InvertStencilOp = 5386;\r\n\r\nexport const NeverStencilFunc = 512;\r\nexport const LessStencilFunc = 513;\r\nexport const EqualStencilFunc = 514;\r\nexport const LessEqualStencilFunc = 515;\r\nexport const GreaterStencilFunc = 516;\r\nexport const NotEqualStencilFunc = 517;\r\nexport const GreaterEqualStencilFunc = 518;\r\nexport const AlwaysStencilFunc = 519;\r\n\r\nexport const StaticDrawUsage = 35044;\r\nexport const DynamicDrawUsage = 35048;\r\nexport const StreamDrawUsage = 35040;\r\nexport const StaticReadUsage = 35045;\r\nexport const DynamicReadUsage = 35049;\r\nexport const StreamReadUsage = 35041;\r\nexport const StaticCopyUsage = 35046;\r\nexport const DynamicCopyUsage = 35050;\r\nexport const StreamCopyUsage = 35042;\r\n\r\nexport const GLSL1 = '100';\r\nexport const GLSL3 = '300 es';\r\n", "const _lut = [];\r\n\r\nfor ( let i = 0; i < 256; i ++ ) {\r\n\r\n\t_lut[ i ] = ( i < 16 ? '0' : '' ) + ( i ).toString( 16 );\r\n\r\n}\r\n\r\nlet _seed = 1234567;\r\n\r\n\r\nconst DEG2RAD = Math.PI / 180;\r\nconst RAD2DEG = 180 / Math.PI;\r\n\r\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136\r\nfunction generateUUID() {\r\n\r\n\tconst d0 = Math.random() * 0xffffffff | 0;\r\n\tconst d1 = Math.random() * 0xffffffff | 0;\r\n\tconst d2 = Math.random() * 0xffffffff | 0;\r\n\tconst d3 = Math.random() * 0xffffffff | 0;\r\n\tconst uuid = _lut[ d0 & 0xff ] + _lut[ d0 >> 8 & 0xff ] + _lut[ d0 >> 16 & 0xff ] + _lut[ d0 >> 24 & 0xff ] + '-' +\r\n\t\t\t_lut[ d1 & 0xff ] + _lut[ d1 >> 8 & 0xff ] + '-' + _lut[ d1 >> 16 & 0x0f | 0x40 ] + _lut[ d1 >> 24 & 0xff ] + '-' +\r\n\t\t\t_lut[ d2 & 0x3f | 0x80 ] + _lut[ d2 >> 8 & 0xff ] + '-' + _lut[ d2 >> 16 & 0xff ] + _lut[ d2 >> 24 & 0xff ] +\r\n\t\t\t_lut[ d3 & 0xff ] + _lut[ d3 >> 8 & 0xff ] + _lut[ d3 >> 16 & 0xff ] + _lut[ d3 >> 24 & 0xff ];\r\n\r\n\t// .toUpperCase() here flattens concatenated strings to save heap memory space.\r\n\treturn uuid.toUpperCase();\r\n\r\n}\r\n\r\nfunction clamp( value, min, max ) {\r\n\r\n\treturn Math.max( min, Math.min( max, value ) );\r\n\r\n}\r\n\r\n// compute euclidian modulo of m % n\r\n// https://en.wikipedia.org/wiki/Modulo_operation\r\nfunction euclideanModulo( n, m ) {\r\n\r\n\treturn ( ( n % m ) + m ) % m;\r\n\r\n}\r\n\r\n// Linear mapping from range <a1, a2> to range <b1, b2>\r\nfunction mapLinear( x, a1, a2, b1, b2 ) {\r\n\r\n\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\r\n\r\n}\r\n\r\n// https://www.gamedev.net/tutorials/programming/general-and-gameplay-programming/inverse-lerp-a-super-useful-yet-often-overlooked-function-r5230/\r\nfunction inverseLerp( x, y, value ) {\r\n\r\n\tif ( x !== y ) {\r\n\r\n\t\treturn ( value - x ) / ( y - x );\r\n\r\n\t\t } else {\r\n\r\n\t\treturn 0;\r\n\r\n\t\t }\r\n\r\n}\r\n\r\n// https://en.wikipedia.org/wiki/Linear_interpolation\r\nfunction lerp( x, y, t ) {\r\n\r\n\treturn ( 1 - t ) * x + t * y;\r\n\r\n}\r\n\r\n// http://www.rorydriscoll.com/2016/03/07/frame-rate-independent-damping-using-lerp/\r\nfunction damp( x, y, lambda, dt ) {\r\n\r\n\treturn lerp( x, y, 1 - Math.exp( - lambda * dt ) );\r\n\r\n}\r\n\r\n// https://www.desmos.com/calculator/vcsjnyz7x4\r\nfunction pingpong( x, length = 1 ) {\r\n\r\n\treturn length - Math.abs( euclideanModulo( x, length * 2 ) - length );\r\n\r\n}\r\n\r\n// http://en.wikipedia.org/wiki/Smoothstep\r\nfunction smoothstep( x, min, max ) {\r\n\r\n\tif ( x <= min ) return 0;\r\n\tif ( x >= max ) return 1;\r\n\r\n\tx = ( x - min ) / ( max - min );\r\n\r\n\treturn x * x * ( 3 - 2 * x );\r\n\r\n}\r\n\r\nfunction smootherstep( x, min, max ) {\r\n\r\n\tif ( x <= min ) return 0;\r\n\tif ( x >= max ) return 1;\r\n\r\n\tx = ( x - min ) / ( max - min );\r\n\r\n\treturn x * x * x * ( x * ( x * 6 - 15 ) + 10 );\r\n\r\n}\r\n\r\n// Random integer from <low, high> interval\r\nfunction randInt( low, high ) {\r\n\r\n\treturn low + Math.floor( Math.random() * ( high - low + 1 ) );\r\n\r\n}\r\n\r\n// Random float from <low, high> interval\r\nfunction randFloat( low, high ) {\r\n\r\n\treturn low + Math.random() * ( high - low );\r\n\r\n}\r\n\r\n// Random float from <-range/2, range/2> interval\r\nfunction randFloatSpread( range ) {\r\n\r\n\treturn range * ( 0.5 - Math.random() );\r\n\r\n}\r\n\r\n// Deterministic pseudo-random float in the interval [ 0, 1 ]\r\nfunction seededRandom( s ) {\r\n\r\n\tif ( s !== undefined ) _seed = s % 2147483647;\r\n\r\n\t// Park-Miller algorithm\r\n\r\n\t_seed = _seed * 16807 % 2147483647;\r\n\r\n\treturn ( _seed - 1 ) / 2147483646;\r\n\r\n}\r\n\r\nfunction degToRad( degrees ) {\r\n\r\n\treturn degrees * DEG2RAD;\r\n\r\n}\r\n\r\nfunction radToDeg( radians ) {\r\n\r\n\treturn radians * RAD2DEG;\r\n\r\n}\r\n\r\nfunction isPowerOfTwo( value ) {\r\n\r\n\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\r\n\r\n}\r\n\r\nfunction ceilPowerOfTwo( value ) {\r\n\r\n\treturn Math.pow( 2, Math.ceil( Math.log( value ) / Math.LN2 ) );\r\n\r\n}\r\n\r\nfunction floorPowerOfTwo( value ) {\r\n\r\n\treturn Math.pow( 2, Math.floor( Math.log( value ) / Math.LN2 ) );\r\n\r\n}\r\n\r\nfunction setQuaternionFromProperEuler( q, a, b, c, order ) {\r\n\r\n\t// Intrinsic Proper Euler Angles - see https://en.wikipedia.org/wiki/Euler_angles\r\n\r\n\t// rotations are applied to the axes in the order specified by 'order'\r\n\t// rotation by angle 'a' is applied first, then by angle 'b', then by angle 'c'\r\n\t// angles are in radians\r\n\r\n\tconst cos = Math.cos;\r\n\tconst sin = Math.sin;\r\n\r\n\tconst c2 = cos( b / 2 );\r\n\tconst s2 = sin( b / 2 );\r\n\r\n\tconst c13 = cos( ( a + c ) / 2 );\r\n\tconst s13 = sin( ( a + c ) / 2 );\r\n\r\n\tconst c1_3 = cos( ( a - c ) / 2 );\r\n\tconst s1_3 = sin( ( a - c ) / 2 );\r\n\r\n\tconst c3_1 = cos( ( c - a ) / 2 );\r\n\tconst s3_1 = sin( ( c - a ) / 2 );\r\n\r\n\tswitch ( order ) {\r\n\r\n\t\tcase 'XYX':\r\n\t\t\tq.set( c2 * s13, s2 * c1_3, s2 * s1_3, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'YZY':\r\n\t\t\tq.set( s2 * s1_3, c2 * s13, s2 * c1_3, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'ZXZ':\r\n\t\t\tq.set( s2 * c1_3, s2 * s1_3, c2 * s13, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'XZX':\r\n\t\t\tq.set( c2 * s13, s2 * s3_1, s2 * c3_1, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'YXY':\r\n\t\t\tq.set( s2 * c3_1, c2 * s13, s2 * s3_1, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'ZYZ':\r\n\t\t\tq.set( s2 * s3_1, s2 * c3_1, c2 * s13, c2 * c13 );\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconsole.warn( 'THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: ' + order );\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n\r\n\r\nexport {\r\n\tDEG2RAD,\r\n\tRAD2DEG,\r\n\tgenerateUUID,\r\n\tclamp,\r\n\teuclideanModulo,\r\n\tmapLinear,\r\n\tinverseLerp,\r\n\tlerp,\r\n\tdamp,\r\n\tpingpong,\r\n\tsmoothstep,\r\n\tsmootherstep,\r\n\trandInt,\r\n\trandFloat,\r\n\trandFloatSpread,\r\n\tseededRandom,\r\n\tdegToRad,\r\n\tradToDeg,\r\n\tisPowerOfTwo,\r\n\tceilPowerOfTwo,\r\n\tfloorPowerOfTwo,\r\n\tsetQuaternionFromProperEuler,\r\n};\r\n", "import * as MathUtils from './MathUtils.js';\r\n\r\nclass Quaternion {\r\n\r\n\tconstructor( x = 0, y = 0, z = 0, w = 1 ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._w = w;\r\n\r\n\t}\r\n\r\n\tstatic slerp( qa, qb, qm, t ) {\r\n\r\n\t\tconsole.warn( 'THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead.' );\r\n\t\treturn qm.slerpQuaternions( qa, qb, t );\r\n\r\n\t}\r\n\r\n\tstatic slerpFlat( dst, dstOffset, src0, srcOffset0, src1, srcOffset1, t ) {\r\n\r\n\t\t// fuzz-free, array-based Quaternion SLERP operation\r\n\r\n\t\tlet x0 = src0[ srcOffset0 + 0 ],\r\n\t\t\ty0 = src0[ srcOffset0 + 1 ],\r\n\t\t\tz0 = src0[ srcOffset0 + 2 ],\r\n\t\t\tw0 = src0[ srcOffset0 + 3 ];\r\n\r\n\t\tconst x1 = src1[ srcOffset1 + 0 ],\r\n\t\t\ty1 = src1[ srcOffset1 + 1 ],\r\n\t\t\tz1 = src1[ srcOffset1 + 2 ],\r\n\t\t\tw1 = src1[ srcOffset1 + 3 ];\r\n\r\n\t\tif ( t === 0 ) {\r\n\r\n\t\t\tdst[ dstOffset + 0 ] = x0;\r\n\t\t\tdst[ dstOffset + 1 ] = y0;\r\n\t\t\tdst[ dstOffset + 2 ] = z0;\r\n\t\t\tdst[ dstOffset + 3 ] = w0;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( t === 1 ) {\r\n\r\n\t\t\tdst[ dstOffset + 0 ] = x1;\r\n\t\t\tdst[ dstOffset + 1 ] = y1;\r\n\t\t\tdst[ dstOffset + 2 ] = z1;\r\n\t\t\tdst[ dstOffset + 3 ] = w1;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( w0 !== w1 || x0 !== x1 || y0 !== y1 || z0 !== z1 ) {\r\n\r\n\t\t\tlet s = 1 - t;\r\n\t\t\tconst cos = x0 * x1 + y0 * y1 + z0 * z1 + w0 * w1,\r\n\t\t\t\tdir = ( cos >= 0 ? 1 : - 1 ),\r\n\t\t\t\tsqrSin = 1 - cos * cos;\r\n\r\n\t\t\t// Skip the Slerp for tiny steps to avoid numeric problems:\r\n\t\t\tif ( sqrSin > Number.EPSILON ) {\r\n\r\n\t\t\t\tconst sin = Math.sqrt( sqrSin ),\r\n\t\t\t\t\tlen = Math.atan2( sin, cos * dir );\r\n\r\n\t\t\t\ts = Math.sin( s * len ) / sin;\r\n\t\t\t\tt = Math.sin( t * len ) / sin;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst tDir = t * dir;\r\n\r\n\t\t\tx0 = x0 * s + x1 * tDir;\r\n\t\t\ty0 = y0 * s + y1 * tDir;\r\n\t\t\tz0 = z0 * s + z1 * tDir;\r\n\t\t\tw0 = w0 * s + w1 * tDir;\r\n\r\n\t\t\t// Normalize in case we just did a lerp:\r\n\t\t\tif ( s === 1 - t ) {\r\n\r\n\t\t\t\tconst f = 1 / Math.sqrt( x0 * x0 + y0 * y0 + z0 * z0 + w0 * w0 );\r\n\r\n\t\t\t\tx0 *= f;\r\n\t\t\t\ty0 *= f;\r\n\t\t\t\tz0 *= f;\r\n\t\t\t\tw0 *= f;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdst[ dstOffset ] = x0;\r\n\t\tdst[ dstOffset + 1 ] = y0;\r\n\t\tdst[ dstOffset + 2 ] = z0;\r\n\t\tdst[ dstOffset + 3 ] = w0;\r\n\r\n\t}\r\n\r\n\tstatic multiplyQuaternionsFlat( dst, dstOffset, src0, srcOffset0, src1, srcOffset1 ) {\r\n\r\n\t\tconst x0 = src0[ srcOffset0 ];\r\n\t\tconst y0 = src0[ srcOffset0 + 1 ];\r\n\t\tconst z0 = src0[ srcOffset0 + 2 ];\r\n\t\tconst w0 = src0[ srcOffset0 + 3 ];\r\n\r\n\t\tconst x1 = src1[ srcOffset1 ];\r\n\t\tconst y1 = src1[ srcOffset1 + 1 ];\r\n\t\tconst z1 = src1[ srcOffset1 + 2 ];\r\n\t\tconst w1 = src1[ srcOffset1 + 3 ];\r\n\r\n\t\tdst[ dstOffset ] = x0 * w1 + w0 * x1 + y0 * z1 - z0 * y1;\r\n\t\tdst[ dstOffset + 1 ] = y0 * w1 + w0 * y1 + z0 * x1 - x0 * z1;\r\n\t\tdst[ dstOffset + 2 ] = z0 * w1 + w0 * z1 + x0 * y1 - y0 * x1;\r\n\t\tdst[ dstOffset + 3 ] = w0 * w1 - x0 * x1 - y0 * y1 - z0 * z1;\r\n\r\n\t\treturn dst;\r\n\r\n\t}\r\n\r\n\tget x() {\r\n\r\n\t\treturn this._x;\r\n\r\n\t}\r\n\r\n\tset x( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget y() {\r\n\r\n\t\treturn this._y;\r\n\r\n\t}\r\n\r\n\tset y( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget z() {\r\n\r\n\t\treturn this._z;\r\n\r\n\t}\r\n\r\n\tset z( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget w() {\r\n\r\n\t\treturn this._w;\r\n\r\n\t}\r\n\r\n\tset w( value ) {\r\n\r\n\t\tthis._w = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tset( x, y, z, w ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._w = w;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this._x, this._y, this._z, this._w );\r\n\r\n\t}\r\n\r\n\tcopy( quaternion ) {\r\n\r\n\t\tthis._x = quaternion.x;\r\n\t\tthis._y = quaternion.y;\r\n\t\tthis._z = quaternion.z;\r\n\t\tthis._w = quaternion.w;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromEuler( euler, update ) {\r\n\r\n\t\tif ( ! ( euler && euler.isEuler ) ) {\r\n\r\n\t\t\tthrow new Error( 'THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst x = euler._x, y = euler._y, z = euler._z, order = euler._order;\r\n\r\n\t\t// http://www.mathworks.com/matlabcentral/fileexchange/\r\n\t\t// \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\r\n\t\t//\tcontent/SpinCalc.m\r\n\r\n\t\tconst cos = Math.cos;\r\n\t\tconst sin = Math.sin;\r\n\r\n\t\tconst c1 = cos( x / 2 );\r\n\t\tconst c2 = cos( y / 2 );\r\n\t\tconst c3 = cos( z / 2 );\r\n\r\n\t\tconst s1 = sin( x / 2 );\r\n\t\tconst s2 = sin( y / 2 );\r\n\t\tconst s3 = sin( z / 2 );\r\n\r\n\t\tswitch ( order ) {\r\n\r\n\t\t\tcase 'XYZ':\r\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'YXZ':\r\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ZXY':\r\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ZYX':\r\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'YZX':\r\n\t\t\t\tthis._x = s1 * c2 * c3 + c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 + s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 - s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 - s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'XZY':\r\n\t\t\t\tthis._x = s1 * c2 * c3 - c1 * s2 * s3;\r\n\t\t\t\tthis._y = c1 * s2 * c3 - s1 * c2 * s3;\r\n\t\t\t\tthis._z = c1 * c2 * s3 + s1 * s2 * c3;\r\n\t\t\t\tthis._w = c1 * c2 * c3 + s1 * s2 * s3;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn( 'THREE.Quaternion: .setFromEuler() encountered an unknown order: ' + order );\r\n\r\n\t\t}\r\n\r\n\t\tif ( update !== false ) this._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromAxisAngle( axis, angle ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToQuaternion/index.htm\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tconst halfAngle = angle / 2, s = Math.sin( halfAngle );\r\n\r\n\t\tthis._x = axis.x * s;\r\n\t\tthis._y = axis.y * s;\r\n\t\tthis._z = axis.z * s;\r\n\t\tthis._w = Math.cos( halfAngle );\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromRotationMatrix( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tconst te = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ],\r\n\r\n\t\t\ttrace = m11 + m22 + m33;\r\n\r\n\t\tif ( trace > 0 ) {\r\n\r\n\t\t\tconst s = 0.5 / Math.sqrt( trace + 1.0 );\r\n\r\n\t\t\tthis._w = 0.25 / s;\r\n\t\t\tthis._x = ( m32 - m23 ) * s;\r\n\t\t\tthis._y = ( m13 - m31 ) * s;\r\n\t\t\tthis._z = ( m21 - m12 ) * s;\r\n\r\n\t\t} else if ( m11 > m22 && m11 > m33 ) {\r\n\r\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m11 - m22 - m33 );\r\n\r\n\t\t\tthis._w = ( m32 - m23 ) / s;\r\n\t\t\tthis._x = 0.25 * s;\r\n\t\t\tthis._y = ( m12 + m21 ) / s;\r\n\t\t\tthis._z = ( m13 + m31 ) / s;\r\n\r\n\t\t} else if ( m22 > m33 ) {\r\n\r\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m22 - m11 - m33 );\r\n\r\n\t\t\tthis._w = ( m13 - m31 ) / s;\r\n\t\t\tthis._x = ( m12 + m21 ) / s;\r\n\t\t\tthis._y = 0.25 * s;\r\n\t\t\tthis._z = ( m23 + m32 ) / s;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst s = 2.0 * Math.sqrt( 1.0 + m33 - m11 - m22 );\r\n\r\n\t\t\tthis._w = ( m21 - m12 ) / s;\r\n\t\t\tthis._x = ( m13 + m31 ) / s;\r\n\t\t\tthis._y = ( m23 + m32 ) / s;\r\n\t\t\tthis._z = 0.25 * s;\r\n\r\n\t\t}\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromUnitVectors( vFrom, vTo ) {\r\n\r\n\t\t// assumes direction vectors vFrom and vTo are normalized\r\n\r\n\t\tlet r = vFrom.dot( vTo ) + 1;\r\n\r\n\t\tif ( r < Number.EPSILON ) {\r\n\r\n\t\t\t// vFrom and vTo point in opposite directions\r\n\r\n\t\t\tr = 0;\r\n\r\n\t\t\tif ( Math.abs( vFrom.x ) > Math.abs( vFrom.z ) ) {\r\n\r\n\t\t\t\tthis._x = - vFrom.y;\r\n\t\t\t\tthis._y = vFrom.x;\r\n\t\t\t\tthis._z = 0;\r\n\t\t\t\tthis._w = r;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._x = 0;\r\n\t\t\t\tthis._y = - vFrom.z;\r\n\t\t\t\tthis._z = vFrom.y;\r\n\t\t\t\tthis._w = r;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// crossVectors( vFrom, vTo ); // inlined to avoid cyclic dependency on Vector3\r\n\r\n\t\t\tthis._x = vFrom.y * vTo.z - vFrom.z * vTo.y;\r\n\t\t\tthis._y = vFrom.z * vTo.x - vFrom.x * vTo.z;\r\n\t\t\tthis._z = vFrom.x * vTo.y - vFrom.y * vTo.x;\r\n\t\t\tthis._w = r;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.normalize();\r\n\r\n\t}\r\n\r\n\tangleTo( q ) {\r\n\r\n\t\treturn 2 * Math.acos( Math.abs( MathUtils.clamp( this.dot( q ), - 1, 1 ) ) );\r\n\r\n\t}\r\n\r\n\trotateTowards( q, step ) {\r\n\r\n\t\tconst angle = this.angleTo( q );\r\n\r\n\t\tif ( angle === 0 ) return this;\r\n\r\n\t\tconst t = Math.min( 1, step / angle );\r\n\r\n\t\tthis.slerp( q, t );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tidentity() {\r\n\r\n\t\treturn this.set( 0, 0, 0, 1 );\r\n\r\n\t}\r\n\r\n\tinvert() {\r\n\r\n\t\t// quaternion is assumed to have unit length\r\n\r\n\t\treturn this.conjugate();\r\n\r\n\t}\r\n\r\n\tconjugate() {\r\n\r\n\t\tthis._x *= - 1;\r\n\t\tthis._y *= - 1;\r\n\t\tthis._z *= - 1;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdot( v ) {\r\n\r\n\t\treturn this._x * v._x + this._y * v._y + this._z * v._z + this._w * v._w;\r\n\r\n\t}\r\n\r\n\tlengthSq() {\r\n\r\n\t\treturn this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;\r\n\r\n\t}\r\n\r\n\tlength() {\r\n\r\n\t\treturn Math.sqrt( this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w );\r\n\r\n\t}\r\n\r\n\tnormalize() {\r\n\r\n\t\tlet l = this.length();\r\n\r\n\t\tif ( l === 0 ) {\r\n\r\n\t\t\tthis._x = 0;\r\n\t\t\tthis._y = 0;\r\n\t\t\tthis._z = 0;\r\n\t\t\tthis._w = 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tl = 1 / l;\r\n\r\n\t\t\tthis._x = this._x * l;\r\n\t\t\tthis._y = this._y * l;\r\n\t\t\tthis._z = this._z * l;\r\n\t\t\tthis._w = this._w * l;\r\n\r\n\t\t}\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( q, p ) {\r\n\r\n\t\tif ( p !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.' );\r\n\t\t\treturn this.multiplyQuaternions( q, p );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyQuaternions( this, q );\r\n\r\n\t}\r\n\r\n\tpremultiply( q ) {\r\n\r\n\t\treturn this.multiplyQuaternions( q, this );\r\n\r\n\t}\r\n\r\n\tmultiplyQuaternions( a, b ) {\r\n\r\n\t\t// from http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/code/index.htm\r\n\r\n\t\tconst qax = a._x, qay = a._y, qaz = a._z, qaw = a._w;\r\n\t\tconst qbx = b._x, qby = b._y, qbz = b._z, qbw = b._w;\r\n\r\n\t\tthis._x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;\r\n\t\tthis._y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;\r\n\t\tthis._z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;\r\n\t\tthis._w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tslerp( qb, t ) {\r\n\r\n\t\tif ( t === 0 ) return this;\r\n\t\tif ( t === 1 ) return this.copy( qb );\r\n\r\n\t\tconst x = this._x, y = this._y, z = this._z, w = this._w;\r\n\r\n\t\t// http://www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/slerp/\r\n\r\n\t\tlet cosHalfTheta = w * qb._w + x * qb._x + y * qb._y + z * qb._z;\r\n\r\n\t\tif ( cosHalfTheta < 0 ) {\r\n\r\n\t\t\tthis._w = - qb._w;\r\n\t\t\tthis._x = - qb._x;\r\n\t\t\tthis._y = - qb._y;\r\n\t\t\tthis._z = - qb._z;\r\n\r\n\t\t\tcosHalfTheta = - cosHalfTheta;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.copy( qb );\r\n\r\n\t\t}\r\n\r\n\t\tif ( cosHalfTheta >= 1.0 ) {\r\n\r\n\t\t\tthis._w = w;\r\n\t\t\tthis._x = x;\r\n\t\t\tthis._y = y;\r\n\t\t\tthis._z = z;\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tconst sqrSinHalfTheta = 1.0 - cosHalfTheta * cosHalfTheta;\r\n\r\n\t\tif ( sqrSinHalfTheta <= Number.EPSILON ) {\r\n\r\n\t\t\tconst s = 1 - t;\r\n\t\t\tthis._w = s * w + t * this._w;\r\n\t\t\tthis._x = s * x + t * this._x;\r\n\t\t\tthis._y = s * y + t * this._y;\r\n\t\t\tthis._z = s * z + t * this._z;\r\n\r\n\t\t\tthis.normalize();\r\n\t\t\tthis._onChangeCallback();\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tconst sinHalfTheta = Math.sqrt( sqrSinHalfTheta );\r\n\t\tconst halfTheta = Math.atan2( sinHalfTheta, cosHalfTheta );\r\n\t\tconst ratioA = Math.sin( ( 1 - t ) * halfTheta ) / sinHalfTheta,\r\n\t\t\tratioB = Math.sin( t * halfTheta ) / sinHalfTheta;\r\n\r\n\t\tthis._w = ( w * ratioA + this._w * ratioB );\r\n\t\tthis._x = ( x * ratioA + this._x * ratioB );\r\n\t\tthis._y = ( y * ratioA + this._y * ratioB );\r\n\t\tthis._z = ( z * ratioA + this._z * ratioB );\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tslerpQuaternions( qa, qb, t ) {\r\n\r\n\t\tthis.copy( qa ).slerp( qb, t );\r\n\r\n\t}\r\n\r\n\tequals( quaternion ) {\r\n\r\n\t\treturn ( quaternion._x === this._x ) && ( quaternion._y === this._y ) && ( quaternion._z === this._z ) && ( quaternion._w === this._w );\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tthis._x = array[ offset ];\r\n\t\tthis._y = array[ offset + 1 ];\r\n\t\tthis._z = array[ offset + 2 ];\r\n\t\tthis._w = array[ offset + 3 ];\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._w;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfromBufferAttribute( attribute, index ) {\r\n\r\n\t\tthis._x = attribute.getX( index );\r\n\t\tthis._y = attribute.getY( index );\r\n\t\tthis._z = attribute.getZ( index );\r\n\t\tthis._w = attribute.getW( index );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t_onChange( callback ) {\r\n\r\n\t\tthis._onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t_onChangeCallback() {}\r\n\r\n}\r\n\r\nQuaternion.prototype.isQuaternion = true;\r\n\r\nexport { Quaternion };\r\n", "import * as MathUtils from './MathUtils.js';\r\nimport { Quaternion } from './Quaternion.js';\r\n\r\nclass Vector3 {\r\n\r\n\tconstructor( x = 0, y = 0, z = 0 ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\r\n\t}\r\n\r\n\tset( x, y, z ) {\r\n\r\n\t\tif ( z === undefined ) z = this.z; // sprite.scale.set(x,y)\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetScalar( scalar ) {\r\n\r\n\t\tthis.x = scalar;\r\n\t\tthis.y = scalar;\r\n\t\tthis.z = scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetX( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetY( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetZ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetComponent( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetComponent( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this.x, this.y, this.z );\r\n\r\n\t}\r\n\r\n\tcopy( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tadd( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScalar( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScaledVector( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\t\tthis.z += v.z * s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsub( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubScalar( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.' );\r\n\t\t\treturn this.multiplyVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\t\tthis.z *= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x * b.x;\r\n\t\tthis.y = a.y * b.y;\r\n\t\tthis.z = a.z * b.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyEuler( euler ) {\r\n\r\n\t\tif ( ! ( euler && euler.isEuler ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.applyQuaternion( _quaternion.setFromEuler( euler ) );\r\n\r\n\t}\r\n\r\n\tapplyAxisAngle( axis, angle ) {\r\n\r\n\t\treturn this.applyQuaternion( _quaternion.setFromAxisAngle( axis, angle ) );\r\n\r\n\t}\r\n\r\n\tapplyMatrix3( m ) {\r\n\r\n\t\tconst x = this.x, y = this.y, z = this.z;\r\n\t\tconst e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ] * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ] * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 5 ] * y + e[ 8 ] * z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyNormalMatrix( m ) {\r\n\r\n\t\treturn this.applyMatrix3( m ).normalize();\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( m ) {\r\n\r\n\t\tconst x = this.x, y = this.y, z = this.z;\r\n\t\tconst e = m.elements;\r\n\r\n\t\tconst w = 1 / ( e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] );\r\n\r\n\t\tthis.x = ( e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] ) * w;\r\n\t\tthis.y = ( e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] ) * w;\r\n\t\tthis.z = ( e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] ) * w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyQuaternion( q ) {\r\n\r\n\t\tconst x = this.x, y = this.y, z = this.z;\r\n\t\tconst qx = q.x, qy = q.y, qz = q.z, qw = q.w;\r\n\r\n\t\t// calculate quat * vector\r\n\r\n\t\tconst ix = qw * x + qy * z - qz * y;\r\n\t\tconst iy = qw * y + qz * x - qx * z;\r\n\t\tconst iz = qw * z + qx * y - qy * x;\r\n\t\tconst iw = - qx * x - qy * y - qz * z;\r\n\r\n\t\t// calculate result * inverse quat\r\n\r\n\t\tthis.x = ix * qw + iw * - qx + iy * - qz - iz * - qy;\r\n\t\tthis.y = iy * qw + iw * - qy + iz * - qx - ix * - qz;\r\n\t\tthis.z = iz * qw + iw * - qz + ix * - qy - iy * - qx;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tproject( camera ) {\r\n\r\n\t\treturn this.applyMatrix4( camera.matrixWorldInverse ).applyMatrix4( camera.projectionMatrix );\r\n\r\n\t}\r\n\r\n\tunproject( camera ) {\r\n\r\n\t\treturn this.applyMatrix4( camera.projectionMatrixInverse ).applyMatrix4( camera.matrixWorld );\r\n\r\n\t}\r\n\r\n\ttransformDirection( m ) {\r\n\r\n\t\t// input: THREE.Matrix4 affine matrix\r\n\t\t// vector interpreted as a direction\r\n\r\n\t\tconst x = this.x, y = this.y, z = this.z;\r\n\t\tconst e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z;\r\n\r\n\t\treturn this.normalize();\r\n\r\n\t}\r\n\r\n\tdivide( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\t\tthis.z /= v.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdivideScalar( scalar ) {\r\n\r\n\t\treturn this.multiplyScalar( 1 / scalar );\r\n\r\n\t}\r\n\r\n\tmin( v ) {\r\n\r\n\t\tthis.x = Math.min( this.x, v.x );\r\n\t\tthis.y = Math.min( this.y, v.y );\r\n\t\tthis.z = Math.min( this.z, v.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmax( v ) {\r\n\r\n\t\tthis.x = Math.max( this.x, v.x );\r\n\t\tthis.y = Math.max( this.y, v.y );\r\n\t\tthis.z = Math.max( this.z, v.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclamp( min, max ) {\r\n\r\n\t\t// assumes min < max, componentwise\r\n\r\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\r\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\r\n\t\tthis.z = Math.max( min.z, Math.min( max.z, this.z ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampScalar( minVal, maxVal ) {\r\n\r\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\r\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\r\n\t\tthis.z = Math.max( minVal, Math.min( maxVal, this.z ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampLength( min, max ) {\r\n\r\n\t\tconst length = this.length();\r\n\r\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\r\n\r\n\t}\r\n\r\n\tfloor() {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tceil() {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tround() {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\troundToZero() {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnegate() {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdot( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t}\r\n\r\n\t// TODO lengthSquared?\r\n\r\n\tlengthSq() {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z;\r\n\r\n\t}\r\n\r\n\tlength() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n\r\n\t}\r\n\r\n\tmanhattanLength() {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z );\r\n\r\n\t}\r\n\r\n\tnormalize() {\r\n\r\n\t\treturn this.divideScalar( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tsetLength( length ) {\r\n\r\n\t\treturn this.normalize().multiplyScalar( length );\r\n\r\n\t}\r\n\r\n\tlerp( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerpVectors( v1, v2, alpha ) {\r\n\r\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\r\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\r\n\t\tthis.z = v1.z + ( v2.z - v1.z ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcross( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.' );\r\n\t\t\treturn this.crossVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.crossVectors( this, v );\r\n\r\n\t}\r\n\r\n\tcrossVectors( a, b ) {\r\n\r\n\t\tconst ax = a.x, ay = a.y, az = a.z;\r\n\t\tconst bx = b.x, by = b.y, bz = b.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprojectOnVector( v ) {\r\n\r\n\t\tconst denominator = v.lengthSq();\r\n\r\n\t\tif ( denominator === 0 ) return this.set( 0, 0, 0 );\r\n\r\n\t\tconst scalar = v.dot( this ) / denominator;\r\n\r\n\t\treturn this.copy( v ).multiplyScalar( scalar );\r\n\r\n\t}\r\n\r\n\tprojectOnPlane( planeNormal ) {\r\n\r\n\t\t_vector.copy( this ).projectOnVector( planeNormal );\r\n\r\n\t\treturn this.sub( _vector );\r\n\r\n\t}\r\n\r\n\treflect( normal ) {\r\n\r\n\t\t// reflect incident vector off plane orthogonal to normal\r\n\t\t// normal is assumed to have unit length\r\n\r\n\t\treturn this.sub( _vector.copy( normal ).multiplyScalar( 2 * this.dot( normal ) ) );\r\n\r\n\t}\r\n\r\n\tangleTo( v ) {\r\n\r\n\t\tconst denominator = Math.sqrt( this.lengthSq() * v.lengthSq() );\r\n\r\n\t\tif ( denominator === 0 ) return Math.PI / 2;\r\n\r\n\t\tconst theta = this.dot( v ) / denominator;\r\n\r\n\t\t// clamp, to handle numerical problems\r\n\r\n\t\treturn Math.acos( MathUtils.clamp( theta, - 1, 1 ) );\r\n\r\n\t}\r\n\r\n\tdistanceTo( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t}\r\n\r\n\tdistanceToSquared( v ) {\r\n\r\n\t\tconst dx = this.x - v.x, dy = this.y - v.y, dz = this.z - v.z;\r\n\r\n\t\treturn dx * dx + dy * dy + dz * dz;\r\n\r\n\t}\r\n\r\n\tmanhattanDistanceTo( v ) {\r\n\r\n\t\treturn Math.abs( this.x - v.x ) + Math.abs( this.y - v.y ) + Math.abs( this.z - v.z );\r\n\r\n\t}\r\n\r\n\tsetFromSpherical( s ) {\r\n\r\n\t\treturn this.setFromSphericalCoords( s.radius, s.phi, s.theta );\r\n\r\n\t}\r\n\r\n\tsetFromSphericalCoords( radius, phi, theta ) {\r\n\r\n\t\tconst sinPhiRadius = Math.sin( phi ) * radius;\r\n\r\n\t\tthis.x = sinPhiRadius * Math.sin( theta );\r\n\t\tthis.y = Math.cos( phi ) * radius;\r\n\t\tthis.z = sinPhiRadius * Math.cos( theta );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromCylindrical( c ) {\r\n\r\n\t\treturn this.setFromCylindricalCoords( c.radius, c.theta, c.y );\r\n\r\n\t}\r\n\r\n\tsetFromCylindricalCoords( radius, theta, y ) {\r\n\r\n\t\tthis.x = radius * Math.sin( theta );\r\n\t\tthis.y = y;\r\n\t\tthis.z = radius * Math.cos( theta );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromMatrixPosition( m ) {\r\n\r\n\t\tconst e = m.elements;\r\n\r\n\t\tthis.x = e[ 12 ];\r\n\t\tthis.y = e[ 13 ];\r\n\t\tthis.z = e[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromMatrixScale( m ) {\r\n\r\n\t\tconst sx = this.setFromMatrixColumn( m, 0 ).length();\r\n\t\tconst sy = this.setFromMatrixColumn( m, 1 ).length();\r\n\t\tconst sz = this.setFromMatrixColumn( m, 2 ).length();\r\n\r\n\t\tthis.x = sx;\r\n\t\tthis.y = sy;\r\n\t\tthis.z = sz;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromMatrixColumn( m, index ) {\r\n\r\n\t\treturn this.fromArray( m.elements, index * 4 );\r\n\r\n\t}\r\n\r\n\tsetFromMatrix3Column( m, index ) {\r\n\r\n\t\treturn this.fromArray( m.elements, index * 3 );\r\n\r\n\t}\r\n\r\n\tequals( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) );\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfromBufferAttribute( attribute, index, offset ) {\r\n\r\n\t\tif ( offset !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector3: offset has been removed from .fromBufferAttribute().' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x = attribute.getX( index );\r\n\t\tthis.y = attribute.getY( index );\r\n\t\tthis.z = attribute.getZ( index );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trandom() {\r\n\r\n\t\tthis.x = Math.random();\r\n\t\tthis.y = Math.random();\r\n\t\tthis.z = Math.random();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nVector3.prototype.isVector3 = true;\r\n\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\nconst _quaternion = /*@__PURE__*/ new Quaternion();\r\n\r\nexport { Vector3 };\r\n", "import { Vector3 } from './Vector3.js';\r\n\r\nclass Matrix4 {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.elements = [\r\n\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t];\r\n\r\n\t\tif ( arguments.length > 0 ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tset( n11, n12, n13, n14, n21, n22, n23, n24, n31, n32, n33, n34, n41, n42, n43, n44 ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 4 ] = n12; te[ 8 ] = n13; te[ 12 ] = n14;\r\n\t\tte[ 1 ] = n21; te[ 5 ] = n22; te[ 9 ] = n23; te[ 13 ] = n24;\r\n\t\tte[ 2 ] = n31; te[ 6 ] = n32; te[ 10 ] = n33; te[ 14 ] = n34;\r\n\t\tte[ 3 ] = n41; te[ 7 ] = n42; te[ 11 ] = n43; te[ 15 ] = n44;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tidentity() {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new Matrix4().fromArray( this.elements );\r\n\r\n\t}\r\n\r\n\tcopy( m ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst me = m.elements;\r\n\r\n\t\tte[ 0 ] = me[ 0 ]; te[ 1 ] = me[ 1 ]; te[ 2 ] = me[ 2 ]; te[ 3 ] = me[ 3 ];\r\n\t\tte[ 4 ] = me[ 4 ]; te[ 5 ] = me[ 5 ]; te[ 6 ] = me[ 6 ]; te[ 7 ] = me[ 7 ];\r\n\t\tte[ 8 ] = me[ 8 ]; te[ 9 ] = me[ 9 ]; te[ 10 ] = me[ 10 ]; te[ 11 ] = me[ 11 ];\r\n\t\tte[ 12 ] = me[ 12 ]; te[ 13 ] = me[ 13 ]; te[ 14 ] = me[ 14 ]; te[ 15 ] = me[ 15 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyPosition( m ) {\r\n\r\n\t\tconst te = this.elements, me = m.elements;\r\n\r\n\t\tte[ 12 ] = me[ 12 ];\r\n\t\tte[ 13 ] = me[ 13 ];\r\n\t\tte[ 14 ] = me[ 14 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromMatrix3( m ) {\r\n\r\n\t\tconst me = m.elements;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tme[ 0 ], me[ 3 ], me[ 6 ], 0,\r\n\t\t\tme[ 1 ], me[ 4 ], me[ 7 ], 0,\r\n\t\t\tme[ 2 ], me[ 5 ], me[ 8 ], 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\textractBasis( xAxis, yAxis, zAxis ) {\r\n\r\n\t\txAxis.setFromMatrixColumn( this, 0 );\r\n\t\tyAxis.setFromMatrixColumn( this, 1 );\r\n\t\tzAxis.setFromMatrixColumn( this, 2 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeBasis( xAxis, yAxis, zAxis ) {\r\n\r\n\t\tthis.set(\r\n\t\t\txAxis.x, yAxis.x, zAxis.x, 0,\r\n\t\t\txAxis.y, yAxis.y, zAxis.y, 0,\r\n\t\t\txAxis.z, yAxis.z, zAxis.z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\textractRotation( m ) {\r\n\r\n\t\t// this method does not support reflection matrices\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst me = m.elements;\r\n\r\n\t\tconst scaleX = 1 / _v1.setFromMatrixColumn( m, 0 ).length();\r\n\t\tconst scaleY = 1 / _v1.setFromMatrixColumn( m, 1 ).length();\r\n\t\tconst scaleZ = 1 / _v1.setFromMatrixColumn( m, 2 ).length();\r\n\r\n\t\tte[ 0 ] = me[ 0 ] * scaleX;\r\n\t\tte[ 1 ] = me[ 1 ] * scaleX;\r\n\t\tte[ 2 ] = me[ 2 ] * scaleX;\r\n\t\tte[ 3 ] = 0;\r\n\r\n\t\tte[ 4 ] = me[ 4 ] * scaleY;\r\n\t\tte[ 5 ] = me[ 5 ] * scaleY;\r\n\t\tte[ 6 ] = me[ 6 ] * scaleY;\r\n\t\tte[ 7 ] = 0;\r\n\r\n\t\tte[ 8 ] = me[ 8 ] * scaleZ;\r\n\t\tte[ 9 ] = me[ 9 ] * scaleZ;\r\n\t\tte[ 10 ] = me[ 10 ] * scaleZ;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationFromEuler( euler ) {\r\n\r\n\t\tif ( ! ( euler && euler.isEuler ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst x = euler.x, y = euler.y, z = euler.z;\r\n\t\tconst a = Math.cos( x ), b = Math.sin( x );\r\n\t\tconst c = Math.cos( y ), d = Math.sin( y );\r\n\t\tconst e = Math.cos( z ), f = Math.sin( z );\r\n\r\n\t\tif ( euler.order === 'XYZ' ) {\r\n\r\n\t\t\tconst ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - c * f;\r\n\t\t\tte[ 8 ] = d;\r\n\r\n\t\t\tte[ 1 ] = af + be * d;\r\n\t\t\tte[ 5 ] = ae - bf * d;\r\n\t\t\tte[ 9 ] = - b * c;\r\n\r\n\t\t\tte[ 2 ] = bf - ae * d;\r\n\t\t\tte[ 6 ] = be + af * d;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YXZ' ) {\r\n\r\n\t\t\tconst ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce + df * b;\r\n\t\t\tte[ 4 ] = de * b - cf;\r\n\t\t\tte[ 8 ] = a * d;\r\n\r\n\t\t\tte[ 1 ] = a * f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b;\r\n\r\n\t\t\tte[ 2 ] = cf * b - de;\r\n\t\t\tte[ 6 ] = df + ce * b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZXY' ) {\r\n\r\n\t\t\tconst ce = c * e, cf = c * f, de = d * e, df = d * f;\r\n\r\n\t\t\tte[ 0 ] = ce - df * b;\r\n\t\t\tte[ 4 ] = - a * f;\r\n\t\t\tte[ 8 ] = de + cf * b;\r\n\r\n\t\t\tte[ 1 ] = cf + de * b;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = df - ce * b;\r\n\r\n\t\t\tte[ 2 ] = - a * d;\r\n\t\t\tte[ 6 ] = b;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'ZYX' ) {\r\n\r\n\t\t\tconst ae = a * e, af = a * f, be = b * e, bf = b * f;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = be * d - af;\r\n\t\t\tte[ 8 ] = ae * d + bf;\r\n\r\n\t\t\tte[ 1 ] = c * f;\r\n\t\t\tte[ 5 ] = bf * d + ae;\r\n\t\t\tte[ 9 ] = af * d - be;\r\n\r\n\t\t\tte[ 2 ] = - d;\r\n\t\t\tte[ 6 ] = b * c;\r\n\t\t\tte[ 10 ] = a * c;\r\n\r\n\t\t} else if ( euler.order === 'YZX' ) {\r\n\r\n\t\t\tconst ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = bd - ac * f;\r\n\t\t\tte[ 8 ] = bc * f + ad;\r\n\r\n\t\t\tte[ 1 ] = f;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = - b * e;\r\n\r\n\t\t\tte[ 2 ] = - d * e;\r\n\t\t\tte[ 6 ] = ad * f + bc;\r\n\t\t\tte[ 10 ] = ac - bd * f;\r\n\r\n\t\t} else if ( euler.order === 'XZY' ) {\r\n\r\n\t\t\tconst ac = a * c, ad = a * d, bc = b * c, bd = b * d;\r\n\r\n\t\t\tte[ 0 ] = c * e;\r\n\t\t\tte[ 4 ] = - f;\r\n\t\t\tte[ 8 ] = d * e;\r\n\r\n\t\t\tte[ 1 ] = ac * f + bd;\r\n\t\t\tte[ 5 ] = a * e;\r\n\t\t\tte[ 9 ] = ad * f - bc;\r\n\r\n\t\t\tte[ 2 ] = bc * f - ad;\r\n\t\t\tte[ 6 ] = b * e;\r\n\t\t\tte[ 10 ] = bd * f + ac;\r\n\r\n\t\t}\r\n\r\n\t\t// bottom row\r\n\t\tte[ 3 ] = 0;\r\n\t\tte[ 7 ] = 0;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\t// last column\r\n\t\tte[ 12 ] = 0;\r\n\t\tte[ 13 ] = 0;\r\n\t\tte[ 14 ] = 0;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationFromQuaternion( q ) {\r\n\r\n\t\treturn this.compose( _zero, q, _one );\r\n\r\n\t}\r\n\r\n\tlookAt( eye, target, up ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\t_z.subVectors( eye, target );\r\n\r\n\t\tif ( _z.lengthSq() === 0 ) {\r\n\r\n\t\t\t// eye and target are in the same position\r\n\r\n\t\t\t_z.z = 1;\r\n\r\n\t\t}\r\n\r\n\t\t_z.normalize();\r\n\t\t_x.crossVectors( up, _z );\r\n\r\n\t\tif ( _x.lengthSq() === 0 ) {\r\n\r\n\t\t\t// up and z are parallel\r\n\r\n\t\t\tif ( Math.abs( up.z ) === 1 ) {\r\n\r\n\t\t\t\t_z.x += 0.0001;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_z.z += 0.0001;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_z.normalize();\r\n\t\t\t_x.crossVectors( up, _z );\r\n\r\n\t\t}\r\n\r\n\t\t_x.normalize();\r\n\t\t_y.crossVectors( _z, _x );\r\n\r\n\t\tte[ 0 ] = _x.x; te[ 4 ] = _y.x; te[ 8 ] = _z.x;\r\n\t\tte[ 1 ] = _x.y; te[ 5 ] = _y.y; te[ 9 ] = _z.y;\r\n\t\tte[ 2 ] = _x.z; te[ 6 ] = _y.z; te[ 10 ] = _z.z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( m, n ) {\r\n\r\n\t\tif ( n !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.' );\r\n\t\t\treturn this.multiplyMatrices( m, n );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.multiplyMatrices( this, m );\r\n\r\n\t}\r\n\r\n\tpremultiply( m ) {\r\n\r\n\t\treturn this.multiplyMatrices( m, this );\r\n\r\n\t}\r\n\r\n\tmultiplyMatrices( a, b ) {\r\n\r\n\t\tconst ae = a.elements;\r\n\t\tconst be = b.elements;\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst a11 = ae[ 0 ], a12 = ae[ 4 ], a13 = ae[ 8 ], a14 = ae[ 12 ];\r\n\t\tconst a21 = ae[ 1 ], a22 = ae[ 5 ], a23 = ae[ 9 ], a24 = ae[ 13 ];\r\n\t\tconst a31 = ae[ 2 ], a32 = ae[ 6 ], a33 = ae[ 10 ], a34 = ae[ 14 ];\r\n\t\tconst a41 = ae[ 3 ], a42 = ae[ 7 ], a43 = ae[ 11 ], a44 = ae[ 15 ];\r\n\r\n\t\tconst b11 = be[ 0 ], b12 = be[ 4 ], b13 = be[ 8 ], b14 = be[ 12 ];\r\n\t\tconst b21 = be[ 1 ], b22 = be[ 5 ], b23 = be[ 9 ], b24 = be[ 13 ];\r\n\t\tconst b31 = be[ 2 ], b32 = be[ 6 ], b33 = be[ 10 ], b34 = be[ 14 ];\r\n\t\tconst b41 = be[ 3 ], b42 = be[ 7 ], b43 = be[ 11 ], b44 = be[ 15 ];\r\n\r\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31 + a14 * b41;\r\n\t\tte[ 4 ] = a11 * b12 + a12 * b22 + a13 * b32 + a14 * b42;\r\n\t\tte[ 8 ] = a11 * b13 + a12 * b23 + a13 * b33 + a14 * b43;\r\n\t\tte[ 12 ] = a11 * b14 + a12 * b24 + a13 * b34 + a14 * b44;\r\n\r\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31 + a24 * b41;\r\n\t\tte[ 5 ] = a21 * b12 + a22 * b22 + a23 * b32 + a24 * b42;\r\n\t\tte[ 9 ] = a21 * b13 + a22 * b23 + a23 * b33 + a24 * b43;\r\n\t\tte[ 13 ] = a21 * b14 + a22 * b24 + a23 * b34 + a24 * b44;\r\n\r\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31 + a34 * b41;\r\n\t\tte[ 6 ] = a31 * b12 + a32 * b22 + a33 * b32 + a34 * b42;\r\n\t\tte[ 10 ] = a31 * b13 + a32 * b23 + a33 * b33 + a34 * b43;\r\n\t\tte[ 14 ] = a31 * b14 + a32 * b24 + a33 * b34 + a34 * b44;\r\n\r\n\t\tte[ 3 ] = a41 * b11 + a42 * b21 + a43 * b31 + a44 * b41;\r\n\t\tte[ 7 ] = a41 * b12 + a42 * b22 + a43 * b32 + a44 * b42;\r\n\t\tte[ 11 ] = a41 * b13 + a42 * b23 + a43 * b33 + a44 * b43;\r\n\t\tte[ 15 ] = a41 * b14 + a42 * b24 + a43 * b34 + a44 * b44;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( s ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 4 ] *= s; te[ 8 ] *= s; te[ 12 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 5 ] *= s; te[ 9 ] *= s; te[ 13 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 6 ] *= s; te[ 10 ] *= s; te[ 14 ] *= s;\r\n\t\tte[ 3 ] *= s; te[ 7 ] *= s; te[ 11 ] *= s; te[ 15 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdeterminant() {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst n11 = te[ 0 ], n12 = te[ 4 ], n13 = te[ 8 ], n14 = te[ 12 ];\r\n\t\tconst n21 = te[ 1 ], n22 = te[ 5 ], n23 = te[ 9 ], n24 = te[ 13 ];\r\n\t\tconst n31 = te[ 2 ], n32 = te[ 6 ], n33 = te[ 10 ], n34 = te[ 14 ];\r\n\t\tconst n41 = te[ 3 ], n42 = te[ 7 ], n43 = te[ 11 ], n44 = te[ 15 ];\r\n\r\n\t\t//TODO: make this more efficient\r\n\t\t//( based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm )\r\n\r\n\t\treturn (\r\n\t\t\tn41 * (\r\n\t\t\t\t+ n14 * n23 * n32\r\n\t\t\t\t - n13 * n24 * n32\r\n\t\t\t\t - n14 * n22 * n33\r\n\t\t\t\t + n12 * n24 * n33\r\n\t\t\t\t + n13 * n22 * n34\r\n\t\t\t\t - n12 * n23 * n34\r\n\t\t\t) +\r\n\t\t\tn42 * (\r\n\t\t\t\t+ n11 * n23 * n34\r\n\t\t\t\t - n11 * n24 * n33\r\n\t\t\t\t + n14 * n21 * n33\r\n\t\t\t\t - n13 * n21 * n34\r\n\t\t\t\t + n13 * n24 * n31\r\n\t\t\t\t - n14 * n23 * n31\r\n\t\t\t) +\r\n\t\t\tn43 * (\r\n\t\t\t\t+ n11 * n24 * n32\r\n\t\t\t\t - n11 * n22 * n34\r\n\t\t\t\t - n14 * n21 * n32\r\n\t\t\t\t + n12 * n21 * n34\r\n\t\t\t\t + n14 * n22 * n31\r\n\t\t\t\t - n12 * n24 * n31\r\n\t\t\t) +\r\n\t\t\tn44 * (\r\n\t\t\t\t- n13 * n22 * n31\r\n\t\t\t\t - n11 * n23 * n32\r\n\t\t\t\t + n11 * n22 * n33\r\n\t\t\t\t + n13 * n21 * n32\r\n\t\t\t\t - n12 * n21 * n33\r\n\t\t\t\t + n12 * n23 * n31\r\n\t\t\t)\r\n\r\n\t\t);\r\n\r\n\t}\r\n\r\n\ttranspose() {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tlet tmp;\r\n\r\n\t\ttmp = te[ 1 ]; te[ 1 ] = te[ 4 ]; te[ 4 ] = tmp;\r\n\t\ttmp = te[ 2 ]; te[ 2 ] = te[ 8 ]; te[ 8 ] = tmp;\r\n\t\ttmp = te[ 6 ]; te[ 6 ] = te[ 9 ]; te[ 9 ] = tmp;\r\n\r\n\t\ttmp = te[ 3 ]; te[ 3 ] = te[ 12 ]; te[ 12 ] = tmp;\r\n\t\ttmp = te[ 7 ]; te[ 7 ] = te[ 13 ]; te[ 13 ] = tmp;\r\n\t\ttmp = te[ 11 ]; te[ 11 ] = te[ 14 ]; te[ 14 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetPosition( x, y, z ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tif ( x.isVector3 ) {\r\n\r\n\t\t\tte[ 12 ] = x.x;\r\n\t\t\tte[ 13 ] = x.y;\r\n\t\t\tte[ 14 ] = x.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tte[ 12 ] = x;\r\n\t\t\tte[ 13 ] = y;\r\n\t\t\tte[ 14 ] = z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tinvert() {\r\n\r\n\t\t// based on http://www.euclideanspace.com/maths/algebra/matrix/functions/inverse/fourD/index.htm\r\n\t\tconst te = this.elements,\r\n\r\n\t\t\tn11 = te[ 0 ], n21 = te[ 1 ], n31 = te[ 2 ], n41 = te[ 3 ],\r\n\t\t\tn12 = te[ 4 ], n22 = te[ 5 ], n32 = te[ 6 ], n42 = te[ 7 ],\r\n\t\t\tn13 = te[ 8 ], n23 = te[ 9 ], n33 = te[ 10 ], n43 = te[ 11 ],\r\n\t\t\tn14 = te[ 12 ], n24 = te[ 13 ], n34 = te[ 14 ], n44 = te[ 15 ],\r\n\r\n\t\t\tt11 = n23 * n34 * n42 - n24 * n33 * n42 + n24 * n32 * n43 - n22 * n34 * n43 - n23 * n32 * n44 + n22 * n33 * n44,\r\n\t\t\tt12 = n14 * n33 * n42 - n13 * n34 * n42 - n14 * n32 * n43 + n12 * n34 * n43 + n13 * n32 * n44 - n12 * n33 * n44,\r\n\t\t\tt13 = n13 * n24 * n42 - n14 * n23 * n42 + n14 * n22 * n43 - n12 * n24 * n43 - n13 * n22 * n44 + n12 * n23 * n44,\r\n\t\t\tt14 = n14 * n23 * n32 - n13 * n24 * n32 - n14 * n22 * n33 + n12 * n24 * n33 + n13 * n22 * n34 - n12 * n23 * n34;\r\n\r\n\t\tconst det = n11 * t11 + n21 * t12 + n31 * t13 + n41 * t14;\r\n\r\n\t\tif ( det === 0 ) return this.set( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 );\r\n\r\n\t\tconst detInv = 1 / det;\r\n\r\n\t\tte[ 0 ] = t11 * detInv;\r\n\t\tte[ 1 ] = ( n24 * n33 * n41 - n23 * n34 * n41 - n24 * n31 * n43 + n21 * n34 * n43 + n23 * n31 * n44 - n21 * n33 * n44 ) * detInv;\r\n\t\tte[ 2 ] = ( n22 * n34 * n41 - n24 * n32 * n41 + n24 * n31 * n42 - n21 * n34 * n42 - n22 * n31 * n44 + n21 * n32 * n44 ) * detInv;\r\n\t\tte[ 3 ] = ( n23 * n32 * n41 - n22 * n33 * n41 - n23 * n31 * n42 + n21 * n33 * n42 + n22 * n31 * n43 - n21 * n32 * n43 ) * detInv;\r\n\r\n\t\tte[ 4 ] = t12 * detInv;\r\n\t\tte[ 5 ] = ( n13 * n34 * n41 - n14 * n33 * n41 + n14 * n31 * n43 - n11 * n34 * n43 - n13 * n31 * n44 + n11 * n33 * n44 ) * detInv;\r\n\t\tte[ 6 ] = ( n14 * n32 * n41 - n12 * n34 * n41 - n14 * n31 * n42 + n11 * n34 * n42 + n12 * n31 * n44 - n11 * n32 * n44 ) * detInv;\r\n\t\tte[ 7 ] = ( n12 * n33 * n41 - n13 * n32 * n41 + n13 * n31 * n42 - n11 * n33 * n42 - n12 * n31 * n43 + n11 * n32 * n43 ) * detInv;\r\n\r\n\t\tte[ 8 ] = t13 * detInv;\r\n\t\tte[ 9 ] = ( n14 * n23 * n41 - n13 * n24 * n41 - n14 * n21 * n43 + n11 * n24 * n43 + n13 * n21 * n44 - n11 * n23 * n44 ) * detInv;\r\n\t\tte[ 10 ] = ( n12 * n24 * n41 - n14 * n22 * n41 + n14 * n21 * n42 - n11 * n24 * n42 - n12 * n21 * n44 + n11 * n22 * n44 ) * detInv;\r\n\t\tte[ 11 ] = ( n13 * n22 * n41 - n12 * n23 * n41 - n13 * n21 * n42 + n11 * n23 * n42 + n12 * n21 * n43 - n11 * n22 * n43 ) * detInv;\r\n\r\n\t\tte[ 12 ] = t14 * detInv;\r\n\t\tte[ 13 ] = ( n13 * n24 * n31 - n14 * n23 * n31 + n14 * n21 * n33 - n11 * n24 * n33 - n13 * n21 * n34 + n11 * n23 * n34 ) * detInv;\r\n\t\tte[ 14 ] = ( n14 * n22 * n31 - n12 * n24 * n31 - n14 * n21 * n32 + n11 * n24 * n32 + n12 * n21 * n34 - n11 * n22 * n34 ) * detInv;\r\n\t\tte[ 15 ] = ( n12 * n23 * n31 - n13 * n22 * n31 + n13 * n21 * n32 - n11 * n23 * n32 - n12 * n21 * n33 + n11 * n22 * n33 ) * detInv;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tscale( v ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst x = v.x, y = v.y, z = v.z;\r\n\r\n\t\tte[ 0 ] *= x; te[ 4 ] *= y; te[ 8 ] *= z;\r\n\t\tte[ 1 ] *= x; te[ 5 ] *= y; te[ 9 ] *= z;\r\n\t\tte[ 2 ] *= x; te[ 6 ] *= y; te[ 10 ] *= z;\r\n\t\tte[ 3 ] *= x; te[ 7 ] *= y; te[ 11 ] *= z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetMaxScaleOnAxis() {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst scaleXSq = te[ 0 ] * te[ 0 ] + te[ 1 ] * te[ 1 ] + te[ 2 ] * te[ 2 ];\r\n\t\tconst scaleYSq = te[ 4 ] * te[ 4 ] + te[ 5 ] * te[ 5 ] + te[ 6 ] * te[ 6 ];\r\n\t\tconst scaleZSq = te[ 8 ] * te[ 8 ] + te[ 9 ] * te[ 9 ] + te[ 10 ] * te[ 10 ];\r\n\r\n\t\treturn Math.sqrt( Math.max( scaleXSq, scaleYSq, scaleZSq ) );\r\n\r\n\t}\r\n\r\n\tmakeTranslation( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, x,\r\n\t\t\t0, 1, 0, y,\r\n\t\t\t0, 0, 1, z,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationX( theta ) {\r\n\r\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, c, - s, 0,\r\n\t\t\t0, s, c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationY( theta ) {\r\n\r\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t c, 0, s, 0,\r\n\t\t\t 0, 1, 0, 0,\r\n\t\t\t- s, 0, c, 0,\r\n\t\t\t 0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationZ( theta ) {\r\n\r\n\t\tconst c = Math.cos( theta ), s = Math.sin( theta );\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tc, - s, 0, 0,\r\n\t\t\ts, c, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeRotationAxis( axis, angle ) {\r\n\r\n\t\t// Based on http://www.gamedev.net/reference/articles/article1199.asp\r\n\r\n\t\tconst c = Math.cos( angle );\r\n\t\tconst s = Math.sin( angle );\r\n\t\tconst t = 1 - c;\r\n\t\tconst x = axis.x, y = axis.y, z = axis.z;\r\n\t\tconst tx = t * x, ty = t * y;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\ttx * x + c, tx * y - s * z, tx * z + s * y, 0,\r\n\t\t\ttx * y + s * z, ty * y + c, ty * z - s * x, 0,\r\n\t\t\ttx * z - s * y, ty * z + s * x, t * z * z + c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeScale( x, y, z ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tx, 0, 0, 0,\r\n\t\t\t0, y, 0, 0,\r\n\t\t\t0, 0, z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeShear( xy, xz, yx, yz, zx, zy ) {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, yx, zx, 0,\r\n\t\t\txy, 1, zy, 0,\r\n\t\t\txz, yz, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcompose( position, quaternion, scale ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst x = quaternion._x, y = quaternion._y, z = quaternion._z, w = quaternion._w;\r\n\t\tconst x2 = x + x,\ty2 = y + y, z2 = z + z;\r\n\t\tconst xx = x * x2, xy = x * y2, xz = x * z2;\r\n\t\tconst yy = y * y2, yz = y * z2, zz = z * z2;\r\n\t\tconst wx = w * x2, wy = w * y2, wz = w * z2;\r\n\r\n\t\tconst sx = scale.x, sy = scale.y, sz = scale.z;\r\n\r\n\t\tte[ 0 ] = ( 1 - ( yy + zz ) ) * sx;\r\n\t\tte[ 1 ] = ( xy + wz ) * sx;\r\n\t\tte[ 2 ] = ( xz - wy ) * sx;\r\n\t\tte[ 3 ] = 0;\r\n\r\n\t\tte[ 4 ] = ( xy - wz ) * sy;\r\n\t\tte[ 5 ] = ( 1 - ( xx + zz ) ) * sy;\r\n\t\tte[ 6 ] = ( yz + wx ) * sy;\r\n\t\tte[ 7 ] = 0;\r\n\r\n\t\tte[ 8 ] = ( xz + wy ) * sz;\r\n\t\tte[ 9 ] = ( yz - wx ) * sz;\r\n\t\tte[ 10 ] = ( 1 - ( xx + yy ) ) * sz;\r\n\t\tte[ 11 ] = 0;\r\n\r\n\t\tte[ 12 ] = position.x;\r\n\t\tte[ 13 ] = position.y;\r\n\t\tte[ 14 ] = position.z;\r\n\t\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdecompose( position, quaternion, scale ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tlet sx = _v1.set( te[ 0 ], te[ 1 ], te[ 2 ] ).length();\r\n\t\tconst sy = _v1.set( te[ 4 ], te[ 5 ], te[ 6 ] ).length();\r\n\t\tconst sz = _v1.set( te[ 8 ], te[ 9 ], te[ 10 ] ).length();\r\n\r\n\t\t// if determine is negative, we need to invert one scale\r\n\t\tconst det = this.determinant();\r\n\t\tif ( det < 0 ) sx = - sx;\r\n\r\n\t\tposition.x = te[ 12 ];\r\n\t\tposition.y = te[ 13 ];\r\n\t\tposition.z = te[ 14 ];\r\n\r\n\t\t// scale the rotation part\r\n\t\t_m1.copy( this );\r\n\r\n\t\tconst invSX = 1 / sx;\r\n\t\tconst invSY = 1 / sy;\r\n\t\tconst invSZ = 1 / sz;\r\n\r\n\t\t_m1.elements[ 0 ] *= invSX;\r\n\t\t_m1.elements[ 1 ] *= invSX;\r\n\t\t_m1.elements[ 2 ] *= invSX;\r\n\r\n\t\t_m1.elements[ 4 ] *= invSY;\r\n\t\t_m1.elements[ 5 ] *= invSY;\r\n\t\t_m1.elements[ 6 ] *= invSY;\r\n\r\n\t\t_m1.elements[ 8 ] *= invSZ;\r\n\t\t_m1.elements[ 9 ] *= invSZ;\r\n\t\t_m1.elements[ 10 ] *= invSZ;\r\n\r\n\t\tquaternion.setFromRotationMatrix( _m1 );\r\n\r\n\t\tscale.x = sx;\r\n\t\tscale.y = sy;\r\n\t\tscale.z = sz;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakePerspective( left, right, top, bottom, near, far ) {\r\n\r\n\t\tif ( far === undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst x = 2 * near / ( right - left );\r\n\t\tconst y = 2 * near / ( top - bottom );\r\n\r\n\t\tconst a = ( right + left ) / ( right - left );\r\n\t\tconst b = ( top + bottom ) / ( top - bottom );\r\n\t\tconst c = - ( far + near ) / ( far - near );\r\n\t\tconst d = - 2 * far * near / ( far - near );\r\n\r\n\t\tte[ 0 ] = x;\tte[ 4 ] = 0;\tte[ 8 ] = a;\tte[ 12 ] = 0;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = y;\tte[ 9 ] = b;\tte[ 13 ] = 0;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = c;\tte[ 14 ] = d;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = - 1;\tte[ 15 ] = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeOrthographic( left, right, top, bottom, near, far ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst w = 1.0 / ( right - left );\r\n\t\tconst h = 1.0 / ( top - bottom );\r\n\t\tconst p = 1.0 / ( far - near );\r\n\r\n\t\tconst x = ( right + left ) * w;\r\n\t\tconst y = ( top + bottom ) * h;\r\n\t\tconst z = ( far + near ) * p;\r\n\r\n\t\tte[ 0 ] = 2 * w;\tte[ 4 ] = 0;\tte[ 8 ] = 0;\tte[ 12 ] = - x;\r\n\t\tte[ 1 ] = 0;\tte[ 5 ] = 2 * h;\tte[ 9 ] = 0;\tte[ 13 ] = - y;\r\n\t\tte[ 2 ] = 0;\tte[ 6 ] = 0;\tte[ 10 ] = - 2 * p;\tte[ 14 ] = - z;\r\n\t\tte[ 3 ] = 0;\tte[ 7 ] = 0;\tte[ 11 ] = 0;\tte[ 15 ] = 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( matrix ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst me = matrix.elements;\r\n\r\n\t\tfor ( let i = 0; i < 16; i ++ ) {\r\n\r\n\t\t\tif ( te[ i ] !== me[ i ] ) return false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tfor ( let i = 0; i < 16; i ++ ) {\r\n\r\n\t\t\tthis.elements[ i ] = array[ i + offset ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tarray[ offset ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\r\n\t\tarray[ offset + 8 ] = te[ 8 ];\r\n\t\tarray[ offset + 9 ] = te[ 9 ];\r\n\t\tarray[ offset + 10 ] = te[ 10 ];\r\n\t\tarray[ offset + 11 ] = te[ 11 ];\r\n\r\n\t\tarray[ offset + 12 ] = te[ 12 ];\r\n\t\tarray[ offset + 13 ] = te[ 13 ];\r\n\t\tarray[ offset + 14 ] = te[ 14 ];\r\n\t\tarray[ offset + 15 ] = te[ 15 ];\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMatrix4.prototype.isMatrix4 = true;\r\n\r\nconst _v1 = /*@__PURE__*/ new Vector3();\r\nconst _m1 = /*@__PURE__*/ new Matrix4();\r\nconst _zero = /*@__PURE__*/ new Vector3( 0, 0, 0 );\r\nconst _one = /*@__PURE__*/ new Vector3( 1, 1, 1 );\r\nconst _x = /*@__PURE__*/ new Vector3();\r\nconst _y = /*@__PURE__*/ new Vector3();\r\nconst _z = /*@__PURE__*/ new Vector3();\r\n\r\nexport { Matrix4 };\r\n", "/**\r\n * https://github.com/mrdoob/eventdispatcher.js/\r\n */\r\n\r\nclass EventDispatcher {\r\n\r\n\taddEventListener( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) this._listeners = {};\r\n\r\n\t\tconst listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] === undefined ) {\r\n\r\n\t\t\tlisteners[ type ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tif ( listeners[ type ].indexOf( listener ) === - 1 ) {\r\n\r\n\t\t\tlisteners[ type ].push( listener );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\thasEventListener( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return false;\r\n\r\n\t\tconst listeners = this._listeners;\r\n\r\n\t\treturn listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1;\r\n\r\n\t}\r\n\r\n\tremoveEventListener( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tconst listeners = this._listeners;\r\n\t\tconst listenerArray = listeners[ type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tconst index = listenerArray.indexOf( listener );\r\n\r\n\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\tlistenerArray.splice( index, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdispatchEvent( event ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tconst listeners = this._listeners;\r\n\t\tconst listenerArray = listeners[ event.type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tevent.target = this;\r\n\r\n\t\t\t// Make a copy, in case listeners are removed while iterating.\r\n\t\t\tconst array = listenerArray.slice( 0 );\r\n\r\n\t\t\tfor ( let i = 0, l = array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ].call( this, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tevent.target = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { EventDispatcher };\r\n", "import { Quaternion } from './Quaternion.js';\r\nimport { Vector3 } from './Vector3.js';\r\nimport { Matrix4 } from './Matrix4.js';\r\nimport { clamp } from './MathUtils.js';\r\n\r\nconst _matrix = /*@__PURE__*/ new Matrix4();\r\nconst _quaternion = /*@__PURE__*/ new Quaternion();\r\n\r\nclass Euler {\r\n\r\n\tconstructor( x = 0, y = 0, z = 0, order = Euler.DefaultOrder ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._order = order;\r\n\r\n\t}\r\n\r\n\tget x() {\r\n\r\n\t\treturn this._x;\r\n\r\n\t}\r\n\r\n\tset x( value ) {\r\n\r\n\t\tthis._x = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget y() {\r\n\r\n\t\treturn this._y;\r\n\r\n\t}\r\n\r\n\tset y( value ) {\r\n\r\n\t\tthis._y = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget z() {\r\n\r\n\t\treturn this._z;\r\n\r\n\t}\r\n\r\n\tset z( value ) {\r\n\r\n\t\tthis._z = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tget order() {\r\n\r\n\t\treturn this._order;\r\n\r\n\t}\r\n\r\n\tset order( value ) {\r\n\r\n\t\tthis._order = value;\r\n\t\tthis._onChangeCallback();\r\n\r\n\t}\r\n\r\n\tset( x, y, z, order = this._order ) {\r\n\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._order = order;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this._x, this._y, this._z, this._order );\r\n\r\n\t}\r\n\r\n\tcopy( euler ) {\r\n\r\n\t\tthis._x = euler._x;\r\n\t\tthis._y = euler._y;\r\n\t\tthis._z = euler._z;\r\n\t\tthis._order = euler._order;\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromRotationMatrix( m, order = this._order, update = true ) {\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tconst te = m.elements;\r\n\t\tconst m11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ];\r\n\t\tconst m21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ];\r\n\t\tconst m31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\tswitch ( order ) {\r\n\r\n\t\t\tcase 'XYZ':\r\n\r\n\t\t\t\tthis._y = Math.asin( clamp( m13, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m13 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\t\tthis._z = Math.atan2( - m12, m11 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'YXZ':\r\n\r\n\t\t\t\tthis._x = Math.asin( - clamp( m23, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m23 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\t\t\t\t\tthis._z = Math.atan2( m21, m22 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\t\t\t\t\tthis._z = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ZXY':\r\n\r\n\t\t\t\tthis._x = Math.asin( clamp( m32, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m32 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._y = Math.atan2( - m31, m33 );\r\n\t\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._y = 0;\r\n\t\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ZYX':\r\n\r\n\t\t\t\tthis._y = Math.asin( - clamp( m31, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m31 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( m32, m33 );\r\n\t\t\t\t\tthis._z = Math.atan2( m21, m11 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._x = 0;\r\n\t\t\t\t\tthis._z = Math.atan2( - m12, m22 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'YZX':\r\n\r\n\t\t\t\tthis._z = Math.asin( clamp( m21, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m21 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( - m23, m22 );\r\n\t\t\t\t\tthis._y = Math.atan2( - m31, m11 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._x = 0;\r\n\t\t\t\t\tthis._y = Math.atan2( m13, m33 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'XZY':\r\n\r\n\t\t\t\tthis._z = Math.asin( - clamp( m12, - 1, 1 ) );\r\n\r\n\t\t\t\tif ( Math.abs( m12 ) < 0.9999999 ) {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( m32, m22 );\r\n\t\t\t\t\tthis._y = Math.atan2( m13, m11 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis._x = Math.atan2( - m23, m33 );\r\n\t\t\t\t\tthis._y = 0;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Euler: .setFromRotationMatrix() encountered an unknown order: ' + order );\r\n\r\n\t\t}\r\n\r\n\t\tthis._order = order;\r\n\r\n\t\tif ( update === true ) this._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromQuaternion( q, order, update ) {\r\n\r\n\t\t_matrix.makeRotationFromQuaternion( q );\r\n\r\n\t\treturn this.setFromRotationMatrix( _matrix, order, update );\r\n\r\n\t}\r\n\r\n\tsetFromVector3( v, order = this._order ) {\r\n\r\n\t\treturn this.set( v.x, v.y, v.z, order );\r\n\r\n\t}\r\n\r\n\treorder( newOrder ) {\r\n\r\n\t\t// WARNING: this discards revolution information -bhouston\r\n\r\n\t\t_quaternion.setFromEuler( this );\r\n\r\n\t\treturn this.setFromQuaternion( _quaternion, newOrder );\r\n\r\n\t}\r\n\r\n\tequals( euler ) {\r\n\r\n\t\treturn ( euler._x === this._x ) && ( euler._y === this._y ) && ( euler._z === this._z ) && ( euler._order === this._order );\r\n\r\n\t}\r\n\r\n\tfromArray( array ) {\r\n\r\n\t\tthis._x = array[ 0 ];\r\n\t\tthis._y = array[ 1 ];\r\n\t\tthis._z = array[ 2 ];\r\n\t\tif ( array[ 3 ] !== undefined ) this._order = array[ 3 ];\r\n\r\n\t\tthis._onChangeCallback();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this._x;\r\n\t\tarray[ offset + 1 ] = this._y;\r\n\t\tarray[ offset + 2 ] = this._z;\r\n\t\tarray[ offset + 3 ] = this._order;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\ttoVector3( optionalResult ) {\r\n\r\n\t\tif ( optionalResult ) {\r\n\r\n\t\t\treturn optionalResult.set( this._x, this._y, this._z );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn new Vector3( this._x, this._y, this._z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t_onChange( callback ) {\r\n\r\n\t\tthis._onChangeCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t_onChangeCallback() {}\r\n\r\n}\r\n\r\nEuler.prototype.isEuler = true;\r\n\r\nEuler.DefaultOrder = 'XYZ';\r\nEuler.RotationOrders = [ 'XYZ', 'YZX', 'ZXY', 'XZY', 'YXZ', 'ZYX' ];\r\n\r\nexport { Euler };\r\n", "class Layers {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.mask = 1 | 0;\r\n\r\n\t}\r\n\r\n\tset( channel ) {\r\n\r\n\t\tthis.mask = 1 << channel | 0;\r\n\r\n\t}\r\n\r\n\tenable( channel ) {\r\n\r\n\t\tthis.mask |= 1 << channel | 0;\r\n\r\n\t}\r\n\r\n\tenableAll() {\r\n\r\n\t\tthis.mask = 0xffffffff | 0;\r\n\r\n\t}\r\n\r\n\ttoggle( channel ) {\r\n\r\n\t\tthis.mask ^= 1 << channel | 0;\r\n\r\n\t}\r\n\r\n\tdisable( channel ) {\r\n\r\n\t\tthis.mask &= ~ ( 1 << channel | 0 );\r\n\r\n\t}\r\n\r\n\tdisableAll() {\r\n\r\n\t\tthis.mask = 0;\r\n\r\n\t}\r\n\r\n\ttest( layers ) {\r\n\r\n\t\treturn ( this.mask & layers.mask ) !== 0;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { Layers };\r\n", "class Matrix3 {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.elements = [\r\n\r\n\t\t\t1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 0, 1\r\n\r\n\t\t];\r\n\r\n\t\tif ( arguments.length > 0 ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tset( n11, n12, n13, n21, n22, n23, n31, n32, n33 ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] = n11; te[ 1 ] = n21; te[ 2 ] = n31;\r\n\t\tte[ 3 ] = n12; te[ 4 ] = n22; te[ 5 ] = n32;\r\n\t\tte[ 6 ] = n13; te[ 7 ] = n23; te[ 8 ] = n33;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tidentity() {\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\t1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 0, 1\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( m ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst me = m.elements;\r\n\r\n\t\tte[ 0 ] = me[ 0 ]; te[ 1 ] = me[ 1 ]; te[ 2 ] = me[ 2 ];\r\n\t\tte[ 3 ] = me[ 3 ]; te[ 4 ] = me[ 4 ]; te[ 5 ] = me[ 5 ];\r\n\t\tte[ 6 ] = me[ 6 ]; te[ 7 ] = me[ 7 ]; te[ 8 ] = me[ 8 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\textractBasis( xAxis, yAxis, zAxis ) {\r\n\r\n\t\txAxis.setFromMatrix3Column( this, 0 );\r\n\t\tyAxis.setFromMatrix3Column( this, 1 );\r\n\t\tzAxis.setFromMatrix3Column( this, 2 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromMatrix4( m ) {\r\n\r\n\t\tconst me = m.elements;\r\n\r\n\t\tthis.set(\r\n\r\n\t\t\tme[ 0 ], me[ 4 ], me[ 8 ],\r\n\t\t\tme[ 1 ], me[ 5 ], me[ 9 ],\r\n\t\t\tme[ 2 ], me[ 6 ], me[ 10 ]\r\n\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( m ) {\r\n\r\n\t\treturn this.multiplyMatrices( this, m );\r\n\r\n\t}\r\n\r\n\tpremultiply( m ) {\r\n\r\n\t\treturn this.multiplyMatrices( m, this );\r\n\r\n\t}\r\n\r\n\tmultiplyMatrices( a, b ) {\r\n\r\n\t\tconst ae = a.elements;\r\n\t\tconst be = b.elements;\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst a11 = ae[ 0 ], a12 = ae[ 3 ], a13 = ae[ 6 ];\r\n\t\tconst a21 = ae[ 1 ], a22 = ae[ 4 ], a23 = ae[ 7 ];\r\n\t\tconst a31 = ae[ 2 ], a32 = ae[ 5 ], a33 = ae[ 8 ];\r\n\r\n\t\tconst b11 = be[ 0 ], b12 = be[ 3 ], b13 = be[ 6 ];\r\n\t\tconst b21 = be[ 1 ], b22 = be[ 4 ], b23 = be[ 7 ];\r\n\t\tconst b31 = be[ 2 ], b32 = be[ 5 ], b33 = be[ 8 ];\r\n\r\n\t\tte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31;\r\n\t\tte[ 3 ] = a11 * b12 + a12 * b22 + a13 * b32;\r\n\t\tte[ 6 ] = a11 * b13 + a12 * b23 + a13 * b33;\r\n\r\n\t\tte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31;\r\n\t\tte[ 4 ] = a21 * b12 + a22 * b22 + a23 * b32;\r\n\t\tte[ 7 ] = a21 * b13 + a22 * b23 + a23 * b33;\r\n\r\n\t\tte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31;\r\n\t\tte[ 5 ] = a31 * b12 + a32 * b22 + a33 * b32;\r\n\t\tte[ 8 ] = a31 * b13 + a32 * b23 + a33 * b33;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( s ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] *= s; te[ 3 ] *= s; te[ 6 ] *= s;\r\n\t\tte[ 1 ] *= s; te[ 4 ] *= s; te[ 7 ] *= s;\r\n\t\tte[ 2 ] *= s; te[ 5 ] *= s; te[ 8 ] *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdeterminant() {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst a = te[ 0 ], b = te[ 1 ], c = te[ 2 ],\r\n\t\t\td = te[ 3 ], e = te[ 4 ], f = te[ 5 ],\r\n\t\t\tg = te[ 6 ], h = te[ 7 ], i = te[ 8 ];\r\n\r\n\t\treturn a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\r\n\r\n\t}\r\n\r\n\tinvert() {\r\n\r\n\t\tconst te = this.elements,\r\n\r\n\t\t\tn11 = te[ 0 ], n21 = te[ 1 ], n31 = te[ 2 ],\r\n\t\t\tn12 = te[ 3 ], n22 = te[ 4 ], n32 = te[ 5 ],\r\n\t\t\tn13 = te[ 6 ], n23 = te[ 7 ], n33 = te[ 8 ],\r\n\r\n\t\t\tt11 = n33 * n22 - n32 * n23,\r\n\t\t\tt12 = n32 * n13 - n33 * n12,\r\n\t\t\tt13 = n23 * n12 - n22 * n13,\r\n\r\n\t\t\tdet = n11 * t11 + n21 * t12 + n31 * t13;\r\n\r\n\t\tif ( det === 0 ) return this.set( 0, 0, 0, 0, 0, 0, 0, 0, 0 );\r\n\r\n\t\tconst detInv = 1 / det;\r\n\r\n\t\tte[ 0 ] = t11 * detInv;\r\n\t\tte[ 1 ] = ( n31 * n23 - n33 * n21 ) * detInv;\r\n\t\tte[ 2 ] = ( n32 * n21 - n31 * n22 ) * detInv;\r\n\r\n\t\tte[ 3 ] = t12 * detInv;\r\n\t\tte[ 4 ] = ( n33 * n11 - n31 * n13 ) * detInv;\r\n\t\tte[ 5 ] = ( n31 * n12 - n32 * n11 ) * detInv;\r\n\r\n\t\tte[ 6 ] = t13 * detInv;\r\n\t\tte[ 7 ] = ( n21 * n13 - n23 * n11 ) * detInv;\r\n\t\tte[ 8 ] = ( n22 * n11 - n21 * n12 ) * detInv;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranspose() {\r\n\r\n\t\tlet tmp;\r\n\t\tconst m = this.elements;\r\n\r\n\t\ttmp = m[ 1 ]; m[ 1 ] = m[ 3 ]; m[ 3 ] = tmp;\r\n\t\ttmp = m[ 2 ]; m[ 2 ] = m[ 6 ]; m[ 6 ] = tmp;\r\n\t\ttmp = m[ 5 ]; m[ 5 ] = m[ 7 ]; m[ 7 ] = tmp;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetNormalMatrix( matrix4 ) {\r\n\r\n\t\treturn this.setFromMatrix4( matrix4 ).invert().transpose();\r\n\r\n\t}\r\n\r\n\ttransposeIntoArray( r ) {\r\n\r\n\t\tconst m = this.elements;\r\n\r\n\t\tr[ 0 ] = m[ 0 ];\r\n\t\tr[ 1 ] = m[ 3 ];\r\n\t\tr[ 2 ] = m[ 6 ];\r\n\t\tr[ 3 ] = m[ 1 ];\r\n\t\tr[ 4 ] = m[ 4 ];\r\n\t\tr[ 5 ] = m[ 7 ];\r\n\t\tr[ 6 ] = m[ 2 ];\r\n\t\tr[ 7 ] = m[ 5 ];\r\n\t\tr[ 8 ] = m[ 8 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetUvTransform( tx, ty, sx, sy, rotation, cx, cy ) {\r\n\r\n\t\tconst c = Math.cos( rotation );\r\n\t\tconst s = Math.sin( rotation );\r\n\r\n\t\tthis.set(\r\n\t\t\tsx * c, sx * s, - sx * ( c * cx + s * cy ) + cx + tx,\r\n\t\t\t- sy * s, sy * c, - sy * ( - s * cx + c * cy ) + cy + ty,\r\n\t\t\t0, 0, 1\r\n\t\t);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tscale( sx, sy ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] *= sx; te[ 3 ] *= sx; te[ 6 ] *= sx;\r\n\t\tte[ 1 ] *= sy; te[ 4 ] *= sy; te[ 7 ] *= sy;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotate( theta ) {\r\n\r\n\t\tconst c = Math.cos( theta );\r\n\t\tconst s = Math.sin( theta );\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tconst a11 = te[ 0 ], a12 = te[ 3 ], a13 = te[ 6 ];\r\n\t\tconst a21 = te[ 1 ], a22 = te[ 4 ], a23 = te[ 7 ];\r\n\r\n\t\tte[ 0 ] = c * a11 + s * a21;\r\n\t\tte[ 3 ] = c * a12 + s * a22;\r\n\t\tte[ 6 ] = c * a13 + s * a23;\r\n\r\n\t\tte[ 1 ] = - s * a11 + c * a21;\r\n\t\tte[ 4 ] = - s * a12 + c * a22;\r\n\t\tte[ 7 ] = - s * a13 + c * a23;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslate( tx, ty ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tte[ 0 ] += tx * te[ 2 ]; te[ 3 ] += tx * te[ 5 ]; te[ 6 ] += tx * te[ 8 ];\r\n\t\tte[ 1 ] += ty * te[ 2 ]; te[ 4 ] += ty * te[ 5 ]; te[ 7 ] += ty * te[ 8 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( matrix ) {\r\n\r\n\t\tconst te = this.elements;\r\n\t\tconst me = matrix.elements;\r\n\r\n\t\tfor ( let i = 0; i < 9; i ++ ) {\r\n\r\n\t\t\tif ( te[ i ] !== me[ i ] ) return false;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tfor ( let i = 0; i < 9; i ++ ) {\r\n\r\n\t\t\tthis.elements[ i ] = array[ i + offset ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tconst te = this.elements;\r\n\r\n\t\tarray[ offset ] = te[ 0 ];\r\n\t\tarray[ offset + 1 ] = te[ 1 ];\r\n\t\tarray[ offset + 2 ] = te[ 2 ];\r\n\r\n\t\tarray[ offset + 3 ] = te[ 3 ];\r\n\t\tarray[ offset + 4 ] = te[ 4 ];\r\n\t\tarray[ offset + 5 ] = te[ 5 ];\r\n\r\n\t\tarray[ offset + 6 ] = te[ 6 ];\r\n\t\tarray[ offset + 7 ] = te[ 7 ];\r\n\t\tarray[ offset + 8 ] = te[ 8 ];\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().fromArray( this.elements );\r\n\r\n\t}\r\n\r\n}\r\n\r\nMatrix3.prototype.isMatrix3 = true;\r\n\r\nexport { Matrix3 };\r\n", "import { Quaternion } from '../math/Quaternion.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\nimport { EventDispatcher } from './EventDispatcher.js';\r\nimport { Euler } from '../math/Euler.js';\r\nimport { Layers } from './Layers.js';\r\nimport { Matrix3 } from '../math/Matrix3.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\n\r\nlet _object3DId = 0;\r\n\r\nconst _v1 = /*@__PURE__*/ new Vector3();\r\nconst _q1 = /*@__PURE__*/ new Quaternion();\r\nconst _m1 = /*@__PURE__*/ new Matrix4();\r\nconst _target = /*@__PURE__*/ new Vector3();\r\n\r\nconst _position = /*@__PURE__*/ new Vector3();\r\nconst _scale = /*@__PURE__*/ new Vector3();\r\nconst _quaternion = /*@__PURE__*/ new Quaternion();\r\n\r\nconst _xAxis = /*@__PURE__*/ new Vector3( 1, 0, 0 );\r\nconst _yAxis = /*@__PURE__*/ new Vector3( 0, 1, 0 );\r\nconst _zAxis = /*@__PURE__*/ new Vector3( 0, 0, 1 );\r\n\r\nconst _addedEvent = { type: 'added' };\r\nconst _removedEvent = { type: 'removed' };\r\n\r\nclass Object3D extends EventDispatcher {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tObject.defineProperty( this, 'id', { value: _object3DId ++ } );\r\n\r\n\t\tthis.uuid = MathUtils.generateUUID();\r\n\r\n\t\tthis.name = '';\r\n\t\tthis.type = 'Object3D';\r\n\r\n\t\tthis.parent = null;\r\n\t\tthis.children = [];\r\n\r\n\t\tthis.up = Object3D.DefaultUp.clone();\r\n\r\n\t\tconst position = new Vector3();\r\n\t\tconst rotation = new Euler();\r\n\t\tconst quaternion = new Quaternion();\r\n\t\tconst scale = new Vector3( 1, 1, 1 );\r\n\r\n\t\tfunction onRotationChange() {\r\n\r\n\t\t\tquaternion.setFromEuler( rotation, false );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onQuaternionChange() {\r\n\r\n\t\t\trotation.setFromQuaternion( quaternion, undefined, false );\r\n\r\n\t\t}\r\n\r\n\t\trotation._onChange( onRotationChange );\r\n\t\tquaternion._onChange( onQuaternionChange );\r\n\r\n\t\tObject.defineProperties( this, {\r\n\t\t\tposition: {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tvalue: position\r\n\t\t\t},\r\n\t\t\trotation: {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tvalue: rotation\r\n\t\t\t},\r\n\t\t\tquaternion: {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tvalue: quaternion\r\n\t\t\t},\r\n\t\t\tscale: {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tvalue: scale\r\n\t\t\t},\r\n\t\t\tmodelViewMatrix: {\r\n\t\t\t\tvalue: new Matrix4()\r\n\t\t\t},\r\n\t\t\tnormalMatrix: {\r\n\t\t\t\tvalue: new Matrix3()\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tthis.matrix = new Matrix4();\r\n\t\tthis.matrixWorld = new Matrix4();\r\n\r\n\t\tthis.matrixAutoUpdate = Object3D.DefaultMatrixAutoUpdate;\r\n\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\tthis.layers = new Layers();\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.castShadow = false;\r\n\t\tthis.receiveShadow = false;\r\n\r\n\t\tthis.frustumCulled = true;\r\n\t\tthis.renderOrder = 0;\r\n\r\n\t\tthis.animations = [];\r\n\r\n\t\tthis.userData = {};\r\n\r\n\t}\r\n\r\n\tonBeforeRender() {}\r\n\tonAfterRender() {}\r\n\r\n\tapplyMatrix4( matrix ) {\r\n\r\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\r\n\r\n\t\tthis.matrix.premultiply( matrix );\r\n\r\n\t\tthis.matrix.decompose( this.position, this.quaternion, this.scale );\r\n\r\n\t}\r\n\r\n\tapplyQuaternion( q ) {\r\n\r\n\t\tthis.quaternion.premultiply( q );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetRotationFromAxisAngle( axis, angle ) {\r\n\r\n\t\t// assumes axis is normalized\r\n\r\n\t\tthis.quaternion.setFromAxisAngle( axis, angle );\r\n\r\n\t}\r\n\r\n\tsetRotationFromEuler( euler ) {\r\n\r\n\t\tthis.quaternion.setFromEuler( euler, true );\r\n\r\n\t}\r\n\r\n\tsetRotationFromMatrix( m ) {\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( m );\r\n\r\n\t}\r\n\r\n\tsetRotationFromQuaternion( q ) {\r\n\r\n\t\t// assumes q is normalized\r\n\r\n\t\tthis.quaternion.copy( q );\r\n\r\n\t}\r\n\r\n\trotateOnAxis( axis, angle ) {\r\n\r\n\t\t// rotate object on axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\t_q1.setFromAxisAngle( axis, angle );\r\n\r\n\t\tthis.quaternion.multiply( _q1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateOnWorldAxis( axis, angle ) {\r\n\r\n\t\t// rotate object on axis in world space\r\n\t\t// axis is assumed to be normalized\r\n\t\t// method assumes no rotated parent\r\n\r\n\t\t_q1.setFromAxisAngle( axis, angle );\r\n\r\n\t\tthis.quaternion.premultiply( _q1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateX( angle ) {\r\n\r\n\t\treturn this.rotateOnAxis( _xAxis, angle );\r\n\r\n\t}\r\n\r\n\trotateY( angle ) {\r\n\r\n\t\treturn this.rotateOnAxis( _yAxis, angle );\r\n\r\n\t}\r\n\r\n\trotateZ( angle ) {\r\n\r\n\t\treturn this.rotateOnAxis( _zAxis, angle );\r\n\r\n\t}\r\n\r\n\ttranslateOnAxis( axis, distance ) {\r\n\r\n\t\t// translate object by distance along axis in object space\r\n\t\t// axis is assumed to be normalized\r\n\r\n\t\t_v1.copy( axis ).applyQuaternion( this.quaternion );\r\n\r\n\t\tthis.position.add( _v1.multiplyScalar( distance ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslateX( distance ) {\r\n\r\n\t\treturn this.translateOnAxis( _xAxis, distance );\r\n\r\n\t}\r\n\r\n\ttranslateY( distance ) {\r\n\r\n\t\treturn this.translateOnAxis( _yAxis, distance );\r\n\r\n\t}\r\n\r\n\ttranslateZ( distance ) {\r\n\r\n\t\treturn this.translateOnAxis( _zAxis, distance );\r\n\r\n\t}\r\n\r\n\tlocalToWorld( vector ) {\r\n\r\n\t\treturn vector.applyMatrix4( this.matrixWorld );\r\n\r\n\t}\r\n\r\n\tworldToLocal( vector ) {\r\n\r\n\t\treturn vector.applyMatrix4( _m1.copy( this.matrixWorld ).invert() );\r\n\r\n\t}\r\n\r\n\tlookAt( x, y, z ) {\r\n\r\n\t\t// This method does not support objects having non-uniformly-scaled parent(s)\r\n\r\n\t\tif ( x.isVector3 ) {\r\n\r\n\t\t\t_target.copy( x );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_target.set( x, y, z );\r\n\r\n\t\t}\r\n\r\n\t\tconst parent = this.parent;\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\t_position.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t\tif ( this.isCamera || this.isLight ) {\r\n\r\n\t\t\t_m1.lookAt( _position, _target, this.up );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_m1.lookAt( _target, _position, this.up );\r\n\r\n\t\t}\r\n\r\n\t\tthis.quaternion.setFromRotationMatrix( _m1 );\r\n\r\n\t\tif ( parent ) {\r\n\r\n\t\t\t_m1.extractRotation( parent.matrixWorld );\r\n\t\t\t_q1.setFromRotationMatrix( _m1 );\r\n\t\t\tthis.quaternion.premultiply( _q1.invert() );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tadd( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( let i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.add( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tif ( object === this ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Object3D.add: object can\\'t be added as a child of itself.', object );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tif ( object && object.isObject3D ) {\r\n\r\n\t\t\tif ( object.parent !== null ) {\r\n\r\n\t\t\t\tobject.parent.remove( object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tobject.parent = this;\r\n\t\t\tthis.children.push( object );\r\n\r\n\t\t\tobject.dispatchEvent( _addedEvent );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( 'THREE.Object3D.add: object not an instance of THREE.Object3D.', object );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tremove( object ) {\r\n\r\n\t\tif ( arguments.length > 1 ) {\r\n\r\n\t\t\tfor ( let i = 0; i < arguments.length; i ++ ) {\r\n\r\n\t\t\t\tthis.remove( arguments[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tconst index = this.children.indexOf( object );\r\n\r\n\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\tobject.parent = null;\r\n\t\t\tthis.children.splice( index, 1 );\r\n\r\n\t\t\tobject.dispatchEvent( _removedEvent );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tremoveFromParent() {\r\n\r\n\t\tconst parent = this.parent;\r\n\r\n\t\tif ( parent !== null ) {\r\n\r\n\t\t\tparent.remove( this );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\tfor ( let i = 0; i < this.children.length; i ++ ) {\r\n\r\n\t\t\tconst object = this.children[ i ];\r\n\r\n\t\t\tobject.parent = null;\r\n\r\n\t\t\tobject.dispatchEvent( _removedEvent );\r\n\r\n\t\t}\r\n\r\n\t\tthis.children.length = 0;\r\n\r\n\t\treturn this;\r\n\r\n\r\n\t}\r\n\r\n\tattach( object ) {\r\n\r\n\t\t// adds object as a child of this, while maintaining the object's world transform\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\t_m1.copy( this.matrixWorld ).invert();\r\n\r\n\t\tif ( object.parent !== null ) {\r\n\r\n\t\t\tobject.parent.updateWorldMatrix( true, false );\r\n\r\n\t\t\t_m1.multiply( object.parent.matrixWorld );\r\n\r\n\t\t}\r\n\r\n\t\tobject.applyMatrix4( _m1 );\r\n\r\n\t\tthis.add( object );\r\n\r\n\t\tobject.updateWorldMatrix( false, true );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetObjectById( id ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'id', id );\r\n\r\n\t}\r\n\r\n\tgetObjectByName( name ) {\r\n\r\n\t\treturn this.getObjectByProperty( 'name', name );\r\n\r\n\t}\r\n\r\n\tgetObjectByProperty( name, value ) {\r\n\r\n\t\tif ( this[ name ] === value ) return this;\r\n\r\n\t\tfor ( let i = 0, l = this.children.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst child = this.children[ i ];\r\n\t\t\tconst object = child.getObjectByProperty( name, value );\r\n\r\n\t\t\tif ( object !== undefined ) {\r\n\r\n\t\t\t\treturn object;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\r\n\t}\r\n\r\n\tgetWorldPosition( target ) {\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\treturn target.setFromMatrixPosition( this.matrixWorld );\r\n\r\n\t}\r\n\r\n\tgetWorldQuaternion( target ) {\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\tthis.matrixWorld.decompose( _position, target, _scale );\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tgetWorldScale( target ) {\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\tthis.matrixWorld.decompose( _position, _quaternion, target );\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tgetWorldDirection( target ) {\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\tconst e = this.matrixWorld.elements;\r\n\r\n\t\treturn target.set( e[ 8 ], e[ 9 ], e[ 10 ] ).normalize();\r\n\r\n\t}\r\n\r\n\traycast() {}\r\n\r\n\ttraverse( callback ) {\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tconst children = this.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tchildren[ i ].traverse( callback );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttraverseVisible( callback ) {\r\n\r\n\t\tif ( this.visible === false ) return;\r\n\r\n\t\tcallback( this );\r\n\r\n\t\tconst children = this.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tchildren[ i ].traverseVisible( callback );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttraverseAncestors( callback ) {\r\n\r\n\t\tconst parent = this.parent;\r\n\r\n\t\tif ( parent !== null ) {\r\n\r\n\t\t\tcallback( parent );\r\n\r\n\t\t\tparent.traverseAncestors( callback );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateMatrix() {\r\n\r\n\t\tthis.matrix.compose( this.position, this.quaternion, this.scale );\r\n\r\n\t\tthis.matrixWorldNeedsUpdate = true;\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( force ) {\r\n\r\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\r\n\r\n\t\tif ( this.matrixWorldNeedsUpdate || force ) {\r\n\r\n\t\t\tif ( this.parent === null ) {\r\n\r\n\t\t\t\tthis.matrixWorld.copy( this.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.matrixWorldNeedsUpdate = false;\r\n\r\n\t\t\tforce = true;\r\n\r\n\t\t}\r\n\r\n\t\t// update children\r\n\r\n\t\tconst children = this.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tchildren[ i ].updateMatrixWorld( force );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateWorldMatrix( updateParents, updateChildren ) {\r\n\r\n\t\tconst parent = this.parent;\r\n\r\n\t\tif ( updateParents === true && parent !== null ) {\r\n\r\n\t\t\tparent.updateWorldMatrix( true, false );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.matrixAutoUpdate ) this.updateMatrix();\r\n\r\n\t\tif ( this.parent === null ) {\r\n\r\n\t\t\tthis.matrixWorld.copy( this.matrix );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.matrixWorld.multiplyMatrices( this.parent.matrixWorld, this.matrix );\r\n\r\n\t\t}\r\n\r\n\t\t// update children\r\n\r\n\t\tif ( updateChildren === true ) {\r\n\r\n\t\t\tconst children = this.children;\r\n\r\n\t\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tchildren[ i ].updateWorldMatrix( false, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\t// meta is a string when called from JSON.stringify\r\n\t\tconst isRootObject = ( meta === undefined || typeof meta === 'string' );\r\n\r\n\t\tconst output = {};\r\n\r\n\t\t// meta is a hash used to collect geometries, materials.\r\n\t\t// not providing it implies that this is the root object\r\n\t\t// being serialized.\r\n\t\tif ( isRootObject ) {\r\n\r\n\t\t\t// initialize meta obj\r\n\t\t\tmeta = {\r\n\t\t\t\tgeometries: {},\r\n\t\t\t\tmaterials: {},\r\n\t\t\t\ttextures: {},\r\n\t\t\t\timages: {},\r\n\t\t\t\tshapes: {},\r\n\t\t\t\tskeletons: {},\r\n\t\t\t\tanimations: {}\r\n\t\t\t};\r\n\r\n\t\t\toutput.metadata = {\r\n\t\t\t\tversion: 4.5,\r\n\t\t\t\ttype: 'Object',\r\n\t\t\t\tgenerator: 'Object3D.toJSON'\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\t// standard Object3D serialization\r\n\r\n\t\tconst object = {};\r\n\r\n\t\tobject.uuid = this.uuid;\r\n\t\tobject.type = this.type;\r\n\r\n\t\tif ( this.name !== '' ) object.name = this.name;\r\n\t\tif ( this.castShadow === true ) object.castShadow = true;\r\n\t\tif ( this.receiveShadow === true ) object.receiveShadow = true;\r\n\t\tif ( this.visible === false ) object.visible = false;\r\n\t\tif ( this.frustumCulled === false ) object.frustumCulled = false;\r\n\t\tif ( this.renderOrder !== 0 ) object.renderOrder = this.renderOrder;\r\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) object.userData = this.userData;\r\n\r\n\t\tobject.layers = this.layers.mask;\r\n\t\tobject.matrix = this.matrix.toArray();\r\n\r\n\t\tif ( this.matrixAutoUpdate === false ) object.matrixAutoUpdate = false;\r\n\r\n\t\t// object specific properties\r\n\r\n\t\tif ( this.isInstancedMesh ) {\r\n\r\n\t\t\tobject.type = 'InstancedMesh';\r\n\t\t\tobject.count = this.count;\r\n\t\t\tobject.instanceMatrix = this.instanceMatrix.toJSON();\r\n\t\t\tif ( this.instanceColor !== null ) object.instanceColor = this.instanceColor.toJSON();\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tfunction serialize( library, element ) {\r\n\r\n\t\t\tif ( library[ element.uuid ] === undefined ) {\r\n\r\n\t\t\t\tlibrary[ element.uuid ] = element.toJSON( meta );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn element.uuid;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.isScene ) {\r\n\r\n\t\t\tif ( this.background ) {\r\n\r\n\t\t\t\tif ( this.background.isColor ) {\r\n\r\n\t\t\t\t\tobject.background = this.background.toJSON();\r\n\r\n\t\t\t\t} else if ( this.background.isTexture ) {\r\n\r\n\t\t\t\t\tobject.background = this.background.toJSON( meta ).uuid;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.environment && this.environment.isTexture ) {\r\n\r\n\t\t\t\tobject.environment = this.environment.toJSON( meta ).uuid;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( this.isMesh || this.isLine || this.isPoints ) {\r\n\r\n\t\t\tobject.geometry = serialize( meta.geometries, this.geometry );\r\n\r\n\t\t\tconst parameters = this.geometry.parameters;\r\n\r\n\t\t\tif ( parameters !== undefined && parameters.shapes !== undefined ) {\r\n\r\n\t\t\t\tconst shapes = parameters.shapes;\r\n\r\n\t\t\t\tif ( Array.isArray( shapes ) ) {\r\n\r\n\t\t\t\t\tfor ( let i = 0, l = shapes.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst shape = shapes[ i ];\r\n\r\n\t\t\t\t\t\tserialize( meta.shapes, shape );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tserialize( meta.shapes, shapes );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.isSkinnedMesh ) {\r\n\r\n\t\t\tobject.bindMode = this.bindMode;\r\n\t\t\tobject.bindMatrix = this.bindMatrix.toArray();\r\n\r\n\t\t\tif ( this.skeleton !== undefined ) {\r\n\r\n\t\t\t\tserialize( meta.skeletons, this.skeleton );\r\n\r\n\t\t\t\tobject.skeleton = this.skeleton.uuid;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.material !== undefined ) {\r\n\r\n\t\t\tif ( Array.isArray( this.material ) ) {\r\n\r\n\t\t\t\tconst uuids = [];\r\n\r\n\t\t\t\tfor ( let i = 0, l = this.material.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\tuuids.push( serialize( meta.materials, this.material[ i ] ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tobject.material = uuids;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tobject.material = serialize( meta.materials, this.material );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( this.children.length > 0 ) {\r\n\r\n\t\t\tobject.children = [];\r\n\r\n\t\t\tfor ( let i = 0; i < this.children.length; i ++ ) {\r\n\r\n\t\t\t\tobject.children.push( this.children[ i ].toJSON( meta ).object );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( this.animations.length > 0 ) {\r\n\r\n\t\t\tobject.animations = [];\r\n\r\n\t\t\tfor ( let i = 0; i < this.animations.length; i ++ ) {\r\n\r\n\t\t\t\tconst animation = this.animations[ i ];\r\n\r\n\t\t\t\tobject.animations.push( serialize( meta.animations, animation ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( isRootObject ) {\r\n\r\n\t\t\tconst geometries = extractFromCache( meta.geometries );\r\n\t\t\tconst materials = extractFromCache( meta.materials );\r\n\t\t\tconst textures = extractFromCache( meta.textures );\r\n\t\t\tconst images = extractFromCache( meta.images );\r\n\t\t\tconst shapes = extractFromCache( meta.shapes );\r\n\t\t\tconst skeletons = extractFromCache( meta.skeletons );\r\n\t\t\tconst animations = extractFromCache( meta.animations );\r\n\r\n\t\t\tif ( geometries.length > 0 ) output.geometries = geometries;\r\n\t\t\tif ( materials.length > 0 ) output.materials = materials;\r\n\t\t\tif ( textures.length > 0 ) output.textures = textures;\r\n\t\t\tif ( images.length > 0 ) output.images = images;\r\n\t\t\tif ( shapes.length > 0 ) output.shapes = shapes;\r\n\t\t\tif ( skeletons.length > 0 ) output.skeletons = skeletons;\r\n\t\t\tif ( animations.length > 0 ) output.animations = animations;\r\n\r\n\t\t}\r\n\r\n\t\toutput.object = object;\r\n\r\n\t\treturn output;\r\n\r\n\t\t// extract data from the cache hash\r\n\t\t// remove metadata on each item\r\n\t\t// and return as array\r\n\t\tfunction extractFromCache( cache ) {\r\n\r\n\t\t\tconst values = [];\r\n\t\t\tfor ( const key in cache ) {\r\n\r\n\t\t\t\tconst data = cache[ key ];\r\n\t\t\t\tdelete data.metadata;\r\n\t\t\t\tvalues.push( data );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn values;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tclone( recursive ) {\r\n\r\n\t\treturn new this.constructor().copy( this, recursive );\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive = true ) {\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\tthis.up.copy( source.up );\r\n\r\n\t\tthis.position.copy( source.position );\r\n\t\tthis.rotation.order = source.rotation.order;\r\n\t\tthis.quaternion.copy( source.quaternion );\r\n\t\tthis.scale.copy( source.scale );\r\n\r\n\t\tthis.matrix.copy( source.matrix );\r\n\t\tthis.matrixWorld.copy( source.matrixWorld );\r\n\r\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\r\n\t\tthis.matrixWorldNeedsUpdate = source.matrixWorldNeedsUpdate;\r\n\r\n\t\tthis.layers.mask = source.layers.mask;\r\n\t\tthis.visible = source.visible;\r\n\r\n\t\tthis.castShadow = source.castShadow;\r\n\t\tthis.receiveShadow = source.receiveShadow;\r\n\r\n\t\tthis.frustumCulled = source.frustumCulled;\r\n\t\tthis.renderOrder = source.renderOrder;\r\n\r\n\t\tthis.userData = JSON.parse( JSON.stringify( source.userData ) );\r\n\r\n\t\tif ( recursive === true ) {\r\n\r\n\t\t\tfor ( let i = 0; i < source.children.length; i ++ ) {\r\n\r\n\t\t\t\tconst child = source.children[ i ];\r\n\t\t\t\tthis.add( child.clone() );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nObject3D.DefaultUp = new Vector3( 0, 1, 0 );\r\nObject3D.DefaultMatrixAutoUpdate = true;\r\n\r\nObject3D.prototype.isObject3D = true;\r\n\r\nexport { Object3D };\r\n", "import { Matrix4 } from '../math/Matrix4.js';\r\nimport { Object3D } from '../core/Object3D.js';\r\n\r\nclass Camera extends Object3D {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Camera';\r\n\r\n\t\tthis.matrixWorldInverse = new Matrix4();\r\n\r\n\t\tthis.projectionMatrix = new Matrix4();\r\n\t\tthis.projectionMatrixInverse = new Matrix4();\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive ) {\r\n\r\n\t\tsuper.copy( source, recursive );\r\n\r\n\t\tthis.matrixWorldInverse.copy( source.matrixWorldInverse );\r\n\r\n\t\tthis.projectionMatrix.copy( source.projectionMatrix );\r\n\t\tthis.projectionMatrixInverse.copy( source.projectionMatrixInverse );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetWorldDirection( target ) {\r\n\r\n\t\tthis.updateWorldMatrix( true, false );\r\n\r\n\t\tconst e = this.matrixWorld.elements;\r\n\r\n\t\treturn target.set( - e[ 8 ], - e[ 9 ], - e[ 10 ] ).normalize();\r\n\r\n\t}\r\n\r\n\tupdateMatrixWorld( force ) {\r\n\r\n\t\tsuper.updateMatrixWorld( force );\r\n\r\n\t\tthis.matrixWorldInverse.copy( this.matrixWorld ).invert();\r\n\r\n\t}\r\n\r\n\tupdateWorldMatrix( updateParents, updateChildren ) {\r\n\r\n\t\tsuper.updateWorldMatrix( updateParents, updateChildren );\r\n\r\n\t\tthis.matrixWorldInverse.copy( this.matrixWorld ).invert();\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nCamera.prototype.isCamera = true;\r\n\r\nexport { Camera };\r\n", "import { Camera } from './Camera.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\n\r\nclass PerspectiveCamera extends Camera {\r\n\r\n\tconstructor( fov = 50, aspect = 1, near = 0.1, far = 2000 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'PerspectiveCamera';\r\n\r\n\t\tthis.fov = fov;\r\n\t\tthis.zoom = 1;\r\n\r\n\t\tthis.near = near;\r\n\t\tthis.far = far;\r\n\t\tthis.focus = 10;\r\n\r\n\t\tthis.aspect = aspect;\r\n\t\tthis.view = null;\r\n\r\n\t\tthis.filmGauge = 35;\t// width of the film (default in millimeters)\r\n\t\tthis.filmOffset = 0;\t// horizontal film offset (same unit as gauge)\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive ) {\r\n\r\n\t\tsuper.copy( source, recursive );\r\n\r\n\t\tthis.fov = source.fov;\r\n\t\tthis.zoom = source.zoom;\r\n\r\n\t\tthis.near = source.near;\r\n\t\tthis.far = source.far;\r\n\t\tthis.focus = source.focus;\r\n\r\n\t\tthis.aspect = source.aspect;\r\n\t\tthis.view = source.view === null ? null : Object.assign( {}, source.view );\r\n\r\n\t\tthis.filmGauge = source.filmGauge;\r\n\t\tthis.filmOffset = source.filmOffset;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the FOV by focal length in respect to the current .filmGauge.\r\n\t *\r\n\t * The default film gauge is 35, so that the focal length can be specified for\r\n\t * a 35mm (full frame) camera.\r\n\t *\r\n\t * Values for focal length and film gauge must have the same unit.\r\n\t */\r\n\tsetFocalLength( focalLength ) {\r\n\r\n\t\t/** see {@link http://www.bobatkins.com/photography/technical/field_of_view.html} */\r\n\t\tconst vExtentSlope = 0.5 * this.getFilmHeight() / focalLength;\r\n\r\n\t\tthis.fov = MathUtils.RAD2DEG * 2 * Math.atan( vExtentSlope );\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates the focal length from the current .fov and .filmGauge.\r\n\t */\r\n\tgetFocalLength() {\r\n\r\n\t\tconst vExtentSlope = Math.tan( MathUtils.DEG2RAD * 0.5 * this.fov );\r\n\r\n\t\treturn 0.5 * this.getFilmHeight() / vExtentSlope;\r\n\r\n\t}\r\n\r\n\tgetEffectiveFOV() {\r\n\r\n\t\treturn MathUtils.RAD2DEG * 2 * Math.atan(\r\n\t\t\tMath.tan( MathUtils.DEG2RAD * 0.5 * this.fov ) / this.zoom );\r\n\r\n\t}\r\n\r\n\tgetFilmWidth() {\r\n\r\n\t\t// film not completely covered in portrait format (aspect < 1)\r\n\t\treturn this.filmGauge * Math.min( this.aspect, 1 );\r\n\r\n\t}\r\n\r\n\tgetFilmHeight() {\r\n\r\n\t\t// film not completely covered in landscape format (aspect > 1)\r\n\t\treturn this.filmGauge / Math.max( this.aspect, 1 );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets an offset in a larger frustum. This is useful for multi-window or\r\n\t * multi-monitor/multi-machine setups.\r\n\t *\r\n\t * For example, if you have 3x2 monitors and each monitor is 1920x1080 and\r\n\t * the monitors are in grid like this\r\n\t *\r\n\t *   +---+---+---+\r\n\t *   | A | B | C |\r\n\t *   +---+---+---+\r\n\t *   | D | E | F |\r\n\t *   +---+---+---+\r\n\t *\r\n\t * then for each monitor you would call it like this\r\n\t *\r\n\t *   const w = 1920;\r\n\t *   const h = 1080;\r\n\t *   const fullWidth = w * 3;\r\n\t *   const fullHeight = h * 2;\r\n\t *\r\n\t *   --A--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 0, w, h );\r\n\t *   --B--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 0, w, h );\r\n\t *   --C--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 0, w, h );\r\n\t *   --D--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 0, h * 1, w, h );\r\n\t *   --E--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 1, h * 1, w, h );\r\n\t *   --F--\r\n\t *   camera.setViewOffset( fullWidth, fullHeight, w * 2, h * 1, w, h );\r\n\t *\r\n\t *   Note there is no reason monitors have to be the same size or in a grid.\r\n\t */\r\n\tsetViewOffset( fullWidth, fullHeight, x, y, width, height ) {\r\n\r\n\t\tthis.aspect = fullWidth / fullHeight;\r\n\r\n\t\tif ( this.view === null ) {\r\n\r\n\t\t\tthis.view = {\r\n\t\t\t\tenabled: true,\r\n\t\t\t\tfullWidth: 1,\r\n\t\t\t\tfullHeight: 1,\r\n\t\t\t\toffsetX: 0,\r\n\t\t\t\toffsetY: 0,\r\n\t\t\t\twidth: 1,\r\n\t\t\t\theight: 1\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tthis.view.enabled = true;\r\n\t\tthis.view.fullWidth = fullWidth;\r\n\t\tthis.view.fullHeight = fullHeight;\r\n\t\tthis.view.offsetX = x;\r\n\t\tthis.view.offsetY = y;\r\n\t\tthis.view.width = width;\r\n\t\tthis.view.height = height;\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tclearViewOffset() {\r\n\r\n\t\tif ( this.view !== null ) {\r\n\r\n\t\t\tthis.view.enabled = false;\r\n\r\n\t\t}\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tupdateProjectionMatrix() {\r\n\r\n\t\tconst near = this.near;\r\n\t\tlet top = near * Math.tan( MathUtils.DEG2RAD * 0.5 * this.fov ) / this.zoom;\r\n\t\tlet height = 2 * top;\r\n\t\tlet width = this.aspect * height;\r\n\t\tlet left = - 0.5 * width;\r\n\t\tconst view = this.view;\r\n\r\n\t\tif ( this.view !== null && this.view.enabled ) {\r\n\r\n\t\t\tconst fullWidth = view.fullWidth,\r\n\t\t\t\tfullHeight = view.fullHeight;\r\n\r\n\t\t\tleft += view.offsetX * width / fullWidth;\r\n\t\t\ttop -= view.offsetY * height / fullHeight;\r\n\t\t\twidth *= view.width / fullWidth;\r\n\t\t\theight *= view.height / fullHeight;\r\n\r\n\t\t}\r\n\r\n\t\tconst skew = this.filmOffset;\r\n\t\tif ( skew !== 0 ) left += near * skew / this.getFilmWidth();\r\n\r\n\t\tthis.projectionMatrix.makePerspective( left, left + width, top, top - height, near, this.far );\r\n\r\n\t\tthis.projectionMatrixInverse.copy( this.projectionMatrix ).invert();\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst data = super.toJSON( meta );\r\n\r\n\t\tdata.object.fov = this.fov;\r\n\t\tdata.object.zoom = this.zoom;\r\n\r\n\t\tdata.object.near = this.near;\r\n\t\tdata.object.far = this.far;\r\n\t\tdata.object.focus = this.focus;\r\n\r\n\t\tdata.object.aspect = this.aspect;\r\n\r\n\t\tif ( this.view !== null ) data.object.view = Object.assign( {}, this.view );\r\n\r\n\t\tdata.object.filmGauge = this.filmGauge;\r\n\t\tdata.object.filmOffset = this.filmOffset;\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nPerspectiveCamera.prototype.isPerspectiveCamera = true;\r\n\r\nexport { PerspectiveCamera };\r\n", "import { Matrix4 } from '../math/Matrix4.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\nimport { PerspectiveCamera } from './PerspectiveCamera.js';\r\n\r\nconst _eyeRight = /*@__PURE__*/ new Matrix4();\r\nconst _eyeLeft = /*@__PURE__*/ new Matrix4();\r\n\r\nclass StereoCamera {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.type = 'StereoCamera';\r\n\r\n\t\tthis.aspect = 1;\r\n\r\n\t\tthis.eyeSep = 0.064;\r\n\r\n\t\tthis.cameraL = new PerspectiveCamera();\r\n\t\tthis.cameraL.layers.enable( 1 );\r\n\t\tthis.cameraL.matrixAutoUpdate = false;\r\n\r\n\t\tthis.cameraR = new PerspectiveCamera();\r\n\t\tthis.cameraR.layers.enable( 2 );\r\n\t\tthis.cameraR.matrixAutoUpdate = false;\r\n\r\n\t\tthis._cache = {\r\n\t\t\tfocus: null,\r\n\t\t\tfov: null,\r\n\t\t\taspect: null,\r\n\t\t\tnear: null,\r\n\t\t\tfar: null,\r\n\t\t\tzoom: null,\r\n\t\t\teyeSep: null\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tupdate( camera ) {\r\n\r\n\t\tconst cache = this._cache;\r\n\r\n\t\tconst needsUpdate = cache.focus !== camera.focus || cache.fov !== camera.fov ||\r\n\t\t\tcache.aspect !== camera.aspect * this.aspect || cache.near !== camera.near ||\r\n\t\t\tcache.far !== camera.far || cache.zoom !== camera.zoom || cache.eyeSep !== this.eyeSep;\r\n\r\n\t\tif ( needsUpdate ) {\r\n\r\n\t\t\tcache.focus = camera.focus;\r\n\t\t\tcache.fov = camera.fov;\r\n\t\t\tcache.aspect = camera.aspect * this.aspect;\r\n\t\t\tcache.near = camera.near;\r\n\t\t\tcache.far = camera.far;\r\n\t\t\tcache.zoom = camera.zoom;\r\n\t\t\tcache.eyeSep = this.eyeSep;\r\n\r\n\t\t\t// Off-axis stereoscopic effect based on\r\n\t\t\t// http://paulbourke.net/stereographics/stereorender/\r\n\r\n\t\t\tconst projectionMatrix = camera.projectionMatrix.clone();\r\n\t\t\tconst eyeSepHalf = cache.eyeSep / 2;\r\n\t\t\tconst eyeSepOnProjection = eyeSepHalf * cache.near / cache.focus;\r\n\t\t\tconst ymax = ( cache.near * Math.tan( MathUtils.DEG2RAD * cache.fov * 0.5 ) ) / cache.zoom;\r\n\t\t\tlet xmin, xmax;\r\n\r\n\t\t\t// translate xOffset\r\n\r\n\t\t\t_eyeLeft.elements[ 12 ] = - eyeSepHalf;\r\n\t\t\t_eyeRight.elements[ 12 ] = eyeSepHalf;\r\n\r\n\t\t\t// for left eye\r\n\r\n\t\t\txmin = - ymax * cache.aspect + eyeSepOnProjection;\r\n\t\t\txmax = ymax * cache.aspect + eyeSepOnProjection;\r\n\r\n\t\t\tprojectionMatrix.elements[ 0 ] = 2 * cache.near / ( xmax - xmin );\r\n\t\t\tprojectionMatrix.elements[ 8 ] = ( xmax + xmin ) / ( xmax - xmin );\r\n\r\n\t\t\tthis.cameraL.projectionMatrix.copy( projectionMatrix );\r\n\r\n\t\t\t// for right eye\r\n\r\n\t\t\txmin = - ymax * cache.aspect - eyeSepOnProjection;\r\n\t\t\txmax = ymax * cache.aspect - eyeSepOnProjection;\r\n\r\n\t\t\tprojectionMatrix.elements[ 0 ] = 2 * cache.near / ( xmax - xmin );\r\n\t\t\tprojectionMatrix.elements[ 8 ] = ( xmax + xmin ) / ( xmax - xmin );\r\n\r\n\t\t\tthis.cameraR.projectionMatrix.copy( projectionMatrix );\r\n\r\n\t\t}\r\n\r\n\t\tthis.cameraL.matrixWorld.copy( camera.matrixWorld ).multiply( _eyeLeft );\r\n\t\tthis.cameraR.matrixWorld.copy( camera.matrixWorld ).multiply( _eyeRight );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { StereoCamera };\r\n", "import { Object3D } from '../core/Object3D.js';\r\n\r\nclass Scene extends Object3D {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Scene';\r\n\r\n\t\tthis.background = null;\r\n\t\tthis.environment = null;\r\n\t\tthis.fog = null;\r\n\r\n\t\tthis.overrideMaterial = null;\r\n\r\n\t\tthis.autoUpdate = true; // checked by the renderer\r\n\r\n\t\tif ( typeof __THREE_DEVTOOLS__ !== 'undefined' ) {\r\n\r\n\t\t\t__THREE_DEVTOOLS__.dispatchEvent( new CustomEvent( 'observe', { detail: this } ) ); // eslint-disable-line no-undef\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive ) {\r\n\r\n\t\tsuper.copy( source, recursive );\r\n\r\n\t\tif ( source.background !== null ) this.background = source.background.clone();\r\n\t\tif ( source.environment !== null ) this.environment = source.environment.clone();\r\n\t\tif ( source.fog !== null ) this.fog = source.fog.clone();\r\n\r\n\t\tif ( source.overrideMaterial !== null ) this.overrideMaterial = source.overrideMaterial.clone();\r\n\r\n\t\tthis.autoUpdate = source.autoUpdate;\r\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst data = super.toJSON( meta );\r\n\r\n\t\tif ( this.fog !== null ) data.object.fog = this.fog.toJSON();\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nScene.prototype.isScene = true;\r\n\r\nexport { Scene };\r\n", "import * as MathUtils from './MathUtils.js';\r\n\r\nconst _colorKeywords = { 'aliceblue': 0xF0F8FF, 'antiquewhite': 0xFAEBD7, 'aqua': 0x00FFFF, 'aquamarine': 0x7FFFD4, 'azure': 0xF0FFFF,\r\n\t'beige': 0xF5F5DC, 'bisque': 0xFFE4C4, 'black': 0x000000, 'blanchedalmond': 0xFFEBCD, 'blue': 0x0000FF, 'blueviolet': 0x8A2BE2,\r\n\t'brown': 0xA52A2A, 'burlywood': 0xDEB887, 'cadetblue': 0x5F9EA0, 'chartreuse': 0x7FFF00, 'chocolate': 0xD2691E, 'coral': 0xFF7F50,\r\n\t'cornflowerblue': 0x6495ED, 'cornsilk': 0xFFF8DC, 'crimson': 0xDC143C, 'cyan': 0x00FFFF, 'darkblue': 0x00008B, 'darkcyan': 0x008B8B,\r\n\t'darkgoldenrod': 0xB8860B, 'darkgray': 0xA9A9A9, 'darkgreen': 0x006400, 'darkgrey': 0xA9A9A9, 'darkkhaki': 0xBDB76B, 'darkmagenta': 0x8B008B,\r\n\t'darkolivegreen': 0x556B2F, 'darkorange': 0xFF8C00, 'darkorchid': 0x9932CC, 'darkred': 0x8B0000, 'darksalmon': 0xE9967A, 'darkseagreen': 0x8FBC8F,\r\n\t'darkslateblue': 0x483D8B, 'darkslategray': 0x2F4F4F, 'darkslategrey': 0x2F4F4F, 'darkturquoise': 0x00CED1, 'darkviolet': 0x9400D3,\r\n\t'deeppink': 0xFF1493, 'deepskyblue': 0x00BFFF, 'dimgray': 0x696969, 'dimgrey': 0x696969, 'dodgerblue': 0x1E90FF, 'firebrick': 0xB22222,\r\n\t'floralwhite': 0xFFFAF0, 'forestgreen': 0x228B22, 'fuchsia': 0xFF00FF, 'gainsboro': 0xDCDCDC, 'ghostwhite': 0xF8F8FF, 'gold': 0xFFD700,\r\n\t'goldenrod': 0xDAA520, 'gray': 0x808080, 'green': 0x008000, 'greenyellow': 0xADFF2F, 'grey': 0x808080, 'honeydew': 0xF0FFF0, 'hotpink': 0xFF69B4,\r\n\t'indianred': 0xCD5C5C, 'indigo': 0x4B0082, 'ivory': 0xFFFFF0, 'khaki': 0xF0E68C, 'lavender': 0xE6E6FA, 'lavenderblush': 0xFFF0F5, 'lawngreen': 0x7CFC00,\r\n\t'lemonchiffon': 0xFFFACD, 'lightblue': 0xADD8E6, 'lightcoral': 0xF08080, 'lightcyan': 0xE0FFFF, 'lightgoldenrodyellow': 0xFAFAD2, 'lightgray': 0xD3D3D3,\r\n\t'lightgreen': 0x90EE90, 'lightgrey': 0xD3D3D3, 'lightpink': 0xFFB6C1, 'lightsalmon': 0xFFA07A, 'lightseagreen': 0x20B2AA, 'lightskyblue': 0x87CEFA,\r\n\t'lightslategray': 0x778899, 'lightslategrey': 0x778899, 'lightsteelblue': 0xB0C4DE, 'lightyellow': 0xFFFFE0, 'lime': 0x00FF00, 'limegreen': 0x32CD32,\r\n\t'linen': 0xFAF0E6, 'magenta': 0xFF00FF, 'maroon': 0x800000, 'mediumaquamarine': 0x66CDAA, 'mediumblue': 0x0000CD, 'mediumorchid': 0xBA55D3,\r\n\t'mediumpurple': 0x9370DB, 'mediumseagreen': 0x3CB371, 'mediumslateblue': 0x7B68EE, 'mediumspringgreen': 0x00FA9A, 'mediumturquoise': 0x48D1CC,\r\n\t'mediumvioletred': 0xC71585, 'midnightblue': 0x191970, 'mintcream': 0xF5FFFA, 'mistyrose': 0xFFE4E1, 'moccasin': 0xFFE4B5, 'navajowhite': 0xFFDEAD,\r\n\t'navy': 0x000080, 'oldlace': 0xFDF5E6, 'olive': 0x808000, 'olivedrab': 0x6B8E23, 'orange': 0xFFA500, 'orangered': 0xFF4500, 'orchid': 0xDA70D6,\r\n\t'palegoldenrod': 0xEEE8AA, 'palegreen': 0x98FB98, 'paleturquoise': 0xAFEEEE, 'palevioletred': 0xDB7093, 'papayawhip': 0xFFEFD5, 'peachpuff': 0xFFDAB9,\r\n\t'peru': 0xCD853F, 'pink': 0xFFC0CB, 'plum': 0xDDA0DD, 'powderblue': 0xB0E0E6, 'purple': 0x800080, 'rebeccapurple': 0x663399, 'red': 0xFF0000, 'rosybrown': 0xBC8F8F,\r\n\t'royalblue': 0x4169E1, 'saddlebrown': 0x8B4513, 'salmon': 0xFA8072, 'sandybrown': 0xF4A460, 'seagreen': 0x2E8B57, 'seashell': 0xFFF5EE,\r\n\t'sienna': 0xA0522D, 'silver': 0xC0C0C0, 'skyblue': 0x87CEEB, 'slateblue': 0x6A5ACD, 'slategray': 0x708090, 'slategrey': 0x708090, 'snow': 0xFFFAFA,\r\n\t'springgreen': 0x00FF7F, 'steelblue': 0x4682B4, 'tan': 0xD2B48C, 'teal': 0x008080, 'thistle': 0xD8BFD8, 'tomato': 0xFF6347, 'turquoise': 0x40E0D0,\r\n\t'violet': 0xEE82EE, 'wheat': 0xF5DEB3, 'white': 0xFFFFFF, 'whitesmoke': 0xF5F5F5, 'yellow': 0xFFFF00, 'yellowgreen': 0x9ACD32 };\r\n\r\nconst _hslA = { h: 0, s: 0, l: 0 };\r\nconst _hslB = { h: 0, s: 0, l: 0 };\r\n\r\nfunction hue2rgb( p, q, t ) {\r\n\r\n\tif ( t < 0 ) t += 1;\r\n\tif ( t > 1 ) t -= 1;\r\n\tif ( t < 1 / 6 ) return p + ( q - p ) * 6 * t;\r\n\tif ( t < 1 / 2 ) return q;\r\n\tif ( t < 2 / 3 ) return p + ( q - p ) * 6 * ( 2 / 3 - t );\r\n\treturn p;\r\n\r\n}\r\n\r\nfunction SRGBToLinear( c ) {\r\n\r\n\treturn ( c < 0.04045 ) ? c * 0.0773993808 : Math.pow( c * 0.9478672986 + 0.0521327014, 2.4 );\r\n\r\n}\r\n\r\nfunction LinearToSRGB( c ) {\r\n\r\n\treturn ( c < 0.0031308 ) ? c * 12.92 : 1.055 * ( Math.pow( c, 0.41666 ) ) - 0.055;\r\n\r\n}\r\n\r\nclass Color {\r\n\r\n\tconstructor( r, g, b ) {\r\n\r\n\t\tif ( g === undefined && b === undefined ) {\r\n\r\n\t\t\t// r is THREE.Color, hex or string\r\n\t\t\treturn this.set( r );\r\n\r\n\t\t}\r\n\r\n\t\treturn this.setRGB( r, g, b );\r\n\r\n\t}\r\n\r\n\tset( value ) {\r\n\r\n\t\tif ( value && value.isColor ) {\r\n\r\n\t\t\tthis.copy( value );\r\n\r\n\t\t} else if ( typeof value === 'number' ) {\r\n\r\n\t\t\tthis.setHex( value );\r\n\r\n\t\t} else if ( typeof value === 'string' ) {\r\n\r\n\t\t\tthis.setStyle( value );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetScalar( scalar ) {\r\n\r\n\t\tthis.r = scalar;\r\n\t\tthis.g = scalar;\r\n\t\tthis.b = scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetHex( hex ) {\r\n\r\n\t\thex = Math.floor( hex );\r\n\r\n\t\tthis.r = ( hex >> 16 & 255 ) / 255;\r\n\t\tthis.g = ( hex >> 8 & 255 ) / 255;\r\n\t\tthis.b = ( hex & 255 ) / 255;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetRGB( r, g, b ) {\r\n\r\n\t\tthis.r = r;\r\n\t\tthis.g = g;\r\n\t\tthis.b = b;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetHSL( h, s, l ) {\r\n\r\n\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\t\th = MathUtils.euclideanModulo( h, 1 );\r\n\t\ts = MathUtils.clamp( s, 0, 1 );\r\n\t\tl = MathUtils.clamp( l, 0, 1 );\r\n\r\n\t\tif ( s === 0 ) {\r\n\r\n\t\t\tthis.r = this.g = this.b = l;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst p = l <= 0.5 ? l * ( 1 + s ) : l + s - ( l * s );\r\n\t\t\tconst q = ( 2 * l ) - p;\r\n\r\n\t\t\tthis.r = hue2rgb( q, p, h + 1 / 3 );\r\n\t\t\tthis.g = hue2rgb( q, p, h );\r\n\t\t\tthis.b = hue2rgb( q, p, h - 1 / 3 );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetStyle( style ) {\r\n\r\n\t\tfunction handleAlpha( string ) {\r\n\r\n\t\t\tif ( string === undefined ) return;\r\n\r\n\t\t\tif ( parseFloat( string ) < 1 ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Color: Alpha component of ' + style + ' will be ignored.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\tlet m;\r\n\r\n\t\tif ( m = /^((?:rgb|hsl)a?)\\(([^\\)]*)\\)/.exec( style ) ) {\r\n\r\n\t\t\t// rgb / hsl\r\n\r\n\t\t\tlet color;\r\n\t\t\tconst name = m[ 1 ];\r\n\t\t\tconst components = m[ 2 ];\r\n\r\n\t\t\tswitch ( name ) {\r\n\r\n\t\t\t\tcase 'rgb':\r\n\t\t\t\tcase 'rgba':\r\n\r\n\t\t\t\t\tif ( color = /^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgb(255,0,0) rgba(255,0,0,0.5)\r\n\t\t\t\t\t\tthis.r = Math.min( 255, parseInt( color[ 1 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.g = Math.min( 255, parseInt( color[ 2 ], 10 ) ) / 255;\r\n\t\t\t\t\t\tthis.b = Math.min( 255, parseInt( color[ 3 ], 10 ) ) / 255;\r\n\r\n\t\t\t\t\t\thandleAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( color = /^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// rgb(100%,0%,0%) rgba(100%,0%,0%,0.5)\r\n\t\t\t\t\t\tthis.r = Math.min( 100, parseInt( color[ 1 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.g = Math.min( 100, parseInt( color[ 2 ], 10 ) ) / 100;\r\n\t\t\t\t\t\tthis.b = Math.min( 100, parseInt( color[ 3 ], 10 ) ) / 100;\r\n\r\n\t\t\t\t\t\thandleAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'hsl':\r\n\t\t\t\tcase 'hsla':\r\n\r\n\t\t\t\t\tif ( color = /^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec( components ) ) {\r\n\r\n\t\t\t\t\t\t// hsl(120,50%,50%) hsla(120,50%,50%,0.5)\r\n\t\t\t\t\t\tconst h = parseFloat( color[ 1 ] ) / 360;\r\n\t\t\t\t\t\tconst s = parseInt( color[ 2 ], 10 ) / 100;\r\n\t\t\t\t\t\tconst l = parseInt( color[ 3 ], 10 ) / 100;\r\n\r\n\t\t\t\t\t\thandleAlpha( color[ 4 ] );\r\n\r\n\t\t\t\t\t\treturn this.setHSL( h, s, l );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( m = /^\\#([A-Fa-f\\d]+)$/.exec( style ) ) {\r\n\r\n\t\t\t// hex color\r\n\r\n\t\t\tconst hex = m[ 1 ];\r\n\t\t\tconst size = hex.length;\r\n\r\n\t\t\tif ( size === 3 ) {\r\n\r\n\t\t\t\t// #ff0\r\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 0 ), 16 ) / 255;\r\n\t\t\t\tthis.g = parseInt( hex.charAt( 1 ) + hex.charAt( 1 ), 16 ) / 255;\r\n\t\t\t\tthis.b = parseInt( hex.charAt( 2 ) + hex.charAt( 2 ), 16 ) / 255;\r\n\r\n\t\t\t\treturn this;\r\n\r\n\t\t\t} else if ( size === 6 ) {\r\n\r\n\t\t\t\t// #ff0000\r\n\t\t\t\tthis.r = parseInt( hex.charAt( 0 ) + hex.charAt( 1 ), 16 ) / 255;\r\n\t\t\t\tthis.g = parseInt( hex.charAt( 2 ) + hex.charAt( 3 ), 16 ) / 255;\r\n\t\t\t\tthis.b = parseInt( hex.charAt( 4 ) + hex.charAt( 5 ), 16 ) / 255;\r\n\r\n\t\t\t\treturn this;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( style && style.length > 0 ) {\r\n\r\n\t\t\treturn this.setColorName( style );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetColorName( style ) {\r\n\r\n\t\t// color keywords\r\n\t\tconst hex = _colorKeywords[ style.toLowerCase() ];\r\n\r\n\t\tif ( hex !== undefined ) {\r\n\r\n\t\t\t// red\r\n\t\t\tthis.setHex( hex );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// unknown color\r\n\t\t\tconsole.warn( 'THREE.Color: Unknown color ' + style );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this.r, this.g, this.b );\r\n\r\n\t}\r\n\r\n\tcopy( color ) {\r\n\r\n\t\tthis.r = color.r;\r\n\t\tthis.g = color.g;\r\n\t\tthis.b = color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyGammaToLinear( color, gammaFactor = 2.0 ) {\r\n\r\n\t\tthis.r = Math.pow( color.r, gammaFactor );\r\n\t\tthis.g = Math.pow( color.g, gammaFactor );\r\n\t\tthis.b = Math.pow( color.b, gammaFactor );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyLinearToGamma( color, gammaFactor = 2.0 ) {\r\n\r\n\t\tconst safeInverse = ( gammaFactor > 0 ) ? ( 1.0 / gammaFactor ) : 1.0;\r\n\r\n\t\tthis.r = Math.pow( color.r, safeInverse );\r\n\t\tthis.g = Math.pow( color.g, safeInverse );\r\n\t\tthis.b = Math.pow( color.b, safeInverse );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tconvertGammaToLinear( gammaFactor ) {\r\n\r\n\t\tthis.copyGammaToLinear( this, gammaFactor );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tconvertLinearToGamma( gammaFactor ) {\r\n\r\n\t\tthis.copyLinearToGamma( this, gammaFactor );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopySRGBToLinear( color ) {\r\n\r\n\t\tthis.r = SRGBToLinear( color.r );\r\n\t\tthis.g = SRGBToLinear( color.g );\r\n\t\tthis.b = SRGBToLinear( color.b );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyLinearToSRGB( color ) {\r\n\r\n\t\tthis.r = LinearToSRGB( color.r );\r\n\t\tthis.g = LinearToSRGB( color.g );\r\n\t\tthis.b = LinearToSRGB( color.b );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tconvertSRGBToLinear() {\r\n\r\n\t\tthis.copySRGBToLinear( this );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tconvertLinearToSRGB() {\r\n\r\n\t\tthis.copyLinearToSRGB( this );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetHex() {\r\n\r\n\t\treturn ( this.r * 255 ) << 16 ^ ( this.g * 255 ) << 8 ^ ( this.b * 255 ) << 0;\r\n\r\n\t}\r\n\r\n\tgetHexString() {\r\n\r\n\t\treturn ( '000000' + this.getHex().toString( 16 ) ).slice( - 6 );\r\n\r\n\t}\r\n\r\n\tgetHSL( target ) {\r\n\r\n\t\t// h,s,l ranges are in 0.0 - 1.0\r\n\r\n\t\tconst r = this.r, g = this.g, b = this.b;\r\n\r\n\t\tconst max = Math.max( r, g, b );\r\n\t\tconst min = Math.min( r, g, b );\r\n\r\n\t\tlet hue, saturation;\r\n\t\tconst lightness = ( min + max ) / 2.0;\r\n\r\n\t\tif ( min === max ) {\r\n\r\n\t\t\thue = 0;\r\n\t\t\tsaturation = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst delta = max - min;\r\n\r\n\t\t\tsaturation = lightness <= 0.5 ? delta / ( max + min ) : delta / ( 2 - max - min );\r\n\r\n\t\t\tswitch ( max ) {\r\n\r\n\t\t\t\tcase r: hue = ( g - b ) / delta + ( g < b ? 6 : 0 ); break;\r\n\t\t\t\tcase g: hue = ( b - r ) / delta + 2; break;\r\n\t\t\t\tcase b: hue = ( r - g ) / delta + 4; break;\r\n\r\n\t\t\t}\r\n\r\n\t\t\thue /= 6;\r\n\r\n\t\t}\r\n\r\n\t\ttarget.h = hue;\r\n\t\ttarget.s = saturation;\r\n\t\ttarget.l = lightness;\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tgetStyle() {\r\n\r\n\t\treturn 'rgb(' + ( ( this.r * 255 ) | 0 ) + ',' + ( ( this.g * 255 ) | 0 ) + ',' + ( ( this.b * 255 ) | 0 ) + ')';\r\n\r\n\t}\r\n\r\n\toffsetHSL( h, s, l ) {\r\n\r\n\t\tthis.getHSL( _hslA );\r\n\r\n\t\t_hslA.h += h; _hslA.s += s; _hslA.l += l;\r\n\r\n\t\tthis.setHSL( _hslA.h, _hslA.s, _hslA.l );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tadd( color ) {\r\n\r\n\t\tthis.r += color.r;\r\n\t\tthis.g += color.g;\r\n\t\tthis.b += color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddColors( color1, color2 ) {\r\n\r\n\t\tthis.r = color1.r + color2.r;\r\n\t\tthis.g = color1.g + color2.g;\r\n\t\tthis.b = color1.b + color2.b;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScalar( s ) {\r\n\r\n\t\tthis.r += s;\r\n\t\tthis.g += s;\r\n\t\tthis.b += s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsub( color ) {\r\n\r\n\t\tthis.r = Math.max( 0, this.r - color.r );\r\n\t\tthis.g = Math.max( 0, this.g - color.g );\r\n\t\tthis.b = Math.max( 0, this.b - color.b );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( color ) {\r\n\r\n\t\tthis.r *= color.r;\r\n\t\tthis.g *= color.g;\r\n\t\tthis.b *= color.b;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( s ) {\r\n\r\n\t\tthis.r *= s;\r\n\t\tthis.g *= s;\r\n\t\tthis.b *= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerp( color, alpha ) {\r\n\r\n\t\tthis.r += ( color.r - this.r ) * alpha;\r\n\t\tthis.g += ( color.g - this.g ) * alpha;\r\n\t\tthis.b += ( color.b - this.b ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerpColors( color1, color2, alpha ) {\r\n\r\n\t\tthis.r = color1.r + ( color2.r - color1.r ) * alpha;\r\n\t\tthis.g = color1.g + ( color2.g - color1.g ) * alpha;\r\n\t\tthis.b = color1.b + ( color2.b - color1.b ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerpHSL( color, alpha ) {\r\n\r\n\t\tthis.getHSL( _hslA );\r\n\t\tcolor.getHSL( _hslB );\r\n\r\n\t\tconst h = MathUtils.lerp( _hslA.h, _hslB.h, alpha );\r\n\t\tconst s = MathUtils.lerp( _hslA.s, _hslB.s, alpha );\r\n\t\tconst l = MathUtils.lerp( _hslA.l, _hslB.l, alpha );\r\n\r\n\t\tthis.setHSL( h, s, l );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( c ) {\r\n\r\n\t\treturn ( c.r === this.r ) && ( c.g === this.g ) && ( c.b === this.b );\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tthis.r = array[ offset ];\r\n\t\tthis.g = array[ offset + 1 ];\r\n\t\tthis.b = array[ offset + 2 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this.r;\r\n\t\tarray[ offset + 1 ] = this.g;\r\n\t\tarray[ offset + 2 ] = this.b;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfromBufferAttribute( attribute, index ) {\r\n\r\n\t\tthis.r = attribute.getX( index );\r\n\t\tthis.g = attribute.getY( index );\r\n\t\tthis.b = attribute.getZ( index );\r\n\r\n\t\tif ( attribute.normalized === true ) {\r\n\r\n\t\t\t// assuming Uint8Array\r\n\r\n\t\t\tthis.r /= 255;\r\n\t\t\tthis.g /= 255;\r\n\t\t\tthis.b /= 255;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\treturn this.getHex();\r\n\r\n\t}\r\n\r\n}\r\n\r\nColor.NAMES = _colorKeywords;\r\n\r\nColor.prototype.isColor = true;\r\nColor.prototype.r = 1;\r\nColor.prototype.g = 1;\r\nColor.prototype.b = 1;\r\n\r\nexport { Color };\r\n", "import { Object3D } from '../core/Object3D.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\nclass Light extends Object3D {\r\n\r\n\tconstructor( color, intensity = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Light';\r\n\r\n\t\tthis.color = new Color( color );\r\n\t\tthis.intensity = intensity;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\t// Empty here in base class; some subclasses override.\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.color.copy( source.color );\r\n\t\tthis.intensity = source.intensity;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst data = super.toJSON( meta );\r\n\r\n\t\tdata.object.color = this.color.getHex();\r\n\t\tdata.object.intensity = this.intensity;\r\n\r\n\t\tif ( this.groundColor !== undefined ) data.object.groundColor = this.groundColor.getHex();\r\n\r\n\t\tif ( this.distance !== undefined ) data.object.distance = this.distance;\r\n\t\tif ( this.angle !== undefined ) data.object.angle = this.angle;\r\n\t\tif ( this.decay !== undefined ) data.object.decay = this.decay;\r\n\t\tif ( this.penumbra !== undefined ) data.object.penumbra = this.penumbra;\r\n\r\n\t\tif ( this.shadow !== undefined ) data.object.shadow = this.shadow.toJSON();\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nLight.prototype.isLight = true;\r\n\r\nexport { Light };\r\n", "import { Light } from './Light.js';\r\nimport { Color } from '../math/Color.js';\r\nimport { Object3D } from '../core/Object3D.js';\r\n\r\nclass HemisphereLight extends Light {\r\n\r\n\tconstructor( skyColor, groundColor, intensity ) {\r\n\r\n\t\tsuper( skyColor, intensity );\r\n\r\n\t\tthis.type = 'HemisphereLight';\r\n\r\n\t\tthis.position.copy( Object3D.DefaultUp );\r\n\t\tthis.updateMatrix();\r\n\r\n\t\tthis.groundColor = new Color( groundColor );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tLight.prototype.copy.call( this, source );\r\n\r\n\t\tthis.groundColor.copy( source.groundColor );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nHemisphereLight.prototype.isHemisphereLight = true;\r\n\r\nexport { HemisphereLight };\r\n", "class Vector2 {\r\n\r\n\tconstructor( x = 0, y = 0 ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t}\r\n\r\n\tget width() {\r\n\r\n\t\treturn this.x;\r\n\r\n\t}\r\n\r\n\tset width( value ) {\r\n\r\n\t\tthis.x = value;\r\n\r\n\t}\r\n\r\n\tget height() {\r\n\r\n\t\treturn this.y;\r\n\r\n\t}\r\n\r\n\tset height( value ) {\r\n\r\n\t\tthis.y = value;\r\n\r\n\t}\r\n\r\n\tset( x, y ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetScalar( scalar ) {\r\n\r\n\t\tthis.x = scalar;\r\n\t\tthis.y = scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetX( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetY( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetComponent( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetComponent( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this.x, this.y );\r\n\r\n\t}\r\n\r\n\tcopy( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tadd( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScalar( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScaledVector( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsub( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubScalar( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( v ) {\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdivide( v ) {\r\n\r\n\t\tthis.x /= v.x;\r\n\t\tthis.y /= v.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdivideScalar( scalar ) {\r\n\r\n\t\treturn this.multiplyScalar( 1 / scalar );\r\n\r\n\t}\r\n\r\n\tapplyMatrix3( m ) {\r\n\r\n\t\tconst x = this.x, y = this.y;\r\n\t\tconst e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 3 ] * y + e[ 6 ];\r\n\t\tthis.y = e[ 1 ] * x + e[ 4 ] * y + e[ 7 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmin( v ) {\r\n\r\n\t\tthis.x = Math.min( this.x, v.x );\r\n\t\tthis.y = Math.min( this.y, v.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmax( v ) {\r\n\r\n\t\tthis.x = Math.max( this.x, v.x );\r\n\t\tthis.y = Math.max( this.y, v.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclamp( min, max ) {\r\n\r\n\t\t// assumes min < max, componentwise\r\n\r\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\r\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampScalar( minVal, maxVal ) {\r\n\r\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\r\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampLength( min, max ) {\r\n\r\n\t\tconst length = this.length();\r\n\r\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\r\n\r\n\t}\r\n\r\n\tfloor() {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tceil() {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tround() {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\troundToZero() {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnegate() {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdot( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y;\r\n\r\n\t}\r\n\r\n\tcross( v ) {\r\n\r\n\t\treturn this.x * v.y - this.y * v.x;\r\n\r\n\t}\r\n\r\n\tlengthSq() {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y;\r\n\r\n\t}\r\n\r\n\tlength() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y );\r\n\r\n\t}\r\n\r\n\tmanhattanLength() {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y );\r\n\r\n\t}\r\n\r\n\tnormalize() {\r\n\r\n\t\treturn this.divideScalar( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tangle() {\r\n\r\n\t\t// computes the angle in radians with respect to the positive x-axis\r\n\r\n\t\tconst angle = Math.atan2( - this.y, - this.x ) + Math.PI;\r\n\r\n\t\treturn angle;\r\n\r\n\t}\r\n\r\n\tdistanceTo( v ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceToSquared( v ) );\r\n\r\n\t}\r\n\r\n\tdistanceToSquared( v ) {\r\n\r\n\t\tconst dx = this.x - v.x, dy = this.y - v.y;\r\n\t\treturn dx * dx + dy * dy;\r\n\r\n\t}\r\n\r\n\tmanhattanDistanceTo( v ) {\r\n\r\n\t\treturn Math.abs( this.x - v.x ) + Math.abs( this.y - v.y );\r\n\r\n\t}\r\n\r\n\tsetLength( length ) {\r\n\r\n\t\treturn this.normalize().multiplyScalar( length );\r\n\r\n\t}\r\n\r\n\tlerp( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerpVectors( v1, v2, alpha ) {\r\n\r\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\r\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) );\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfromBufferAttribute( attribute, index, offset ) {\r\n\r\n\t\tif ( offset !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector2: offset has been removed from .fromBufferAttribute().' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x = attribute.getX( index );\r\n\t\tthis.y = attribute.getY( index );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateAround( center, angle ) {\r\n\r\n\t\tconst c = Math.cos( angle ), s = Math.sin( angle );\r\n\r\n\t\tconst x = this.x - center.x;\r\n\t\tconst y = this.y - center.y;\r\n\r\n\t\tthis.x = x * c - y * s + center.x;\r\n\t\tthis.y = x * s + y * c + center.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trandom() {\r\n\r\n\t\tthis.x = Math.random();\r\n\t\tthis.y = Math.random();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nVector2.prototype.isVector2 = true;\r\n\r\nexport { Vector2 };\r\n", "class Vector4 {\r\n\r\n\tconstructor( x = 0, y = 0, z = 0, w = 1 ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.w = w;\r\n\r\n\t}\r\n\r\n\tget width() {\r\n\r\n\t\treturn this.z;\r\n\r\n\t}\r\n\r\n\tset width( value ) {\r\n\r\n\t\tthis.z = value;\r\n\r\n\t}\r\n\r\n\tget height() {\r\n\r\n\t\treturn this.w;\r\n\r\n\t}\r\n\r\n\tset height( value ) {\r\n\r\n\t\tthis.w = value;\r\n\r\n\t}\r\n\r\n\tset( x, y, z, w ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetScalar( scalar ) {\r\n\r\n\t\tthis.x = scalar;\r\n\t\tthis.y = scalar;\r\n\t\tthis.z = scalar;\r\n\t\tthis.w = scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetX( x ) {\r\n\r\n\t\tthis.x = x;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetY( y ) {\r\n\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetZ( z ) {\r\n\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetW( w ) {\r\n\r\n\t\tthis.w = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetComponent( index, value ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: this.x = value; break;\r\n\t\t\tcase 1: this.y = value; break;\r\n\t\t\tcase 2: this.z = value; break;\r\n\t\t\tcase 3: this.w = value; break;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetComponent( index ) {\r\n\r\n\t\tswitch ( index ) {\r\n\r\n\t\t\tcase 0: return this.x;\r\n\t\t\tcase 1: return this.y;\r\n\t\t\tcase 2: return this.z;\r\n\t\t\tcase 3: return this.w;\r\n\t\t\tdefault: throw new Error( 'index is out of range: ' + index );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this.x, this.y, this.z, this.w );\r\n\r\n\t}\r\n\r\n\tcopy( v ) {\r\n\r\n\t\tthis.x = v.x;\r\n\t\tthis.y = v.y;\r\n\t\tthis.z = v.z;\r\n\t\tthis.w = ( v.w !== undefined ) ? v.w : 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tadd( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.' );\r\n\t\t\treturn this.addVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x += v.x;\r\n\t\tthis.y += v.y;\r\n\t\tthis.z += v.z;\r\n\t\tthis.w += v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScalar( s ) {\r\n\r\n\t\tthis.x += s;\r\n\t\tthis.y += s;\r\n\t\tthis.z += s;\r\n\t\tthis.w += s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x + b.x;\r\n\t\tthis.y = a.y + b.y;\r\n\t\tthis.z = a.z + b.z;\r\n\t\tthis.w = a.w + b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\taddScaledVector( v, s ) {\r\n\r\n\t\tthis.x += v.x * s;\r\n\t\tthis.y += v.y * s;\r\n\t\tthis.z += v.z * s;\r\n\t\tthis.w += v.w * s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsub( v, w ) {\r\n\r\n\t\tif ( w !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.' );\r\n\t\t\treturn this.subVectors( v, w );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x -= v.x;\r\n\t\tthis.y -= v.y;\r\n\t\tthis.z -= v.z;\r\n\t\tthis.w -= v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubScalar( s ) {\r\n\r\n\t\tthis.x -= s;\r\n\t\tthis.y -= s;\r\n\t\tthis.z -= s;\r\n\t\tthis.w -= s;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsubVectors( a, b ) {\r\n\r\n\t\tthis.x = a.x - b.x;\r\n\t\tthis.y = a.y - b.y;\r\n\t\tthis.z = a.z - b.z;\r\n\t\tthis.w = a.w - b.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiply( v ) {\r\n\r\n\t\tthis.x *= v.x;\r\n\t\tthis.y *= v.y;\r\n\t\tthis.z *= v.z;\r\n\t\tthis.w *= v.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmultiplyScalar( scalar ) {\r\n\r\n\t\tthis.x *= scalar;\r\n\t\tthis.y *= scalar;\r\n\t\tthis.z *= scalar;\r\n\t\tthis.w *= scalar;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( m ) {\r\n\r\n\t\tconst x = this.x, y = this.y, z = this.z, w = this.w;\r\n\t\tconst e = m.elements;\r\n\r\n\t\tthis.x = e[ 0 ] * x + e[ 4 ] * y + e[ 8 ] * z + e[ 12 ] * w;\r\n\t\tthis.y = e[ 1 ] * x + e[ 5 ] * y + e[ 9 ] * z + e[ 13 ] * w;\r\n\t\tthis.z = e[ 2 ] * x + e[ 6 ] * y + e[ 10 ] * z + e[ 14 ] * w;\r\n\t\tthis.w = e[ 3 ] * x + e[ 7 ] * y + e[ 11 ] * z + e[ 15 ] * w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdivideScalar( scalar ) {\r\n\r\n\t\treturn this.multiplyScalar( 1 / scalar );\r\n\r\n\t}\r\n\r\n\tsetAxisAngleFromQuaternion( q ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\r\n\r\n\t\t// q is assumed to be normalized\r\n\r\n\t\tthis.w = 2 * Math.acos( q.w );\r\n\r\n\t\tconst s = Math.sqrt( 1 - q.w * q.w );\r\n\r\n\t\tif ( s < 0.0001 ) {\r\n\r\n\t\t\tthis.x = 1;\r\n\t\t\tthis.y = 0;\r\n\t\t\tthis.z = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x = q.x / s;\r\n\t\t\tthis.y = q.y / s;\r\n\t\t\tthis.z = q.z / s;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetAxisAngleFromRotationMatrix( m ) {\r\n\r\n\t\t// http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToAngle/index.htm\r\n\r\n\t\t// assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\r\n\r\n\t\tlet angle, x, y, z; // variables for result\r\n\t\tconst epsilon = 0.01,\t\t// margin to allow for rounding errors\r\n\t\t\tepsilon2 = 0.1,\t\t// margin to distinguish between 0 and 180 degrees\r\n\r\n\t\t\tte = m.elements,\r\n\r\n\t\t\tm11 = te[ 0 ], m12 = te[ 4 ], m13 = te[ 8 ],\r\n\t\t\tm21 = te[ 1 ], m22 = te[ 5 ], m23 = te[ 9 ],\r\n\t\t\tm31 = te[ 2 ], m32 = te[ 6 ], m33 = te[ 10 ];\r\n\r\n\t\tif ( ( Math.abs( m12 - m21 ) < epsilon ) &&\r\n\t\t     ( Math.abs( m13 - m31 ) < epsilon ) &&\r\n\t\t     ( Math.abs( m23 - m32 ) < epsilon ) ) {\r\n\r\n\t\t\t// singularity found\r\n\t\t\t// first check for identity matrix which must have +1 for all terms\r\n\t\t\t// in leading diagonal and zero in other terms\r\n\r\n\t\t\tif ( ( Math.abs( m12 + m21 ) < epsilon2 ) &&\r\n\t\t\t     ( Math.abs( m13 + m31 ) < epsilon2 ) &&\r\n\t\t\t     ( Math.abs( m23 + m32 ) < epsilon2 ) &&\r\n\t\t\t     ( Math.abs( m11 + m22 + m33 - 3 ) < epsilon2 ) ) {\r\n\r\n\t\t\t\t// this singularity is identity matrix so angle = 0\r\n\r\n\t\t\t\tthis.set( 1, 0, 0, 0 );\r\n\r\n\t\t\t\treturn this; // zero angle, arbitrary axis\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// otherwise this singularity is angle = 180\r\n\r\n\t\t\tangle = Math.PI;\r\n\r\n\t\t\tconst xx = ( m11 + 1 ) / 2;\r\n\t\t\tconst yy = ( m22 + 1 ) / 2;\r\n\t\t\tconst zz = ( m33 + 1 ) / 2;\r\n\t\t\tconst xy = ( m12 + m21 ) / 4;\r\n\t\t\tconst xz = ( m13 + m31 ) / 4;\r\n\t\t\tconst yz = ( m23 + m32 ) / 4;\r\n\r\n\t\t\tif ( ( xx > yy ) && ( xx > zz ) ) {\r\n\r\n\t\t\t\t// m11 is the largest diagonal term\r\n\r\n\t\t\t\tif ( xx < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tx = Math.sqrt( xx );\r\n\t\t\t\t\ty = xy / x;\r\n\t\t\t\t\tz = xz / x;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( yy > zz ) {\r\n\r\n\t\t\t\t// m22 is the largest diagonal term\r\n\r\n\t\t\t\tif ( yy < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0;\r\n\t\t\t\t\tz = 0.707106781;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ty = Math.sqrt( yy );\r\n\t\t\t\t\tx = xy / y;\r\n\t\t\t\t\tz = yz / y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// m33 is the largest diagonal term so base result on this\r\n\r\n\t\t\t\tif ( zz < epsilon ) {\r\n\r\n\t\t\t\t\tx = 0.707106781;\r\n\t\t\t\t\ty = 0.707106781;\r\n\t\t\t\t\tz = 0;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tz = Math.sqrt( zz );\r\n\t\t\t\t\tx = xz / z;\r\n\t\t\t\t\ty = yz / z;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.set( x, y, z, angle );\r\n\r\n\t\t\treturn this; // return 180 deg rotation\r\n\r\n\t\t}\r\n\r\n\t\t// as we have reached here there are no singularities so we can handle normally\r\n\r\n\t\tlet s = Math.sqrt( ( m32 - m23 ) * ( m32 - m23 ) +\r\n\t\t\t( m13 - m31 ) * ( m13 - m31 ) +\r\n\t\t\t( m21 - m12 ) * ( m21 - m12 ) ); // used to normalize\r\n\r\n\t\tif ( Math.abs( s ) < 0.001 ) s = 1;\r\n\r\n\t\t// prevent divide by zero, should not happen if matrix is orthogonal and should be\r\n\t\t// caught by singularity test above, but I've left it in just in case\r\n\r\n\t\tthis.x = ( m32 - m23 ) / s;\r\n\t\tthis.y = ( m13 - m31 ) / s;\r\n\t\tthis.z = ( m21 - m12 ) / s;\r\n\t\tthis.w = Math.acos( ( m11 + m22 + m33 - 1 ) / 2 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmin( v ) {\r\n\r\n\t\tthis.x = Math.min( this.x, v.x );\r\n\t\tthis.y = Math.min( this.y, v.y );\r\n\t\tthis.z = Math.min( this.z, v.z );\r\n\t\tthis.w = Math.min( this.w, v.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmax( v ) {\r\n\r\n\t\tthis.x = Math.max( this.x, v.x );\r\n\t\tthis.y = Math.max( this.y, v.y );\r\n\t\tthis.z = Math.max( this.z, v.z );\r\n\t\tthis.w = Math.max( this.w, v.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclamp( min, max ) {\r\n\r\n\t\t// assumes min < max, componentwise\r\n\r\n\t\tthis.x = Math.max( min.x, Math.min( max.x, this.x ) );\r\n\t\tthis.y = Math.max( min.y, Math.min( max.y, this.y ) );\r\n\t\tthis.z = Math.max( min.z, Math.min( max.z, this.z ) );\r\n\t\tthis.w = Math.max( min.w, Math.min( max.w, this.w ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampScalar( minVal, maxVal ) {\r\n\r\n\t\tthis.x = Math.max( minVal, Math.min( maxVal, this.x ) );\r\n\t\tthis.y = Math.max( minVal, Math.min( maxVal, this.y ) );\r\n\t\tthis.z = Math.max( minVal, Math.min( maxVal, this.z ) );\r\n\t\tthis.w = Math.max( minVal, Math.min( maxVal, this.w ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclampLength( min, max ) {\r\n\r\n\t\tconst length = this.length();\r\n\r\n\t\treturn this.divideScalar( length || 1 ).multiplyScalar( Math.max( min, Math.min( max, length ) ) );\r\n\r\n\t}\r\n\r\n\tfloor() {\r\n\r\n\t\tthis.x = Math.floor( this.x );\r\n\t\tthis.y = Math.floor( this.y );\r\n\t\tthis.z = Math.floor( this.z );\r\n\t\tthis.w = Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tceil() {\r\n\r\n\t\tthis.x = Math.ceil( this.x );\r\n\t\tthis.y = Math.ceil( this.y );\r\n\t\tthis.z = Math.ceil( this.z );\r\n\t\tthis.w = Math.ceil( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tround() {\r\n\r\n\t\tthis.x = Math.round( this.x );\r\n\t\tthis.y = Math.round( this.y );\r\n\t\tthis.z = Math.round( this.z );\r\n\t\tthis.w = Math.round( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\troundToZero() {\r\n\r\n\t\tthis.x = ( this.x < 0 ) ? Math.ceil( this.x ) : Math.floor( this.x );\r\n\t\tthis.y = ( this.y < 0 ) ? Math.ceil( this.y ) : Math.floor( this.y );\r\n\t\tthis.z = ( this.z < 0 ) ? Math.ceil( this.z ) : Math.floor( this.z );\r\n\t\tthis.w = ( this.w < 0 ) ? Math.ceil( this.w ) : Math.floor( this.w );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnegate() {\r\n\r\n\t\tthis.x = - this.x;\r\n\t\tthis.y = - this.y;\r\n\t\tthis.z = - this.z;\r\n\t\tthis.w = - this.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdot( v ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z + this.w * v.w;\r\n\r\n\t}\r\n\r\n\tlengthSq() {\r\n\r\n\t\treturn this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;\r\n\r\n\t}\r\n\r\n\tlength() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n\t}\r\n\r\n\tmanhattanLength() {\r\n\r\n\t\treturn Math.abs( this.x ) + Math.abs( this.y ) + Math.abs( this.z ) + Math.abs( this.w );\r\n\r\n\t}\r\n\r\n\tnormalize() {\r\n\r\n\t\treturn this.divideScalar( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tsetLength( length ) {\r\n\r\n\t\treturn this.normalize().multiplyScalar( length );\r\n\r\n\t}\r\n\r\n\tlerp( v, alpha ) {\r\n\r\n\t\tthis.x += ( v.x - this.x ) * alpha;\r\n\t\tthis.y += ( v.y - this.y ) * alpha;\r\n\t\tthis.z += ( v.z - this.z ) * alpha;\r\n\t\tthis.w += ( v.w - this.w ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlerpVectors( v1, v2, alpha ) {\r\n\r\n\t\tthis.x = v1.x + ( v2.x - v1.x ) * alpha;\r\n\t\tthis.y = v1.y + ( v2.y - v1.y ) * alpha;\r\n\t\tthis.z = v1.z + ( v2.z - v1.z ) * alpha;\r\n\t\tthis.w = v1.w + ( v2.w - v1.w ) * alpha;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( v ) {\r\n\r\n\t\treturn ( ( v.x === this.x ) && ( v.y === this.y ) && ( v.z === this.z ) && ( v.w === this.w ) );\r\n\r\n\t}\r\n\r\n\tfromArray( array, offset = 0 ) {\r\n\r\n\t\tthis.x = array[ offset ];\r\n\t\tthis.y = array[ offset + 1 ];\r\n\t\tthis.z = array[ offset + 2 ];\r\n\t\tthis.w = array[ offset + 3 ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoArray( array = [], offset = 0 ) {\r\n\r\n\t\tarray[ offset ] = this.x;\r\n\t\tarray[ offset + 1 ] = this.y;\r\n\t\tarray[ offset + 2 ] = this.z;\r\n\t\tarray[ offset + 3 ] = this.w;\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\tfromBufferAttribute( attribute, index, offset ) {\r\n\r\n\t\tif ( offset !== undefined ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.Vector4: offset has been removed from .fromBufferAttribute().' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.x = attribute.getX( index );\r\n\t\tthis.y = attribute.getY( index );\r\n\t\tthis.z = attribute.getZ( index );\r\n\t\tthis.w = attribute.getW( index );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trandom() {\r\n\r\n\t\tthis.x = Math.random();\r\n\t\tthis.y = Math.random();\r\n\t\tthis.z = Math.random();\r\n\t\tthis.w = Math.random();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nVector4.prototype.isVector4 = true;\r\n\r\nexport { Vector4 };\r\n", "import { Vector3 } from './Vector3.js';\r\n\r\nclass Box3 {\r\n\r\n\tconstructor( min = new Vector3( + Infinity, + Infinity, + Infinity ), max = new Vector3( - Infinity, - Infinity, - Infinity ) ) {\r\n\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\r\n\t}\r\n\r\n\tset( min, max ) {\r\n\r\n\t\tthis.min.copy( min );\r\n\t\tthis.max.copy( max );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromArray( array ) {\r\n\r\n\t\tlet minX = + Infinity;\r\n\t\tlet minY = + Infinity;\r\n\t\tlet minZ = + Infinity;\r\n\r\n\t\tlet maxX = - Infinity;\r\n\t\tlet maxY = - Infinity;\r\n\t\tlet maxZ = - Infinity;\r\n\r\n\t\tfor ( let i = 0, l = array.length; i < l; i += 3 ) {\r\n\r\n\t\t\tconst x = array[ i ];\r\n\t\t\tconst y = array[ i + 1 ];\r\n\t\t\tconst z = array[ i + 2 ];\r\n\r\n\t\t\tif ( x < minX ) minX = x;\r\n\t\t\tif ( y < minY ) minY = y;\r\n\t\t\tif ( z < minZ ) minZ = z;\r\n\r\n\t\t\tif ( x > maxX ) maxX = x;\r\n\t\t\tif ( y > maxY ) maxY = y;\r\n\t\t\tif ( z > maxZ ) maxZ = z;\r\n\r\n\t\t}\r\n\r\n\t\tthis.min.set( minX, minY, minZ );\r\n\t\tthis.max.set( maxX, maxY, maxZ );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromBufferAttribute( attribute ) {\r\n\r\n\t\tlet minX = + Infinity;\r\n\t\tlet minY = + Infinity;\r\n\t\tlet minZ = + Infinity;\r\n\r\n\t\tlet maxX = - Infinity;\r\n\t\tlet maxY = - Infinity;\r\n\t\tlet maxZ = - Infinity;\r\n\r\n\t\tfor ( let i = 0, l = attribute.count; i < l; i ++ ) {\r\n\r\n\t\t\tconst x = attribute.getX( i );\r\n\t\t\tconst y = attribute.getY( i );\r\n\t\t\tconst z = attribute.getZ( i );\r\n\r\n\t\t\tif ( x < minX ) minX = x;\r\n\t\t\tif ( y < minY ) minY = y;\r\n\t\t\tif ( z < minZ ) minZ = z;\r\n\r\n\t\t\tif ( x > maxX ) maxX = x;\r\n\t\t\tif ( y > maxY ) maxY = y;\r\n\t\t\tif ( z > maxZ ) maxZ = z;\r\n\r\n\t\t}\r\n\r\n\t\tthis.min.set( minX, minY, minZ );\r\n\t\tthis.max.set( maxX, maxY, maxZ );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromPoints( points ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\tfor ( let i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tthis.expandByPoint( points[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromCenterAndSize( center, size ) {\r\n\r\n\t\tconst halfSize = _vector.copy( size ).multiplyScalar( 0.5 );\r\n\r\n\t\tthis.min.copy( center ).sub( halfSize );\r\n\t\tthis.max.copy( center ).add( halfSize );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromObject( object ) {\r\n\r\n\t\tthis.makeEmpty();\r\n\r\n\t\treturn this.expandByObject( object );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( box ) {\r\n\r\n\t\tthis.min.copy( box.min );\r\n\t\tthis.max.copy( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tmakeEmpty() {\r\n\r\n\t\tthis.min.x = this.min.y = this.min.z = + Infinity;\r\n\t\tthis.max.x = this.max.y = this.max.z = - Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tisEmpty() {\r\n\r\n\t\t// this is a more robust check for empty than ( volume <= 0 ) because volume can get positive with two negative axes\r\n\r\n\t\treturn ( this.max.x < this.min.x ) || ( this.max.y < this.min.y ) || ( this.max.z < this.min.z );\r\n\r\n\t}\r\n\r\n\tgetCenter( target ) {\r\n\r\n\t\treturn this.isEmpty() ? target.set( 0, 0, 0 ) : target.addVectors( this.min, this.max ).multiplyScalar( 0.5 );\r\n\r\n\t}\r\n\r\n\tgetSize( target ) {\r\n\r\n\t\treturn this.isEmpty() ? target.set( 0, 0, 0 ) : target.subVectors( this.max, this.min );\r\n\r\n\t}\r\n\r\n\texpandByPoint( point ) {\r\n\r\n\t\tthis.min.min( point );\r\n\t\tthis.max.max( point );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\texpandByVector( vector ) {\r\n\r\n\t\tthis.min.sub( vector );\r\n\t\tthis.max.add( vector );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\texpandByScalar( scalar ) {\r\n\r\n\t\tthis.min.addScalar( - scalar );\r\n\t\tthis.max.addScalar( scalar );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\texpandByObject( object ) {\r\n\r\n\t\t// Computes the world-axis-aligned bounding box of an object (including its children),\r\n\t\t// accounting for both the object's, and children's, world transforms\r\n\r\n\t\tobject.updateWorldMatrix( false, false );\r\n\r\n\t\tconst geometry = object.geometry;\r\n\r\n\t\tif ( geometry !== undefined ) {\r\n\r\n\t\t\tif ( geometry.boundingBox === null ) {\r\n\r\n\t\t\t\tgeometry.computeBoundingBox();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_box.copy( geometry.boundingBox );\r\n\t\t\t_box.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\tthis.union( _box );\r\n\r\n\t\t}\r\n\r\n\t\tconst children = object.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tthis.expandByObject( children[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcontainsPoint( point ) {\r\n\r\n\t\treturn point.x < this.min.x || point.x > this.max.x ||\r\n\t\t\tpoint.y < this.min.y || point.y > this.max.y ||\r\n\t\t\tpoint.z < this.min.z || point.z > this.max.z ? false : true;\r\n\r\n\t}\r\n\r\n\tcontainsBox( box ) {\r\n\r\n\t\treturn this.min.x <= box.min.x && box.max.x <= this.max.x &&\r\n\t\t\tthis.min.y <= box.min.y && box.max.y <= this.max.y &&\r\n\t\t\tthis.min.z <= box.min.z && box.max.z <= this.max.z;\r\n\r\n\t}\r\n\r\n\tgetParameter( point, target ) {\r\n\r\n\t\t// This can potentially have a divide by zero if the box\r\n\t\t// has a size dimension of 0.\r\n\r\n\t\treturn target.set(\r\n\t\t\t( point.x - this.min.x ) / ( this.max.x - this.min.x ),\r\n\t\t\t( point.y - this.min.y ) / ( this.max.y - this.min.y ),\r\n\t\t\t( point.z - this.min.z ) / ( this.max.z - this.min.z )\r\n\t\t);\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\t// using 6 splitting planes to rule out intersections.\r\n\t\treturn box.max.x < this.min.x || box.min.x > this.max.x ||\r\n\t\t\tbox.max.y < this.min.y || box.min.y > this.max.y ||\r\n\t\t\tbox.max.z < this.min.z || box.min.z > this.max.z ? false : true;\r\n\r\n\t}\r\n\r\n\tintersectsSphere( sphere ) {\r\n\r\n\t\t// Find the point on the AABB closest to the sphere center.\r\n\t\tthis.clampPoint( sphere.center, _vector );\r\n\r\n\t\t// If that point is inside the sphere, the AABB and sphere intersect.\r\n\t\treturn _vector.distanceToSquared( sphere.center ) <= ( sphere.radius * sphere.radius );\r\n\r\n\t}\r\n\r\n\tintersectsPlane( plane ) {\r\n\r\n\t\t// We compute the minimum and maximum dot product values. If those values\r\n\t\t// are on the same side (back or front) of the plane, then there is no intersection.\r\n\r\n\t\tlet min, max;\r\n\r\n\t\tif ( plane.normal.x > 0 ) {\r\n\r\n\t\t\tmin = plane.normal.x * this.min.x;\r\n\t\t\tmax = plane.normal.x * this.max.x;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmin = plane.normal.x * this.max.x;\r\n\t\t\tmax = plane.normal.x * this.min.x;\r\n\r\n\t\t}\r\n\r\n\t\tif ( plane.normal.y > 0 ) {\r\n\r\n\t\t\tmin += plane.normal.y * this.min.y;\r\n\t\t\tmax += plane.normal.y * this.max.y;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmin += plane.normal.y * this.max.y;\r\n\t\t\tmax += plane.normal.y * this.min.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( plane.normal.z > 0 ) {\r\n\r\n\t\t\tmin += plane.normal.z * this.min.z;\r\n\t\t\tmax += plane.normal.z * this.max.z;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmin += plane.normal.z * this.max.z;\r\n\t\t\tmax += plane.normal.z * this.min.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn ( min <= - plane.constant && max >= - plane.constant );\r\n\r\n\t}\r\n\r\n\tintersectsTriangle( triangle ) {\r\n\r\n\t\tif ( this.isEmpty() ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t// compute box center and extents\r\n\t\tthis.getCenter( _center );\r\n\t\t_extents.subVectors( this.max, _center );\r\n\r\n\t\t// translate triangle to aabb origin\r\n\t\t_v0.subVectors( triangle.a, _center );\r\n\t\t_v1.subVectors( triangle.b, _center );\r\n\t\t_v2.subVectors( triangle.c, _center );\r\n\r\n\t\t// compute edge vectors for triangle\r\n\t\t_f0.subVectors( _v1, _v0 );\r\n\t\t_f1.subVectors( _v2, _v1 );\r\n\t\t_f2.subVectors( _v0, _v2 );\r\n\r\n\t\t// test against axes that are given by cross product combinations of the edges of the triangle and the edges of the aabb\r\n\t\t// make an axis testing of each of the 3 sides of the aabb against each of the 3 sides of the triangle = 9 axis of separation\r\n\t\t// axis_ij = u_i x f_j (u0, u1, u2 = face normals of aabb = x,y,z axes vectors since aabb is axis aligned)\r\n\t\tlet axes = [\r\n\t\t\t0, - _f0.z, _f0.y, 0, - _f1.z, _f1.y, 0, - _f2.z, _f2.y,\r\n\t\t\t_f0.z, 0, - _f0.x, _f1.z, 0, - _f1.x, _f2.z, 0, - _f2.x,\r\n\t\t\t- _f0.y, _f0.x, 0, - _f1.y, _f1.x, 0, - _f2.y, _f2.x, 0\r\n\t\t];\r\n\t\tif ( ! satForAxes( axes, _v0, _v1, _v2, _extents ) ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t// test 3 face normals from the aabb\r\n\t\taxes = [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ];\r\n\t\tif ( ! satForAxes( axes, _v0, _v1, _v2, _extents ) ) {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\t// finally testing the face normal of the triangle\r\n\t\t// use already existing triangle edge vectors here\r\n\t\t_triangleNormal.crossVectors( _f0, _f1 );\r\n\t\taxes = [ _triangleNormal.x, _triangleNormal.y, _triangleNormal.z ];\r\n\r\n\t\treturn satForAxes( axes, _v0, _v1, _v2, _extents );\r\n\r\n\t}\r\n\r\n\tclampPoint( point, target ) {\r\n\r\n\t\treturn target.copy( point ).clamp( this.min, this.max );\r\n\r\n\t}\r\n\r\n\tdistanceToPoint( point ) {\r\n\r\n\t\tconst clampedPoint = _vector.copy( point ).clamp( this.min, this.max );\r\n\r\n\t\treturn clampedPoint.sub( point ).length();\r\n\r\n\t}\r\n\r\n\tgetBoundingSphere( target ) {\r\n\r\n\t\tthis.getCenter( target.center );\r\n\r\n\t\ttarget.radius = this.getSize( _vector ).length() * 0.5;\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tintersect( box ) {\r\n\r\n\t\tthis.min.max( box.min );\r\n\t\tthis.max.min( box.max );\r\n\r\n\t\t// ensure that if there is no overlap, the result is fully empty, not slightly empty with non-inf/+inf values that will cause subsequence intersects to erroneously return valid values.\r\n\t\tif ( this.isEmpty() ) this.makeEmpty();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tunion( box ) {\r\n\r\n\t\tthis.min.min( box.min );\r\n\t\tthis.max.max( box.max );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix ) {\r\n\r\n\t\t// transform of empty box is an empty box.\r\n\t\tif ( this.isEmpty() ) return this;\r\n\r\n\t\t// NOTE: I am using a binary pattern to specify all 2^3 combinations below\r\n\t\t_points[ 0 ].set( this.min.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 000\r\n\t\t_points[ 1 ].set( this.min.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 001\r\n\t\t_points[ 2 ].set( this.min.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 010\r\n\t\t_points[ 3 ].set( this.min.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 011\r\n\t\t_points[ 4 ].set( this.max.x, this.min.y, this.min.z ).applyMatrix4( matrix ); // 100\r\n\t\t_points[ 5 ].set( this.max.x, this.min.y, this.max.z ).applyMatrix4( matrix ); // 101\r\n\t\t_points[ 6 ].set( this.max.x, this.max.y, this.min.z ).applyMatrix4( matrix ); // 110\r\n\t\t_points[ 7 ].set( this.max.x, this.max.y, this.max.z ).applyMatrix4( matrix ); // 111\r\n\r\n\t\tthis.setFromPoints( _points );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslate( offset ) {\r\n\r\n\t\tthis.min.add( offset );\r\n\t\tthis.max.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( box ) {\r\n\r\n\t\treturn box.min.equals( this.min ) && box.max.equals( this.max );\r\n\r\n\t}\r\n\r\n}\r\n\r\nBox3.prototype.isBox3 = true;\r\n\r\nconst _points = [\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3(),\r\n\t/*@__PURE__*/ new Vector3()\r\n];\r\n\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\n\r\nconst _box = /*@__PURE__*/ new Box3();\r\n\r\n// triangle centered vertices\r\n\r\nconst _v0 = /*@__PURE__*/ new Vector3();\r\nconst _v1 = /*@__PURE__*/ new Vector3();\r\nconst _v2 = /*@__PURE__*/ new Vector3();\r\n\r\n// triangle edge vectors\r\n\r\nconst _f0 = /*@__PURE__*/ new Vector3();\r\nconst _f1 = /*@__PURE__*/ new Vector3();\r\nconst _f2 = /*@__PURE__*/ new Vector3();\r\n\r\nconst _center = /*@__PURE__*/ new Vector3();\r\nconst _extents = /*@__PURE__*/ new Vector3();\r\nconst _triangleNormal = /*@__PURE__*/ new Vector3();\r\nconst _testAxis = /*@__PURE__*/ new Vector3();\r\n\r\nfunction satForAxes( axes, v0, v1, v2, extents ) {\r\n\r\n\tfor ( let i = 0, j = axes.length - 3; i <= j; i += 3 ) {\r\n\r\n\t\t_testAxis.fromArray( axes, i );\r\n\t\t// project the aabb onto the seperating axis\r\n\t\tconst r = extents.x * Math.abs( _testAxis.x ) + extents.y * Math.abs( _testAxis.y ) + extents.z * Math.abs( _testAxis.z );\r\n\t\t// project all 3 vertices of the triangle onto the seperating axis\r\n\t\tconst p0 = v0.dot( _testAxis );\r\n\t\tconst p1 = v1.dot( _testAxis );\r\n\t\tconst p2 = v2.dot( _testAxis );\r\n\t\t// actual test, basically see if either of the most extreme of the triangle points intersects r\r\n\t\tif ( Math.max( - Math.max( p0, p1, p2 ), Math.min( p0, p1, p2 ) ) > r ) {\r\n\r\n\t\t\t// points of the projected triangle are outside the projected half-length of the aabb\r\n\t\t\t// the axis is seperating and we can exit\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\nexport { Box3 };\r\n", "import { Box3 } from './Box3.js';\r\nimport { Vector3 } from './Vector3.js';\r\n\r\nconst _box = /*@__PURE__*/ new Box3();\r\nconst _v1 = /*@__PURE__*/ new Vector3();\r\nconst _toFarthestPoint = /*@__PURE__*/ new Vector3();\r\nconst _toPoint = /*@__PURE__*/ new Vector3();\r\n\r\nclass Sphere {\r\n\r\n\tconstructor( center = new Vector3(), radius = - 1 ) {\r\n\r\n\t\tthis.center = center;\r\n\t\tthis.radius = radius;\r\n\r\n\t}\r\n\r\n\tset( center, radius ) {\r\n\r\n\t\tthis.center.copy( center );\r\n\t\tthis.radius = radius;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromPoints( points, optionalCenter ) {\r\n\r\n\t\tconst center = this.center;\r\n\r\n\t\tif ( optionalCenter !== undefined ) {\r\n\r\n\t\t\tcenter.copy( optionalCenter );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_box.setFromPoints( points ).getCenter( center );\r\n\r\n\t\t}\r\n\r\n\t\tlet maxRadiusSq = 0;\r\n\r\n\t\tfor ( let i = 0, il = points.length; i < il; i ++ ) {\r\n\r\n\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( points[ i ] ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( sphere ) {\r\n\r\n\t\tthis.center.copy( sphere.center );\r\n\t\tthis.radius = sphere.radius;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tisEmpty() {\r\n\r\n\t\treturn ( this.radius < 0 );\r\n\r\n\t}\r\n\r\n\tmakeEmpty() {\r\n\r\n\t\tthis.center.set( 0, 0, 0 );\r\n\t\tthis.radius = - 1;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcontainsPoint( point ) {\r\n\r\n\t\treturn ( point.distanceToSquared( this.center ) <= ( this.radius * this.radius ) );\r\n\r\n\t}\r\n\r\n\tdistanceToPoint( point ) {\r\n\r\n\t\treturn ( point.distanceTo( this.center ) - this.radius );\r\n\r\n\t}\r\n\r\n\tintersectsSphere( sphere ) {\r\n\r\n\t\tconst radiusSum = this.radius + sphere.radius;\r\n\r\n\t\treturn sphere.center.distanceToSquared( this.center ) <= ( radiusSum * radiusSum );\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\treturn box.intersectsSphere( this );\r\n\r\n\t}\r\n\r\n\tintersectsPlane( plane ) {\r\n\r\n\t\treturn Math.abs( plane.distanceToPoint( this.center ) ) <= this.radius;\r\n\r\n\t}\r\n\r\n\tclampPoint( point, target ) {\r\n\r\n\t\tconst deltaLengthSq = this.center.distanceToSquared( point );\r\n\r\n\t\ttarget.copy( point );\r\n\r\n\t\tif ( deltaLengthSq > ( this.radius * this.radius ) ) {\r\n\r\n\t\t\ttarget.sub( this.center ).normalize();\r\n\t\t\ttarget.multiplyScalar( this.radius ).add( this.center );\r\n\r\n\t\t}\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tgetBoundingBox( target ) {\r\n\r\n\t\tif ( this.isEmpty() ) {\r\n\r\n\t\t\t// Empty sphere produces empty bounding box\r\n\t\t\ttarget.makeEmpty();\r\n\t\t\treturn target;\r\n\r\n\t\t}\r\n\r\n\t\ttarget.set( this.center, this.center );\r\n\t\ttarget.expandByScalar( this.radius );\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix ) {\r\n\r\n\t\tthis.center.applyMatrix4( matrix );\r\n\t\tthis.radius = this.radius * matrix.getMaxScaleOnAxis();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslate( offset ) {\r\n\r\n\t\tthis.center.add( offset );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\texpandByPoint( point ) {\r\n\r\n\t\t// from https://github.com/juj/MathGeoLib/blob/2940b99b99cfe575dd45103ef20f4019dee15b54/src/Geometry/Sphere.cpp#L649-L671\r\n\r\n\t\t_toPoint.subVectors( point, this.center );\r\n\r\n\t\tconst lengthSq = _toPoint.lengthSq();\r\n\r\n\t\tif ( lengthSq > ( this.radius * this.radius ) ) {\r\n\r\n\t\t\tconst length = Math.sqrt( lengthSq );\r\n\t\t\tconst missingRadiusHalf = ( length - this.radius ) * 0.5;\r\n\r\n\t\t\t// Nudge this sphere towards the target point. Add half the missing distance to radius,\r\n\t\t\t// and the other half to position. This gives a tighter enclosure, instead of if\r\n\t\t\t// the whole missing distance were just added to radius.\r\n\r\n\t\t\tthis.center.add( _toPoint.multiplyScalar( missingRadiusHalf / length ) );\r\n\t\t\tthis.radius += missingRadiusHalf;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tunion( sphere ) {\r\n\r\n\t\t// from https://github.com/juj/MathGeoLib/blob/2940b99b99cfe575dd45103ef20f4019dee15b54/src/Geometry/Sphere.cpp#L759-L769\r\n\r\n\t\t// To enclose another sphere into this sphere, we only need to enclose two points:\r\n\t\t// 1) Enclose the farthest point on the other sphere into this sphere.\r\n\t\t// 2) Enclose the opposite point of the farthest point into this sphere.\r\n\r\n\t\t_toFarthestPoint.subVectors( sphere.center, this.center ).normalize().multiplyScalar( sphere.radius );\r\n\r\n\t\tthis.expandByPoint( _v1.copy( sphere.center ).add( _toFarthestPoint ) );\r\n\t\tthis.expandByPoint( _v1.copy( sphere.center ).sub( _toFarthestPoint ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( sphere ) {\r\n\r\n\t\treturn sphere.center.equals( this.center ) && ( sphere.radius === this.radius );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Sphere };\r\n", "import { Matrix3 } from './Matrix3.js';\r\nimport { Vector3 } from './Vector3.js';\r\n\r\nconst _vector1 = /*@__PURE__*/ new Vector3();\r\nconst _vector2 = /*@__PURE__*/ new Vector3();\r\nconst _normalMatrix = /*@__PURE__*/ new Matrix3();\r\n\r\nclass Plane {\r\n\r\n\tconstructor( normal = new Vector3( 1, 0, 0 ), constant = 0 ) {\r\n\r\n\t\t// normal is assumed to be normalized\r\n\r\n\t\tthis.normal = normal;\r\n\t\tthis.constant = constant;\r\n\r\n\t}\r\n\r\n\tset( normal, constant ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = constant;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetComponents( x, y, z, w ) {\r\n\r\n\t\tthis.normal.set( x, y, z );\r\n\t\tthis.constant = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromNormalAndCoplanarPoint( normal, point ) {\r\n\r\n\t\tthis.normal.copy( normal );\r\n\t\tthis.constant = - point.dot( this.normal );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromCoplanarPoints( a, b, c ) {\r\n\r\n\t\tconst normal = _vector1.subVectors( c, b ).cross( _vector2.subVectors( a, b ) ).normalize();\r\n\r\n\t\t// Q: should an error be thrown if normal is zero (e.g. degenerate plane)?\r\n\r\n\t\tthis.setFromNormalAndCoplanarPoint( normal, a );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( plane ) {\r\n\r\n\t\tthis.normal.copy( plane.normal );\r\n\t\tthis.constant = plane.constant;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnormalize() {\r\n\r\n\t\t// Note: will lead to a divide by zero if the plane is invalid.\r\n\r\n\t\tconst inverseNormalLength = 1.0 / this.normal.length();\r\n\t\tthis.normal.multiplyScalar( inverseNormalLength );\r\n\t\tthis.constant *= inverseNormalLength;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnegate() {\r\n\r\n\t\tthis.constant *= - 1;\r\n\t\tthis.normal.negate();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdistanceToPoint( point ) {\r\n\r\n\t\treturn this.normal.dot( point ) + this.constant;\r\n\r\n\t}\r\n\r\n\tdistanceToSphere( sphere ) {\r\n\r\n\t\treturn this.distanceToPoint( sphere.center ) - sphere.radius;\r\n\r\n\t}\r\n\r\n\tprojectPoint( point, target ) {\r\n\r\n\t\treturn target.copy( this.normal ).multiplyScalar( - this.distanceToPoint( point ) ).add( point );\r\n\r\n\t}\r\n\r\n\tintersectLine( line, target ) {\r\n\r\n\t\tconst direction = line.delta( _vector1 );\r\n\r\n\t\tconst denominator = this.normal.dot( direction );\r\n\r\n\t\tif ( denominator === 0 ) {\r\n\r\n\t\t\t// line is coplanar, return origin\r\n\t\t\tif ( this.distanceToPoint( line.start ) === 0 ) {\r\n\r\n\t\t\t\treturn target.copy( line.start );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Unsure if this is the correct method to handle this case.\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tconst t = - ( line.start.dot( this.normal ) + this.constant ) / denominator;\r\n\r\n\t\tif ( t < 0 || t > 1 ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\treturn target.copy( direction ).multiplyScalar( t ).add( line.start );\r\n\r\n\t}\r\n\r\n\tintersectsLine( line ) {\r\n\r\n\t\t// Note: this tests if a line intersects the plane, not whether it (or its end-points) are coplanar with it.\r\n\r\n\t\tconst startSign = this.distanceToPoint( line.start );\r\n\t\tconst endSign = this.distanceToPoint( line.end );\r\n\r\n\t\treturn ( startSign < 0 && endSign > 0 ) || ( endSign < 0 && startSign > 0 );\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\treturn box.intersectsPlane( this );\r\n\r\n\t}\r\n\r\n\tintersectsSphere( sphere ) {\r\n\r\n\t\treturn sphere.intersectsPlane( this );\r\n\r\n\t}\r\n\r\n\tcoplanarPoint( target ) {\r\n\r\n\t\treturn target.copy( this.normal ).multiplyScalar( - this.constant );\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix, optionalNormalMatrix ) {\r\n\r\n\t\tconst normalMatrix = optionalNormalMatrix || _normalMatrix.getNormalMatrix( matrix );\r\n\r\n\t\tconst referencePoint = this.coplanarPoint( _vector1 ).applyMatrix4( matrix );\r\n\r\n\t\tconst normal = this.normal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\tthis.constant = - referencePoint.dot( normal );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslate( offset ) {\r\n\r\n\t\tthis.constant -= offset.dot( this.normal );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( plane ) {\r\n\r\n\t\treturn plane.normal.equals( this.normal ) && ( plane.constant === this.constant );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nPlane.prototype.isPlane = true;\r\n\r\nexport { Plane };\r\n", "import { Vector3 } from './Vector3.js';\r\nimport { Sphere } from './Sphere.js';\r\nimport { Plane } from './Plane.js';\r\n\r\nconst _sphere = /*@__PURE__*/ new Sphere();\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\n\r\nclass Frustum {\r\n\r\n\tconstructor( p0 = new Plane(), p1 = new Plane(), p2 = new Plane(), p3 = new Plane(), p4 = new Plane(), p5 = new Plane() ) {\r\n\r\n\t\tthis.planes = [ p0, p1, p2, p3, p4, p5 ];\r\n\r\n\t}\r\n\r\n\tset( p0, p1, p2, p3, p4, p5 ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\r\n\t\tplanes[ 0 ].copy( p0 );\r\n\t\tplanes[ 1 ].copy( p1 );\r\n\t\tplanes[ 2 ].copy( p2 );\r\n\t\tplanes[ 3 ].copy( p3 );\r\n\t\tplanes[ 4 ].copy( p4 );\r\n\t\tplanes[ 5 ].copy( p5 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( frustum ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tplanes[ i ].copy( frustum.planes[ i ] );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromProjectionMatrix( m ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\t\tconst me = m.elements;\r\n\t\tconst me0 = me[ 0 ], me1 = me[ 1 ], me2 = me[ 2 ], me3 = me[ 3 ];\r\n\t\tconst me4 = me[ 4 ], me5 = me[ 5 ], me6 = me[ 6 ], me7 = me[ 7 ];\r\n\t\tconst me8 = me[ 8 ], me9 = me[ 9 ], me10 = me[ 10 ], me11 = me[ 11 ];\r\n\t\tconst me12 = me[ 12 ], me13 = me[ 13 ], me14 = me[ 14 ], me15 = me[ 15 ];\r\n\r\n\t\tplanes[ 0 ].setComponents( me3 - me0, me7 - me4, me11 - me8, me15 - me12 ).normalize();\r\n\t\tplanes[ 1 ].setComponents( me3 + me0, me7 + me4, me11 + me8, me15 + me12 ).normalize();\r\n\t\tplanes[ 2 ].setComponents( me3 + me1, me7 + me5, me11 + me9, me15 + me13 ).normalize();\r\n\t\tplanes[ 3 ].setComponents( me3 - me1, me7 - me5, me11 - me9, me15 - me13 ).normalize();\r\n\t\tplanes[ 4 ].setComponents( me3 - me2, me7 - me6, me11 - me10, me15 - me14 ).normalize();\r\n\t\tplanes[ 5 ].setComponents( me3 + me2, me7 + me6, me11 + me10, me15 + me14 ).normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tintersectsObject( object ) {\r\n\r\n\t\tconst geometry = object.geometry;\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t_sphere.copy( geometry.boundingSphere ).applyMatrix4( object.matrixWorld );\r\n\r\n\t\treturn this.intersectsSphere( _sphere );\r\n\r\n\t}\r\n\r\n\tintersectsSprite( sprite ) {\r\n\r\n\t\t_sphere.center.set( 0, 0, 0 );\r\n\t\t_sphere.radius = 0.7071067811865476;\r\n\t\t_sphere.applyMatrix4( sprite.matrixWorld );\r\n\r\n\t\treturn this.intersectsSphere( _sphere );\r\n\r\n\t}\r\n\r\n\tintersectsSphere( sphere ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\t\tconst center = sphere.center;\r\n\t\tconst negRadius = - sphere.radius;\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tconst distance = planes[ i ].distanceToPoint( center );\r\n\r\n\t\t\tif ( distance < negRadius ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tconst plane = planes[ i ];\r\n\r\n\t\t\t// corner at max distance\r\n\r\n\t\t\t_vector.x = plane.normal.x > 0 ? box.max.x : box.min.x;\r\n\t\t\t_vector.y = plane.normal.y > 0 ? box.max.y : box.min.y;\r\n\t\t\t_vector.z = plane.normal.z > 0 ? box.max.z : box.min.z;\r\n\r\n\t\t\tif ( plane.distanceToPoint( _vector ) < 0 ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tcontainsPoint( point ) {\r\n\r\n\t\tconst planes = this.planes;\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tif ( planes[ i ].distanceToPoint( point ) < 0 ) {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { Frustum };\r\n", "import { Matrix4 } from '../math/Matrix4.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Vector4 } from '../math/Vector4.js';\r\nimport { Frustum } from '../math/Frustum.js';\r\n\r\nconst _projScreenMatrix = /*@__PURE__*/ new Matrix4();\r\nconst _lightPositionWorld = /*@__PURE__*/ new Vector3();\r\nconst _lookTarget = /*@__PURE__*/ new Vector3();\r\n\r\nclass LightShadow {\r\n\r\n\tconstructor( camera ) {\r\n\r\n\t\tthis.camera = camera;\r\n\r\n\t\tthis.bias = 0;\r\n\t\tthis.normalBias = 0;\r\n\t\tthis.radius = 1;\r\n\t\tthis.blurSamples = 8;\r\n\r\n\t\tthis.mapSize = new Vector2( 512, 512 );\r\n\r\n\t\tthis.map = null;\r\n\t\tthis.mapPass = null;\r\n\t\tthis.matrix = new Matrix4();\r\n\r\n\t\tthis.autoUpdate = true;\r\n\t\tthis.needsUpdate = false;\r\n\r\n\t\tthis._frustum = new Frustum();\r\n\t\tthis._frameExtents = new Vector2( 1, 1 );\r\n\r\n\t\tthis._viewportCount = 1;\r\n\r\n\t\tthis._viewports = [\r\n\r\n\t\t\tnew Vector4( 0, 0, 1, 1 )\r\n\r\n\t\t];\r\n\r\n\t}\r\n\r\n\tgetViewportCount() {\r\n\r\n\t\treturn this._viewportCount;\r\n\r\n\t}\r\n\r\n\tgetFrustum() {\r\n\r\n\t\treturn this._frustum;\r\n\r\n\t}\r\n\r\n\tupdateMatrices( light ) {\r\n\r\n\t\tconst shadowCamera = this.camera;\r\n\t\tconst shadowMatrix = this.matrix;\r\n\r\n\t\t_lightPositionWorld.setFromMatrixPosition( light.matrixWorld );\r\n\t\tshadowCamera.position.copy( _lightPositionWorld );\r\n\r\n\t\t_lookTarget.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\tshadowCamera.lookAt( _lookTarget );\r\n\t\tshadowCamera.updateMatrixWorld();\r\n\r\n\t\t_projScreenMatrix.multiplyMatrices( shadowCamera.projectionMatrix, shadowCamera.matrixWorldInverse );\r\n\t\tthis._frustum.setFromProjectionMatrix( _projScreenMatrix );\r\n\r\n\t\tshadowMatrix.set(\r\n\t\t\t0.5, 0.0, 0.0, 0.5,\r\n\t\t\t0.0, 0.5, 0.0, 0.5,\r\n\t\t\t0.0, 0.0, 0.5, 0.5,\r\n\t\t\t0.0, 0.0, 0.0, 1.0\r\n\t\t);\r\n\r\n\t\tshadowMatrix.multiply( shadowCamera.projectionMatrix );\r\n\t\tshadowMatrix.multiply( shadowCamera.matrixWorldInverse );\r\n\r\n\t}\r\n\r\n\tgetViewport( viewportIndex ) {\r\n\r\n\t\treturn this._viewports[ viewportIndex ];\r\n\r\n\t}\r\n\r\n\tgetFrameExtents() {\r\n\r\n\t\treturn this._frameExtents;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tif ( this.map ) {\r\n\r\n\t\t\tthis.map.dispose();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.mapPass ) {\r\n\r\n\t\t\tthis.mapPass.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tthis.camera = source.camera.clone();\r\n\r\n\t\tthis.bias = source.bias;\r\n\t\tthis.radius = source.radius;\r\n\r\n\t\tthis.mapSize.copy( source.mapSize );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\tconst object = {};\r\n\r\n\t\tif ( this.bias !== 0 ) object.bias = this.bias;\r\n\t\tif ( this.normalBias !== 0 ) object.normalBias = this.normalBias;\r\n\t\tif ( this.radius !== 1 ) object.radius = this.radius;\r\n\t\tif ( this.mapSize.x !== 512 || this.mapSize.y !== 512 ) object.mapSize = this.mapSize.toArray();\r\n\r\n\t\tobject.camera = this.camera.toJSON( false ).object;\r\n\t\tdelete object.camera.matrix;\r\n\r\n\t\treturn object;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { LightShadow };\r\n", "import { Camera } from './Camera.js';\r\n\r\nclass OrthographicCamera extends Camera {\r\n\r\n\tconstructor( left = - 1, right = 1, top = 1, bottom = - 1, near = 0.1, far = 2000 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'OrthographicCamera';\r\n\r\n\t\tthis.zoom = 1;\r\n\t\tthis.view = null;\r\n\r\n\t\tthis.left = left;\r\n\t\tthis.right = right;\r\n\t\tthis.top = top;\r\n\t\tthis.bottom = bottom;\r\n\r\n\t\tthis.near = near;\r\n\t\tthis.far = far;\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tcopy( source, recursive ) {\r\n\r\n\t\tsuper.copy( source, recursive );\r\n\r\n\t\tthis.left = source.left;\r\n\t\tthis.right = source.right;\r\n\t\tthis.top = source.top;\r\n\t\tthis.bottom = source.bottom;\r\n\t\tthis.near = source.near;\r\n\t\tthis.far = source.far;\r\n\r\n\t\tthis.zoom = source.zoom;\r\n\t\tthis.view = source.view === null ? null : Object.assign( {}, source.view );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetViewOffset( fullWidth, fullHeight, x, y, width, height ) {\r\n\r\n\t\tif ( this.view === null ) {\r\n\r\n\t\t\tthis.view = {\r\n\t\t\t\tenabled: true,\r\n\t\t\t\tfullWidth: 1,\r\n\t\t\t\tfullHeight: 1,\r\n\t\t\t\toffsetX: 0,\r\n\t\t\t\toffsetY: 0,\r\n\t\t\t\twidth: 1,\r\n\t\t\t\theight: 1\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tthis.view.enabled = true;\r\n\t\tthis.view.fullWidth = fullWidth;\r\n\t\tthis.view.fullHeight = fullHeight;\r\n\t\tthis.view.offsetX = x;\r\n\t\tthis.view.offsetY = y;\r\n\t\tthis.view.width = width;\r\n\t\tthis.view.height = height;\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tclearViewOffset() {\r\n\r\n\t\tif ( this.view !== null ) {\r\n\r\n\t\t\tthis.view.enabled = false;\r\n\r\n\t\t}\r\n\r\n\t\tthis.updateProjectionMatrix();\r\n\r\n\t}\r\n\r\n\tupdateProjectionMatrix() {\r\n\r\n\t\tconst dx = ( this.right - this.left ) / ( 2 * this.zoom );\r\n\t\tconst dy = ( this.top - this.bottom ) / ( 2 * this.zoom );\r\n\t\tconst cx = ( this.right + this.left ) / 2;\r\n\t\tconst cy = ( this.top + this.bottom ) / 2;\r\n\r\n\t\tlet left = cx - dx;\r\n\t\tlet right = cx + dx;\r\n\t\tlet top = cy + dy;\r\n\t\tlet bottom = cy - dy;\r\n\r\n\t\tif ( this.view !== null && this.view.enabled ) {\r\n\r\n\t\t\tconst scaleW = ( this.right - this.left ) / this.view.fullWidth / this.zoom;\r\n\t\t\tconst scaleH = ( this.top - this.bottom ) / this.view.fullHeight / this.zoom;\r\n\r\n\t\t\tleft += scaleW * this.view.offsetX;\r\n\t\t\tright = left + scaleW * this.view.width;\r\n\t\t\ttop -= scaleH * this.view.offsetY;\r\n\t\t\tbottom = top - scaleH * this.view.height;\r\n\r\n\t\t}\r\n\r\n\t\tthis.projectionMatrix.makeOrthographic( left, right, top, bottom, this.near, this.far );\r\n\r\n\t\tthis.projectionMatrixInverse.copy( this.projectionMatrix ).invert();\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst data = super.toJSON( meta );\r\n\r\n\t\tdata.object.zoom = this.zoom;\r\n\t\tdata.object.left = this.left;\r\n\t\tdata.object.right = this.right;\r\n\t\tdata.object.top = this.top;\r\n\t\tdata.object.bottom = this.bottom;\r\n\t\tdata.object.near = this.near;\r\n\t\tdata.object.far = this.far;\r\n\r\n\t\tif ( this.view !== null ) data.object.view = Object.assign( {}, this.view );\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nOrthographicCamera.prototype.isOrthographicCamera = true;\r\n\r\nexport { OrthographicCamera };\r\n", "import { LightShadow } from './LightShadow.js';\r\nimport { OrthographicCamera } from '../cameras/OrthographicCamera.js';\r\n\r\nclass DirectionalLightShadow extends LightShadow {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper( new OrthographicCamera( - 5, 5, 5, - 5, 0.5, 500 ) );\r\n\r\n\t}\r\n\r\n}\r\n\r\nDirectionalLightShadow.prototype.isDirectionalLightShadow = true;\r\n\r\nexport { DirectionalLightShadow };\r\n", "import { Light } from './Light.js';\r\nimport { DirectionalLightShadow } from './DirectionalLightShadow.js';\r\nimport { Object3D } from '../core/Object3D.js';\r\n\r\nclass DirectionalLight extends Light {\r\n\r\n\tconstructor( color, intensity ) {\r\n\r\n\t\tsuper( color, intensity );\r\n\r\n\t\tthis.type = 'DirectionalLight';\r\n\r\n\t\tthis.position.copy( Object3D.DefaultUp );\r\n\t\tthis.updateMatrix();\r\n\r\n\t\tthis.target = new Object3D();\r\n\r\n\t\tthis.shadow = new DirectionalLightShadow();\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.shadow.dispose();\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.target = source.target.clone();\r\n\t\tthis.shadow = source.shadow.clone();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nDirectionalLight.prototype.isDirectionalLight = true;\r\n\r\nexport { DirectionalLight };\r\n", "import { Vector4 } from '../math/Vector4.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Color } from '../math/Color.js';\r\nimport { StaticDrawUsage } from '../constants.js';\r\n\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\nconst _vector2 = /*@__PURE__*/ new Vector2();\r\n\r\nclass BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tif ( Array.isArray( array ) ) {\r\n\r\n\t\t\tthrow new TypeError( 'THREE.BufferAttribute: array should be a Typed Array.' );\r\n\r\n\t\t}\r\n\r\n\t\tthis.name = '';\r\n\r\n\t\tthis.array = array;\r\n\t\tthis.itemSize = itemSize;\r\n\t\tthis.count = array !== undefined ? array.length / itemSize : 0;\r\n\t\tthis.normalized = normalized === true;\r\n\r\n\t\tthis.usage = StaticDrawUsage;\r\n\t\tthis.updateRange = { offset: 0, count: - 1 };\r\n\r\n\t\tthis.version = 0;\r\n\r\n\t}\r\n\r\n\tonUploadCallback() {}\r\n\r\n\tset needsUpdate( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t}\r\n\r\n\tsetUsage( value ) {\r\n\r\n\t\tthis.usage = value;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tthis.name = source.name;\r\n\t\tthis.array = new source.array.constructor( source.array );\r\n\t\tthis.itemSize = source.itemSize;\r\n\t\tthis.count = source.count;\r\n\t\tthis.normalized = source.normalized;\r\n\r\n\t\tthis.usage = source.usage;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyAt( index1, attribute, index2 ) {\r\n\r\n\t\tindex1 *= this.itemSize;\r\n\t\tindex2 *= attribute.itemSize;\r\n\r\n\t\tfor ( let i = 0, l = this.itemSize; i < l; i ++ ) {\r\n\r\n\t\t\tthis.array[ index1 + i ] = attribute.array[ index2 + i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyArray( array ) {\r\n\r\n\t\tthis.array.set( array );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyColorsArray( colors ) {\r\n\r\n\t\tconst array = this.array;\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor ( let i = 0, l = colors.length; i < l; i ++ ) {\r\n\r\n\t\t\tlet color = colors[ i ];\r\n\r\n\t\t\tif ( color === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyColorsArray(): color is undefined', i );\r\n\t\t\t\tcolor = new Color();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = color.r;\r\n\t\t\tarray[ offset ++ ] = color.g;\r\n\t\t\tarray[ offset ++ ] = color.b;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyVector2sArray( vectors ) {\r\n\r\n\t\tconst array = this.array;\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tlet vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector2sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new Vector2();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyVector3sArray( vectors ) {\r\n\r\n\t\tconst array = this.array;\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tlet vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector3sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new Vector3();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\t\t\tarray[ offset ++ ] = vector.z;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopyVector4sArray( vectors ) {\r\n\r\n\t\tconst array = this.array;\r\n\t\tlet offset = 0;\r\n\r\n\t\tfor ( let i = 0, l = vectors.length; i < l; i ++ ) {\r\n\r\n\t\t\tlet vector = vectors[ i ];\r\n\r\n\t\t\tif ( vector === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.BufferAttribute.copyVector4sArray(): vector is undefined', i );\r\n\t\t\t\tvector = new Vector4();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray[ offset ++ ] = vector.x;\r\n\t\t\tarray[ offset ++ ] = vector.y;\r\n\t\t\tarray[ offset ++ ] = vector.z;\r\n\t\t\tarray[ offset ++ ] = vector.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyMatrix3( m ) {\r\n\r\n\t\tif ( this.itemSize === 2 ) {\r\n\r\n\t\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\r\n\r\n\t\t\t\t_vector2.fromBufferAttribute( this, i );\r\n\t\t\t\t_vector2.applyMatrix3( m );\r\n\r\n\t\t\t\tthis.setXY( i, _vector2.x, _vector2.y );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( this.itemSize === 3 ) {\r\n\r\n\t\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\r\n\r\n\t\t\t\t_vector.fromBufferAttribute( this, i );\r\n\t\t\t\t_vector.applyMatrix3( m );\r\n\r\n\t\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( m ) {\r\n\r\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\r\n\r\n\t\t\t_vector.x = this.getX( i );\r\n\t\t\t_vector.y = this.getY( i );\r\n\t\t\t_vector.z = this.getZ( i );\r\n\r\n\t\t\t_vector.applyMatrix4( m );\r\n\r\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyNormalMatrix( m ) {\r\n\r\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\r\n\r\n\t\t\t_vector.x = this.getX( i );\r\n\t\t\t_vector.y = this.getY( i );\r\n\t\t\t_vector.z = this.getZ( i );\r\n\r\n\t\t\t_vector.applyNormalMatrix( m );\r\n\r\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttransformDirection( m ) {\r\n\r\n\t\tfor ( let i = 0, l = this.count; i < l; i ++ ) {\r\n\r\n\t\t\t_vector.x = this.getX( i );\r\n\t\t\t_vector.y = this.getY( i );\r\n\t\t\t_vector.z = this.getZ( i );\r\n\r\n\t\t\t_vector.transformDirection( m );\r\n\r\n\t\t\tthis.setXYZ( i, _vector.x, _vector.y, _vector.z );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tset( value, offset = 0 ) {\r\n\r\n\t\tthis.array.set( value, offset );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetX( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize ];\r\n\r\n\t}\r\n\r\n\tsetX( index, x ) {\r\n\r\n\t\tthis.array[ index * this.itemSize ] = x;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetY( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 1 ];\r\n\r\n\t}\r\n\r\n\tsetY( index, y ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetZ( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 2 ];\r\n\r\n\t}\r\n\r\n\tsetZ( index, z ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetW( index ) {\r\n\r\n\t\treturn this.array[ index * this.itemSize + 3 ];\r\n\r\n\t}\r\n\r\n\tsetW( index, w ) {\r\n\r\n\t\tthis.array[ index * this.itemSize + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetXY( index, x, y ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetXYZ( index, x, y, z ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetXYZW( index, x, y, z, w ) {\r\n\r\n\t\tindex *= this.itemSize;\r\n\r\n\t\tthis.array[ index + 0 ] = x;\r\n\t\tthis.array[ index + 1 ] = y;\r\n\t\tthis.array[ index + 2 ] = z;\r\n\t\tthis.array[ index + 3 ] = w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tonUpload( callback ) {\r\n\r\n\t\tthis.onUploadCallback = callback;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor( this.array, this.itemSize ).copy( this );\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\tconst data = {\r\n\t\t\titemSize: this.itemSize,\r\n\t\t\ttype: this.array.constructor.name,\r\n\t\t\tarray: Array.prototype.slice.call( this.array ),\r\n\t\t\tnormalized: this.normalized\r\n\t\t};\r\n\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\t\tif ( this.usage !== StaticDrawUsage ) data.usage = this.usage;\r\n\t\tif ( this.updateRange.offset !== 0 || this.updateRange.count !== - 1 ) data.updateRange = this.updateRange;\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nBufferAttribute.prototype.isBufferAttribute = true;\r\n\r\n//\r\n\r\nclass Int8BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Int8Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Uint8BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Uint8Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Uint8ClampedBufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Uint8ClampedArray( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Int16BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Int16Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Uint16BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Uint16Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Int32BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Int32Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Uint32BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Uint32Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Float16BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Uint16Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nFloat16BufferAttribute.prototype.isFloat16BufferAttribute = true;\r\n\r\nclass Float32BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Float32Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass Float64BufferAttribute extends BufferAttribute {\r\n\r\n\tconstructor( array, itemSize, normalized ) {\r\n\r\n\t\tsuper( new Float64Array( array ), itemSize, normalized );\r\n\r\n\t}\r\n\r\n}\r\n\r\n//\r\n\r\nexport {\r\n\tFloat64BufferAttribute,\r\n\tFloat32BufferAttribute,\r\n\tFloat16BufferAttribute,\r\n\tUint32BufferAttribute,\r\n\tInt32BufferAttribute,\r\n\tUint16BufferAttribute,\r\n\tInt16BufferAttribute,\r\n\tUint8ClampedBufferAttribute,\r\n\tUint8BufferAttribute,\r\n\tInt8BufferAttribute,\r\n\tBufferAttribute\r\n};\r\n", "function arrayMin( array ) {\r\n\r\n\tif ( array.length === 0 ) return Infinity;\r\n\r\n\tlet min = array[ 0 ];\r\n\r\n\tfor ( let i = 1, l = array.length; i < l; ++ i ) {\r\n\r\n\t\tif ( array[ i ] < min ) min = array[ i ];\r\n\r\n\t}\r\n\r\n\treturn min;\r\n\r\n}\r\n\r\nfunction arrayMax( array ) {\r\n\r\n\tif ( array.length === 0 ) return - Infinity;\r\n\r\n\tlet max = array[ 0 ];\r\n\r\n\tfor ( let i = 1, l = array.length; i < l; ++ i ) {\r\n\r\n\t\tif ( array[ i ] > max ) max = array[ i ];\r\n\r\n\t}\r\n\r\n\treturn max;\r\n\r\n}\r\n\r\nconst TYPED_ARRAYS = {\r\n\tInt8Array: Int8Array,\r\n\tUint8Array: Uint8Array,\r\n\tUint8ClampedArray: Uint8ClampedArray,\r\n\tInt16Array: Int16Array,\r\n\tUint16Array: Uint16Array,\r\n\tInt32Array: Int32Array,\r\n\tUint32Array: Uint32Array,\r\n\tFloat32Array: Float32Array,\r\n\tFloat64Array: Float64Array\r\n};\r\n\r\nfunction getTypedArray( type, buffer ) {\r\n\r\n\treturn new TYPED_ARRAYS[ type ]( buffer );\r\n\r\n}\r\n\r\nexport { arrayMin, arrayMax, getTypedArray };\r\n", "import { Vector3 } from '../math/Vector3.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Box3 } from '../math/Box3.js';\r\nimport { EventDispatcher } from './EventDispatcher.js';\r\nimport { BufferAttribute, Float32BufferAttribute, Uint16BufferAttribute, Uint32BufferAttribute } from './BufferAttribute.js';\r\nimport { Sphere } from '../math/Sphere.js';\r\nimport { Object3D } from './Object3D.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\nimport { Matrix3 } from '../math/Matrix3.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\nimport { arrayMax } from '../utils.js';\r\n\r\nlet _id = 0;\r\n\r\nconst _m1 = /*@__PURE__*/ new Matrix4();\r\nconst _obj = /*@__PURE__*/ new Object3D();\r\nconst _offset = /*@__PURE__*/ new Vector3();\r\nconst _box = /*@__PURE__*/ new Box3();\r\nconst _boxMorphTargets = /*@__PURE__*/ new Box3();\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\n\r\nclass BufferGeometry extends EventDispatcher {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tObject.defineProperty( this, 'id', { value: _id ++ } );\r\n\r\n\t\tthis.uuid = MathUtils.generateUUID();\r\n\r\n\t\tthis.name = '';\r\n\t\tthis.type = 'BufferGeometry';\r\n\r\n\t\tthis.index = null;\r\n\t\tthis.attributes = {};\r\n\r\n\t\tthis.morphAttributes = {};\r\n\t\tthis.morphTargetsRelative = false;\r\n\r\n\t\tthis.groups = [];\r\n\r\n\t\tthis.boundingBox = null;\r\n\t\tthis.boundingSphere = null;\r\n\r\n\t\tthis.drawRange = { start: 0, count: Infinity };\r\n\r\n\t\tthis.userData = {};\r\n\r\n\t}\r\n\r\n\tgetIndex() {\r\n\r\n\t\treturn this.index;\r\n\r\n\t}\r\n\r\n\tsetIndex( index ) {\r\n\r\n\t\tif ( Array.isArray( index ) ) {\r\n\r\n\t\t\tthis.index = new ( arrayMax( index ) > 65535 ? Uint32BufferAttribute : Uint16BufferAttribute )( index, 1 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.index = index;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetAttribute( name ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t}\r\n\r\n\tsetAttribute( name, attribute ) {\r\n\r\n\t\tthis.attributes[ name ] = attribute;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdeleteAttribute( name ) {\r\n\r\n\t\tdelete this.attributes[ name ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\thasAttribute( name ) {\r\n\r\n\t\treturn this.attributes[ name ] !== undefined;\r\n\r\n\t}\r\n\r\n\taddGroup( start, count, materialIndex = 0 ) {\r\n\r\n\t\tthis.groups.push( {\r\n\r\n\t\t\tstart: start,\r\n\t\t\tcount: count,\r\n\t\t\tmaterialIndex: materialIndex\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tclearGroups() {\r\n\r\n\t\tthis.groups = [];\r\n\r\n\t}\r\n\r\n\tsetDrawRange( start, count ) {\r\n\r\n\t\tthis.drawRange.start = start;\r\n\t\tthis.drawRange.count = count;\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix ) {\r\n\r\n\t\tconst position = this.attributes.position;\r\n\r\n\t\tif ( position !== undefined ) {\r\n\r\n\t\t\tposition.applyMatrix4( matrix );\r\n\r\n\t\t\tposition.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tconst normal = this.attributes.normal;\r\n\r\n\t\tif ( normal !== undefined ) {\r\n\r\n\t\t\tconst normalMatrix = new Matrix3().getNormalMatrix( matrix );\r\n\r\n\t\t\tnormal.applyNormalMatrix( normalMatrix );\r\n\r\n\t\t\tnormal.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tconst tangent = this.attributes.tangent;\r\n\r\n\t\tif ( tangent !== undefined ) {\r\n\r\n\t\t\ttangent.transformDirection( matrix );\r\n\r\n\t\t\ttangent.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingBox !== null ) {\r\n\r\n\t\t\tthis.computeBoundingBox();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.boundingSphere !== null ) {\r\n\r\n\t\t\tthis.computeBoundingSphere();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tapplyQuaternion( q ) {\r\n\r\n\t\t_m1.makeRotationFromQuaternion( q );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateX( angle ) {\r\n\r\n\t\t// rotate geometry around world x-axis\r\n\r\n\t\t_m1.makeRotationX( angle );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateY( angle ) {\r\n\r\n\t\t// rotate geometry around world y-axis\r\n\r\n\t\t_m1.makeRotationY( angle );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trotateZ( angle ) {\r\n\r\n\t\t// rotate geometry around world z-axis\r\n\r\n\t\t_m1.makeRotationZ( angle );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttranslate( x, y, z ) {\r\n\r\n\t\t// translate geometry\r\n\r\n\t\t_m1.makeTranslation( x, y, z );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tscale( x, y, z ) {\r\n\r\n\t\t// scale geometry\r\n\r\n\t\t_m1.makeScale( x, y, z );\r\n\r\n\t\tthis.applyMatrix4( _m1 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tlookAt( vector ) {\r\n\r\n\t\t_obj.lookAt( vector );\r\n\r\n\t\t_obj.updateMatrix();\r\n\r\n\t\tthis.applyMatrix4( _obj.matrix );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcenter() {\r\n\r\n\t\tthis.computeBoundingBox();\r\n\r\n\t\tthis.boundingBox.getCenter( _offset ).negate();\r\n\r\n\t\tthis.translate( _offset.x, _offset.y, _offset.z );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromPoints( points ) {\r\n\r\n\t\tconst position = [];\r\n\r\n\t\tfor ( let i = 0, l = points.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst point = points[ i ];\r\n\t\t\tposition.push( point.x, point.y, point.z || 0 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( position, 3 ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcomputeBoundingBox() {\r\n\r\n\t\tif ( this.boundingBox === null ) {\r\n\r\n\t\t\tthis.boundingBox = new Box3();\r\n\r\n\t\t}\r\n\r\n\t\tconst position = this.attributes.position;\r\n\t\tconst morphAttributesPosition = this.morphAttributes.position;\r\n\r\n\t\tif ( position && position.isGLBufferAttribute ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set \"mesh.frustumCulled\" to \"false\".', this );\r\n\r\n\t\t\tthis.boundingBox.set(\r\n\t\t\t\tnew Vector3( - Infinity, - Infinity, - Infinity ),\r\n\t\t\t\tnew Vector3( + Infinity, + Infinity, + Infinity )\r\n\t\t\t);\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( position !== undefined ) {\r\n\r\n\t\t\tthis.boundingBox.setFromBufferAttribute( position );\r\n\r\n\t\t\t// process morph attributes if present\r\n\r\n\t\t\tif ( morphAttributesPosition ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\r\n\t\t\t\t\t_box.setFromBufferAttribute( morphAttribute );\r\n\r\n\t\t\t\t\tif ( this.morphTargetsRelative ) {\r\n\r\n\t\t\t\t\t\t_vector.addVectors( this.boundingBox.min, _box.min );\r\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _vector );\r\n\r\n\t\t\t\t\t\t_vector.addVectors( this.boundingBox.max, _box.max );\r\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _vector );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _box.min );\r\n\t\t\t\t\t\tthis.boundingBox.expandByPoint( _box.max );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.boundingBox.makeEmpty();\r\n\r\n\t\t}\r\n\r\n\t\tif ( isNaN( this.boundingBox.min.x ) || isNaN( this.boundingBox.min.y ) || isNaN( this.boundingBox.min.z ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.', this );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcomputeBoundingSphere() {\r\n\r\n\t\tif ( this.boundingSphere === null ) {\r\n\r\n\t\t\tthis.boundingSphere = new Sphere();\r\n\r\n\t\t}\r\n\r\n\t\tconst position = this.attributes.position;\r\n\t\tconst morphAttributesPosition = this.morphAttributes.position;\r\n\r\n\t\tif ( position && position.isGLBufferAttribute ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set \"mesh.frustumCulled\" to \"false\".', this );\r\n\r\n\t\t\tthis.boundingSphere.set( new Vector3(), Infinity );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( position ) {\r\n\r\n\t\t\t// first, find the center of the bounding sphere\r\n\r\n\t\t\tconst center = this.boundingSphere.center;\r\n\r\n\t\t\t_box.setFromBufferAttribute( position );\r\n\r\n\t\t\t// process morph attributes if present\r\n\r\n\t\t\tif ( morphAttributesPosition ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\r\n\t\t\t\t\t_boxMorphTargets.setFromBufferAttribute( morphAttribute );\r\n\r\n\t\t\t\t\tif ( this.morphTargetsRelative ) {\r\n\r\n\t\t\t\t\t\t_vector.addVectors( _box.min, _boxMorphTargets.min );\r\n\t\t\t\t\t\t_box.expandByPoint( _vector );\r\n\r\n\t\t\t\t\t\t_vector.addVectors( _box.max, _boxMorphTargets.max );\r\n\t\t\t\t\t\t_box.expandByPoint( _vector );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t_box.expandByPoint( _boxMorphTargets.min );\r\n\t\t\t\t\t\t_box.expandByPoint( _boxMorphTargets.max );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_box.getCenter( center );\r\n\r\n\t\t\t// second, try to find a boundingSphere with a radius smaller than the\r\n\t\t\t// boundingSphere of the boundingBox: sqrt(3) smaller in the best case\r\n\r\n\t\t\tlet maxRadiusSq = 0;\r\n\r\n\t\t\tfor ( let i = 0, il = position.count; i < il; i ++ ) {\r\n\r\n\t\t\t\t_vector.fromBufferAttribute( position, i );\r\n\r\n\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// process morph attributes if present\r\n\r\n\t\t\tif ( morphAttributesPosition ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = morphAttributesPosition.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tconst morphAttribute = morphAttributesPosition[ i ];\r\n\t\t\t\t\tconst morphTargetsRelative = this.morphTargetsRelative;\r\n\r\n\t\t\t\t\tfor ( let j = 0, jl = morphAttribute.count; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\t\t_vector.fromBufferAttribute( morphAttribute, j );\r\n\r\n\t\t\t\t\t\tif ( morphTargetsRelative ) {\r\n\r\n\t\t\t\t\t\t\t_offset.fromBufferAttribute( position, j );\r\n\t\t\t\t\t\t\t_vector.add( _offset );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmaxRadiusSq = Math.max( maxRadiusSq, center.distanceToSquared( _vector ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.boundingSphere.radius = Math.sqrt( maxRadiusSq );\r\n\r\n\t\t\tif ( isNaN( this.boundingSphere.radius ) ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.', this );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcomputeFaceNormals() {\r\n\r\n\t\t// backwards compatibility\r\n\r\n\t}\r\n\r\n\tcomputeTangents() {\r\n\r\n\t\tconst index = this.index;\r\n\t\tconst attributes = this.attributes;\r\n\r\n\t\t// based on http://www.terathon.com/code/tangent.html\r\n\t\t// (per vertex tangents)\r\n\r\n\t\tif ( index === null ||\r\n\t\t\t attributes.position === undefined ||\r\n\t\t\t attributes.normal === undefined ||\r\n\t\t\t attributes.uv === undefined ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst indices = index.array;\r\n\t\tconst positions = attributes.position.array;\r\n\t\tconst normals = attributes.normal.array;\r\n\t\tconst uvs = attributes.uv.array;\r\n\r\n\t\tconst nVertices = positions.length / 3;\r\n\r\n\t\tif ( attributes.tangent === undefined ) {\r\n\r\n\t\t\tthis.setAttribute( 'tangent', new BufferAttribute( new Float32Array( 4 * nVertices ), 4 ) );\r\n\r\n\t\t}\r\n\r\n\t\tconst tangents = attributes.tangent.array;\r\n\r\n\t\tconst tan1 = [], tan2 = [];\r\n\r\n\t\tfor ( let i = 0; i < nVertices; i ++ ) {\r\n\r\n\t\t\ttan1[ i ] = new Vector3();\r\n\t\t\ttan2[ i ] = new Vector3();\r\n\r\n\t\t}\r\n\r\n\t\tconst vA = new Vector3(),\r\n\t\t\tvB = new Vector3(),\r\n\t\t\tvC = new Vector3(),\r\n\r\n\t\t\tuvA = new Vector2(),\r\n\t\t\tuvB = new Vector2(),\r\n\t\t\tuvC = new Vector2(),\r\n\r\n\t\t\tsdir = new Vector3(),\r\n\t\t\ttdir = new Vector3();\r\n\r\n\t\tfunction handleTriangle( a, b, c ) {\r\n\r\n\t\t\tvA.fromArray( positions, a * 3 );\r\n\t\t\tvB.fromArray( positions, b * 3 );\r\n\t\t\tvC.fromArray( positions, c * 3 );\r\n\r\n\t\t\tuvA.fromArray( uvs, a * 2 );\r\n\t\t\tuvB.fromArray( uvs, b * 2 );\r\n\t\t\tuvC.fromArray( uvs, c * 2 );\r\n\r\n\t\t\tvB.sub( vA );\r\n\t\t\tvC.sub( vA );\r\n\r\n\t\t\tuvB.sub( uvA );\r\n\t\t\tuvC.sub( uvA );\r\n\r\n\t\t\tconst r = 1.0 / ( uvB.x * uvC.y - uvC.x * uvB.y );\r\n\r\n\t\t\t// silently ignore degenerate uv triangles having coincident or colinear vertices\r\n\r\n\t\t\tif ( ! isFinite( r ) ) return;\r\n\r\n\t\t\tsdir.copy( vB ).multiplyScalar( uvC.y ).addScaledVector( vC, - uvB.y ).multiplyScalar( r );\r\n\t\t\ttdir.copy( vC ).multiplyScalar( uvB.x ).addScaledVector( vB, - uvC.x ).multiplyScalar( r );\r\n\r\n\t\t\ttan1[ a ].add( sdir );\r\n\t\t\ttan1[ b ].add( sdir );\r\n\t\t\ttan1[ c ].add( sdir );\r\n\r\n\t\t\ttan2[ a ].add( tdir );\r\n\t\t\ttan2[ b ].add( tdir );\r\n\t\t\ttan2[ c ].add( tdir );\r\n\r\n\t\t}\r\n\r\n\t\tlet groups = this.groups;\r\n\r\n\t\tif ( groups.length === 0 ) {\r\n\r\n\t\t\tgroups = [ {\r\n\t\t\t\tstart: 0,\r\n\t\t\t\tcount: indices.length\r\n\t\t\t} ];\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let i = 0, il = groups.length; i < il; ++ i ) {\r\n\r\n\t\t\tconst group = groups[ i ];\r\n\r\n\t\t\tconst start = group.start;\r\n\t\t\tconst count = group.count;\r\n\r\n\t\t\tfor ( let j = start, jl = start + count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\thandleTriangle(\r\n\t\t\t\t\tindices[ j + 0 ],\r\n\t\t\t\t\tindices[ j + 1 ],\r\n\t\t\t\t\tindices[ j + 2 ]\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst tmp = new Vector3(), tmp2 = new Vector3();\r\n\t\tconst n = new Vector3(), n2 = new Vector3();\r\n\r\n\t\tfunction handleVertex( v ) {\r\n\r\n\t\t\tn.fromArray( normals, v * 3 );\r\n\t\t\tn2.copy( n );\r\n\r\n\t\t\tconst t = tan1[ v ];\r\n\r\n\t\t\t// Gram-Schmidt orthogonalize\r\n\r\n\t\t\ttmp.copy( t );\r\n\t\t\ttmp.sub( n.multiplyScalar( n.dot( t ) ) ).normalize();\r\n\r\n\t\t\t// Calculate handedness\r\n\r\n\t\t\ttmp2.crossVectors( n2, t );\r\n\t\t\tconst test = tmp2.dot( tan2[ v ] );\r\n\t\t\tconst w = ( test < 0.0 ) ? - 1.0 : 1.0;\r\n\r\n\t\t\ttangents[ v * 4 ] = tmp.x;\r\n\t\t\ttangents[ v * 4 + 1 ] = tmp.y;\r\n\t\t\ttangents[ v * 4 + 2 ] = tmp.z;\r\n\t\t\ttangents[ v * 4 + 3 ] = w;\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let i = 0, il = groups.length; i < il; ++ i ) {\r\n\r\n\t\t\tconst group = groups[ i ];\r\n\r\n\t\t\tconst start = group.start;\r\n\t\t\tconst count = group.count;\r\n\r\n\t\t\tfor ( let j = start, jl = start + count; j < jl; j += 3 ) {\r\n\r\n\t\t\t\thandleVertex( indices[ j + 0 ] );\r\n\t\t\t\thandleVertex( indices[ j + 1 ] );\r\n\t\t\t\thandleVertex( indices[ j + 2 ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcomputeVertexNormals() {\r\n\r\n\t\tconst index = this.index;\r\n\t\tconst positionAttribute = this.getAttribute( 'position' );\r\n\r\n\t\tif ( positionAttribute !== undefined ) {\r\n\r\n\t\t\tlet normalAttribute = this.getAttribute( 'normal' );\r\n\r\n\t\t\tif ( normalAttribute === undefined ) {\r\n\r\n\t\t\t\tnormalAttribute = new BufferAttribute( new Float32Array( positionAttribute.count * 3 ), 3 );\r\n\t\t\t\tthis.setAttribute( 'normal', normalAttribute );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// reset existing normals to zero\r\n\r\n\t\t\t\tfor ( let i = 0, il = normalAttribute.count; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tnormalAttribute.setXYZ( i, 0, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst pA = new Vector3(), pB = new Vector3(), pC = new Vector3();\r\n\t\t\tconst nA = new Vector3(), nB = new Vector3(), nC = new Vector3();\r\n\t\t\tconst cb = new Vector3(), ab = new Vector3();\r\n\r\n\t\t\t// indexed elements\r\n\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = index.count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tconst vA = index.getX( i + 0 );\r\n\t\t\t\t\tconst vB = index.getX( i + 1 );\r\n\t\t\t\t\tconst vC = index.getX( i + 2 );\r\n\r\n\t\t\t\t\tpA.fromBufferAttribute( positionAttribute, vA );\r\n\t\t\t\t\tpB.fromBufferAttribute( positionAttribute, vB );\r\n\t\t\t\t\tpC.fromBufferAttribute( positionAttribute, vC );\r\n\r\n\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\tnA.fromBufferAttribute( normalAttribute, vA );\r\n\t\t\t\t\tnB.fromBufferAttribute( normalAttribute, vB );\r\n\t\t\t\t\tnC.fromBufferAttribute( normalAttribute, vC );\r\n\r\n\t\t\t\t\tnA.add( cb );\r\n\t\t\t\t\tnB.add( cb );\r\n\t\t\t\t\tnC.add( cb );\r\n\r\n\t\t\t\t\tnormalAttribute.setXYZ( vA, nA.x, nA.y, nA.z );\r\n\t\t\t\t\tnormalAttribute.setXYZ( vB, nB.x, nB.y, nB.z );\r\n\t\t\t\t\tnormalAttribute.setXYZ( vC, nC.x, nC.y, nC.z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed elements (unconnected triangle soup)\r\n\r\n\t\t\t\tfor ( let i = 0, il = positionAttribute.count; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\tpA.fromBufferAttribute( positionAttribute, i + 0 );\r\n\t\t\t\t\tpB.fromBufferAttribute( positionAttribute, i + 1 );\r\n\t\t\t\t\tpC.fromBufferAttribute( positionAttribute, i + 2 );\r\n\r\n\t\t\t\t\tcb.subVectors( pC, pB );\r\n\t\t\t\t\tab.subVectors( pA, pB );\r\n\t\t\t\t\tcb.cross( ab );\r\n\r\n\t\t\t\t\tnormalAttribute.setXYZ( i + 0, cb.x, cb.y, cb.z );\r\n\t\t\t\t\tnormalAttribute.setXYZ( i + 1, cb.x, cb.y, cb.z );\r\n\t\t\t\t\tnormalAttribute.setXYZ( i + 2, cb.x, cb.y, cb.z );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.normalizeNormals();\r\n\r\n\t\t\tnormalAttribute.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tmerge( geometry, offset ) {\r\n\r\n\t\tif ( ! ( geometry && geometry.isBufferGeometry ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.', geometry );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( offset === undefined ) {\r\n\r\n\t\t\toffset = 0;\r\n\r\n\t\t\tconsole.warn(\r\n\t\t\t\t'THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. '\r\n\t\t\t\t+ 'Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge.'\r\n\t\t\t);\r\n\r\n\t\t}\r\n\r\n\t\tconst attributes = this.attributes;\r\n\r\n\t\tfor ( const key in attributes ) {\r\n\r\n\t\t\tif ( geometry.attributes[ key ] === undefined ) continue;\r\n\r\n\t\t\tconst attribute1 = attributes[ key ];\r\n\t\t\tconst attributeArray1 = attribute1.array;\r\n\r\n\t\t\tconst attribute2 = geometry.attributes[ key ];\r\n\t\t\tconst attributeArray2 = attribute2.array;\r\n\r\n\t\t\tconst attributeOffset = attribute2.itemSize * offset;\r\n\t\t\tconst length = Math.min( attributeArray2.length, attributeArray1.length - attributeOffset );\r\n\r\n\t\t\tfor ( let i = 0, j = attributeOffset; i < length; i ++, j ++ ) {\r\n\r\n\t\t\t\tattributeArray1[ j ] = attributeArray2[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tnormalizeNormals() {\r\n\r\n\t\tconst normals = this.attributes.normal;\r\n\r\n\t\tfor ( let i = 0, il = normals.count; i < il; i ++ ) {\r\n\r\n\t\t\t_vector.fromBufferAttribute( normals, i );\r\n\r\n\t\t\t_vector.normalize();\r\n\r\n\t\t\tnormals.setXYZ( i, _vector.x, _vector.y, _vector.z );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttoNonIndexed() {\r\n\r\n\t\tfunction convertBufferAttribute( attribute, indices ) {\r\n\r\n\t\t\tconst array = attribute.array;\r\n\t\t\tconst itemSize = attribute.itemSize;\r\n\t\t\tconst normalized = attribute.normalized;\r\n\r\n\t\t\tconst array2 = new array.constructor( indices.length * itemSize );\r\n\r\n\t\t\tlet index = 0, index2 = 0;\r\n\r\n\t\t\tfor ( let i = 0, l = indices.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tif ( attribute.isInterleavedBufferAttribute ) {\r\n\r\n\t\t\t\t\tindex = indices[ i ] * attribute.data.stride + attribute.offset;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tindex = indices[ i ] * itemSize;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let j = 0; j < itemSize; j ++ ) {\r\n\r\n\t\t\t\t\tarray2[ index2 ++ ] = array[ index ++ ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn new BufferAttribute( array2, itemSize, normalized );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( this.index === null ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed.' );\r\n\t\t\treturn this;\r\n\r\n\t\t}\r\n\r\n\t\tconst geometry2 = new BufferGeometry();\r\n\r\n\t\tconst indices = this.index.array;\r\n\t\tconst attributes = this.attributes;\r\n\r\n\t\t// attributes\r\n\r\n\t\tfor ( const name in attributes ) {\r\n\r\n\t\t\tconst attribute = attributes[ name ];\r\n\r\n\t\t\tconst newAttribute = convertBufferAttribute( attribute, indices );\r\n\r\n\t\t\tgeometry2.setAttribute( name, newAttribute );\r\n\r\n\t\t}\r\n\r\n\t\t// morph attributes\r\n\r\n\t\tconst morphAttributes = this.morphAttributes;\r\n\r\n\t\tfor ( const name in morphAttributes ) {\r\n\r\n\t\t\tconst morphArray = [];\r\n\t\t\tconst morphAttribute = morphAttributes[ name ]; // morphAttribute: array of Float32BufferAttributes\r\n\r\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst attribute = morphAttribute[ i ];\r\n\r\n\t\t\t\tconst newAttribute = convertBufferAttribute( attribute, indices );\r\n\r\n\t\t\t\tmorphArray.push( newAttribute );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgeometry2.morphAttributes[ name ] = morphArray;\r\n\r\n\t\t}\r\n\r\n\t\tgeometry2.morphTargetsRelative = this.morphTargetsRelative;\r\n\r\n\t\t// groups\r\n\r\n\t\tconst groups = this.groups;\r\n\r\n\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst group = groups[ i ];\r\n\t\t\tgeometry2.addGroup( group.start, group.count, group.materialIndex );\r\n\r\n\t\t}\r\n\r\n\t\treturn geometry2;\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\tconst data = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.5,\r\n\t\t\t\ttype: 'BufferGeometry',\r\n\t\t\t\tgenerator: 'BufferGeometry.toJSON'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// standard BufferGeometry serialization\r\n\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\t\tif ( Object.keys( this.userData ).length > 0 ) data.userData = this.userData;\r\n\r\n\t\tif ( this.parameters !== undefined ) {\r\n\r\n\t\t\tconst parameters = this.parameters;\r\n\r\n\t\t\tfor ( const key in parameters ) {\r\n\r\n\t\t\t\tif ( parameters[ key ] !== undefined ) data[ key ] = parameters[ key ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\r\n\t\t}\r\n\r\n\t\t// for simplicity the code assumes attributes are not shared across geometries, see #15811\r\n\r\n\t\tdata.data = { attributes: {} };\r\n\r\n\t\tconst index = this.index;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tdata.data.index = {\r\n\t\t\t\ttype: index.array.constructor.name,\r\n\t\t\t\tarray: Array.prototype.slice.call( index.array )\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tconst attributes = this.attributes;\r\n\r\n\t\tfor ( const key in attributes ) {\r\n\r\n\t\t\tconst attribute = attributes[ key ];\r\n\r\n\t\t\tdata.data.attributes[ key ] = attribute.toJSON( data.data );\r\n\r\n\t\t}\r\n\r\n\t\tconst morphAttributes = {};\r\n\t\tlet hasMorphAttributes = false;\r\n\r\n\t\tfor ( const key in this.morphAttributes ) {\r\n\r\n\t\t\tconst attributeArray = this.morphAttributes[ key ];\r\n\r\n\t\t\tconst array = [];\r\n\r\n\t\t\tfor ( let i = 0, il = attributeArray.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst attribute = attributeArray[ i ];\r\n\r\n\t\t\t\tarray.push( attribute.toJSON( data.data ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( array.length > 0 ) {\r\n\r\n\t\t\t\tmorphAttributes[ key ] = array;\r\n\r\n\t\t\t\thasMorphAttributes = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( hasMorphAttributes ) {\r\n\r\n\t\t\tdata.data.morphAttributes = morphAttributes;\r\n\t\t\tdata.data.morphTargetsRelative = this.morphTargetsRelative;\r\n\r\n\t\t}\r\n\r\n\t\tconst groups = this.groups;\r\n\r\n\t\tif ( groups.length > 0 ) {\r\n\r\n\t\t\tdata.data.groups = JSON.parse( JSON.stringify( groups ) );\r\n\r\n\t\t}\r\n\r\n\t\tconst boundingSphere = this.boundingSphere;\r\n\r\n\t\tif ( boundingSphere !== null ) {\r\n\r\n\t\t\tdata.data.boundingSphere = {\r\n\t\t\t\tcenter: boundingSphere.center.toArray(),\r\n\t\t\t\tradius: boundingSphere.radius\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\t/*\r\n\t\t // Handle primitives\r\n\r\n\t\t const parameters = this.parameters;\r\n\r\n\t\t if ( parameters !== undefined ) {\r\n\r\n\t\t const values = [];\r\n\r\n\t\t for ( const key in parameters ) {\r\n\r\n\t\t values.push( parameters[ key ] );\r\n\r\n\t\t }\r\n\r\n\t\t const geometry = Object.create( this.constructor.prototype );\r\n\t\t this.constructor.apply( geometry, values );\r\n\t\t return geometry;\r\n\r\n\t\t }\r\n\r\n\t\t return new this.constructor().copy( this );\r\n\t\t */\r\n\r\n\t\treturn new BufferGeometry().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\t// reset\r\n\r\n\t\tthis.index = null;\r\n\t\tthis.attributes = {};\r\n\t\tthis.morphAttributes = {};\r\n\t\tthis.groups = [];\r\n\t\tthis.boundingBox = null;\r\n\t\tthis.boundingSphere = null;\r\n\r\n\t\t// used for storing cloned, shared data\r\n\r\n\t\tconst data = {};\r\n\r\n\t\t// name\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\t// index\r\n\r\n\t\tconst index = source.index;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tthis.setIndex( index.clone( data ) );\r\n\r\n\t\t}\r\n\r\n\t\t// attributes\r\n\r\n\t\tconst attributes = source.attributes;\r\n\r\n\t\tfor ( const name in attributes ) {\r\n\r\n\t\t\tconst attribute = attributes[ name ];\r\n\t\t\tthis.setAttribute( name, attribute.clone( data ) );\r\n\r\n\t\t}\r\n\r\n\t\t// morph attributes\r\n\r\n\t\tconst morphAttributes = source.morphAttributes;\r\n\r\n\t\tfor ( const name in morphAttributes ) {\r\n\r\n\t\t\tconst array = [];\r\n\t\t\tconst morphAttribute = morphAttributes[ name ]; // morphAttribute: array of Float32BufferAttributes\r\n\r\n\t\t\tfor ( let i = 0, l = morphAttribute.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray.push( morphAttribute[ i ].clone( data ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.morphAttributes[ name ] = array;\r\n\r\n\t\t}\r\n\r\n\t\tthis.morphTargetsRelative = source.morphTargetsRelative;\r\n\r\n\t\t// groups\r\n\r\n\t\tconst groups = source.groups;\r\n\r\n\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst group = groups[ i ];\r\n\t\t\tthis.addGroup( group.start, group.count, group.materialIndex );\r\n\r\n\t\t}\r\n\r\n\t\t// bounding box\r\n\r\n\t\tconst boundingBox = source.boundingBox;\r\n\r\n\t\tif ( boundingBox !== null ) {\r\n\r\n\t\t\tthis.boundingBox = boundingBox.clone();\r\n\r\n\t\t}\r\n\r\n\t\t// bounding sphere\r\n\r\n\t\tconst boundingSphere = source.boundingSphere;\r\n\r\n\t\tif ( boundingSphere !== null ) {\r\n\r\n\t\t\tthis.boundingSphere = boundingSphere.clone();\r\n\r\n\t\t}\r\n\r\n\t\t// draw range\r\n\r\n\t\tthis.drawRange.start = source.drawRange.start;\r\n\t\tthis.drawRange.count = source.drawRange.count;\r\n\r\n\t\t// user data\r\n\r\n\t\tthis.userData = source.userData;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n}\r\n\r\nBufferGeometry.prototype.isBufferGeometry = true;\r\n\r\nexport { BufferGeometry };\r\n", "import { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\n\r\nclass PlaneGeometry extends BufferGeometry {\r\n\r\n\tconstructor( width = 1, height = 1, widthSegments = 1, heightSegments = 1 ) {\r\n\r\n\t\tsuper();\r\n\t\tthis.type = 'PlaneGeometry';\r\n\r\n\t\tthis.parameters = {\r\n\t\t\twidth: width,\r\n\t\t\theight: height,\r\n\t\t\twidthSegments: widthSegments,\r\n\t\t\theightSegments: heightSegments\r\n\t\t};\r\n\r\n\t\tconst width_half = width / 2;\r\n\t\tconst height_half = height / 2;\r\n\r\n\t\tconst gridX = Math.floor( widthSegments );\r\n\t\tconst gridY = Math.floor( heightSegments );\r\n\r\n\t\tconst gridX1 = gridX + 1;\r\n\t\tconst gridY1 = gridY + 1;\r\n\r\n\t\tconst segment_width = width / gridX;\r\n\t\tconst segment_height = height / gridY;\r\n\r\n\t\t//\r\n\r\n\t\tconst indices = [];\r\n\t\tconst vertices = [];\r\n\t\tconst normals = [];\r\n\t\tconst uvs = [];\r\n\r\n\t\tfor ( let iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\t\tconst y = iy * segment_height - height_half;\r\n\r\n\t\t\tfor ( let ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\t\tconst x = ix * segment_width - width_half;\r\n\r\n\t\t\t\tvertices.push( x, - y, 0 );\r\n\r\n\t\t\t\tnormals.push( 0, 0, 1 );\r\n\r\n\t\t\t\tuvs.push( ix / gridX );\r\n\t\t\t\tuvs.push( 1 - ( iy / gridY ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\t\tfor ( let ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\t\tconst a = ix + gridX1 * iy;\r\n\t\t\t\tconst b = ix + gridX1 * ( iy + 1 );\r\n\t\t\t\tconst c = ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\t\tconst d = ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\t\tindices.push( a, b, d );\r\n\t\t\t\tindices.push( b, c, d );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setIndex( indices );\r\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\r\n\t\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\r\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\r\n\r\n\t}\r\n\r\n\tstatic fromJSON( data ) {\r\n\r\n\t\treturn new PlaneGeometry( data.width, data.height, data.widthSegments, data.heightSegments );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { PlaneGeometry, PlaneGeometry as PlaneBufferGeometry };\r\n", "import { EventDispatcher } from '../core/EventDispatcher.js';\r\nimport { FrontSide, FlatShading, NormalBlending, LessEqualDepth, AddEquation, OneMinusSrcAlphaFactor, SrcAlphaFactor, AlwaysStencilFunc, KeepStencilOp } from '../constants.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\n\r\nlet materialId = 0;\r\n\r\nclass Material extends EventDispatcher {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tObject.defineProperty( this, 'id', { value: materialId ++ } );\r\n\r\n\t\tthis.uuid = MathUtils.generateUUID();\r\n\r\n\t\tthis.name = '';\r\n\t\tthis.type = 'Material';\r\n\r\n\t\tthis.fog = true;\r\n\r\n\t\tthis.blending = NormalBlending;\r\n\t\tthis.side = FrontSide;\r\n\t\tthis.vertexColors = false;\r\n\r\n\t\tthis.opacity = 1;\r\n\t\tthis.transparent = false;\r\n\r\n\t\tthis.blendSrc = SrcAlphaFactor;\r\n\t\tthis.blendDst = OneMinusSrcAlphaFactor;\r\n\t\tthis.blendEquation = AddEquation;\r\n\t\tthis.blendSrcAlpha = null;\r\n\t\tthis.blendDstAlpha = null;\r\n\t\tthis.blendEquationAlpha = null;\r\n\r\n\t\tthis.depthFunc = LessEqualDepth;\r\n\t\tthis.depthTest = true;\r\n\t\tthis.depthWrite = true;\r\n\r\n\t\tthis.stencilWriteMask = 0xff;\r\n\t\tthis.stencilFunc = AlwaysStencilFunc;\r\n\t\tthis.stencilRef = 0;\r\n\t\tthis.stencilFuncMask = 0xff;\r\n\t\tthis.stencilFail = KeepStencilOp;\r\n\t\tthis.stencilZFail = KeepStencilOp;\r\n\t\tthis.stencilZPass = KeepStencilOp;\r\n\t\tthis.stencilWrite = false;\r\n\r\n\t\tthis.clippingPlanes = null;\r\n\t\tthis.clipIntersection = false;\r\n\t\tthis.clipShadows = false;\r\n\r\n\t\tthis.shadowSide = null;\r\n\r\n\t\tthis.colorWrite = true;\r\n\r\n\t\tthis.precision = null; // override the renderer's default precision for this material\r\n\r\n\t\tthis.polygonOffset = false;\r\n\t\tthis.polygonOffsetFactor = 0;\r\n\t\tthis.polygonOffsetUnits = 0;\r\n\r\n\t\tthis.dithering = false;\r\n\r\n\t\tthis.alphaTest = 0;\r\n\t\tthis.alphaToCoverage = false;\r\n\t\tthis.premultipliedAlpha = false;\r\n\r\n\t\tthis.visible = true;\r\n\r\n\t\tthis.toneMapped = true;\r\n\r\n\t\tthis.userData = {};\r\n\r\n\t\tthis.version = 0;\r\n\r\n\t}\r\n\r\n\tonBuild( /* shaderobject, renderer */ ) {}\r\n\r\n\tonBeforeCompile( /* shaderobject, renderer */ ) {}\r\n\r\n\tcustomProgramCacheKey() {\r\n\r\n\t\treturn this.onBeforeCompile.toString();\r\n\r\n\t}\r\n\r\n\tsetValues( values ) {\r\n\r\n\t\tif ( values === undefined ) return;\r\n\r\n\t\tfor ( const key in values ) {\r\n\r\n\t\t\tconst newValue = values[ key ];\r\n\r\n\t\t\tif ( newValue === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Material: \\'' + key + '\\' parameter is undefined.' );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// for backward compatability if shading is set in the constructor\r\n\t\t\tif ( key === 'shading' ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.' + this.type + ': .shading has been removed. Use the boolean .flatShading instead.' );\r\n\t\t\t\tthis.flatShading = ( newValue === FlatShading ) ? true : false;\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst currentValue = this[ key ];\r\n\r\n\t\t\tif ( currentValue === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.' + this.type + ': \\'' + key + '\\' is not a property of this material.' );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( currentValue && currentValue.isColor ) {\r\n\r\n\t\t\t\tcurrentValue.set( newValue );\r\n\r\n\t\t\t} else if ( ( currentValue && currentValue.isVector3 ) && ( newValue && newValue.isVector3 ) ) {\r\n\r\n\t\t\t\tcurrentValue.copy( newValue );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis[ key ] = newValue;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst isRoot = ( meta === undefined || typeof meta === 'string' );\r\n\r\n\t\tif ( isRoot ) {\r\n\r\n\t\t\tmeta = {\r\n\t\t\t\ttextures: {},\r\n\t\t\t\timages: {}\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tconst data = {\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.5,\r\n\t\t\t\ttype: 'Material',\r\n\t\t\t\tgenerator: 'Material.toJSON'\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// standard Material serialization\r\n\t\tdata.uuid = this.uuid;\r\n\t\tdata.type = this.type;\r\n\r\n\t\tif ( this.name !== '' ) data.name = this.name;\r\n\r\n\t\tif ( this.color && this.color.isColor ) data.color = this.color.getHex();\r\n\r\n\t\tif ( this.roughness !== undefined ) data.roughness = this.roughness;\r\n\t\tif ( this.metalness !== undefined ) data.metalness = this.metalness;\r\n\r\n\t\tif ( this.sheen && this.sheen.isColor ) data.sheen = this.sheen.getHex();\r\n\t\tif ( this.emissive && this.emissive.isColor ) data.emissive = this.emissive.getHex();\r\n\t\tif ( this.emissiveIntensity && this.emissiveIntensity !== 1 ) data.emissiveIntensity = this.emissiveIntensity;\r\n\r\n\t\tif ( this.specular && this.specular.isColor ) data.specular = this.specular.getHex();\r\n\t\tif ( this.specularIntensity !== undefined ) data.specularIntensity = this.specularIntensity;\r\n\t\tif ( this.specularTint && this.specularTint.isColor ) data.specularTint = this.specularTint.getHex();\r\n\t\tif ( this.shininess !== undefined ) data.shininess = this.shininess;\r\n\t\tif ( this.clearcoat !== undefined ) data.clearcoat = this.clearcoat;\r\n\t\tif ( this.clearcoatRoughness !== undefined ) data.clearcoatRoughness = this.clearcoatRoughness;\r\n\r\n\t\tif ( this.clearcoatMap && this.clearcoatMap.isTexture ) {\r\n\r\n\t\t\tdata.clearcoatMap = this.clearcoatMap.toJSON( meta ).uuid;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.clearcoatRoughnessMap && this.clearcoatRoughnessMap.isTexture ) {\r\n\r\n\t\t\tdata.clearcoatRoughnessMap = this.clearcoatRoughnessMap.toJSON( meta ).uuid;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.clearcoatNormalMap && this.clearcoatNormalMap.isTexture ) {\r\n\r\n\t\t\tdata.clearcoatNormalMap = this.clearcoatNormalMap.toJSON( meta ).uuid;\r\n\t\t\tdata.clearcoatNormalScale = this.clearcoatNormalScale.toArray();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.map && this.map.isTexture ) data.map = this.map.toJSON( meta ).uuid;\r\n\t\tif ( this.matcap && this.matcap.isTexture ) data.matcap = this.matcap.toJSON( meta ).uuid;\r\n\t\tif ( this.alphaMap && this.alphaMap.isTexture ) data.alphaMap = this.alphaMap.toJSON( meta ).uuid;\r\n\r\n\t\tif ( this.lightMap && this.lightMap.isTexture ) {\r\n\r\n\t\t\tdata.lightMap = this.lightMap.toJSON( meta ).uuid;\r\n\t\t\tdata.lightMapIntensity = this.lightMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.aoMap && this.aoMap.isTexture ) {\r\n\r\n\t\t\tdata.aoMap = this.aoMap.toJSON( meta ).uuid;\r\n\t\t\tdata.aoMapIntensity = this.aoMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.bumpMap && this.bumpMap.isTexture ) {\r\n\r\n\t\t\tdata.bumpMap = this.bumpMap.toJSON( meta ).uuid;\r\n\t\t\tdata.bumpScale = this.bumpScale;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.normalMap && this.normalMap.isTexture ) {\r\n\r\n\t\t\tdata.normalMap = this.normalMap.toJSON( meta ).uuid;\r\n\t\t\tdata.normalMapType = this.normalMapType;\r\n\t\t\tdata.normalScale = this.normalScale.toArray();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.displacementMap && this.displacementMap.isTexture ) {\r\n\r\n\t\t\tdata.displacementMap = this.displacementMap.toJSON( meta ).uuid;\r\n\t\t\tdata.displacementScale = this.displacementScale;\r\n\t\t\tdata.displacementBias = this.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.roughnessMap && this.roughnessMap.isTexture ) data.roughnessMap = this.roughnessMap.toJSON( meta ).uuid;\r\n\t\tif ( this.metalnessMap && this.metalnessMap.isTexture ) data.metalnessMap = this.metalnessMap.toJSON( meta ).uuid;\r\n\r\n\t\tif ( this.emissiveMap && this.emissiveMap.isTexture ) data.emissiveMap = this.emissiveMap.toJSON( meta ).uuid;\r\n\t\tif ( this.specularMap && this.specularMap.isTexture ) data.specularMap = this.specularMap.toJSON( meta ).uuid;\r\n\t\tif ( this.specularIntensityMap && this.specularIntensityMap.isTexture ) data.specularIntensityMap = this.specularIntensityMap.toJSON( meta ).uuid;\r\n\t\tif ( this.specularTintMap && this.specularTintMap.isTexture ) data.specularTintMap = this.specularTintMap.toJSON( meta ).uuid;\r\n\r\n\t\tif ( this.envMap && this.envMap.isTexture ) {\r\n\r\n\t\t\tdata.envMap = this.envMap.toJSON( meta ).uuid;\r\n\r\n\t\t\tif ( this.combine !== undefined ) data.combine = this.combine;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.envMapIntensity !== undefined ) data.envMapIntensity = this.envMapIntensity;\r\n\t\tif ( this.reflectivity !== undefined ) data.reflectivity = this.reflectivity;\r\n\t\tif ( this.refractionRatio !== undefined ) data.refractionRatio = this.refractionRatio;\r\n\r\n\t\tif ( this.gradientMap && this.gradientMap.isTexture ) {\r\n\r\n\t\t\tdata.gradientMap = this.gradientMap.toJSON( meta ).uuid;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.transmission !== undefined ) data.transmission = this.transmission;\r\n\t\tif ( this.transmissionMap && this.transmissionMap.isTexture ) data.transmissionMap = this.transmissionMap.toJSON( meta ).uuid;\r\n\t\tif ( this.thickness !== undefined ) data.thickness = this.thickness;\r\n\t\tif ( this.thicknessMap && this.thicknessMap.isTexture ) data.thicknessMap = this.thicknessMap.toJSON( meta ).uuid;\r\n\t\tif ( this.attenuationDistance !== undefined ) data.attenuationDistance = this.attenuationDistance;\r\n\t\tif ( this.attenuationTint !== undefined ) data.attenuationTint = this.attenuationTint.getHex();\r\n\r\n\t\tif ( this.size !== undefined ) data.size = this.size;\r\n\t\tif ( this.shadowSide !== null ) data.shadowSide = this.shadowSide;\r\n\t\tif ( this.sizeAttenuation !== undefined ) data.sizeAttenuation = this.sizeAttenuation;\r\n\r\n\t\tif ( this.blending !== NormalBlending ) data.blending = this.blending;\r\n\t\tif ( this.side !== FrontSide ) data.side = this.side;\r\n\t\tif ( this.vertexColors ) data.vertexColors = true;\r\n\r\n\t\tif ( this.opacity < 1 ) data.opacity = this.opacity;\r\n\t\tif ( this.transparent === true ) data.transparent = this.transparent;\r\n\r\n\t\tdata.depthFunc = this.depthFunc;\r\n\t\tdata.depthTest = this.depthTest;\r\n\t\tdata.depthWrite = this.depthWrite;\r\n\t\tdata.colorWrite = this.colorWrite;\r\n\r\n\t\tdata.stencilWrite = this.stencilWrite;\r\n\t\tdata.stencilWriteMask = this.stencilWriteMask;\r\n\t\tdata.stencilFunc = this.stencilFunc;\r\n\t\tdata.stencilRef = this.stencilRef;\r\n\t\tdata.stencilFuncMask = this.stencilFuncMask;\r\n\t\tdata.stencilFail = this.stencilFail;\r\n\t\tdata.stencilZFail = this.stencilZFail;\r\n\t\tdata.stencilZPass = this.stencilZPass;\r\n\r\n\t\t// rotation (SpriteMaterial)\r\n\t\tif ( this.rotation && this.rotation !== 0 ) data.rotation = this.rotation;\r\n\r\n\t\tif ( this.polygonOffset === true ) data.polygonOffset = true;\r\n\t\tif ( this.polygonOffsetFactor !== 0 ) data.polygonOffsetFactor = this.polygonOffsetFactor;\r\n\t\tif ( this.polygonOffsetUnits !== 0 ) data.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n\t\tif ( this.linewidth && this.linewidth !== 1 ) data.linewidth = this.linewidth;\r\n\t\tif ( this.dashSize !== undefined ) data.dashSize = this.dashSize;\r\n\t\tif ( this.gapSize !== undefined ) data.gapSize = this.gapSize;\r\n\t\tif ( this.scale !== undefined ) data.scale = this.scale;\r\n\r\n\t\tif ( this.dithering === true ) data.dithering = true;\r\n\r\n\t\tif ( this.alphaTest > 0 ) data.alphaTest = this.alphaTest;\r\n\t\tif ( this.alphaToCoverage === true ) data.alphaToCoverage = this.alphaToCoverage;\r\n\t\tif ( this.premultipliedAlpha === true ) data.premultipliedAlpha = this.premultipliedAlpha;\r\n\r\n\t\tif ( this.wireframe === true ) data.wireframe = this.wireframe;\r\n\t\tif ( this.wireframeLinewidth > 1 ) data.wireframeLinewidth = this.wireframeLinewidth;\r\n\t\tif ( this.wireframeLinecap !== 'round' ) data.wireframeLinecap = this.wireframeLinecap;\r\n\t\tif ( this.wireframeLinejoin !== 'round' ) data.wireframeLinejoin = this.wireframeLinejoin;\r\n\r\n\t\tif ( this.flatShading === true ) data.flatShading = this.flatShading;\r\n\r\n\t\tif ( this.visible === false ) data.visible = false;\r\n\r\n\t\tif ( this.toneMapped === false ) data.toneMapped = false;\r\n\r\n\t\tif ( JSON.stringify( this.userData ) !== '{}' ) data.userData = this.userData;\r\n\r\n\t\t// TODO: Copied from Object3D.toJSON\r\n\r\n\t\tfunction extractFromCache( cache ) {\r\n\r\n\t\t\tconst values = [];\r\n\r\n\t\t\tfor ( const key in cache ) {\r\n\r\n\t\t\t\tconst data = cache[ key ];\r\n\t\t\t\tdelete data.metadata;\r\n\t\t\t\tvalues.push( data );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn values;\r\n\r\n\t\t}\r\n\r\n\t\tif ( isRoot ) {\r\n\r\n\t\t\tconst textures = extractFromCache( meta.textures );\r\n\t\t\tconst images = extractFromCache( meta.images );\r\n\r\n\t\t\tif ( textures.length > 0 ) data.textures = textures;\r\n\t\t\tif ( images.length > 0 ) data.images = images;\r\n\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\tthis.fog = source.fog;\r\n\r\n\t\tthis.blending = source.blending;\r\n\t\tthis.side = source.side;\r\n\t\tthis.vertexColors = source.vertexColors;\r\n\r\n\t\tthis.opacity = source.opacity;\r\n\t\tthis.transparent = source.transparent;\r\n\r\n\t\tthis.blendSrc = source.blendSrc;\r\n\t\tthis.blendDst = source.blendDst;\r\n\t\tthis.blendEquation = source.blendEquation;\r\n\t\tthis.blendSrcAlpha = source.blendSrcAlpha;\r\n\t\tthis.blendDstAlpha = source.blendDstAlpha;\r\n\t\tthis.blendEquationAlpha = source.blendEquationAlpha;\r\n\r\n\t\tthis.depthFunc = source.depthFunc;\r\n\t\tthis.depthTest = source.depthTest;\r\n\t\tthis.depthWrite = source.depthWrite;\r\n\r\n\t\tthis.stencilWriteMask = source.stencilWriteMask;\r\n\t\tthis.stencilFunc = source.stencilFunc;\r\n\t\tthis.stencilRef = source.stencilRef;\r\n\t\tthis.stencilFuncMask = source.stencilFuncMask;\r\n\t\tthis.stencilFail = source.stencilFail;\r\n\t\tthis.stencilZFail = source.stencilZFail;\r\n\t\tthis.stencilZPass = source.stencilZPass;\r\n\t\tthis.stencilWrite = source.stencilWrite;\r\n\r\n\t\tconst srcPlanes = source.clippingPlanes;\r\n\t\tlet dstPlanes = null;\r\n\r\n\t\tif ( srcPlanes !== null ) {\r\n\r\n\t\t\tconst n = srcPlanes.length;\r\n\t\t\tdstPlanes = new Array( n );\r\n\r\n\t\t\tfor ( let i = 0; i !== n; ++ i ) {\r\n\r\n\t\t\t\tdstPlanes[ i ] = srcPlanes[ i ].clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.clippingPlanes = dstPlanes;\r\n\t\tthis.clipIntersection = source.clipIntersection;\r\n\t\tthis.clipShadows = source.clipShadows;\r\n\r\n\t\tthis.shadowSide = source.shadowSide;\r\n\r\n\t\tthis.colorWrite = source.colorWrite;\r\n\r\n\t\tthis.precision = source.precision;\r\n\r\n\t\tthis.polygonOffset = source.polygonOffset;\r\n\t\tthis.polygonOffsetFactor = source.polygonOffsetFactor;\r\n\t\tthis.polygonOffsetUnits = source.polygonOffsetUnits;\r\n\r\n\t\tthis.dithering = source.dithering;\r\n\r\n\t\tthis.alphaTest = source.alphaTest;\r\n\t\tthis.alphaToCoverage = source.alphaToCoverage;\r\n\t\tthis.premultipliedAlpha = source.premultipliedAlpha;\r\n\r\n\t\tthis.visible = source.visible;\r\n\r\n\t\tthis.toneMapped = source.toneMapped;\r\n\r\n\t\tthis.userData = JSON.parse( JSON.stringify( source.userData ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n\tset needsUpdate( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMaterial.prototype.isMaterial = true;\r\n\r\nexport { Material };\r\n", "import { MultiplyOperation, TangentSpaceNormalMap } from '../constants.js';\r\nimport { Material } from './Material.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\n/**\r\n * parameters = {\r\n *  color: <hex>,\r\n *  specular: <hex>,\r\n *  shininess: <float>,\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *  lightMapIntensity: <float>\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  emissive: <hex>,\r\n *  emissiveIntensity: <float>\r\n *  emissiveMap: new THREE.Texture( <Image> ),\r\n *\r\n *  bumpMap: new THREE.Texture( <Image> ),\r\n *  bumpScale: <float>,\r\n *\r\n *  normalMap: new THREE.Texture( <Image> ),\r\n *  normalMapType: THREE.TangentSpaceNormalMap,\r\n *  normalScale: <Vector2>,\r\n *\r\n *  displacementMap: new THREE.Texture( <Image> ),\r\n *  displacementScale: <float>,\r\n *  displacementBias: <float>,\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.MultiplyOperation,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  flatShading: <bool>\r\n * }\r\n */\r\n\r\nclass MeshPhongMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'MeshPhongMaterial';\r\n\r\n\t\tthis.color = new Color( 0xffffff ); // diffuse\r\n\t\tthis.specular = new Color( 0x111111 );\r\n\t\tthis.shininess = 30;\r\n\r\n\t\tthis.map = null;\r\n\r\n\t\tthis.lightMap = null;\r\n\t\tthis.lightMapIntensity = 1.0;\r\n\r\n\t\tthis.aoMap = null;\r\n\t\tthis.aoMapIntensity = 1.0;\r\n\r\n\t\tthis.emissive = new Color( 0x000000 );\r\n\t\tthis.emissiveIntensity = 1.0;\r\n\t\tthis.emissiveMap = null;\r\n\r\n\t\tthis.bumpMap = null;\r\n\t\tthis.bumpScale = 1;\r\n\r\n\t\tthis.normalMap = null;\r\n\t\tthis.normalMapType = TangentSpaceNormalMap;\r\n\t\tthis.normalScale = new Vector2( 1, 1 );\r\n\r\n\t\tthis.displacementMap = null;\r\n\t\tthis.displacementScale = 1;\r\n\t\tthis.displacementBias = 0;\r\n\r\n\t\tthis.specularMap = null;\r\n\r\n\t\tthis.alphaMap = null;\r\n\r\n\t\tthis.envMap = null;\r\n\t\tthis.combine = MultiplyOperation;\r\n\t\tthis.reflectivity = 1;\r\n\t\tthis.refractionRatio = 0.98;\r\n\r\n\t\tthis.wireframe = false;\r\n\t\tthis.wireframeLinewidth = 1;\r\n\t\tthis.wireframeLinecap = 'round';\r\n\t\tthis.wireframeLinejoin = 'round';\r\n\r\n\t\tthis.flatShading = false;\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.color.copy( source.color );\r\n\t\tthis.specular.copy( source.specular );\r\n\t\tthis.shininess = source.shininess;\r\n\r\n\t\tthis.map = source.map;\r\n\r\n\t\tthis.lightMap = source.lightMap;\r\n\t\tthis.lightMapIntensity = source.lightMapIntensity;\r\n\r\n\t\tthis.aoMap = source.aoMap;\r\n\t\tthis.aoMapIntensity = source.aoMapIntensity;\r\n\r\n\t\tthis.emissive.copy( source.emissive );\r\n\t\tthis.emissiveMap = source.emissiveMap;\r\n\t\tthis.emissiveIntensity = source.emissiveIntensity;\r\n\r\n\t\tthis.bumpMap = source.bumpMap;\r\n\t\tthis.bumpScale = source.bumpScale;\r\n\r\n\t\tthis.normalMap = source.normalMap;\r\n\t\tthis.normalMapType = source.normalMapType;\r\n\t\tthis.normalScale.copy( source.normalScale );\r\n\r\n\t\tthis.displacementMap = source.displacementMap;\r\n\t\tthis.displacementScale = source.displacementScale;\r\n\t\tthis.displacementBias = source.displacementBias;\r\n\r\n\t\tthis.specularMap = source.specularMap;\r\n\r\n\t\tthis.alphaMap = source.alphaMap;\r\n\r\n\t\tthis.envMap = source.envMap;\r\n\t\tthis.combine = source.combine;\r\n\t\tthis.reflectivity = source.reflectivity;\r\n\t\tthis.refractionRatio = source.refractionRatio;\r\n\r\n\t\tthis.wireframe = source.wireframe;\r\n\t\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\t\tthis.wireframeLinecap = source.wireframeLinecap;\r\n\t\tthis.wireframeLinejoin = source.wireframeLinejoin;\r\n\r\n\t\tthis.flatShading = source.flatShading;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMeshPhongMaterial.prototype.isMeshPhongMaterial = true;\r\n\r\nexport { MeshPhongMaterial };\r\n", "import { Material } from './Material.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\n/**\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *\r\n *  linewidth: <float>,\r\n *  linecap: \"round\",\r\n *  linejoin: \"round\"\r\n * }\r\n */\r\n\r\nclass LineBasicMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'LineBasicMaterial';\r\n\r\n\t\tthis.color = new Color( 0xffffff );\r\n\r\n\t\tthis.linewidth = 1;\r\n\t\tthis.linecap = 'round';\r\n\t\tthis.linejoin = 'round';\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.color.copy( source.color );\r\n\r\n\t\tthis.linewidth = source.linewidth;\r\n\t\tthis.linecap = source.linecap;\r\n\t\tthis.linejoin = source.linejoin;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nLineBasicMaterial.prototype.isLineBasicMaterial = true;\r\n\r\nexport { LineBasicMaterial };\r\n", "function WebGLAnimation() {\r\n\r\n\tlet context = null;\r\n\tlet isAnimating = false;\r\n\tlet animationLoop = null;\r\n\tlet requestId = null;\r\n\r\n\tfunction onAnimationFrame( time, frame ) {\r\n\r\n\t\tanimationLoop( time, frame );\r\n\r\n\t\trequestId = context.requestAnimationFrame( onAnimationFrame );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tstart: function () {\r\n\r\n\t\t\tif ( isAnimating === true ) return;\r\n\t\t\tif ( animationLoop === null ) return;\r\n\r\n\t\t\trequestId = context.requestAnimationFrame( onAnimationFrame );\r\n\r\n\t\t\tisAnimating = true;\r\n\r\n\t\t},\r\n\r\n\t\tstop: function () {\r\n\r\n\t\t\tcontext.cancelAnimationFrame( requestId );\r\n\r\n\t\t\tisAnimating = false;\r\n\r\n\t\t},\r\n\r\n\t\tsetAnimationLoop: function ( callback ) {\r\n\r\n\t\t\tanimationLoop = callback;\r\n\r\n\t\t},\r\n\r\n\t\tsetContext: function ( value ) {\r\n\r\n\t\t\tcontext = value;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\nexport { WebGLAnimation };\r\n", "function WebGLAttributes( gl, capabilities ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\r\n\tconst buffers = new WeakMap();\r\n\r\n\tfunction createBuffer( attribute, bufferType ) {\r\n\r\n\t\tconst array = attribute.array;\r\n\t\tconst usage = attribute.usage;\r\n\r\n\t\tconst buffer = gl.createBuffer();\r\n\r\n\t\tgl.bindBuffer( bufferType, buffer );\r\n\t\tgl.bufferData( bufferType, array, usage );\r\n\r\n\t\tattribute.onUploadCallback();\r\n\r\n\t\tlet type = gl.FLOAT;\r\n\r\n\t\tif ( array instanceof Float32Array ) {\r\n\r\n\t\t\ttype = gl.FLOAT;\r\n\r\n\t\t} else if ( array instanceof Float64Array ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.' );\r\n\r\n\t\t} else if ( array instanceof Uint16Array ) {\r\n\r\n\t\t\tif ( attribute.isFloat16BufferAttribute ) {\r\n\r\n\t\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\t\ttype = gl.HALF_FLOAT;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttype = gl.UNSIGNED_SHORT;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( array instanceof Int16Array ) {\r\n\r\n\t\t\ttype = gl.SHORT;\r\n\r\n\t\t} else if ( array instanceof Uint32Array ) {\r\n\r\n\t\t\ttype = gl.UNSIGNED_INT;\r\n\r\n\t\t} else if ( array instanceof Int32Array ) {\r\n\r\n\t\t\ttype = gl.INT;\r\n\r\n\t\t} else if ( array instanceof Int8Array ) {\r\n\r\n\t\t\ttype = gl.BYTE;\r\n\r\n\t\t} else if ( array instanceof Uint8Array ) {\r\n\r\n\t\t\ttype = gl.UNSIGNED_BYTE;\r\n\r\n\t\t} else if ( array instanceof Uint8ClampedArray ) {\r\n\r\n\t\t\ttype = gl.UNSIGNED_BYTE;\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tbuffer: buffer,\r\n\t\t\ttype: type,\r\n\t\t\tbytesPerElement: array.BYTES_PER_ELEMENT,\r\n\t\t\tversion: attribute.version\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction updateBuffer( buffer, attribute, bufferType ) {\r\n\r\n\t\tconst array = attribute.array;\r\n\t\tconst updateRange = attribute.updateRange;\r\n\r\n\t\tgl.bindBuffer( bufferType, buffer );\r\n\r\n\t\tif ( updateRange.count === - 1 ) {\r\n\r\n\t\t\t// Not using update ranges\r\n\r\n\t\t\tgl.bufferSubData( bufferType, 0, array );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\tgl.bufferSubData( bufferType, updateRange.offset * array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\tarray, updateRange.offset, updateRange.count );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.bufferSubData( bufferType, updateRange.offset * array.BYTES_PER_ELEMENT,\r\n\t\t\t\t\tarray.subarray( updateRange.offset, updateRange.offset + updateRange.count ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tupdateRange.count = - 1; // reset range\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction get( attribute ) {\r\n\r\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\r\n\r\n\t\treturn buffers.get( attribute );\r\n\r\n\t}\r\n\r\n\tfunction remove( attribute ) {\r\n\r\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\r\n\r\n\t\tconst data = buffers.get( attribute );\r\n\r\n\t\tif ( data ) {\r\n\r\n\t\t\tgl.deleteBuffer( data.buffer );\r\n\r\n\t\t\tbuffers.delete( attribute );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction update( attribute, bufferType ) {\r\n\r\n\t\tif ( attribute.isGLBufferAttribute ) {\r\n\r\n\t\t\tconst cached = buffers.get( attribute );\r\n\r\n\t\t\tif ( ! cached || cached.version < attribute.version ) {\r\n\r\n\t\t\t\tbuffers.set( attribute, {\r\n\t\t\t\t\tbuffer: attribute.buffer,\r\n\t\t\t\t\ttype: attribute.type,\r\n\t\t\t\t\tbytesPerElement: attribute.elementSize,\r\n\t\t\t\t\tversion: attribute.version\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( attribute.isInterleavedBufferAttribute ) attribute = attribute.data;\r\n\r\n\t\tconst data = buffers.get( attribute );\r\n\r\n\t\tif ( data === undefined ) {\r\n\r\n\t\t\tbuffers.set( attribute, createBuffer( attribute, bufferType ) );\r\n\r\n\t\t} else if ( data.version < attribute.version ) {\r\n\r\n\t\t\tupdateBuffer( data.buffer, attribute, bufferType );\r\n\r\n\t\t\tdata.version = attribute.version;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tget: get,\r\n\t\tremove: remove,\r\n\t\tupdate: update\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLAttributes };\r\n", "import { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\n\r\nclass BoxGeometry extends BufferGeometry {\r\n\r\n\tconstructor( width = 1, height = 1, depth = 1, widthSegments = 1, heightSegments = 1, depthSegments = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'BoxGeometry';\r\n\r\n\t\tthis.parameters = {\r\n\t\t\twidth: width,\r\n\t\t\theight: height,\r\n\t\t\tdepth: depth,\r\n\t\t\twidthSegments: widthSegments,\r\n\t\t\theightSegments: heightSegments,\r\n\t\t\tdepthSegments: depthSegments\r\n\t\t};\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\t// segments\r\n\r\n\t\twidthSegments = Math.floor( widthSegments );\r\n\t\theightSegments = Math.floor( heightSegments );\r\n\t\tdepthSegments = Math.floor( depthSegments );\r\n\r\n\t\t// buffers\r\n\r\n\t\tconst indices = [];\r\n\t\tconst vertices = [];\r\n\t\tconst normals = [];\r\n\t\tconst uvs = [];\r\n\r\n\t\t// helper variables\r\n\r\n\t\tlet numberOfVertices = 0;\r\n\t\tlet groupStart = 0;\r\n\r\n\t\t// build each side of the box geometry\r\n\r\n\t\tbuildPlane( 'z', 'y', 'x', - 1, - 1, depth, height, width, depthSegments, heightSegments, 0 ); // px\r\n\t\tbuildPlane( 'z', 'y', 'x', 1, - 1, depth, height, - width, depthSegments, heightSegments, 1 ); // nx\r\n\t\tbuildPlane( 'x', 'z', 'y', 1, 1, width, depth, height, widthSegments, depthSegments, 2 ); // py\r\n\t\tbuildPlane( 'x', 'z', 'y', 1, - 1, width, depth, - height, widthSegments, depthSegments, 3 ); // ny\r\n\t\tbuildPlane( 'x', 'y', 'z', 1, - 1, width, height, depth, widthSegments, heightSegments, 4 ); // pz\r\n\t\tbuildPlane( 'x', 'y', 'z', - 1, - 1, width, height, - depth, widthSegments, heightSegments, 5 ); // nz\r\n\r\n\t\t// build geometry\r\n\r\n\t\tthis.setIndex( indices );\r\n\t\tthis.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\r\n\t\tthis.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\r\n\t\tthis.setAttribute( 'uv', new Float32BufferAttribute( uvs, 2 ) );\r\n\r\n\t\tfunction buildPlane( u, v, w, udir, vdir, width, height, depth, gridX, gridY, materialIndex ) {\r\n\r\n\t\t\tconst segmentWidth = width / gridX;\r\n\t\t\tconst segmentHeight = height / gridY;\r\n\r\n\t\t\tconst widthHalf = width / 2;\r\n\t\t\tconst heightHalf = height / 2;\r\n\t\t\tconst depthHalf = depth / 2;\r\n\r\n\t\t\tconst gridX1 = gridX + 1;\r\n\t\t\tconst gridY1 = gridY + 1;\r\n\r\n\t\t\tlet vertexCounter = 0;\r\n\t\t\tlet groupCount = 0;\r\n\r\n\t\t\tconst vector = new Vector3();\r\n\r\n\t\t\t// generate vertices, normals and uvs\r\n\r\n\t\t\tfor ( let iy = 0; iy < gridY1; iy ++ ) {\r\n\r\n\t\t\t\tconst y = iy * segmentHeight - heightHalf;\r\n\r\n\t\t\t\tfor ( let ix = 0; ix < gridX1; ix ++ ) {\r\n\r\n\t\t\t\t\tconst x = ix * segmentWidth - widthHalf;\r\n\r\n\t\t\t\t\t// set values to correct vector component\r\n\r\n\t\t\t\t\tvector[ u ] = x * udir;\r\n\t\t\t\t\tvector[ v ] = y * vdir;\r\n\t\t\t\t\tvector[ w ] = depthHalf;\r\n\r\n\t\t\t\t\t// now apply vector to vertex buffer\r\n\r\n\t\t\t\t\tvertices.push( vector.x, vector.y, vector.z );\r\n\r\n\t\t\t\t\t// set values to correct vector component\r\n\r\n\t\t\t\t\tvector[ u ] = 0;\r\n\t\t\t\t\tvector[ v ] = 0;\r\n\t\t\t\t\tvector[ w ] = depth > 0 ? 1 : - 1;\r\n\r\n\t\t\t\t\t// now apply vector to normal buffer\r\n\r\n\t\t\t\t\tnormals.push( vector.x, vector.y, vector.z );\r\n\r\n\t\t\t\t\t// uvs\r\n\r\n\t\t\t\t\tuvs.push( ix / gridX );\r\n\t\t\t\t\tuvs.push( 1 - ( iy / gridY ) );\r\n\r\n\t\t\t\t\t// counters\r\n\r\n\t\t\t\t\tvertexCounter += 1;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// indices\r\n\r\n\t\t\t// 1. you need three indices to draw a single face\r\n\t\t\t// 2. a single segment consists of two faces\r\n\t\t\t// 3. so we need to generate six (2*3) indices per segment\r\n\r\n\t\t\tfor ( let iy = 0; iy < gridY; iy ++ ) {\r\n\r\n\t\t\t\tfor ( let ix = 0; ix < gridX; ix ++ ) {\r\n\r\n\t\t\t\t\tconst a = numberOfVertices + ix + gridX1 * iy;\r\n\t\t\t\t\tconst b = numberOfVertices + ix + gridX1 * ( iy + 1 );\r\n\t\t\t\t\tconst c = numberOfVertices + ( ix + 1 ) + gridX1 * ( iy + 1 );\r\n\t\t\t\t\tconst d = numberOfVertices + ( ix + 1 ) + gridX1 * iy;\r\n\r\n\t\t\t\t\t// faces\r\n\r\n\t\t\t\t\tindices.push( a, b, d );\r\n\t\t\t\t\tindices.push( b, c, d );\r\n\r\n\t\t\t\t\t// increase counter\r\n\r\n\t\t\t\t\tgroupCount += 6;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// add a group to the geometry. this will ensure multi material support\r\n\r\n\t\t\tscope.addGroup( groupStart, groupCount, materialIndex );\r\n\r\n\t\t\t// calculate new start value for groups\r\n\r\n\t\t\tgroupStart += groupCount;\r\n\r\n\t\t\t// update total number of vertices\r\n\r\n\t\t\tnumberOfVertices += vertexCounter;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tstatic fromJSON( data ) {\r\n\r\n\t\treturn new BoxGeometry( data.width, data.height, data.depth, data.widthSegments, data.heightSegments, data.depthSegments );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { BoxGeometry, BoxGeometry as BoxBufferGeometry };\r\n", "/**\r\n * Uniform Utilities\r\n */\r\n\r\nexport function cloneUniforms( src ) {\r\n\r\n\tconst dst = {};\r\n\r\n\tfor ( const u in src ) {\r\n\r\n\t\tdst[ u ] = {};\r\n\r\n\t\tfor ( const p in src[ u ] ) {\r\n\r\n\t\t\tconst property = src[ u ][ p ];\r\n\r\n\t\t\tif ( property && ( property.isColor ||\r\n\t\t\t\tproperty.isMatrix3 || property.isMatrix4 ||\r\n\t\t\t\tproperty.isVector2 || property.isVector3 || property.isVector4 ||\r\n\t\t\t\tproperty.isTexture || property.isQuaternion ) ) {\r\n\r\n\t\t\t\tdst[ u ][ p ] = property.clone();\r\n\r\n\t\t\t} else if ( Array.isArray( property ) ) {\r\n\r\n\t\t\t\tdst[ u ][ p ] = property.slice();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdst[ u ][ p ] = property;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn dst;\r\n\r\n}\r\n\r\nexport function mergeUniforms( uniforms ) {\r\n\r\n\tconst merged = {};\r\n\r\n\tfor ( let u = 0; u < uniforms.length; u ++ ) {\r\n\r\n\t\tconst tmp = cloneUniforms( uniforms[ u ] );\r\n\r\n\t\tfor ( const p in tmp ) {\r\n\r\n\t\t\tmerged[ p ] = tmp[ p ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn merged;\r\n\r\n}\r\n\r\n// Legacy\r\n\r\nconst UniformsUtils = { clone: cloneUniforms, merge: mergeUniforms };\r\n\r\nexport { UniformsUtils };\r\n", "export default /* glsl */`\r\nvoid main() {\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nvoid main() {\r\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\r\n}\r\n`;\r\n", "import { Material } from './Material.js';\r\nimport { cloneUniforms } from '../renderers/shaders/UniformsUtils.js';\r\n\r\nimport default_vertex from '../renderers/shaders/ShaderChunk/default_vertex.glsl.js';\r\nimport default_fragment from '../renderers/shaders/ShaderChunk/default_fragment.glsl.js';\r\n\r\n/**\r\n * parameters = {\r\n *  defines: { \"label\" : \"value\" },\r\n *  uniforms: { \"parameter1\": { value: 1.0 }, \"parameter2\": { value2: 2 } },\r\n *\r\n *  fragmentShader: <string>,\r\n *  vertexShader: <string>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n *\r\n *  lights: <bool>\r\n * }\r\n */\r\n\r\nclass ShaderMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'ShaderMaterial';\r\n\r\n\t\tthis.defines = {};\r\n\t\tthis.uniforms = {};\r\n\r\n\t\tthis.vertexShader = default_vertex;\r\n\t\tthis.fragmentShader = default_fragment;\r\n\r\n\t\tthis.linewidth = 1;\r\n\r\n\t\tthis.wireframe = false;\r\n\t\tthis.wireframeLinewidth = 1;\r\n\r\n\t\tthis.fog = false; // set to use scene fog\r\n\t\tthis.lights = false; // set to use scene lights\r\n\t\tthis.clipping = false; // set to use user-defined clipping planes\r\n\r\n\t\tthis.extensions = {\r\n\t\t\tderivatives: false, // set to use derivatives\r\n\t\t\tfragDepth: false, // set to use fragment depth values\r\n\t\t\tdrawBuffers: false, // set to use draw buffers\r\n\t\t\tshaderTextureLOD: false // set to use shader texture LOD\r\n\t\t};\r\n\r\n\t\t// When rendered geometry doesn't include these attributes but the material does,\r\n\t\t// use these default values in WebGL. This avoids errors when buffer data is missing.\r\n\t\tthis.defaultAttributeValues = {\r\n\t\t\t'color': [ 1, 1, 1 ],\r\n\t\t\t'uv': [ 0, 0 ],\r\n\t\t\t'uv2': [ 0, 0 ]\r\n\t\t};\r\n\r\n\t\tthis.index0AttributeName = undefined;\r\n\t\tthis.uniformsNeedUpdate = false;\r\n\r\n\t\tthis.glslVersion = null;\r\n\r\n\t\tif ( parameters !== undefined ) {\r\n\r\n\t\t\tif ( parameters.attributes !== undefined ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.setValues( parameters );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.fragmentShader = source.fragmentShader;\r\n\t\tthis.vertexShader = source.vertexShader;\r\n\r\n\t\tthis.uniforms = cloneUniforms( source.uniforms );\r\n\r\n\t\tthis.defines = Object.assign( {}, source.defines );\r\n\r\n\t\tthis.wireframe = source.wireframe;\r\n\t\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\r\n\t\tthis.lights = source.lights;\r\n\t\tthis.clipping = source.clipping;\r\n\r\n\t\tthis.extensions = Object.assign( {}, source.extensions );\r\n\r\n\t\tthis.glslVersion = source.glslVersion;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst data = super.toJSON( meta );\r\n\r\n\t\tdata.glslVersion = this.glslVersion;\r\n\t\tdata.uniforms = {};\r\n\r\n\t\tfor ( const name in this.uniforms ) {\r\n\r\n\t\t\tconst uniform = this.uniforms[ name ];\r\n\t\t\tconst value = uniform.value;\r\n\r\n\t\t\tif ( value && value.isTexture ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 't',\r\n\t\t\t\t\tvalue: value.toJSON( meta ).uuid\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isColor ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'c',\r\n\t\t\t\t\tvalue: value.getHex()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isVector2 ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'v2',\r\n\t\t\t\t\tvalue: value.toArray()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isVector3 ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'v3',\r\n\t\t\t\t\tvalue: value.toArray()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isVector4 ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'v4',\r\n\t\t\t\t\tvalue: value.toArray()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isMatrix3 ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'm3',\r\n\t\t\t\t\tvalue: value.toArray()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else if ( value && value.isMatrix4 ) {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\ttype: 'm4',\r\n\t\t\t\t\tvalue: value.toArray()\r\n\t\t\t\t};\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata.uniforms[ name ] = {\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// note: the array variants v2v, v3v, v4v, m4v and tv are not supported so far\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( Object.keys( this.defines ).length > 0 ) data.defines = this.defines;\r\n\r\n\t\tdata.vertexShader = this.vertexShader;\r\n\t\tdata.fragmentShader = this.fragmentShader;\r\n\r\n\t\tconst extensions = {};\r\n\r\n\t\tfor ( const key in this.extensions ) {\r\n\r\n\t\t\tif ( this.extensions[ key ] === true ) extensions[ key ] = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( Object.keys( extensions ).length > 0 ) data.extensions = extensions;\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nShaderMaterial.prototype.isShaderMaterial = true;\r\n\r\nexport { ShaderMaterial };\r\n", "import { Vector3 } from './Vector3.js';\r\n\r\nconst _vector = /*@__PURE__*/ new Vector3();\r\nconst _segCenter = /*@__PURE__*/ new Vector3();\r\nconst _segDir = /*@__PURE__*/ new Vector3();\r\nconst _diff = /*@__PURE__*/ new Vector3();\r\n\r\nconst _edge1 = /*@__PURE__*/ new Vector3();\r\nconst _edge2 = /*@__PURE__*/ new Vector3();\r\nconst _normal = /*@__PURE__*/ new Vector3();\r\n\r\nclass Ray {\r\n\r\n\tconstructor( origin = new Vector3(), direction = new Vector3( 0, 0, - 1 ) ) {\r\n\r\n\t\tthis.origin = origin;\r\n\t\tthis.direction = direction;\r\n\r\n\t}\r\n\r\n\tset( origin, direction ) {\r\n\r\n\t\tthis.origin.copy( origin );\r\n\t\tthis.direction.copy( direction );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( ray ) {\r\n\r\n\t\tthis.origin.copy( ray.origin );\r\n\t\tthis.direction.copy( ray.direction );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tat( t, target ) {\r\n\r\n\t\treturn target.copy( this.direction ).multiplyScalar( t ).add( this.origin );\r\n\r\n\t}\r\n\r\n\tlookAt( v ) {\r\n\r\n\t\tthis.direction.copy( v ).sub( this.origin ).normalize();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\trecast( t ) {\r\n\r\n\t\tthis.origin.copy( this.at( t, _vector ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclosestPointToPoint( point, target ) {\r\n\r\n\t\ttarget.subVectors( point, this.origin );\r\n\r\n\t\tconst directionDistance = target.dot( this.direction );\r\n\r\n\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\treturn target.copy( this.origin );\r\n\r\n\t\t}\r\n\r\n\t\treturn target.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t}\r\n\r\n\tdistanceToPoint( point ) {\r\n\r\n\t\treturn Math.sqrt( this.distanceSqToPoint( point ) );\r\n\r\n\t}\r\n\r\n\tdistanceSqToPoint( point ) {\r\n\r\n\t\tconst directionDistance = _vector.subVectors( point, this.origin ).dot( this.direction );\r\n\r\n\t\t// point behind the ray\r\n\r\n\t\tif ( directionDistance < 0 ) {\r\n\r\n\t\t\treturn this.origin.distanceToSquared( point );\r\n\r\n\t\t}\r\n\r\n\t\t_vector.copy( this.direction ).multiplyScalar( directionDistance ).add( this.origin );\r\n\r\n\t\treturn _vector.distanceToSquared( point );\r\n\r\n\t}\r\n\r\n\tdistanceSqToSegment( v0, v1, optionalPointOnRay, optionalPointOnSegment ) {\r\n\r\n\t\t// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteDistRaySegment.h\r\n\t\t// It returns the min distance between the ray and the segment\r\n\t\t// defined by v0 and v1\r\n\t\t// It can also set two optional targets :\r\n\t\t// - The closest point on the ray\r\n\t\t// - The closest point on the segment\r\n\r\n\t\t_segCenter.copy( v0 ).add( v1 ).multiplyScalar( 0.5 );\r\n\t\t_segDir.copy( v1 ).sub( v0 ).normalize();\r\n\t\t_diff.copy( this.origin ).sub( _segCenter );\r\n\r\n\t\tconst segExtent = v0.distanceTo( v1 ) * 0.5;\r\n\t\tconst a01 = - this.direction.dot( _segDir );\r\n\t\tconst b0 = _diff.dot( this.direction );\r\n\t\tconst b1 = - _diff.dot( _segDir );\r\n\t\tconst c = _diff.lengthSq();\r\n\t\tconst det = Math.abs( 1 - a01 * a01 );\r\n\t\tlet s0, s1, sqrDist, extDet;\r\n\r\n\t\tif ( det > 0 ) {\r\n\r\n\t\t\t// The ray and segment are not parallel.\r\n\r\n\t\t\ts0 = a01 * b1 - b0;\r\n\t\t\ts1 = a01 * b0 - b1;\r\n\t\t\textDet = segExtent * det;\r\n\r\n\t\t\tif ( s0 >= 0 ) {\r\n\r\n\t\t\t\tif ( s1 >= - extDet ) {\r\n\r\n\t\t\t\t\tif ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t\t// region 0\r\n\t\t\t\t\t\t// Minimum at interior points of ray and segment.\r\n\r\n\t\t\t\t\t\tconst invDet = 1 / det;\r\n\t\t\t\t\t\ts0 *= invDet;\r\n\t\t\t\t\t\ts1 *= invDet;\r\n\t\t\t\t\t\tsqrDist = s0 * ( s0 + a01 * s1 + 2 * b0 ) + s1 * ( a01 * s0 + s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// region 1\r\n\r\n\t\t\t\t\t\ts1 = segExtent;\r\n\t\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// region 5\r\n\r\n\t\t\t\t\ts1 = - segExtent;\r\n\t\t\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( s1 <= - extDet ) {\r\n\r\n\t\t\t\t\t// region 4\r\n\r\n\t\t\t\t\ts0 = Math.max( 0, - ( - a01 * segExtent + b0 ) );\r\n\t\t\t\t\ts1 = ( s0 > 0 ) ? - segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t} else if ( s1 <= extDet ) {\r\n\r\n\t\t\t\t\t// region 3\r\n\r\n\t\t\t\t\ts0 = 0;\r\n\t\t\t\t\ts1 = Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\tsqrDist = s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// region 2\r\n\r\n\t\t\t\t\ts0 = Math.max( 0, - ( a01 * segExtent + b0 ) );\r\n\t\t\t\t\ts1 = ( s0 > 0 ) ? segExtent : Math.min( Math.max( - segExtent, - b1 ), segExtent );\r\n\t\t\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Ray and segment are parallel.\r\n\r\n\t\t\ts1 = ( a01 > 0 ) ? - segExtent : segExtent;\r\n\t\t\ts0 = Math.max( 0, - ( a01 * s1 + b0 ) );\r\n\t\t\tsqrDist = - s0 * s0 + s1 * ( s1 + 2 * b1 ) + c;\r\n\r\n\t\t}\r\n\r\n\t\tif ( optionalPointOnRay ) {\r\n\r\n\t\t\toptionalPointOnRay.copy( this.direction ).multiplyScalar( s0 ).add( this.origin );\r\n\r\n\t\t}\r\n\r\n\t\tif ( optionalPointOnSegment ) {\r\n\r\n\t\t\toptionalPointOnSegment.copy( _segDir ).multiplyScalar( s1 ).add( _segCenter );\r\n\r\n\t\t}\r\n\r\n\t\treturn sqrDist;\r\n\r\n\t}\r\n\r\n\tintersectSphere( sphere, target ) {\r\n\r\n\t\t_vector.subVectors( sphere.center, this.origin );\r\n\t\tconst tca = _vector.dot( this.direction );\r\n\t\tconst d2 = _vector.dot( _vector ) - tca * tca;\r\n\t\tconst radius2 = sphere.radius * sphere.radius;\r\n\r\n\t\tif ( d2 > radius2 ) return null;\r\n\r\n\t\tconst thc = Math.sqrt( radius2 - d2 );\r\n\r\n\t\t// t0 = first intersect point - entrance on front of sphere\r\n\t\tconst t0 = tca - thc;\r\n\r\n\t\t// t1 = second intersect point - exit point on back of sphere\r\n\t\tconst t1 = tca + thc;\r\n\r\n\t\t// test to see if both t0 and t1 are behind the ray - if so, return null\r\n\t\tif ( t0 < 0 && t1 < 0 ) return null;\r\n\r\n\t\t// test to see if t0 is behind the ray:\r\n\t\t// if it is, the ray is inside the sphere, so return the second exit point scaled by t1,\r\n\t\t// in order to always return an intersect point that is in front of the ray.\r\n\t\tif ( t0 < 0 ) return this.at( t1, target );\r\n\r\n\t\t// else t0 is in front of the ray, so return the first collision point scaled by t0\r\n\t\treturn this.at( t0, target );\r\n\r\n\t}\r\n\r\n\tintersectsSphere( sphere ) {\r\n\r\n\t\treturn this.distanceSqToPoint( sphere.center ) <= ( sphere.radius * sphere.radius );\r\n\r\n\t}\r\n\r\n\tdistanceToPlane( plane ) {\r\n\r\n\t\tconst denominator = plane.normal.dot( this.direction );\r\n\r\n\t\tif ( denominator === 0 ) {\r\n\r\n\t\t\t// line is coplanar, return origin\r\n\t\t\tif ( plane.distanceToPoint( this.origin ) === 0 ) {\r\n\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Null is preferable to undefined since undefined means.... it is undefined\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tconst t = - ( this.origin.dot( plane.normal ) + plane.constant ) / denominator;\r\n\r\n\t\t// Return if the ray never intersects the plane\r\n\r\n\t\treturn t >= 0 ? t : null;\r\n\r\n\t}\r\n\r\n\tintersectPlane( plane, target ) {\r\n\r\n\t\tconst t = this.distanceToPlane( plane );\r\n\r\n\t\tif ( t === null ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\treturn this.at( t, target );\r\n\r\n\t}\r\n\r\n\tintersectsPlane( plane ) {\r\n\r\n\t\t// check if the ray lies on the plane first\r\n\r\n\t\tconst distToPoint = plane.distanceToPoint( this.origin );\r\n\r\n\t\tif ( distToPoint === 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\tconst denominator = plane.normal.dot( this.direction );\r\n\r\n\t\tif ( denominator * distToPoint < 0 ) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\t// ray origin is behind the plane (and is pointing behind it)\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tintersectBox( box, target ) {\r\n\r\n\t\tlet tmin, tmax, tymin, tymax, tzmin, tzmax;\r\n\r\n\t\tconst invdirx = 1 / this.direction.x,\r\n\t\t\tinvdiry = 1 / this.direction.y,\r\n\t\t\tinvdirz = 1 / this.direction.z;\r\n\r\n\t\tconst origin = this.origin;\r\n\r\n\t\tif ( invdirx >= 0 ) {\r\n\r\n\t\t\ttmin = ( box.min.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.max.x - origin.x ) * invdirx;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttmin = ( box.max.x - origin.x ) * invdirx;\r\n\t\t\ttmax = ( box.min.x - origin.x ) * invdirx;\r\n\r\n\t\t}\r\n\r\n\t\tif ( invdiry >= 0 ) {\r\n\r\n\t\t\ttymin = ( box.min.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.max.y - origin.y ) * invdiry;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttymin = ( box.max.y - origin.y ) * invdiry;\r\n\t\t\ttymax = ( box.min.y - origin.y ) * invdiry;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tymax ) || ( tymin > tmax ) ) return null;\r\n\r\n\t\t// These lines also handle the case where tmin or tmax is NaN\r\n\t\t// (result of 0 * Infinity). x !== x returns true if x is NaN\r\n\r\n\t\tif ( tymin > tmin || tmin !== tmin ) tmin = tymin;\r\n\r\n\t\tif ( tymax < tmax || tmax !== tmax ) tmax = tymax;\r\n\r\n\t\tif ( invdirz >= 0 ) {\r\n\r\n\t\t\ttzmin = ( box.min.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.max.z - origin.z ) * invdirz;\r\n\r\n\t\t} else {\r\n\r\n\t\t\ttzmin = ( box.max.z - origin.z ) * invdirz;\r\n\t\t\ttzmax = ( box.min.z - origin.z ) * invdirz;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ( tmin > tzmax ) || ( tzmin > tmax ) ) return null;\r\n\r\n\t\tif ( tzmin > tmin || tmin !== tmin ) tmin = tzmin;\r\n\r\n\t\tif ( tzmax < tmax || tmax !== tmax ) tmax = tzmax;\r\n\r\n\t\t//return point closest to the ray (positive side)\r\n\r\n\t\tif ( tmax < 0 ) return null;\r\n\r\n\t\treturn this.at( tmin >= 0 ? tmin : tmax, target );\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\treturn this.intersectBox( box, _vector ) !== null;\r\n\r\n\t}\r\n\r\n\tintersectTriangle( a, b, c, backfaceCulling, target ) {\r\n\r\n\t\t// Compute the offset origin, edges, and normal.\r\n\r\n\t\t// from http://www.geometrictools.com/GTEngine/Include/Mathematics/GteIntrRay3Triangle3.h\r\n\r\n\t\t_edge1.subVectors( b, a );\r\n\t\t_edge2.subVectors( c, a );\r\n\t\t_normal.crossVectors( _edge1, _edge2 );\r\n\r\n\t\t// Solve Q + t*D = b1*E1 + b2*E2 (Q = kDiff, D = ray direction,\r\n\t\t// E1 = kEdge1, E2 = kEdge2, N = Cross(E1,E2)) by\r\n\t\t//   |Dot(D,N)|*b1 = sign(Dot(D,N))*Dot(D,Cross(Q,E2))\r\n\t\t//   |Dot(D,N)|*b2 = sign(Dot(D,N))*Dot(D,Cross(E1,Q))\r\n\t\t//   |Dot(D,N)|*t = -sign(Dot(D,N))*Dot(Q,N)\r\n\t\tlet DdN = this.direction.dot( _normal );\r\n\t\tlet sign;\r\n\r\n\t\tif ( DdN > 0 ) {\r\n\r\n\t\t\tif ( backfaceCulling ) return null;\r\n\t\t\tsign = 1;\r\n\r\n\t\t} else if ( DdN < 0 ) {\r\n\r\n\t\t\tsign = - 1;\r\n\t\t\tDdN = - DdN;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t_diff.subVectors( this.origin, a );\r\n\t\tconst DdQxE2 = sign * this.direction.dot( _edge2.crossVectors( _diff, _edge2 ) );\r\n\r\n\t\t// b1 < 0, no intersection\r\n\t\tif ( DdQxE2 < 0 ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tconst DdE1xQ = sign * this.direction.dot( _edge1.cross( _diff ) );\r\n\r\n\t\t// b2 < 0, no intersection\r\n\t\tif ( DdE1xQ < 0 ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// b1+b2 > 1, no intersection\r\n\t\tif ( DdQxE2 + DdE1xQ > DdN ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// Line intersects triangle, check if ray does.\r\n\t\tconst QdN = - sign * _diff.dot( _normal );\r\n\r\n\t\t// t < 0, no intersection\r\n\t\tif ( QdN < 0 ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\t// Ray intersects triangle.\r\n\t\treturn this.at( QdN / DdN, target );\r\n\r\n\t}\r\n\r\n\tapplyMatrix4( matrix4 ) {\r\n\r\n\t\tthis.origin.applyMatrix4( matrix4 );\r\n\t\tthis.direction.transformDirection( matrix4 );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tequals( ray ) {\r\n\r\n\t\treturn ray.origin.equals( this.origin ) && ray.direction.equals( this.direction );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Ray };\r\n", "import { Vector3 } from './Vector3.js';\r\n\r\nconst _v0 = /*@__PURE__*/ new Vector3();\r\nconst _v1 = /*@__PURE__*/ new Vector3();\r\nconst _v2 = /*@__PURE__*/ new Vector3();\r\nconst _v3 = /*@__PURE__*/ new Vector3();\r\n\r\nconst _vab = /*@__PURE__*/ new Vector3();\r\nconst _vac = /*@__PURE__*/ new Vector3();\r\nconst _vbc = /*@__PURE__*/ new Vector3();\r\nconst _vap = /*@__PURE__*/ new Vector3();\r\nconst _vbp = /*@__PURE__*/ new Vector3();\r\nconst _vcp = /*@__PURE__*/ new Vector3();\r\n\r\nclass Triangle {\r\n\r\n\tconstructor( a = new Vector3(), b = new Vector3(), c = new Vector3() ) {\r\n\r\n\t\tthis.a = a;\r\n\t\tthis.b = b;\r\n\t\tthis.c = c;\r\n\r\n\t}\r\n\r\n\tstatic getNormal( a, b, c, target ) {\r\n\r\n\t\ttarget.subVectors( c, b );\r\n\t\t_v0.subVectors( a, b );\r\n\t\ttarget.cross( _v0 );\r\n\r\n\t\tconst targetLengthSq = target.lengthSq();\r\n\t\tif ( targetLengthSq > 0 ) {\r\n\r\n\t\t\treturn target.multiplyScalar( 1 / Math.sqrt( targetLengthSq ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn target.set( 0, 0, 0 );\r\n\r\n\t}\r\n\r\n\t// static/instance method to calculate barycentric coordinates\r\n\t// based on: http://www.blackpawn.com/texts/pointinpoly/default.html\r\n\tstatic getBarycoord( point, a, b, c, target ) {\r\n\r\n\t\t_v0.subVectors( c, a );\r\n\t\t_v1.subVectors( b, a );\r\n\t\t_v2.subVectors( point, a );\r\n\r\n\t\tconst dot00 = _v0.dot( _v0 );\r\n\t\tconst dot01 = _v0.dot( _v1 );\r\n\t\tconst dot02 = _v0.dot( _v2 );\r\n\t\tconst dot11 = _v1.dot( _v1 );\r\n\t\tconst dot12 = _v1.dot( _v2 );\r\n\r\n\t\tconst denom = ( dot00 * dot11 - dot01 * dot01 );\r\n\r\n\t\t// collinear or singular triangle\r\n\t\tif ( denom === 0 ) {\r\n\r\n\t\t\t// arbitrary location outside of triangle?\r\n\t\t\t// not sure if this is the best idea, maybe should be returning undefined\r\n\t\t\treturn target.set( - 2, - 1, - 1 );\r\n\r\n\t\t}\r\n\r\n\t\tconst invDenom = 1 / denom;\r\n\t\tconst u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;\r\n\t\tconst v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;\r\n\r\n\t\t// barycentric coordinates must always sum to 1\r\n\t\treturn target.set( 1 - u - v, v, u );\r\n\r\n\t}\r\n\r\n\tstatic containsPoint( point, a, b, c ) {\r\n\r\n\t\tthis.getBarycoord( point, a, b, c, _v3 );\r\n\r\n\t\treturn ( _v3.x >= 0 ) && ( _v3.y >= 0 ) && ( ( _v3.x + _v3.y ) <= 1 );\r\n\r\n\t}\r\n\r\n\tstatic getUV( point, p1, p2, p3, uv1, uv2, uv3, target ) {\r\n\r\n\t\tthis.getBarycoord( point, p1, p2, p3, _v3 );\r\n\r\n\t\ttarget.set( 0, 0 );\r\n\t\ttarget.addScaledVector( uv1, _v3.x );\r\n\t\ttarget.addScaledVector( uv2, _v3.y );\r\n\t\ttarget.addScaledVector( uv3, _v3.z );\r\n\r\n\t\treturn target;\r\n\r\n\t}\r\n\r\n\tstatic isFrontFacing( a, b, c, direction ) {\r\n\r\n\t\t_v0.subVectors( c, b );\r\n\t\t_v1.subVectors( a, b );\r\n\r\n\t\t// strictly front facing\r\n\t\treturn ( _v0.cross( _v1 ).dot( direction ) < 0 ) ? true : false;\r\n\r\n\t}\r\n\r\n\tset( a, b, c ) {\r\n\r\n\t\tthis.a.copy( a );\r\n\t\tthis.b.copy( b );\r\n\t\tthis.c.copy( c );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromPointsAndIndices( points, i0, i1, i2 ) {\r\n\r\n\t\tthis.a.copy( points[ i0 ] );\r\n\t\tthis.b.copy( points[ i1 ] );\r\n\t\tthis.c.copy( points[ i2 ] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( triangle ) {\r\n\r\n\t\tthis.a.copy( triangle.a );\r\n\t\tthis.b.copy( triangle.b );\r\n\t\tthis.c.copy( triangle.c );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetArea() {\r\n\r\n\t\t_v0.subVectors( this.c, this.b );\r\n\t\t_v1.subVectors( this.a, this.b );\r\n\r\n\t\treturn _v0.cross( _v1 ).length() * 0.5;\r\n\r\n\t}\r\n\r\n\tgetMidpoint( target ) {\r\n\r\n\t\treturn target.addVectors( this.a, this.b ).add( this.c ).multiplyScalar( 1 / 3 );\r\n\r\n\t}\r\n\r\n\tgetNormal( target ) {\r\n\r\n\t\treturn Triangle.getNormal( this.a, this.b, this.c, target );\r\n\r\n\t}\r\n\r\n\tgetPlane( target ) {\r\n\r\n\t\treturn target.setFromCoplanarPoints( this.a, this.b, this.c );\r\n\r\n\t}\r\n\r\n\tgetBarycoord( point, target ) {\r\n\r\n\t\treturn Triangle.getBarycoord( point, this.a, this.b, this.c, target );\r\n\r\n\t}\r\n\r\n\tgetUV( point, uv1, uv2, uv3, target ) {\r\n\r\n\t\treturn Triangle.getUV( point, this.a, this.b, this.c, uv1, uv2, uv3, target );\r\n\r\n\t}\r\n\r\n\tcontainsPoint( point ) {\r\n\r\n\t\treturn Triangle.containsPoint( point, this.a, this.b, this.c );\r\n\r\n\t}\r\n\r\n\tisFrontFacing( direction ) {\r\n\r\n\t\treturn Triangle.isFrontFacing( this.a, this.b, this.c, direction );\r\n\r\n\t}\r\n\r\n\tintersectsBox( box ) {\r\n\r\n\t\treturn box.intersectsTriangle( this );\r\n\r\n\t}\r\n\r\n\tclosestPointToPoint( p, target ) {\r\n\r\n\t\tconst a = this.a, b = this.b, c = this.c;\r\n\t\tlet v, w;\r\n\r\n\t\t// algorithm thanks to Real-Time Collision Detection by Christer Ericson,\r\n\t\t// published by Morgan Kaufmann Publishers, (c) 2005 Elsevier Inc.,\r\n\t\t// under the accompanying license; see chapter 5.1.5 for detailed explanation.\r\n\t\t// basically, we're distinguishing which of the voronoi regions of the triangle\r\n\t\t// the point lies in with the minimum amount of redundant computation.\r\n\r\n\t\t_vab.subVectors( b, a );\r\n\t\t_vac.subVectors( c, a );\r\n\t\t_vap.subVectors( p, a );\r\n\t\tconst d1 = _vab.dot( _vap );\r\n\t\tconst d2 = _vac.dot( _vap );\r\n\t\tif ( d1 <= 0 && d2 <= 0 ) {\r\n\r\n\t\t\t// vertex region of A; barycentric coords (1, 0, 0)\r\n\t\t\treturn target.copy( a );\r\n\r\n\t\t}\r\n\r\n\t\t_vbp.subVectors( p, b );\r\n\t\tconst d3 = _vab.dot( _vbp );\r\n\t\tconst d4 = _vac.dot( _vbp );\r\n\t\tif ( d3 >= 0 && d4 <= d3 ) {\r\n\r\n\t\t\t// vertex region of B; barycentric coords (0, 1, 0)\r\n\t\t\treturn target.copy( b );\r\n\r\n\t\t}\r\n\r\n\t\tconst vc = d1 * d4 - d3 * d2;\r\n\t\tif ( vc <= 0 && d1 >= 0 && d3 <= 0 ) {\r\n\r\n\t\t\tv = d1 / ( d1 - d3 );\r\n\t\t\t// edge region of AB; barycentric coords (1-v, v, 0)\r\n\t\t\treturn target.copy( a ).addScaledVector( _vab, v );\r\n\r\n\t\t}\r\n\r\n\t\t_vcp.subVectors( p, c );\r\n\t\tconst d5 = _vab.dot( _vcp );\r\n\t\tconst d6 = _vac.dot( _vcp );\r\n\t\tif ( d6 >= 0 && d5 <= d6 ) {\r\n\r\n\t\t\t// vertex region of C; barycentric coords (0, 0, 1)\r\n\t\t\treturn target.copy( c );\r\n\r\n\t\t}\r\n\r\n\t\tconst vb = d5 * d2 - d1 * d6;\r\n\t\tif ( vb <= 0 && d2 >= 0 && d6 <= 0 ) {\r\n\r\n\t\t\tw = d2 / ( d2 - d6 );\r\n\t\t\t// edge region of AC; barycentric coords (1-w, 0, w)\r\n\t\t\treturn target.copy( a ).addScaledVector( _vac, w );\r\n\r\n\t\t}\r\n\r\n\t\tconst va = d3 * d6 - d5 * d4;\r\n\t\tif ( va <= 0 && ( d4 - d3 ) >= 0 && ( d5 - d6 ) >= 0 ) {\r\n\r\n\t\t\t_vbc.subVectors( c, b );\r\n\t\t\tw = ( d4 - d3 ) / ( ( d4 - d3 ) + ( d5 - d6 ) );\r\n\t\t\t// edge region of BC; barycentric coords (0, 1-w, w)\r\n\t\t\treturn target.copy( b ).addScaledVector( _vbc, w ); // edge region of BC\r\n\r\n\t\t}\r\n\r\n\t\t// face region\r\n\t\tconst denom = 1 / ( va + vb + vc );\r\n\t\t// u = va * denom\r\n\t\tv = vb * denom;\r\n\t\tw = vc * denom;\r\n\r\n\t\treturn target.copy( a ).addScaledVector( _vab, v ).addScaledVector( _vac, w );\r\n\r\n\t}\r\n\r\n\tequals( triangle ) {\r\n\r\n\t\treturn triangle.a.equals( this.a ) && triangle.b.equals( this.b ) && triangle.c.equals( this.c );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Triangle };\r\n", "import { Material } from './Material.js';\r\nimport { MultiplyOperation } from '../constants.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\n/**\r\n * parameters = {\r\n *  color: <hex>,\r\n *  opacity: <float>,\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  lightMap: new THREE.Texture( <Image> ),\r\n *  lightMapIntensity: <float>\r\n *\r\n *  aoMap: new THREE.Texture( <Image> ),\r\n *  aoMapIntensity: <float>\r\n *\r\n *  specularMap: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  envMap: new THREE.CubeTexture( [posx, negx, posy, negy, posz, negz] ),\r\n *  combine: THREE.Multiply,\r\n *  reflectivity: <float>,\r\n *  refractionRatio: <float>,\r\n *\r\n *  depthTest: <bool>,\r\n *  depthWrite: <bool>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>,\r\n * }\r\n */\r\n\r\nclass MeshBasicMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'MeshBasicMaterial';\r\n\r\n\t\tthis.color = new Color( 0xffffff ); // emissive\r\n\r\n\t\tthis.map = null;\r\n\r\n\t\tthis.lightMap = null;\r\n\t\tthis.lightMapIntensity = 1.0;\r\n\r\n\t\tthis.aoMap = null;\r\n\t\tthis.aoMapIntensity = 1.0;\r\n\r\n\t\tthis.specularMap = null;\r\n\r\n\t\tthis.alphaMap = null;\r\n\r\n\t\tthis.envMap = null;\r\n\t\tthis.combine = MultiplyOperation;\r\n\t\tthis.reflectivity = 1;\r\n\t\tthis.refractionRatio = 0.98;\r\n\r\n\t\tthis.wireframe = false;\r\n\t\tthis.wireframeLinewidth = 1;\r\n\t\tthis.wireframeLinecap = 'round';\r\n\t\tthis.wireframeLinejoin = 'round';\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.color.copy( source.color );\r\n\r\n\t\tthis.map = source.map;\r\n\r\n\t\tthis.lightMap = source.lightMap;\r\n\t\tthis.lightMapIntensity = source.lightMapIntensity;\r\n\r\n\t\tthis.aoMap = source.aoMap;\r\n\t\tthis.aoMapIntensity = source.aoMapIntensity;\r\n\r\n\t\tthis.specularMap = source.specularMap;\r\n\r\n\t\tthis.alphaMap = source.alphaMap;\r\n\r\n\t\tthis.envMap = source.envMap;\r\n\t\tthis.combine = source.combine;\r\n\t\tthis.reflectivity = source.reflectivity;\r\n\t\tthis.refractionRatio = source.refractionRatio;\r\n\r\n\t\tthis.wireframe = source.wireframe;\r\n\t\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\t\tthis.wireframeLinecap = source.wireframeLinecap;\r\n\t\tthis.wireframeLinejoin = source.wireframeLinejoin;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMeshBasicMaterial.prototype.isMeshBasicMaterial = true;\r\n\r\nexport { MeshBasicMaterial };\r\n", "import { Vector3 } from '../math/Vector3.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Sphere } from '../math/Sphere.js';\r\nimport { Ray } from '../math/Ray.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\nimport { Object3D } from '../core/Object3D.js';\r\nimport { Triangle } from '../math/Triangle.js';\r\nimport { DoubleSide, BackSide } from '../constants.js';\r\nimport { MeshBasicMaterial } from '../materials/MeshBasicMaterial.js';\r\nimport { BufferGeometry } from '../core/BufferGeometry.js';\r\n\r\nconst _inverseMatrix = /*@__PURE__*/ new Matrix4();\r\nconst _ray = /*@__PURE__*/ new Ray();\r\nconst _sphere = /*@__PURE__*/ new Sphere();\r\n\r\nconst _vA = /*@__PURE__*/ new Vector3();\r\nconst _vB = /*@__PURE__*/ new Vector3();\r\nconst _vC = /*@__PURE__*/ new Vector3();\r\n\r\nconst _tempA = /*@__PURE__*/ new Vector3();\r\nconst _tempB = /*@__PURE__*/ new Vector3();\r\nconst _tempC = /*@__PURE__*/ new Vector3();\r\n\r\nconst _morphA = /*@__PURE__*/ new Vector3();\r\nconst _morphB = /*@__PURE__*/ new Vector3();\r\nconst _morphC = /*@__PURE__*/ new Vector3();\r\n\r\nconst _uvA = /*@__PURE__*/ new Vector2();\r\nconst _uvB = /*@__PURE__*/ new Vector2();\r\nconst _uvC = /*@__PURE__*/ new Vector2();\r\n\r\nconst _intersectionPoint = /*@__PURE__*/ new Vector3();\r\nconst _intersectionPointWorld = /*@__PURE__*/ new Vector3();\r\n\r\nclass Mesh extends Object3D {\r\n\r\n\tconstructor( geometry = new BufferGeometry(), material = new MeshBasicMaterial() ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Mesh';\r\n\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.material = material;\r\n\r\n\t\tthis.updateMorphTargets();\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tif ( source.morphTargetInfluences !== undefined ) {\r\n\r\n\t\t\tthis.morphTargetInfluences = source.morphTargetInfluences.slice();\r\n\r\n\t\t}\r\n\r\n\t\tif ( source.morphTargetDictionary !== undefined ) {\r\n\r\n\t\t\tthis.morphTargetDictionary = Object.assign( {}, source.morphTargetDictionary );\r\n\r\n\t\t}\r\n\r\n\t\tthis.material = source.material;\r\n\t\tthis.geometry = source.geometry;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tupdateMorphTargets() {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tconst morphAttributes = geometry.morphAttributes;\r\n\t\t\tconst keys = Object.keys( morphAttributes );\r\n\r\n\t\t\tif ( keys.length > 0 ) {\r\n\r\n\t\t\t\tconst morphAttribute = morphAttributes[ keys[ 0 ] ];\r\n\r\n\t\t\t\tif ( morphAttribute !== undefined ) {\r\n\r\n\t\t\t\t\tthis.morphTargetInfluences = [];\r\n\t\t\t\t\tthis.morphTargetDictionary = {};\r\n\r\n\t\t\t\t\tfor ( let m = 0, ml = morphAttribute.length; m < ml; m ++ ) {\r\n\r\n\t\t\t\t\t\tconst name = morphAttribute[ m ].name || String( m );\r\n\r\n\t\t\t\t\t\tthis.morphTargetInfluences.push( 0 );\r\n\t\t\t\t\t\tthis.morphTargetDictionary[ name ] = m;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst morphTargets = geometry.morphTargets;\r\n\r\n\t\t\tif ( morphTargets !== undefined && morphTargets.length > 0 ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\traycast( raycaster, intersects ) {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\t\tconst material = this.material;\r\n\t\tconst matrixWorld = this.matrixWorld;\r\n\r\n\t\tif ( material === undefined ) return;\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t_sphere.copy( geometry.boundingSphere );\r\n\t\t_sphere.applyMatrix4( matrixWorld );\r\n\r\n\t\tif ( raycaster.ray.intersectsSphere( _sphere ) === false ) return;\r\n\r\n\t\t//\r\n\r\n\t\t_inverseMatrix.copy( matrixWorld ).invert();\r\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\r\n\r\n\t\t// Check boundingBox before continuing\r\n\r\n\t\tif ( geometry.boundingBox !== null ) {\r\n\r\n\t\t\tif ( _ray.intersectsBox( geometry.boundingBox ) === false ) return;\r\n\r\n\t\t}\r\n\r\n\t\tlet intersection;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tconst index = geometry.index;\r\n\t\t\tconst position = geometry.attributes.position;\r\n\t\t\tconst morphPosition = geometry.morphAttributes.position;\r\n\t\t\tconst morphTargetsRelative = geometry.morphTargetsRelative;\r\n\t\t\tconst uv = geometry.attributes.uv;\r\n\t\t\tconst uv2 = geometry.attributes.uv2;\r\n\t\t\tconst groups = geometry.groups;\r\n\t\t\tconst drawRange = geometry.drawRange;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\t// indexed buffer geometry\r\n\r\n\t\t\t\tif ( Array.isArray( material ) ) {\r\n\r\n\t\t\t\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst group = groups[ i ];\r\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\tconst start = Math.max( group.start, drawRange.start );\r\n\t\t\t\t\t\tconst end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\t\t\tfor ( let j = start, jl = end; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\t\tconst a = index.getX( j );\r\n\t\t\t\t\t\t\tconst b = index.getX( j + 1 );\r\n\t\t\t\t\t\t\tconst c = index.getX( j + 2 );\r\n\r\n\t\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, groupMaterial, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\r\n\r\n\t\t\t\t\t\t\tif ( intersection ) {\r\n\r\n\t\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( j / 3 ); // triangle number in indexed buffer semantics\r\n\t\t\t\t\t\t\t\tintersection.face.materialIndex = group.materialIndex;\r\n\t\t\t\t\t\t\t\tintersects.push( intersection );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst start = Math.max( 0, drawRange.start );\r\n\t\t\t\t\tconst end = Math.min( index.count, ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\t\tfor ( let i = start, il = end; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\tconst a = index.getX( i );\r\n\t\t\t\t\t\tconst b = index.getX( i + 1 );\r\n\t\t\t\t\t\tconst c = index.getX( i + 2 );\r\n\r\n\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, material, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\r\n\r\n\t\t\t\t\t\tif ( intersection ) {\r\n\r\n\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( i / 3 ); // triangle number in indexed buffer semantics\r\n\t\t\t\t\t\t\tintersects.push( intersection );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( position !== undefined ) {\r\n\r\n\t\t\t\t// non-indexed buffer geometry\r\n\r\n\t\t\t\tif ( Array.isArray( material ) ) {\r\n\r\n\t\t\t\t\tfor ( let i = 0, il = groups.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst group = groups[ i ];\r\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\tconst start = Math.max( group.start, drawRange.start );\r\n\t\t\t\t\t\tconst end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\t\t\tfor ( let j = start, jl = end; j < jl; j += 3 ) {\r\n\r\n\t\t\t\t\t\t\tconst a = j;\r\n\t\t\t\t\t\t\tconst b = j + 1;\r\n\t\t\t\t\t\t\tconst c = j + 2;\r\n\r\n\t\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, groupMaterial, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\r\n\r\n\t\t\t\t\t\t\tif ( intersection ) {\r\n\r\n\t\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( j / 3 ); // triangle number in non-indexed buffer semantics\r\n\t\t\t\t\t\t\t\tintersection.face.materialIndex = group.materialIndex;\r\n\t\t\t\t\t\t\t\tintersects.push( intersection );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst start = Math.max( 0, drawRange.start );\r\n\t\t\t\t\tconst end = Math.min( position.count, ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\t\tfor ( let i = start, il = end; i < il; i += 3 ) {\r\n\r\n\t\t\t\t\t\tconst a = i;\r\n\t\t\t\t\t\tconst b = i + 1;\r\n\t\t\t\t\t\tconst c = i + 2;\r\n\r\n\t\t\t\t\t\tintersection = checkBufferGeometryIntersection( this, material, raycaster, _ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c );\r\n\r\n\t\t\t\t\t\tif ( intersection ) {\r\n\r\n\t\t\t\t\t\t\tintersection.faceIndex = Math.floor( i / 3 ); // triangle number in non-indexed buffer semantics\r\n\t\t\t\t\t\t\tintersects.push( intersection );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nMesh.prototype.isMesh = true;\r\n\r\nfunction checkIntersection( object, material, raycaster, ray, pA, pB, pC, point ) {\r\n\r\n\tlet intersect;\r\n\r\n\tif ( material.side === BackSide ) {\r\n\r\n\t\tintersect = ray.intersectTriangle( pC, pB, pA, true, point );\r\n\r\n\t} else {\r\n\r\n\t\tintersect = ray.intersectTriangle( pA, pB, pC, material.side !== DoubleSide, point );\r\n\r\n\t}\r\n\r\n\tif ( intersect === null ) return null;\r\n\r\n\t_intersectionPointWorld.copy( point );\r\n\t_intersectionPointWorld.applyMatrix4( object.matrixWorld );\r\n\r\n\tconst distance = raycaster.ray.origin.distanceTo( _intersectionPointWorld );\r\n\r\n\tif ( distance < raycaster.near || distance > raycaster.far ) return null;\r\n\r\n\treturn {\r\n\t\tdistance: distance,\r\n\t\tpoint: _intersectionPointWorld.clone(),\r\n\t\tobject: object\r\n\t};\r\n\r\n}\r\n\r\nfunction checkBufferGeometryIntersection( object, material, raycaster, ray, position, morphPosition, morphTargetsRelative, uv, uv2, a, b, c ) {\r\n\r\n\t_vA.fromBufferAttribute( position, a );\r\n\t_vB.fromBufferAttribute( position, b );\r\n\t_vC.fromBufferAttribute( position, c );\r\n\r\n\tconst morphInfluences = object.morphTargetInfluences;\r\n\r\n\tif ( morphPosition && morphInfluences ) {\r\n\r\n\t\t_morphA.set( 0, 0, 0 );\r\n\t\t_morphB.set( 0, 0, 0 );\r\n\t\t_morphC.set( 0, 0, 0 );\r\n\r\n\t\tfor ( let i = 0, il = morphPosition.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst influence = morphInfluences[ i ];\r\n\t\t\tconst morphAttribute = morphPosition[ i ];\r\n\r\n\t\t\tif ( influence === 0 ) continue;\r\n\r\n\t\t\t_tempA.fromBufferAttribute( morphAttribute, a );\r\n\t\t\t_tempB.fromBufferAttribute( morphAttribute, b );\r\n\t\t\t_tempC.fromBufferAttribute( morphAttribute, c );\r\n\r\n\t\t\tif ( morphTargetsRelative ) {\r\n\r\n\t\t\t\t_morphA.addScaledVector( _tempA, influence );\r\n\t\t\t\t_morphB.addScaledVector( _tempB, influence );\r\n\t\t\t\t_morphC.addScaledVector( _tempC, influence );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\r\n\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\r\n\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_vA.add( _morphA );\r\n\t\t_vB.add( _morphB );\r\n\t\t_vC.add( _morphC );\r\n\r\n\t}\r\n\r\n\tif ( object.isSkinnedMesh ) {\r\n\r\n\t\tobject.boneTransform( a, _vA );\r\n\t\tobject.boneTransform( b, _vB );\r\n\t\tobject.boneTransform( c, _vC );\r\n\r\n\t}\r\n\r\n\tconst intersection = checkIntersection( object, material, raycaster, ray, _vA, _vB, _vC, _intersectionPoint );\r\n\r\n\tif ( intersection ) {\r\n\r\n\t\tif ( uv ) {\r\n\r\n\t\t\t_uvA.fromBufferAttribute( uv, a );\r\n\t\t\t_uvB.fromBufferAttribute( uv, b );\r\n\t\t\t_uvC.fromBufferAttribute( uv, c );\r\n\r\n\t\t\tintersection.uv = Triangle.getUV( _intersectionPoint, _vA, _vB, _vC, _uvA, _uvB, _uvC, new Vector2() );\r\n\r\n\t\t}\r\n\r\n\t\tif ( uv2 ) {\r\n\r\n\t\t\t_uvA.fromBufferAttribute( uv2, a );\r\n\t\t\t_uvB.fromBufferAttribute( uv2, b );\r\n\t\t\t_uvC.fromBufferAttribute( uv2, c );\r\n\r\n\t\t\tintersection.uv2 = Triangle.getUV( _intersectionPoint, _vA, _vB, _vC, _uvA, _uvB, _uvC, new Vector2() );\r\n\r\n\t\t}\r\n\r\n\t\tconst face = {\r\n\t\t\ta: a,\r\n\t\t\tb: b,\r\n\t\t\tc: c,\r\n\t\t\tnormal: new Vector3(),\r\n\t\t\tmaterialIndex: 0\r\n\t\t};\r\n\r\n\t\tTriangle.getNormal( _vA, _vB, _vC, face.normal );\r\n\r\n\t\tintersection.face = face;\r\n\r\n\t}\r\n\r\n\treturn intersection;\r\n\r\n}\r\n\r\nexport { Mesh };\r\n", "export default /* glsl */`\r\n#ifdef USE_ALPHAMAP\r\n\r\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ALPHAMAP\r\n\r\n\tuniform sampler2D alphaMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef ALPHATEST\r\n\r\n\tif ( diffuseColor.a < ALPHATEST ) discard;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_AOMAP\r\n\r\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\r\n\r\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\r\n\r\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\r\n\r\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\r\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_AOMAP\r\n\r\n\tuniform sampler2D aoMap;\r\n\tuniform float aoMapIntensity;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nvec3 transformed = vec3( position );\r\n`;\r\n", "export default /* glsl */`\r\nvec3 objectNormal = vec3( normal );\r\n\r\n#ifdef USE_TANGENT\r\n\r\n\tvec3 objectTangent = vec3( tangent.xyz );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n\r\n// Analytical approximation of the DFG LUT, one half of the\r\n// split-sum approximation used in indirect specular lighting.\r\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\r\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\r\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\r\n\r\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\r\n\r\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\r\n\r\n\tvec4 r = roughness * c0 + c1;\r\n\r\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\r\n\r\n\treturn vec2( - 1.04, 1.04 ) * a004 + r.zw;\r\n\r\n}\r\n\r\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\r\n\r\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\r\n\r\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t// page 32, equation 26: E[window1]\r\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\r\n\t// but who must be converted to luminous irradiance for surface lighting calculation\r\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\r\n\r\n\tif( cutoffDistance > 0.0 ) {\r\n\r\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\r\n\r\n\t}\r\n\r\n\treturn distanceFalloff;\r\n\r\n#else\r\n\r\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\r\n\r\n\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\r\n\r\n\t}\r\n\r\n\treturn 1.0;\r\n\r\n#endif\r\n\r\n}\r\n\r\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r\n\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n\r\n} // validated\r\n\r\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\r\n\r\n\t// Original approximation by Christophe Schlick '94\r\n\t// float fresnel = pow( 1.0 - dotVH, 5.0 );\r\n\r\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\r\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\r\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\r\n\r\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\r\n\r\n} // validated\r\n\r\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\r\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\r\n\r\n\tfloat a2 = pow2( alpha );\r\n\r\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\r\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\r\n\r\n\treturn 0.5 / max( gv + gl, EPSILON );\r\n\r\n}\r\n\r\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\r\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\r\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\r\nfloat D_GGX( const in float alpha, const in float dotNH ) {\r\n\r\n\tfloat a2 = pow2( alpha );\r\n\r\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\r\n\r\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\r\n\r\n}\r\n\r\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\r\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\r\n\r\n\tfloat alpha = pow2( roughness ); // UE4's roughness\r\n\r\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\r\n\r\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\r\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\r\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\r\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\r\n\r\n\tvec3 F = F_Schlick( f0, f90, dotVH );\r\n\r\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\r\n\r\n\tfloat D = D_GGX( alpha, dotNH );\r\n\r\n\treturn F * ( V * D );\r\n\r\n} // validated\r\n\r\n// Rect Area Light\r\n\r\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\r\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\r\n// code: https://github.com/selfshadow/ltc_code/\r\n\r\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\r\n\r\n\tconst float LUT_SIZE = 64.0;\r\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\r\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\r\n\r\n\tfloat dotNV = saturate( dot( N, V ) );\r\n\r\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\r\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\r\n\r\n\tuv = uv * LUT_SCALE + LUT_BIAS;\r\n\r\n\treturn uv;\r\n\r\n}\r\n\r\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\r\n\r\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\r\n\t// An approximation of the form factor of a horizon-clipped rectangle.\r\n\r\n\tfloat l = length( f );\r\n\r\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\r\n\r\n}\r\n\r\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\r\n\r\n\tfloat x = dot( v1, v2 );\r\n\r\n\tfloat y = abs( x );\r\n\r\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\r\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\r\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\r\n\tfloat v = a / b;\r\n\r\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\r\n\r\n\treturn cross( v1, v2 ) * theta_sintheta;\r\n\r\n}\r\n\r\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\r\n\r\n\t// bail if point is on back side of plane of light\r\n\t// assumes ccw winding order of light vertices\r\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\r\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\r\n\tvec3 lightNormal = cross( v1, v2 );\r\n\r\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\r\n\r\n\t// construct orthonormal basis around N\r\n\tvec3 T1, T2;\r\n\tT1 = normalize( V - N * dot( V, N ) );\r\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\r\n\r\n\t// compute transform\r\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\r\n\r\n\t// transform rect\r\n\tvec3 coords[ 4 ];\r\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\r\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\r\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\r\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\r\n\r\n\t// project rect onto sphere\r\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\r\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\r\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\r\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\r\n\r\n\t// calculate vector form factor\r\n\tvec3 vectorFormFactor = vec3( 0.0 );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\r\n\r\n\t// adjust for horizon clipping\r\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\r\n\r\n/*\r\n\t// alternate method of adjusting for horizon clipping (see referece)\r\n\t// refactoring required\r\n\tfloat len = length( vectorFormFactor );\r\n\tfloat z = vectorFormFactor.z / len;\r\n\r\n\tconst float LUT_SIZE = 64.0;\r\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\r\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\r\n\r\n\t// tabulated horizon-clipped sphere, apparently...\r\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\r\n\tuv = uv * LUT_SCALE + LUT_BIAS;\r\n\r\n\tfloat scale = texture2D( ltc_2, uv ).w;\r\n\r\n\tfloat result = len * scale;\r\n*/\r\n\r\n\treturn vec3( result );\r\n\r\n}\r\n\r\n// End Rect Area Light\r\n\r\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\r\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\r\n\r\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\r\n\r\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\r\n\r\n\treturn specularColor * brdf.x + brdf.y;\r\n\r\n} // validated\r\n\r\n// Fdez-Ag\u00FCera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\r\n// Approximates multiscattering in order to preserve energy.\r\n// http://www.jcgt.org/published/0008/01/03/\r\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\r\n\r\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\r\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\r\n\r\n\tvec3 FssEss = specularColor * brdf.x + brdf.y;\r\n\r\n\tfloat Ess = brdf.x + brdf.y;\r\n\tfloat Ems = 1.0 - Ess;\r\n\r\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\r\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\r\n\r\n\tsingleScatter += FssEss;\r\n\tmultiScatter += Fms * Ems;\r\n\r\n}\r\n\r\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\r\n\r\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r\n\treturn 0.25;\r\n\r\n}\r\n\r\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\r\n\r\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r\n\r\n}\r\n\r\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r\n\r\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n\r\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\r\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\r\n\r\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\r\n\r\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\r\n\r\n\tfloat D = D_BlinnPhong( shininess, dotNH );\r\n\r\n\treturn F * ( G * D );\r\n\r\n} // validated\r\n\r\n#if defined( USE_SHEEN )\r\n\r\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\r\nfloat D_Charlie( float roughness, float NoH ) {\r\n\r\n\t// Estevez and Kulla 2017, \"Production Friendly Microfacet Sheen BRDF\"\r\n\tfloat invAlpha = 1.0 / roughness;\r\n\tfloat cos2h = NoH * NoH;\r\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\r\n\r\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\r\n\r\n}\r\n\r\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\r\nfloat V_Neubelt( float NoV, float NoL ) {\r\n\r\n\t// Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\r\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\r\n\r\n}\r\n\r\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\r\n\r\n\tvec3 N = geometry.normal;\r\n\tvec3 V = geometry.viewDir;\r\n\r\n\tvec3 H = normalize( V + L );\r\n\tfloat dotNH = saturate( dot( N, H ) );\r\n\r\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\r\n\r\n}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_BUMPMAP\r\n\r\n\tuniform sampler2D bumpMap;\r\n\tuniform float bumpScale;\r\n\r\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\r\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\r\n\r\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\r\n\r\n\tvec2 dHdxy_fwd() {\r\n\r\n\t\tvec2 dSTdx = dFdx( vUv );\r\n\t\tvec2 dSTdy = dFdy( vUv );\r\n\r\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\r\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\r\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\r\n\r\n\t\treturn vec2( dBx, dBy );\r\n\r\n\t}\r\n\r\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\r\n\r\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\r\n\r\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\r\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\r\n\t\tvec3 vN = surf_norm;\t\t// normalized\r\n\r\n\t\tvec3 R1 = cross( vSigmaY, vN );\r\n\t\tvec3 R2 = cross( vN, vSigmaX );\r\n\r\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\r\n\r\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if NUM_CLIPPING_PLANES > 0\r\n\r\n\tvec4 plane;\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\r\n\r\n\t\tplane = clippingPlanes[ i ];\r\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\r\n\r\n\t\tbool clipped = true;\r\n\r\n\t\t#pragma unroll_loop_start\r\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\r\n\r\n\t\t\tplane = clippingPlanes[ i ];\r\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\r\n\r\n\t\t}\r\n\t\t#pragma unroll_loop_end\r\n\r\n\t\tif ( clipped ) discard;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if NUM_CLIPPING_PLANES > 0\r\n\r\n\tvarying vec3 vClipPosition;\r\n\r\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if NUM_CLIPPING_PLANES > 0\r\n\r\n\tvarying vec3 vClipPosition;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if NUM_CLIPPING_PLANES > 0\r\n\r\n\tvClipPosition = - mvPosition.xyz;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_COLOR_ALPHA )\r\n\r\n\tdiffuseColor *= vColor;\r\n\r\n#elif defined( USE_COLOR )\r\n\r\n\tdiffuseColor.rgb *= vColor;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_COLOR_ALPHA )\r\n\r\n\tvarying vec4 vColor;\r\n\r\n#elif defined( USE_COLOR )\r\n\r\n\tvarying vec3 vColor;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_COLOR_ALPHA )\r\n\r\n\tvarying vec4 vColor;\r\n\r\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\r\n\r\n\tvarying vec3 vColor;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_COLOR_ALPHA )\r\n\r\n\tvColor = vec4( 1.0 );\r\n\r\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\r\n\r\n\tvColor = vec3( 1.0 );\r\n\r\n#endif\r\n\r\n#ifdef USE_COLOR\r\n\r\n\tvColor *= color;\r\n\r\n#endif\r\n\r\n#ifdef USE_INSTANCING_COLOR\r\n\r\n\tvColor.xyz *= instanceColor.xyz;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#define PI 3.141592653589793\r\n#define PI2 6.283185307179586\r\n#define PI_HALF 1.5707963267948966\r\n#define RECIPROCAL_PI 0.3183098861837907\r\n#define RECIPROCAL_PI2 0.15915494309189535\r\n#define EPSILON 1e-6\r\n\r\n#ifndef saturate\r\n// <tonemapping_pars_fragment> may have defined saturate() already\r\n#define saturate( a ) clamp( a, 0.0, 1.0 )\r\n#endif\r\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\r\n\r\nfloat pow2( const in float x ) { return x*x; }\r\nfloat pow3( const in float x ) { return x*x*x; }\r\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\r\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\r\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\r\n\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nhighp float rand( const in vec2 uv ) {\r\n\r\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\r\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\r\n\r\n\treturn fract( sin( sn ) * c );\r\n\r\n}\r\n\r\n#ifdef HIGH_PRECISION\r\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\r\n#else\r\n\tfloat precisionSafeLength( vec3 v ) {\r\n\t\tfloat maxComponent = max3( abs( v ) );\r\n\t\treturn length( v / maxComponent ) * maxComponent;\r\n\t}\r\n#endif\r\n\r\nstruct IncidentLight {\r\n\tvec3 color;\r\n\tvec3 direction;\r\n\tbool visible;\r\n};\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct GeometricContext {\r\n\tvec3 position;\r\n\tvec3 normal;\r\n\tvec3 viewDir;\r\n#ifdef CLEARCOAT\r\n\tvec3 clearcoatNormal;\r\n#endif\r\n};\r\n\r\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\r\n\r\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\r\n\r\n}\r\n\r\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\r\n\r\n\t// dir can be either a direction vector or a normal vector\r\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\r\n\r\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\r\n\r\n}\r\n\r\nmat3 transposeMat3( const in mat3 m ) {\r\n\r\n\tmat3 tmp;\r\n\r\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\r\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\r\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\r\n\r\n\treturn tmp;\r\n\r\n}\r\n\r\n// https://en.wikipedia.org/wiki/Relative_luminance\r\nfloat linearToRelativeLuminance( const in vec3 color ) {\r\n\r\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\r\n\r\n\treturn dot( weights, color.rgb );\r\n\r\n}\r\n\r\nbool isPerspectiveMatrix( mat4 m ) {\r\n\r\n\treturn m[ 2 ][ 3 ] == - 1.0;\r\n\r\n}\r\n\r\nvec2 equirectUv( in vec3 dir ) {\r\n\r\n\t// dir is assumed to be unit length\r\n\r\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\r\n\r\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\r\n\r\n\treturn vec2( u, v );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef ENVMAP_TYPE_CUBE_UV\r\n\r\n\t#define cubeUV_maxMipLevel 8.0\r\n\t#define cubeUV_minMipLevel 4.0\r\n\t#define cubeUV_maxTileSize 256.0\r\n\t#define cubeUV_minTileSize 16.0\r\n\r\n\t// These shader functions convert between the UV coordinates of a single face of\r\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\r\n\t// sampling a textureCube (not generally normalized ).\r\n\r\n\tfloat getFace( vec3 direction ) {\r\n\r\n\t\tvec3 absDirection = abs( direction );\r\n\r\n\t\tfloat face = - 1.0;\r\n\r\n\t\tif ( absDirection.x > absDirection.z ) {\r\n\r\n\t\t\tif ( absDirection.x > absDirection.y )\r\n\r\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\r\n\r\n\t\t\telse\r\n\r\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( absDirection.z > absDirection.y )\r\n\r\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\r\n\r\n\t\t\telse\r\n\r\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\r\n\r\n\t\t}\r\n\r\n\t\treturn face;\r\n\r\n\t}\r\n\r\n\t// RH coordinate system; PMREM face-indexing convention\r\n\tvec2 getUV( vec3 direction, float face ) {\r\n\r\n\t\tvec2 uv;\r\n\r\n\t\tif ( face == 0.0 ) {\r\n\r\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\r\n\r\n\t\t} else if ( face == 1.0 ) {\r\n\r\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\r\n\r\n\t\t} else if ( face == 2.0 ) {\r\n\r\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\r\n\r\n\t\t} else if ( face == 3.0 ) {\r\n\r\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\r\n\r\n\t\t} else if ( face == 4.0 ) {\r\n\r\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\r\n\r\n\t\t} else {\r\n\r\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\r\n\r\n\t\t}\r\n\r\n\t\treturn 0.5 * ( uv + 1.0 );\r\n\r\n\t}\r\n\r\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\r\n\r\n\t\tfloat face = getFace( direction );\r\n\r\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\r\n\r\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\r\n\r\n\t\tfloat faceSize = exp2( mipInt );\r\n\r\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\r\n\r\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\r\n\r\n\t\tvec2 f = fract( uv );\r\n\r\n\t\tuv += 0.5 - f;\r\n\r\n\t\tif ( face > 2.0 ) {\r\n\r\n\t\t\tuv.y += faceSize;\r\n\r\n\t\t\tface -= 3.0;\r\n\r\n\t\t}\r\n\r\n\t\tuv.x += face * faceSize;\r\n\r\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\r\n\r\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\r\n\r\n\t\t}\r\n\r\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\r\n\r\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\r\n\r\n\t\tuv *= texelSize;\r\n\r\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\r\n\r\n\t\tuv.x += texelSize;\r\n\r\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\r\n\r\n\t\tuv.y += texelSize;\r\n\r\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\r\n\r\n\t\tuv.x -= texelSize;\r\n\r\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\r\n\r\n\t\tvec3 tm = mix( tl, tr, f.x );\r\n\r\n\t\tvec3 bm = mix( bl, br, f.x );\r\n\r\n\t\treturn mix( tm, bm, f.y );\r\n\r\n\t}\r\n\r\n\t// These defines must match with PMREMGenerator\r\n\r\n\t#define r0 1.0\r\n\t#define v0 0.339\r\n\t#define m0 - 2.0\r\n\t#define r1 0.8\r\n\t#define v1 0.276\r\n\t#define m1 - 1.0\r\n\t#define r4 0.4\r\n\t#define v4 0.046\r\n\t#define m4 2.0\r\n\t#define r5 0.305\r\n\t#define v5 0.016\r\n\t#define m5 3.0\r\n\t#define r6 0.21\r\n\t#define v6 0.0038\r\n\t#define m6 4.0\r\n\r\n\tfloat roughnessToMip( float roughness ) {\r\n\r\n\t\tfloat mip = 0.0;\r\n\r\n\t\tif ( roughness >= r1 ) {\r\n\r\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\r\n\r\n\t\t} else if ( roughness >= r4 ) {\r\n\r\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\r\n\r\n\t\t} else if ( roughness >= r5 ) {\r\n\r\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\r\n\r\n\t\t} else if ( roughness >= r6 ) {\r\n\r\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\r\n\t\t}\r\n\r\n\t\treturn mip;\r\n\r\n\t}\r\n\r\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\r\n\r\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\r\n\r\n\t\tfloat mipF = fract( mip );\r\n\r\n\t\tfloat mipInt = floor( mip );\r\n\r\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\r\n\r\n\t\tif ( mipF == 0.0 ) {\r\n\r\n\t\t\treturn vec4( color0, 1.0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\r\n\r\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nvec3 transformedNormal = objectNormal;\r\n\r\n#ifdef USE_INSTANCING\r\n\r\n\t// this is in lieu of a per-instance normal-matrix\r\n\t// shear transforms in the instance matrix are not supported\r\n\r\n\tmat3 m = mat3( instanceMatrix );\r\n\r\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\r\n\r\n\ttransformedNormal = m * transformedNormal;\r\n\r\n#endif\r\n\r\ntransformedNormal = normalMatrix * transformedNormal;\r\n\r\n#ifdef FLIP_SIDED\r\n\r\n\ttransformedNormal = - transformedNormal;\r\n\r\n#endif\r\n\r\n#ifdef USE_TANGENT\r\n\r\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\r\n\r\n\t#ifdef FLIP_SIDED\r\n\r\n\t\ttransformedTangent = - transformedTangent;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_DISPLACEMENTMAP\r\n\r\n\tuniform sampler2D displacementMap;\r\n\tuniform float displacementScale;\r\n\tuniform float displacementBias;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_DISPLACEMENTMAP\r\n\r\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_EMISSIVEMAP\r\n\r\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\r\n\r\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\r\n\r\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_EMISSIVEMAP\r\n\r\n\tuniform sampler2D emissiveMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\ngl_FragColor = linearToOutputTexel( gl_FragColor );\r\n`;\r\n", "export default /* glsl */`\r\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\r\n\r\nvec4 LinearToLinear( in vec4 value ) {\r\n\treturn value;\r\n}\r\n\r\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\r\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\r\n}\r\n\r\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\r\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\r\n}\r\n\r\nvec4 sRGBToLinear( in vec4 value ) {\r\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\r\n}\r\n\r\nvec4 LinearTosRGB( in vec4 value ) {\r\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\r\n}\r\n\r\nvec4 RGBEToLinear( in vec4 value ) {\r\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\r\n}\r\n\r\nvec4 LinearToRGBE( in vec4 value ) {\r\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\r\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\r\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\r\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\r\n}\r\n\r\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\r\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\r\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\r\n}\r\n\r\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\r\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\r\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\r\n\tM = ceil( M * 255.0 ) / 255.0;\r\n\treturn vec4( value.rgb / ( M * maxRange ), M );\r\n}\r\n\r\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\r\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\r\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\r\n}\r\n\r\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\r\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\r\n\tfloat D = max( maxRange / maxRGB, 1.0 );\r\n\t// NOTE: The implementation with min causes the shader to not compile on\r\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \r\n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\r\n\t// D = min( floor( D ) / 255.0, 1.0 );\r\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\r\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\r\n}\r\n\r\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\r\n\r\n// M matrix, for encoding\r\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\r\nvec4 LinearToLogLuv( in vec4 value ) {\r\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\r\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\r\n\tvec4 vResult;\r\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\r\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\r\n\tvResult.w = fract( Le );\r\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\r\n\treturn vResult;\r\n}\r\n\r\n// Inverse M matrix, for decoding\r\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\r\nvec4 LogLuvToLinear( in vec4 value ) {\r\n\tfloat Le = value.z * 255.0 + value.w;\r\n\tvec3 Xp_Y_XYZp;\r\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\r\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\r\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\r\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\r\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ENVMAP\r\n\r\n\t#ifdef ENV_WORLDPOS\r\n\r\n\t\tvec3 cameraToFrag;\r\n\r\n\t\tif ( isOrthographic ) {\r\n\r\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\r\n\r\n\t\t}\r\n\r\n\t\t// Transforming Normal Vectors with the Inverse Transformation\r\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\r\n\r\n\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\r\n\r\n\t\t#endif\r\n\r\n\t#else\r\n\r\n\t\tvec3 reflectVec = vReflect;\r\n\r\n\t#endif\r\n\r\n\t#ifdef ENVMAP_TYPE_CUBE\r\n\r\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\r\n\r\n\t\tenvColor = envMapTexelToLinear( envColor );\r\n\r\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\r\n\r\n\t#else\r\n\r\n\t\tvec4 envColor = vec4( 0.0 );\r\n\r\n\t#endif\r\n\r\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\r\n\r\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\r\n\r\n\t#elif defined( ENVMAP_BLENDING_MIX )\r\n\r\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\r\n\r\n\t#elif defined( ENVMAP_BLENDING_ADD )\r\n\r\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ENVMAP\r\n\r\n\tuniform float envMapIntensity;\r\n\tuniform float flipEnvMap;\r\n\tuniform int maxMipLevel;\r\n\r\n\t#ifdef ENVMAP_TYPE_CUBE\r\n\t\tuniform samplerCube envMap;\r\n\t#else\r\n\t\tuniform sampler2D envMap;\r\n\t#endif\r\n\t\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ENVMAP\r\n\r\n\tuniform float reflectivity;\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\r\n\r\n\t\t#define ENV_WORLDPOS\r\n\r\n\t#endif\r\n\r\n\t#ifdef ENV_WORLDPOS\r\n\r\n\t\tvarying vec3 vWorldPosition;\r\n\t\tuniform float refractionRatio;\r\n\t#else\r\n\t\tvarying vec3 vReflect;\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ENVMAP\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\r\n\r\n\t\t#define ENV_WORLDPOS\r\n\r\n\t#endif\r\n\r\n\t#ifdef ENV_WORLDPOS\r\n\t\t\r\n\t\tvarying vec3 vWorldPosition;\r\n\r\n\t#else\r\n\r\n\t\tvarying vec3 vReflect;\r\n\t\tuniform float refractionRatio;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ENVMAP\r\n\r\n\t#ifdef ENV_WORLDPOS\r\n\r\n\t\tvWorldPosition = worldPosition.xyz;\r\n\r\n\t#else\r\n\r\n\t\tvec3 cameraToVertex;\r\n\r\n\t\tif ( isOrthographic ) {\r\n\r\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\r\n\r\n\t\t}\r\n\r\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\r\n\r\n\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\r\n\r\n\t\t#endif\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_FOG\r\n\r\n\tvFogDepth = - mvPosition.z;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_FOG\r\n\r\n\tvarying float vFogDepth;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_FOG\r\n\r\n\t#ifdef FOG_EXP2\r\n\r\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\r\n\r\n\t#else\r\n\r\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\r\n\r\n\t#endif\r\n\r\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_FOG\r\n\r\n\tuniform vec3 fogColor;\r\n\tvarying float vFogDepth;\r\n\r\n\t#ifdef FOG_EXP2\r\n\r\n\t\tuniform float fogDensity;\r\n\r\n\t#else\r\n\r\n\t\tuniform float fogNear;\r\n\t\tuniform float fogFar;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n\r\n#ifdef USE_GRADIENTMAP\r\n\r\n\tuniform sampler2D gradientMap;\r\n\r\n#endif\r\n\r\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\r\n\r\n\t// dotNL will be from -1.0 to 1.0\r\n\tfloat dotNL = dot( normal, lightDirection );\r\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\r\n\r\n\t#ifdef USE_GRADIENTMAP\r\n\r\n\t\treturn texture2D( gradientMap, coord ).rgb;\r\n\r\n\t#else\r\n\r\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\r\n\r\n\t#endif\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_LIGHTMAP\r\n\r\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\r\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_LIGHTMAP\r\n\r\n\tuniform sampler2D lightMap;\r\n\tuniform float lightMapIntensity;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nvec3 diffuse = vec3( 1.0 );\r\n\r\nGeometricContext geometry;\r\ngeometry.position = mvPosition.xyz;\r\ngeometry.normal = normalize( transformedNormal );\r\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\r\n\r\nGeometricContext backGeometry;\r\nbackGeometry.position = geometry.position;\r\nbackGeometry.normal = -geometry.normal;\r\nbackGeometry.viewDir = geometry.viewDir;\r\n\r\nvLightFront = vec3( 0.0 );\r\nvIndirectFront = vec3( 0.0 );\r\n#ifdef DOUBLE_SIDED\r\n\tvLightBack = vec3( 0.0 );\r\n\tvIndirectBack = vec3( 0.0 );\r\n#endif\r\n\r\nIncidentLight directLight;\r\nfloat dotNL;\r\nvec3 directLightColor_Diffuse;\r\n\r\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\r\n\r\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\r\n\r\n#ifdef DOUBLE_SIDED\r\n\r\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\r\n\r\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\r\n\r\n#endif\r\n\r\n#if NUM_POINT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if NUM_SPOT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n/*\r\n#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\r\n\r\n\t\t// TODO (abelnation): implement\r\n\r\n\t}\r\n\r\n#endif\r\n*/\r\n\r\n#if NUM_DIR_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if NUM_HEMI_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\r\n\r\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nuniform bool receiveShadow;\r\nuniform vec3 ambientLightColor;\r\nuniform vec3 lightProbe[ 9 ];\r\n\r\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\r\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\r\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\r\n\r\n\t// normal is assumed to have unit length\r\n\r\n\tfloat x = normal.x, y = normal.y, z = normal.z;\r\n\r\n\t// band 0\r\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\r\n\r\n\t// band 1\r\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\r\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\r\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\r\n\r\n\t// band 2\r\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\r\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\r\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\r\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\r\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\r\n\r\n\treturn result;\r\n\r\n}\r\n\r\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\r\n\r\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\r\n\r\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\r\n\r\n\treturn irradiance;\r\n\r\n}\r\n\r\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\r\n\r\n\tvec3 irradiance = ambientLightColor;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI;\r\n\r\n\t#endif\r\n\r\n\treturn irradiance;\r\n\r\n}\r\n\r\n#if NUM_DIR_LIGHTS > 0\r\n\r\n\tstruct DirectionalLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\t};\r\n\r\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\r\n\r\n\t\tdirectLight.color = directionalLight.color;\r\n\t\tdirectLight.direction = directionalLight.direction;\r\n\t\tdirectLight.visible = true;\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_POINT_LIGHTS > 0\r\n\r\n\tstruct PointLight {\r\n\t\tvec3 position;\r\n\t\tvec3 color;\r\n\t\tfloat distance;\r\n\t\tfloat decay;\r\n\t};\r\n\r\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\r\n\r\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\r\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\r\n\r\n\t\tvec3 lVector = pointLight.position - geometry.position;\r\n\t\tdirectLight.direction = normalize( lVector );\r\n\r\n\t\tfloat lightDistance = length( lVector );\r\n\r\n\t\tdirectLight.color = pointLight.color;\r\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\r\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_SPOT_LIGHTS > 0\r\n\r\n\tstruct SpotLight {\r\n\t\tvec3 position;\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\t\tfloat distance;\r\n\t\tfloat decay;\r\n\t\tfloat coneCos;\r\n\t\tfloat penumbraCos;\r\n\t};\r\n\r\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\r\n\r\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\r\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\r\n\r\n\t\tvec3 lVector = spotLight.position - geometry.position;\r\n\t\tdirectLight.direction = normalize( lVector );\r\n\r\n\t\tfloat lightDistance = length( lVector );\r\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\r\n\r\n\t\tif ( angleCos > spotLight.coneCos ) {\r\n\r\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\r\n\r\n\t\t\tdirectLight.color = spotLight.color;\r\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\r\n\t\t\tdirectLight.visible = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdirectLight.color = vec3( 0.0 );\r\n\t\t\tdirectLight.visible = false;\r\n\r\n\t\t}\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\tstruct RectAreaLight {\r\n\t\tvec3 color;\r\n\t\tvec3 position;\r\n\t\tvec3 halfWidth;\r\n\t\tvec3 halfHeight;\r\n\t};\r\n\r\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\r\n\t// BRDF approximation Texture is 64x64\r\n\tuniform sampler2D ltc_1; // RGBA Float\r\n\tuniform sampler2D ltc_2; // RGBA Float\r\n\r\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\r\n\r\n#endif\r\n\r\n\r\n#if NUM_HEMI_LIGHTS > 0\r\n\r\n\tstruct HemisphereLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 skyColor;\r\n\t\tvec3 groundColor;\r\n\t};\r\n\r\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\r\n\r\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\r\n\r\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\r\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\r\n\r\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\r\n\r\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\t\tirradiance *= PI;\r\n\r\n\t\t#endif\r\n\r\n\t\treturn irradiance;\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_ENVMAP )\r\n\r\n\t#ifdef ENVMAP_MODE_REFRACTION\r\n\r\n\t\tuniform float refractionRatio;\r\n\r\n\t#endif\r\n\r\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\r\n\r\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\r\n\r\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\r\n\r\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\r\n\r\n\t\t#else\r\n\r\n\t\t\treturn vec3( 0.0 );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\r\n\r\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\t\tvec3 reflectVec;\r\n\r\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\t\treflectVec = reflect( - viewDir, normal );\r\n\r\n\t\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\r\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\r\n\r\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\r\n\r\n\t\t\treturn envMapColor.rgb * envMapIntensity;\r\n\r\n\t\t#else\r\n\r\n\t\t\treturn vec3( 0.0 );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nToonMaterial material;\r\nmaterial.diffuseColor = diffuseColor.rgb;\r\n`;\r\n", "export default /* glsl */`\r\nvarying vec3 vViewPosition;\r\n\r\nstruct ToonMaterial {\r\n\r\n\tvec3 diffuseColor;\r\n\r\n};\r\n\r\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI; // punctual light\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\n#define RE_Direct\t\t\t\tRE_Direct_Toon\r\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\r\n\r\n#define Material_LightProbeLOD( material )\t(0)\r\n`;\r\n", "export default /* glsl */`\r\nBlinnPhongMaterial material;\r\nmaterial.diffuseColor = diffuseColor.rgb;\r\nmaterial.specularColor = specular;\r\nmaterial.specularShininess = shininess;\r\nmaterial.specularStrength = specularStrength;\r\n`;\r\n", "export default /* glsl */`\r\nvarying vec3 vViewPosition;\r\n\r\nstruct BlinnPhongMaterial {\r\n\r\n\tvec3 diffuseColor;\r\n\tvec3 specularColor;\r\n\tfloat specularShininess;\r\n\tfloat specularStrength;\r\n\r\n};\r\n\r\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\r\n\tvec3 irradiance = dotNL * directLight.color;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI; // punctual light\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\r\n\r\n}\r\n\r\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\r\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\r\n\r\n#define Material_LightProbeLOD( material )\t(0)\r\n`;\r\n", "export default /* glsl */`\r\nPhysicalMaterial material;\r\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\r\n\r\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\r\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\r\n\r\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\r\nmaterial.specularRoughness += geometryRoughness;\r\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\r\n\r\n#ifdef IOR\r\n\r\n\t#ifdef SPECULAR\r\n\r\n\t\tfloat specularIntensityFactor = specularIntensity;\r\n\t\tvec3 specularTintFactor = specularTint;\r\n\r\n\t\t#ifdef USE_SPECULARINTENSITYMAP\r\n\r\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\r\n\r\n\t\t#endif\r\n\r\n\t\t#ifdef USE_SPECULARTINTMAP\r\n\r\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\r\n\r\n\t\t#endif\r\n\r\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\r\n\r\n\t#else\r\n\r\n\t\tfloat specularIntensityFactor = 1.0;\r\n\t\tvec3 specularTintFactor = vec3( 1.0 );\r\n\t\tmaterial.specularF90 = 1.0;\r\n\r\n\t#endif\r\n\r\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\r\n\r\n#else\r\n\r\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\r\n\tmaterial.specularF90 = 1.0;\r\n\r\n#endif\r\n\r\n#ifdef CLEARCOAT\r\n\r\n\tmaterial.clearcoat = clearcoat;\r\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\r\n\r\n\t#ifdef USE_CLEARCOATMAP\r\n\r\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\r\n\r\n\t#endif\r\n\r\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\r\n\r\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\r\n\r\n\t#endif\r\n\r\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\r\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\r\n\tmaterial.clearcoatRoughness += geometryRoughness;\r\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\r\n\r\n#endif\r\n\r\n#ifdef USE_SHEEN\r\n\r\n\tmaterial.sheenColor = sheen;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nstruct PhysicalMaterial {\r\n\r\n\tvec3 diffuseColor;\r\n\tfloat specularRoughness;\r\n\tvec3 specularColor;\r\n\tfloat specularF90;\r\n\r\n#ifdef CLEARCOAT\r\n\tfloat clearcoat;\r\n\tfloat clearcoatRoughness;\r\n#endif\r\n#ifdef USE_SHEEN\r\n\tvec3 sheenColor;\r\n#endif\r\n\r\n};\r\n\r\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\r\n\r\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\r\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\r\n\r\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\r\n\r\n}\r\n\r\n#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\t\tvec3 normal = geometry.normal;\r\n\t\tvec3 viewDir = geometry.viewDir;\r\n\t\tvec3 position = geometry.position;\r\n\t\tvec3 lightPos = rectAreaLight.position;\r\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\r\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\r\n\t\tvec3 lightColor = rectAreaLight.color;\r\n\t\tfloat roughness = material.specularRoughness;\r\n\r\n\t\tvec3 rectCoords[ 4 ];\r\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\r\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\r\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\r\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\r\n\r\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\r\n\r\n\t\tvec4 t1 = texture2D( ltc_1, uv );\r\n\t\tvec4 t2 = texture2D( ltc_2, uv );\r\n\r\n\t\tmat3 mInv = mat3(\r\n\t\t\tvec3( t1.x, 0, t1.y ),\r\n\t\t\tvec3(    0, 1,    0 ),\r\n\t\t\tvec3( t1.z, 0, t1.w )\r\n\t\t);\r\n\r\n\t\t// LTC Fresnel Approximation by Stephen Hill\r\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\r\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\r\n\r\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\r\n\r\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\r\n\r\n\tvec3 irradiance = dotNL * directLight.color;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI; // punctual light\r\n\r\n\t#endif\r\n\r\n\t#ifdef CLEARCOAT\r\n\r\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\r\n\r\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\r\n\r\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\t\tccIrradiance *= PI; // punctual light\r\n\r\n\t\t#endif\r\n\r\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\r\n\r\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), 1.0, material.clearcoatRoughness );\r\n\r\n\t#else\r\n\r\n\t\tfloat clearcoatDHR = 0.0;\r\n\r\n\t#endif\r\n\r\n\t#ifdef USE_SHEEN\r\n\r\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\r\n\t\t\tmaterial.specularRoughness,\r\n\t\t\tdirectLight.direction,\r\n\t\t\tgeometry,\r\n\t\t\tmaterial.sheenColor\r\n\t\t);\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.specularRoughness );\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n}\r\n\r\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\r\n\r\n\t#ifdef CLEARCOAT\r\n\r\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\r\n\r\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\r\n\r\n\t\tfloat ccDotNL = ccDotNV;\r\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\r\n\r\n\t#else\r\n\r\n\t\tfloat clearcoatDHR = 0.0;\r\n\r\n\t#endif\r\n\r\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\r\n\r\n\t// Both indirect specular and indirect diffuse light accumulate here\r\n\r\n\tvec3 singleScattering = vec3( 0.0 );\r\n\tvec3 multiScattering = vec3( 0.0 );\r\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\r\n\r\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\r\n\r\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\r\n\r\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\r\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\r\n\r\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\r\n\r\n}\r\n\r\n#define RE_Direct\t\t\t\tRE_Direct_Physical\r\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\r\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\r\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\r\n\r\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\r\n\r\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n/**\r\n * This is a template that can be used to light a material, it uses pluggable\r\n * RenderEquations (RE)for specific lighting scenarios.\r\n *\r\n * Instructions for use:\r\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\r\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\r\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\r\n *\r\n * TODO:\r\n * - Add area light support.\r\n * - Add sphere light support.\r\n * - Add diffuse light probe (irradiance cubemap) support.\r\n */\r\n\r\nGeometricContext geometry;\r\n\r\ngeometry.position = - vViewPosition;\r\ngeometry.normal = normal;\r\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\r\n\r\n#ifdef CLEARCOAT\r\n\r\n\tgeometry.clearcoatNormal = clearcoatNormal;\r\n\r\n#endif\r\n\r\nIncidentLight directLight;\r\n\r\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tPointLight pointLight;\r\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\r\n\tPointLightShadow pointLightShadow;\r\n\t#endif\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tpointLight = pointLights[ i ];\r\n\r\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\r\n\r\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\r\n\t\tpointLightShadow = pointLightShadows[ i ];\r\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tSpotLight spotLight;\r\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\r\n\tSpotLightShadow spotLightShadow;\r\n\t#endif\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tspotLight = spotLights[ i ];\r\n\r\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\r\n\r\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\r\n\t\tspotLightShadow = spotLightShadows[ i ];\r\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tDirectionalLight directionalLight;\r\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\r\n\tDirectionalLightShadow directionalLightShadow;\r\n\t#endif\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tdirectionalLight = directionalLights[ i ];\r\n\r\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\r\n\r\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\r\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\r\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\r\n\r\n\tRectAreaLight rectAreaLight;\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\r\n\r\n\t\trectAreaLight = rectAreaLights[ i ];\r\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n#endif\r\n\r\n#if defined( RE_IndirectDiffuse )\r\n\r\n\tvec3 iblIrradiance = vec3( 0.0 );\r\n\r\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\r\n\r\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\r\n\r\n\t#if ( NUM_HEMI_LIGHTS > 0 )\r\n\r\n\t\t#pragma unroll_loop_start\r\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\r\n\r\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\r\n\r\n\t\t}\r\n\t\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n#endif\r\n\r\n#if defined( RE_IndirectSpecular )\r\n\r\n\tvec3 radiance = vec3( 0.0 );\r\n\tvec3 clearcoatRadiance = vec3( 0.0 );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( RE_IndirectDiffuse )\r\n\r\n\t#ifdef USE_LIGHTMAP\r\n\r\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\r\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\r\n\r\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\r\n\r\n\t\t#endif\r\n\r\n\t\tirradiance += lightMapIrradiance;\r\n\r\n\t#endif\r\n\r\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\r\n\r\n\t#endif\r\n\r\n#endif\r\n\r\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\r\n\r\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\r\n\r\n\t#ifdef CLEARCOAT\r\n\r\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( RE_IndirectDiffuse )\r\n\r\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\r\n\r\n#endif\r\n\r\n#if defined( RE_IndirectSpecular )\r\n\r\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\r\n\r\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\r\n\t// on some platforms. See issue #17623.\r\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\r\n\r\n\tuniform float logDepthBufFC;\r\n\tvarying float vFragDepth;\r\n\tvarying float vIsPerspective;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_LOGDEPTHBUF\r\n\r\n\t#ifdef USE_LOGDEPTHBUF_EXT\r\n\r\n\t\tvarying float vFragDepth;\r\n\t\tvarying float vIsPerspective;\r\n\r\n\t#else\r\n\r\n\t\tuniform float logDepthBufFC;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_LOGDEPTHBUF\r\n\r\n\t#ifdef USE_LOGDEPTHBUF_EXT\r\n\r\n\t\tvFragDepth = 1.0 + gl_Position.w;\r\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\r\n\r\n\t#else\r\n\r\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\r\n\r\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\r\n\r\n\t\t\tgl_Position.z *= gl_Position.w;\r\n\r\n\t\t}\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_MAP\r\n\r\n\tvec4 texelColor = texture2D( map, vUv );\r\n\r\n\ttexelColor = mapTexelToLinear( texelColor );\r\n\tdiffuseColor *= texelColor;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_MAP\r\n\r\n\tuniform sampler2D map;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\r\n\r\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\r\n\r\n#endif\r\n\r\n#ifdef USE_MAP\r\n\r\n\tvec4 mapTexel = texture2D( map, uv );\r\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\r\n\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n\r\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\r\n\r\n\tuniform mat3 uvTransform;\r\n\r\n#endif\r\n\r\n#ifdef USE_MAP\r\n\r\n\tuniform sampler2D map;\r\n\r\n#endif\r\n\r\n#ifdef USE_ALPHAMAP\r\n\r\n\tuniform sampler2D alphaMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nfloat metalnessFactor = metalness;\r\n\r\n#ifdef USE_METALNESSMAP\r\n\r\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\r\n\r\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\tmetalnessFactor *= texelMetalness.b;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_METALNESSMAP\r\n\r\n\tuniform sampler2D metalnessMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_MORPHNORMALS\r\n\r\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\r\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\r\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\r\n\tobjectNormal *= morphTargetBaseInfluence;\r\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\r\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\r\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\r\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_MORPHTARGETS\r\n\r\n\tuniform float morphTargetBaseInfluence;\r\n\r\n\t#ifndef USE_MORPHNORMALS\r\n\r\n\t\tuniform float morphTargetInfluences[ 8 ];\r\n\r\n\t#else\r\n\r\n\t\tuniform float morphTargetInfluences[ 4 ];\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_MORPHTARGETS\r\n\r\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\r\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\r\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\r\n\ttransformed *= morphTargetBaseInfluence;\r\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\r\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\r\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\r\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\r\n\r\n\t#ifndef USE_MORPHNORMALS\r\n\r\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\r\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\r\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\r\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nfloat faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\r\n\r\n#ifdef FLAT_SHADED\r\n\r\n\t// Workaround for Adreno GPUs not able to do dFdx( vViewPosition )\r\n\r\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\r\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\r\n\tvec3 normal = normalize( cross( fdx, fdy ) );\r\n\r\n#else\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\tnormal = normal * faceDirection;\r\n\r\n\t#endif\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tvec3 tangent = normalize( vTangent );\r\n\t\tvec3 bitangent = normalize( vBitangent );\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\ttangent = tangent * faceDirection;\r\n\t\t\tbitangent = bitangent * faceDirection;\r\n\r\n\t\t#endif\r\n\r\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\r\n\r\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\r\n\r\n\t\t#endif\r\n\r\n\t#endif\r\n\r\n#endif\r\n\r\n// non perturbed normal for clearcoat among others\r\n\r\nvec3 geometryNormal = normal;\r\n\r\n`;\r\n", "export default /* glsl */`\r\n\r\n#ifdef OBJECTSPACE_NORMALMAP\r\n\r\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\r\n\r\n\t#ifdef FLIP_SIDED\r\n\r\n\t\tnormal = - normal;\r\n\r\n\t#endif\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\tnormal = normal * faceDirection;\r\n\r\n\t#endif\r\n\r\n\tnormal = normalize( normalMatrix * normal );\r\n\r\n#elif defined( TANGENTSPACE_NORMALMAP )\r\n\r\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\r\n\tmapN.xy *= normalScale;\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tnormal = normalize( vTBN * mapN );\r\n\r\n\t#else\r\n\r\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\r\n\r\n\t#endif\r\n\r\n#elif defined( USE_BUMPMAP )\r\n\r\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tvarying vec3 vTangent;\r\n\t\tvarying vec3 vBitangent;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tvarying vec3 vTangent;\r\n\t\tvarying vec3 vBitangent;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifndef FLAT_SHADED // normal is computed with derivatives when FLAT_SHADED\r\n\r\n\tvNormal = normalize( transformedNormal );\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tvTangent = normalize( transformedTangent );\r\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_NORMALMAP\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform vec2 normalScale;\r\n\r\n#endif\r\n\r\n#ifdef OBJECTSPACE_NORMALMAP\r\n\r\n\tuniform mat3 normalMatrix;\r\n\r\n#endif\r\n\r\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\r\n\r\n\t// Normal Mapping Without Precomputed Tangents\r\n\t// http://www.thetenthplanet.de/archives/1180\r\n\r\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\r\n\r\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\r\n\r\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\r\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\r\n\t\tvec2 st0 = dFdx( vUv.st );\r\n\t\tvec2 st1 = dFdy( vUv.st );\r\n\r\n\t\tvec3 N = surf_norm; // normalized\r\n\r\n\t\tvec3 q1perp = cross( q1, N );\r\n\t\tvec3 q0perp = cross( N, q0 );\r\n\r\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\r\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\r\n\r\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\r\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\r\n\r\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef CLEARCOAT\r\n\r\n\tvec3 clearcoatNormal = geometryNormal;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_CLEARCOAT_NORMALMAP\r\n\r\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\r\n\tclearcoatMapN.xy *= clearcoatNormalScale;\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\r\n\r\n\t#else\r\n\r\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n\r\n#ifdef USE_CLEARCOATMAP\r\n\r\n\tuniform sampler2D clearcoatMap;\r\n\r\n#endif\r\n\r\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\r\n\r\n\tuniform sampler2D clearcoatRoughnessMap;\r\n\r\n#endif\r\n\r\n#ifdef USE_CLEARCOAT_NORMALMAP\r\n\r\n\tuniform sampler2D clearcoatNormalMap;\r\n\tuniform vec2 clearcoatNormalScale;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nvec3 packNormalToRGB( const in vec3 normal ) {\r\n\treturn normalize( normal ) * 0.5 + 0.5;\r\n}\r\n\r\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\r\n\treturn 2.0 * rgb.xyz - 1.0;\r\n}\r\n\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\r\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n\r\nconst float ShiftRight8 = 1. / 256.;\r\n\r\nvec4 packDepthToRGBA( const in float v ) {\r\n\tvec4 r = vec4( fract( v * PackFactors ), v );\r\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n\treturn r * PackUpscale;\r\n}\r\n\r\nfloat unpackRGBAToDepth( const in vec4 v ) {\r\n\treturn dot( v, UnpackFactors );\r\n}\r\n\r\nvec4 pack2HalfToRGBA( vec2 v ) {\r\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\r\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\r\n}\r\n\r\nvec2 unpackRGBATo2Half( vec4 v ) {\r\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\r\n}\r\n\r\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\r\n\r\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\r\n\treturn ( viewZ + near ) / ( near - far );\r\n}\r\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\r\n\treturn linearClipZ * ( near - far ) - near;\r\n}\r\n\r\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\r\n\r\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\r\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\r\n}\r\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\r\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef PREMULTIPLIED_ALPHA\r\n\r\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\r\n\tgl_FragColor.rgb *= gl_FragColor.a;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nvec4 mvPosition = vec4( transformed, 1.0 );\r\n\r\n#ifdef USE_INSTANCING\r\n\r\n\tmvPosition = instanceMatrix * mvPosition;\r\n\r\n#endif\r\n\r\nmvPosition = modelViewMatrix * mvPosition;\r\n\r\ngl_Position = projectionMatrix * mvPosition;\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef DITHERING\r\n\r\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef DITHERING\r\n\r\n\t// based on https://www.shadertoy.com/view/MslGR8\r\n\tvec3 dithering( vec3 color ) {\r\n\t\t//Calculate grid position\r\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\r\n\r\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n\t\t//modify shift acording to grid position.\r\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n\t\t//shift the color by dither_shift\r\n\t\treturn color + dither_shift_RGB;\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nfloat roughnessFactor = roughness;\r\n\r\n#ifdef USE_ROUGHNESSMAP\r\n\r\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\r\n\r\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\troughnessFactor *= texelRoughness.g;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_ROUGHNESSMAP\r\n\r\n\tuniform sampler2D roughnessMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct DirectionalLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n\r\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct SpotLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n\r\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct PointLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t\tfloat shadowCameraNear;\r\n\t\t\tfloat shadowCameraFar;\r\n\t\t};\r\n\r\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t/*\r\n\t#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\t\t// TODO (abelnation): create uniforms for area light shadows\r\n\r\n\t#endif\r\n\t*/\r\n\r\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r\n\r\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n\r\n\t}\r\n\r\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\r\n\r\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\r\n\r\n\t}\r\n\r\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\r\n\r\n\t\tfloat occlusion = 1.0;\r\n\r\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\r\n\r\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\r\n\r\n\t\tif (hard_shadow != 1.0 ) {\r\n\r\n\t\t\tfloat distance = compare - distribution.x ;\r\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\r\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\r\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\r\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\r\n\r\n\t\t}\r\n\t\treturn occlusion;\r\n\r\n\t}\r\n\r\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n\t\tfloat shadow = 1.0;\r\n\r\n\t\tshadowCoord.xyz /= shadowCoord.w;\r\n\t\tshadowCoord.z += shadowBias;\r\n\r\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\r\n\t\t// if ( all( something, something ) ) using this instead\r\n\r\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n\t\tbool inFrustum = all( inFrustumVec );\r\n\r\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n\t\tbool frustumTest = all( frustumTestVec );\r\n\r\n\t\tif ( frustumTest ) {\r\n\r\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\r\n\r\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\r\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\r\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\r\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\r\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\r\n\t\t\tfloat dx2 = dx0 / 2.0;\r\n\t\t\tfloat dy2 = dy0 / 2.0;\r\n\t\t\tfloat dx3 = dx1 / 2.0;\r\n\t\t\tfloat dy3 = dy1 / 2.0;\r\n\r\n\t\t\tshadow = (\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n\t\t\t) * ( 1.0 / 17.0 );\r\n\r\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\r\n\r\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\t\t\tfloat dx = texelSize.x;\r\n\t\t\tfloat dy = texelSize.y;\r\n\r\n\t\t\tvec2 uv = shadowCoord.xy;\r\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\r\n\t\t\tuv -= f * texelSize;\r\n\r\n\t\t\tshadow = (\r\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\r\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \r\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\r\n\t\t\t\t\t f.x ) +\r\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \r\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\r\n\t\t\t\t\t f.x ) +\r\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \r\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\r\n\t\t\t\t\t f.y ) +\r\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \r\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\r\n\t\t\t\t\t f.y ) +\r\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \r\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\r\n\t\t\t\t\t\t  f.x ),\r\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \r\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\r\n\t\t\t\t\t\t  f.x ),\r\n\t\t\t\t\t f.y )\r\n\t\t\t) * ( 1.0 / 9.0 );\r\n\r\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\r\n\r\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n\r\n\t\t#else // no percentage-closer filtering:\r\n\r\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n\r\n\t\t#endif\r\n\r\n\t\t}\r\n\r\n\t\treturn shadow;\r\n\r\n\t}\r\n\r\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\r\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\r\n\t// 2D texture:\r\n\t//\r\n\t// xzXZ\r\n\t//  y Y\r\n\t//\r\n\t// Y - Positive y direction\r\n\t// y - Negative y direction\r\n\t// X - Positive x direction\r\n\t// x - Negative x direction\r\n\t// Z - Positive z direction\r\n\t// z - Negative z direction\r\n\t//\r\n\t// Source and test bed:\r\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\r\n\r\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\r\n\r\n\t\t// Number of texels to avoid at the edge of each square\r\n\r\n\t\tvec3 absV = abs( v );\r\n\r\n\t\t// Intersect unit cube\r\n\r\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\r\n\t\tabsV *= scaleToCube;\r\n\r\n\t\t// Apply scale to avoid seams\r\n\r\n\t\t// two texels less per square (one texel will do for NEAREST)\r\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\r\n\r\n\t\t// Unwrap\r\n\r\n\t\t// space: -1 ... 1 range for each square\r\n\t\t//\r\n\t\t// #X##\t\tdim    := ( 4 , 2 )\r\n\t\t//  # #\t\tcenter := ( 1 , 1 )\r\n\r\n\t\tvec2 planar = v.xy;\r\n\r\n\t\tfloat almostATexel = 1.5 * texelSizeY;\r\n\t\tfloat almostOne = 1.0 - almostATexel;\r\n\r\n\t\tif ( absV.z >= almostOne ) {\r\n\r\n\t\t\tif ( v.z > 0.0 )\r\n\t\t\t\tplanar.x = 4.0 - v.x;\r\n\r\n\t\t} else if ( absV.x >= almostOne ) {\r\n\r\n\t\t\tfloat signX = sign( v.x );\r\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\r\n\r\n\t\t} else if ( absV.y >= almostOne ) {\r\n\r\n\t\t\tfloat signY = sign( v.y );\r\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\r\n\t\t\tplanar.y = v.z * signY - 2.0;\r\n\r\n\t\t}\r\n\r\n\t\t// Transform to UV space\r\n\r\n\t\t// scale := 0.5 / dim\r\n\t\t// translate := ( center + 0.5 ) / dim\r\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\r\n\r\n\t}\r\n\r\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\r\n\r\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\r\n\r\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\r\n\t\t// the vector from the light to the world-space position of the fragment.\r\n\t\tvec3 lightToPosition = shadowCoord.xyz;\r\n\r\n\t\t// dp = normalized distance from light to fragment position\r\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\r\n\t\tdp += shadowBias;\r\n\r\n\t\t// bd3D = base direction 3D\r\n\t\tvec3 bd3D = normalize( lightToPosition );\r\n\r\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\r\n\r\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\r\n\r\n\t\t\treturn (\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\r\n\t\t\t) * ( 1.0 / 9.0 );\r\n\r\n\t\t#else // no percentage-closer filtering\r\n\r\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct DirectionalLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n\r\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct SpotLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t};\r\n\r\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\r\n\r\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\r\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\r\n\r\n\t\tstruct PointLightShadow {\r\n\t\t\tfloat shadowBias;\r\n\t\t\tfloat shadowNormalBias;\r\n\t\t\tfloat shadowRadius;\r\n\t\t\tvec2 shadowMapSize;\r\n\t\t\tfloat shadowCameraNear;\r\n\t\t\tfloat shadowCameraFar;\r\n\t\t};\r\n\r\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\r\n\r\n\t#endif\r\n\r\n\t/*\r\n\t#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\t\t// TODO (abelnation): uniforms for area light shadows\r\n\r\n\t#endif\r\n\t*/\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\r\n\r\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\r\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\r\n\t\tvec4 shadowWorldPosition;\r\n\r\n\t#endif\r\n\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\r\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\r\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\r\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t/*\r\n\t#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\r\n\r\n\t#endif\r\n\t*/\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nfloat getShadowMask() {\r\n\r\n\tfloat shadow = 1.0;\r\n\r\n\t#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\r\n\r\n\tDirectionalLightShadow directionalLight;\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tdirectionalLight = directionalLightShadows[ i ];\r\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\r\n\r\n\tSpotLightShadow spotLight;\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tspotLight = spotLightShadows[ i ];\r\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\r\n\r\n\tPointLightShadow pointLight;\r\n\r\n\t#pragma unroll_loop_start\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\r\n\r\n\t\tpointLight = pointLightShadows[ i ];\r\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\r\n\r\n\t}\r\n\t#pragma unroll_loop_end\r\n\r\n\t#endif\r\n\r\n\t/*\r\n\t#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\t\t// TODO (abelnation): update shadow for Area light\r\n\r\n\t#endif\r\n\t*/\r\n\r\n\t#endif\r\n\r\n\treturn shadow;\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SKINNING\r\n\r\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\r\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\r\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\r\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SKINNING\r\n\r\n\tuniform mat4 bindMatrix;\r\n\tuniform mat4 bindMatrixInverse;\r\n\r\n\t#ifdef BONE_TEXTURE\r\n\r\n\t\tuniform highp sampler2D boneTexture;\r\n\t\tuniform int boneTextureSize;\r\n\r\n\t\tmat4 getBoneMatrix( const in float i ) {\r\n\r\n\t\t\tfloat j = i * 4.0;\r\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\r\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\r\n\r\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\r\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\r\n\r\n\t\t\ty = dy * ( y + 0.5 );\r\n\r\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\r\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\r\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\r\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\r\n\r\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\r\n\r\n\t\t\treturn bone;\r\n\r\n\t\t}\r\n\r\n\t#else\r\n\r\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\r\n\r\n\t\tmat4 getBoneMatrix( const in float i ) {\r\n\r\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\r\n\t\t\treturn bone;\r\n\r\n\t\t}\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SKINNING\r\n\r\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\r\n\r\n\tvec4 skinned = vec4( 0.0 );\r\n\tskinned += boneMatX * skinVertex * skinWeight.x;\r\n\tskinned += boneMatY * skinVertex * skinWeight.y;\r\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\r\n\tskinned += boneMatW * skinVertex * skinWeight.w;\r\n\r\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SKINNING\r\n\r\n\tmat4 skinMatrix = mat4( 0.0 );\r\n\tskinMatrix += skinWeight.x * boneMatX;\r\n\tskinMatrix += skinWeight.y * boneMatY;\r\n\tskinMatrix += skinWeight.z * boneMatZ;\r\n\tskinMatrix += skinWeight.w * boneMatW;\r\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\r\n\r\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\r\n\r\n\t#ifdef USE_TANGENT\r\n\r\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\r\n\r\n\t#endif\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nfloat specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n\r\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\r\n\tspecularStrength = texelSpecular.r;\r\n\r\n#else\r\n\r\n\tspecularStrength = 1.0;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_SPECULARMAP\r\n\r\n\tuniform sampler2D specularMap;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( TONE_MAPPING )\r\n\r\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifndef saturate\r\n// <common> may have defined saturate() already\r\n#define saturate( a ) clamp( a, 0.0, 1.0 )\r\n#endif\r\n\r\nuniform float toneMappingExposure;\r\n\r\n// exposure only\r\nvec3 LinearToneMapping( vec3 color ) {\r\n\r\n\treturn toneMappingExposure * color;\r\n\r\n}\r\n\r\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\r\nvec3 ReinhardToneMapping( vec3 color ) {\r\n\r\n\tcolor *= toneMappingExposure;\r\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\r\n\r\n}\r\n\r\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\r\nvec3 OptimizedCineonToneMapping( vec3 color ) {\r\n\r\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\r\n\tcolor *= toneMappingExposure;\r\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\r\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\r\n\r\n}\r\n\r\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\r\nvec3 RRTAndODTFit( vec3 v ) {\r\n\r\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\r\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\r\n\treturn a / b;\r\n\r\n}\r\n\r\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\r\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\r\n\r\nvec3 ACESFilmicToneMapping( vec3 color ) {\r\n\r\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\r\n\tconst mat3 ACESInputMat = mat3(\r\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\r\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\r\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\r\n\t);\r\n\r\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\r\n\tconst mat3 ACESOutputMat = mat3(\r\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\r\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\r\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\r\n\t);\r\n\r\n\tcolor *= toneMappingExposure / 0.6;\r\n\r\n\tcolor = ACESInputMat * color;\r\n\r\n\t// Apply RRT and ODT\r\n\tcolor = RRTAndODTFit( color );\r\n\r\n\tcolor = ACESOutputMat * color;\r\n\r\n\t// Clamp to [0, 1]\r\n\treturn saturate( color );\r\n\r\n}\r\n\r\nvec3 CustomToneMapping( vec3 color ) { return color; }\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_TRANSMISSION\r\n\r\n\tfloat transmissionFactor = transmission;\r\n\tfloat thicknessFactor = thickness;\r\n\r\n\t#ifdef USE_TRANSMISSIONMAP\r\n\r\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\r\n\r\n\t#endif\r\n\r\n\t#ifdef USE_THICKNESSMAP\r\n\r\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\r\n\r\n\t#endif\r\n\r\n\tvec3 pos = vWorldPosition;\r\n\tvec3 v = normalize( cameraPosition - pos );\r\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\r\n\r\n\tvec3 transmission = transmissionFactor * getIBLVolumeRefraction(\r\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor,\r\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\r\n\t\tattenuationTint, attenuationDistance );\r\n\r\n\ttotalDiffuse = mix( totalDiffuse, transmission, transmissionFactor );\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_TRANSMISSION\r\n\r\n\t// Transmission code is based on glTF-Sampler-Viewer\r\n\t// https://github.com/KhronosGroup/glTF-Sample-Viewer\r\n\r\n\tuniform float transmission;\r\n\tuniform float thickness;\r\n\tuniform float attenuationDistance;\r\n\tuniform vec3 attenuationTint;\r\n\r\n\t#ifdef USE_TRANSMISSIONMAP\r\n\r\n\t\tuniform sampler2D transmissionMap;\r\n\r\n\t#endif\r\n\r\n\t#ifdef USE_THICKNESSMAP\r\n\r\n\t\tuniform sampler2D thicknessMap;\r\n\r\n\t#endif\r\n\r\n\tuniform vec2 transmissionSamplerSize;\r\n\tuniform sampler2D transmissionSamplerMap;\r\n\r\n\tuniform mat4 modelMatrix;\r\n\tuniform mat4 projectionMatrix;\r\n\r\n\tvarying vec3 vWorldPosition;\r\n\r\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\r\n\r\n\t\t// Direction of refracted light.\r\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\r\n\r\n\t\t// Compute rotation-independant scaling of the model matrix.\r\n\t\tvec3 modelScale;\r\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\r\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\r\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\r\n\r\n\t\t// The thickness is specified in local space.\r\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\r\n\r\n\t}\r\n\r\n\tfloat applyIorToRoughness( float roughness, float ior ) {\r\n\r\n\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\r\n\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\r\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\r\n\r\n\t}\r\n\r\n\tvec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\r\n\r\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\r\n\r\n\t\t#ifdef TEXTURE_LOD_EXT\r\n\r\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ).rgb;\r\n\r\n\t\t#else\r\n\r\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ).rgb;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\r\n\r\n\t\tif ( attenuationDistance == 0.0 ) {\r\n\r\n\t\t\t// Attenuation distance is +\u221E (which we indicate by zero), i.e. the transmitted color is not attenuated at all.\r\n\t\t\treturn radiance;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Compute light attenuation using Beer's law.\r\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\r\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law\r\n\t\t\treturn transmittance * radiance;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tvec3 getIBLVolumeRefraction( vec3 n, vec3 v, float perceptualRoughness, vec3 baseColor, vec3 specularColor,\r\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\r\n\t\tvec3 attenuationColor, float attenuationDistance ) {\r\n\r\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\r\n\t\tvec3 refractedRayExit = position + transmissionRay;\r\n\r\n\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\r\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\r\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\r\n\t\trefractionCoords += 1.0;\r\n\t\trefractionCoords /= 2.0;\r\n\r\n\t\t// Sample framebuffer to get pixel the refracted ray hits.\r\n\t\tvec3 transmittedLight = getTransmissionSample( refractionCoords, perceptualRoughness, ior );\r\n\r\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight, length( transmissionRay ), attenuationColor, attenuationDistance );\r\n\r\n\t\treturn ( 1.0 - specularColor ) * attenuatedColor * baseColor;\r\n\r\n\t}\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\r\n\r\n\tvarying vec2 vUv;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_UV\r\n\r\n\t#ifdef UVS_VERTEX_ONLY\r\n\r\n\t\tvec2 vUv;\r\n\r\n\t#else\r\n\r\n\t\tvarying vec2 vUv;\r\n\r\n\t#endif\r\n\r\n\tuniform mat3 uvTransform;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#ifdef USE_UV\r\n\r\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tvarying vec2 vUv2;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tattribute vec2 uv2;\r\n\tvarying vec2 vUv2;\r\n\r\n\tuniform mat3 uv2Transform;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\r\n\r\n\tvec4 worldPosition = vec4( transformed, 1.0 );\r\n\r\n\t#ifdef USE_INSTANCING\r\n\r\n\t\tworldPosition = instanceMatrix * worldPosition;\r\n\r\n\t#endif\r\n\r\n\tworldPosition = modelMatrix * worldPosition;\r\n\r\n#endif\r\n`;\r\n", "export default /* glsl */`\r\nuniform sampler2D t2D;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\r\n\tvec4 texColor = texture2D( t2D, vUv );\r\n\r\n\tgl_FragColor = mapTexelToLinear( texColor );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nvarying vec2 vUv;\r\nuniform mat3 uvTransform;\r\n\r\nvoid main() {\r\n\r\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\r\n\r\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#include <envmap_common_pars_fragment>\r\nuniform float opacity;\r\n\r\nvarying vec3 vWorldDirection;\r\n\r\n#include <cube_uv_reflection_fragment>\r\n\r\nvoid main() {\r\n\r\n\tvec3 vReflect = vWorldDirection;\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = envColor;\r\n\tgl_FragColor.a *= opacity;\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nvarying vec3 vWorldDirection;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvWorldDirection = transformDirection( position, modelMatrix );\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n\tgl_Position.z = gl_Position.w; // set z to camera.far\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#if DEPTH_PACKING == 3200\r\n\r\n\tuniform float opacity;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvarying vec2 vHighPrecisionZW;\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( 1.0 );\r\n\r\n\t#if DEPTH_PACKING == 3200\r\n\r\n\t\tdiffuseColor.a = opacity;\r\n\r\n\t#endif\r\n\r\n\t#include <map_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\r\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\r\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\r\n\r\n\t#if DEPTH_PACKING == 3200\r\n\r\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\r\n\r\n\t#elif DEPTH_PACKING == 3201\r\n\r\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\r\n\r\n\t#endif\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\r\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\r\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\r\nvarying vec2 vHighPrecisionZW;\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <skinbase_vertex>\r\n\r\n\t#ifdef USE_DISPLACEMENTMAP\r\n\r\n\t\t#include <beginnormal_vertex>\r\n\t\t#include <morphnormal_vertex>\r\n\t\t#include <skinnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvHighPrecisionZW = gl_Position.zw;\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define DISTANCE\r\n\r\nuniform vec3 referencePosition;\r\nuniform float nearDistance;\r\nuniform float farDistance;\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main () {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( 1.0 );\r\n\r\n\t#include <map_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\tfloat dist = length( vWorldPosition - referencePosition );\r\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\r\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\r\n\r\n\tgl_FragColor = packDepthToRGBA( dist );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define DISTANCE\r\n\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <skinbase_vertex>\r\n\r\n\t#ifdef USE_DISPLACEMENTMAP\r\n\r\n\t\t#include <beginnormal_vertex>\r\n\t\t#include <morphnormal_vertex>\r\n\t\t#include <skinnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <worldpos_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvWorldPosition = worldPosition.xyz;\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform sampler2D tEquirect;\r\n\r\nvarying vec3 vWorldDirection;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvec3 direction = normalize( vWorldDirection );\r\n\r\n\tvec2 sampleUV = equirectUv( direction );\r\n\r\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\r\n\r\n\tgl_FragColor = mapTexelToLinear( texColor );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nvarying vec3 vWorldDirection;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvWorldDirection = transformDirection( position, modelMatrix );\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform float dashSize;\r\nuniform float totalSize;\r\n\r\nvarying float vLineDistance;\r\n\r\n#include <common>\r\n#include <color_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\r\n\r\n\t\tdiscard;\r\n\r\n\t}\r\n\r\n\tvec3 outgoingLight = vec3( 0.0 );\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <color_fragment>\r\n\r\n\toutgoingLight = diffuseColor.rgb; // simple shader\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform float scale;\r\nattribute float lineDistance;\r\n\r\nvarying float vLineDistance;\r\n\r\n#include <common>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\tvLineDistance = scale * lineDistance;\r\n\r\n\t#include <color_vertex>\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <fog_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\r\n\t// accumulation (baked indirect lighting only)\r\n\t#ifdef USE_LIGHTMAP\r\n\t\r\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\r\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\r\n\r\n\t#endif\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\r\n\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\r\n\r\n\t\t#include <beginnormal_vertex>\r\n\t\t#include <morphnormal_vertex>\r\n\t\t#include <skinbase_vertex>\r\n\t\t#include <skinnormal_vertex>\r\n\t\t#include <defaultnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float opacity;\r\n\r\nvarying vec3 vLightFront;\r\nvarying vec3 vIndirectFront;\r\n\r\n#ifdef DOUBLE_SIDED\r\n\tvarying vec3 vLightBack;\r\n\tvarying vec3 vIndirectBack;\r\n#endif\r\n\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <fog_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <shadowmask_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\r\n\r\n\t#endif\r\n\r\n\t#include <lightmap_fragment>\r\n\r\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.directDiffuse = vLightFront;\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\r\n\r\n\t// modulation\r\n\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define LAMBERT\r\n\r\nvarying vec3 vLightFront;\r\nvarying vec3 vIndirectFront;\r\n\r\n#ifdef DOUBLE_SIDED\r\n\tvarying vec3 vLightBack;\r\n\tvarying vec3 vIndirectBack;\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <lights_lambert_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define MATCAP\r\n\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\nuniform sampler2D matcap;\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#include <common>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n\r\n#include <fog_pars_fragment>\r\n#include <normal_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n\r\n\tvec3 viewDir = normalize( vViewPosition );\r\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\r\n\tvec3 y = cross( viewDir, x );\r\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\r\n\r\n\t#ifdef USE_MATCAP\r\n\r\n\t\tvec4 matcapColor = texture2D( matcap, uv );\r\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\r\n\r\n\t#else\r\n\r\n\t\tvec4 matcapColor = vec4( 1.0 );\r\n\r\n\t#endif\r\n\r\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define MATCAP\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <normal_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <color_vertex>\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\t#include <normal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <fog_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define NORMAL\r\n\r\nuniform float opacity;\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\r\n\r\n\tvarying vec3 vViewPosition;\r\n\r\n#endif\r\n\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <normal_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n\r\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define NORMAL\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\r\n\r\n\tvarying vec3 vViewPosition;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <normal_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\t#include <normal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n#endif\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define PHONG\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <normal_pars_fragment>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\t#include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\t#include <lights_phong_fragment>\r\n\t#include <lights_fragment_begin>\r\n\t#include <lights_fragment_maps>\r\n\t#include <lights_fragment_end>\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define PHONG\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <normal_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\t#include <normal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define STANDARD\r\n\r\n#ifdef PHYSICAL\r\n\t#define IOR\r\n\t#define CLEARCOAT\r\n\t#define SPECULAR\r\n#endif\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float roughness;\r\nuniform float metalness;\r\nuniform float opacity;\r\n\r\n#ifdef IOR\r\n\tuniform float ior;\r\n#endif\r\n\r\n#ifdef SPECULAR\r\n\tuniform float specularIntensity;\r\n\tuniform vec3 specularTint;\r\n\r\n\t#ifdef USE_SPECULARINTENSITYMAP\r\n\t\tuniform sampler2D specularIntensityMap;\r\n\t#endif\r\n\r\n\t#ifdef USE_SPECULARTINTMAP\r\n\t\tuniform sampler2D specularTintMap;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef CLEARCOAT\r\n\tuniform float clearcoat;\r\n\tuniform float clearcoatRoughness;\r\n#endif\r\n\r\n#ifdef USE_SHEEN\r\n\tuniform vec3 sheen;\r\n#endif\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <bsdfs>\r\n#include <transmission_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_physical_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <lights_pars_begin>\r\n#include <normal_pars_fragment>\r\n#include <lights_physical_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <clearcoat_pars_fragment>\r\n#include <roughnessmap_pars_fragment>\r\n#include <metalnessmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <roughnessmap_fragment>\r\n\t#include <metalnessmap_fragment>\r\n\t#include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n\t#include <clearcoat_normal_fragment_begin>\r\n\t#include <clearcoat_normal_fragment_maps>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\t#include <lights_physical_fragment>\r\n\t#include <lights_fragment_begin>\r\n\t#include <lights_fragment_maps>\r\n\t#include <lights_fragment_end>\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\r\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\r\n\r\n\t#include <transmission_fragment>\r\n\r\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define STANDARD\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifdef USE_TRANSMISSION\r\n\r\n\tvarying vec3 vWorldPosition;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <normal_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\t#include <normal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n#ifdef USE_TRANSMISSION\r\n\r\n\tvWorldPosition = worldPosition.xyz;\r\n\r\n#endif\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define TOON\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <gradientmap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <normal_pars_fragment>\r\n#include <lights_toon_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <normal_fragment_begin>\r\n\t#include <normal_fragment_maps>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\t#include <lights_toon_fragment>\r\n\t#include <lights_fragment_begin>\r\n\t#include <lights_fragment_maps>\r\n\t#include <lights_fragment_end>\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#define TOON\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <normal_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\t#include <normal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <color_pars_fragment>\r\n#include <map_particle_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec3 outgoingLight = vec3( 0.0 );\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_particle_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\toutgoingLight = diffuseColor.rgb;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform float size;\r\nuniform float scale;\r\n\r\n#include <common>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <color_vertex>\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <project_vertex>\r\n\r\n\tgl_PointSize = size;\r\n\r\n\t#ifdef USE_SIZEATTENUATION\r\n\r\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\r\n\r\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\r\n\r\n\t#endif\r\n\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <worldpos_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 color;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <shadowmap_pars_fragment>\r\n#include <shadowmask_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\n#include <common>\r\n#include <fog_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\t#include <worldpos_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec3 outgoingLight = vec3( 0.0 );\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\toutgoingLight = diffuseColor.rgb;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nuniform float rotation;\r\nuniform vec2 center;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\r\n\r\n\tvec2 scale;\r\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\r\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\r\n\r\n\t#ifndef USE_SIZEATTENUATION\r\n\r\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\r\n\r\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\r\n\r\n\t#endif\r\n\r\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\r\n\r\n\tvec2 rotatedPosition;\r\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\r\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\r\n\r\n\tmvPosition.xy += rotatedPosition;\r\n\r\n\tgl_Position = projectionMatrix * mvPosition;\r\n\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n`;\r\n", "import alphamap_fragment from './ShaderChunk/alphamap_fragment.glsl.js';\r\nimport alphamap_pars_fragment from './ShaderChunk/alphamap_pars_fragment.glsl.js';\r\nimport alphatest_fragment from './ShaderChunk/alphatest_fragment.glsl.js';\r\nimport aomap_fragment from './ShaderChunk/aomap_fragment.glsl.js';\r\nimport aomap_pars_fragment from './ShaderChunk/aomap_pars_fragment.glsl.js';\r\nimport begin_vertex from './ShaderChunk/begin_vertex.glsl.js';\r\nimport beginnormal_vertex from './ShaderChunk/beginnormal_vertex.glsl.js';\r\nimport bsdfs from './ShaderChunk/bsdfs.glsl.js';\r\nimport bumpmap_pars_fragment from './ShaderChunk/bumpmap_pars_fragment.glsl.js';\r\nimport clipping_planes_fragment from './ShaderChunk/clipping_planes_fragment.glsl.js';\r\nimport clipping_planes_pars_fragment from './ShaderChunk/clipping_planes_pars_fragment.glsl.js';\r\nimport clipping_planes_pars_vertex from './ShaderChunk/clipping_planes_pars_vertex.glsl.js';\r\nimport clipping_planes_vertex from './ShaderChunk/clipping_planes_vertex.glsl.js';\r\nimport color_fragment from './ShaderChunk/color_fragment.glsl.js';\r\nimport color_pars_fragment from './ShaderChunk/color_pars_fragment.glsl.js';\r\nimport color_pars_vertex from './ShaderChunk/color_pars_vertex.glsl.js';\r\nimport color_vertex from './ShaderChunk/color_vertex.glsl.js';\r\nimport common from './ShaderChunk/common.glsl.js';\r\nimport cube_uv_reflection_fragment from './ShaderChunk/cube_uv_reflection_fragment.glsl.js';\r\nimport defaultnormal_vertex from './ShaderChunk/defaultnormal_vertex.glsl.js';\r\nimport displacementmap_pars_vertex from './ShaderChunk/displacementmap_pars_vertex.glsl.js';\r\nimport displacementmap_vertex from './ShaderChunk/displacementmap_vertex.glsl.js';\r\nimport emissivemap_fragment from './ShaderChunk/emissivemap_fragment.glsl.js';\r\nimport emissivemap_pars_fragment from './ShaderChunk/emissivemap_pars_fragment.glsl.js';\r\nimport encodings_fragment from './ShaderChunk/encodings_fragment.glsl.js';\r\nimport encodings_pars_fragment from './ShaderChunk/encodings_pars_fragment.glsl.js';\r\nimport envmap_fragment from './ShaderChunk/envmap_fragment.glsl.js';\r\nimport envmap_common_pars_fragment from './ShaderChunk/envmap_common_pars_fragment.glsl.js';\r\nimport envmap_pars_fragment from './ShaderChunk/envmap_pars_fragment.glsl.js';\r\nimport envmap_pars_vertex from './ShaderChunk/envmap_pars_vertex.glsl.js';\r\nimport envmap_vertex from './ShaderChunk/envmap_vertex.glsl.js';\r\nimport fog_vertex from './ShaderChunk/fog_vertex.glsl.js';\r\nimport fog_pars_vertex from './ShaderChunk/fog_pars_vertex.glsl.js';\r\nimport fog_fragment from './ShaderChunk/fog_fragment.glsl.js';\r\nimport fog_pars_fragment from './ShaderChunk/fog_pars_fragment.glsl.js';\r\nimport gradientmap_pars_fragment from './ShaderChunk/gradientmap_pars_fragment.glsl.js';\r\nimport lightmap_fragment from './ShaderChunk/lightmap_fragment.glsl.js';\r\nimport lightmap_pars_fragment from './ShaderChunk/lightmap_pars_fragment.glsl.js';\r\nimport lights_lambert_vertex from './ShaderChunk/lights_lambert_vertex.glsl.js';\r\nimport lights_pars_begin from './ShaderChunk/lights_pars_begin.glsl.js';\r\nimport envmap_physical_pars_fragment from './ShaderChunk/envmap_physical_pars_fragment.glsl.js';\r\nimport lights_toon_fragment from './ShaderChunk/lights_toon_fragment.glsl.js';\r\nimport lights_toon_pars_fragment from './ShaderChunk/lights_toon_pars_fragment.glsl.js';\r\nimport lights_phong_fragment from './ShaderChunk/lights_phong_fragment.glsl.js';\r\nimport lights_phong_pars_fragment from './ShaderChunk/lights_phong_pars_fragment.glsl.js';\r\nimport lights_physical_fragment from './ShaderChunk/lights_physical_fragment.glsl.js';\r\nimport lights_physical_pars_fragment from './ShaderChunk/lights_physical_pars_fragment.glsl.js';\r\nimport lights_fragment_begin from './ShaderChunk/lights_fragment_begin.glsl.js';\r\nimport lights_fragment_maps from './ShaderChunk/lights_fragment_maps.glsl.js';\r\nimport lights_fragment_end from './ShaderChunk/lights_fragment_end.glsl.js';\r\nimport logdepthbuf_fragment from './ShaderChunk/logdepthbuf_fragment.glsl.js';\r\nimport logdepthbuf_pars_fragment from './ShaderChunk/logdepthbuf_pars_fragment.glsl.js';\r\nimport logdepthbuf_pars_vertex from './ShaderChunk/logdepthbuf_pars_vertex.glsl.js';\r\nimport logdepthbuf_vertex from './ShaderChunk/logdepthbuf_vertex.glsl.js';\r\nimport map_fragment from './ShaderChunk/map_fragment.glsl.js';\r\nimport map_pars_fragment from './ShaderChunk/map_pars_fragment.glsl.js';\r\nimport map_particle_fragment from './ShaderChunk/map_particle_fragment.glsl.js';\r\nimport map_particle_pars_fragment from './ShaderChunk/map_particle_pars_fragment.glsl.js';\r\nimport metalnessmap_fragment from './ShaderChunk/metalnessmap_fragment.glsl.js';\r\nimport metalnessmap_pars_fragment from './ShaderChunk/metalnessmap_pars_fragment.glsl.js';\r\nimport morphnormal_vertex from './ShaderChunk/morphnormal_vertex.glsl.js';\r\nimport morphtarget_pars_vertex from './ShaderChunk/morphtarget_pars_vertex.glsl.js';\r\nimport morphtarget_vertex from './ShaderChunk/morphtarget_vertex.glsl.js';\r\nimport normal_fragment_begin from './ShaderChunk/normal_fragment_begin.glsl.js';\r\nimport normal_fragment_maps from './ShaderChunk/normal_fragment_maps.glsl.js';\r\nimport normal_pars_fragment from './ShaderChunk/normal_pars_fragment.glsl.js';\r\nimport normal_pars_vertex from './ShaderChunk/normal_pars_vertex.glsl.js';\r\nimport normal_vertex from './ShaderChunk/normal_vertex.glsl.js';\r\nimport normalmap_pars_fragment from './ShaderChunk/normalmap_pars_fragment.glsl.js';\r\nimport clearcoat_normal_fragment_begin from './ShaderChunk/clearcoat_normal_fragment_begin.glsl.js';\r\nimport clearcoat_normal_fragment_maps from './ShaderChunk/clearcoat_normal_fragment_maps.glsl.js';\r\nimport clearcoat_pars_fragment from './ShaderChunk/clearcoat_pars_fragment.glsl.js';\r\nimport packing from './ShaderChunk/packing.glsl.js';\r\nimport premultiplied_alpha_fragment from './ShaderChunk/premultiplied_alpha_fragment.glsl.js';\r\nimport project_vertex from './ShaderChunk/project_vertex.glsl.js';\r\nimport dithering_fragment from './ShaderChunk/dithering_fragment.glsl.js';\r\nimport dithering_pars_fragment from './ShaderChunk/dithering_pars_fragment.glsl.js';\r\nimport roughnessmap_fragment from './ShaderChunk/roughnessmap_fragment.glsl.js';\r\nimport roughnessmap_pars_fragment from './ShaderChunk/roughnessmap_pars_fragment.glsl.js';\r\nimport shadowmap_pars_fragment from './ShaderChunk/shadowmap_pars_fragment.glsl.js';\r\nimport shadowmap_pars_vertex from './ShaderChunk/shadowmap_pars_vertex.glsl.js';\r\nimport shadowmap_vertex from './ShaderChunk/shadowmap_vertex.glsl.js';\r\nimport shadowmask_pars_fragment from './ShaderChunk/shadowmask_pars_fragment.glsl.js';\r\nimport skinbase_vertex from './ShaderChunk/skinbase_vertex.glsl.js';\r\nimport skinning_pars_vertex from './ShaderChunk/skinning_pars_vertex.glsl.js';\r\nimport skinning_vertex from './ShaderChunk/skinning_vertex.glsl.js';\r\nimport skinnormal_vertex from './ShaderChunk/skinnormal_vertex.glsl.js';\r\nimport specularmap_fragment from './ShaderChunk/specularmap_fragment.glsl.js';\r\nimport specularmap_pars_fragment from './ShaderChunk/specularmap_pars_fragment.glsl.js';\r\nimport tonemapping_fragment from './ShaderChunk/tonemapping_fragment.glsl.js';\r\nimport tonemapping_pars_fragment from './ShaderChunk/tonemapping_pars_fragment.glsl.js';\r\nimport transmission_fragment from './ShaderChunk/transmission_fragment.glsl.js';\r\nimport transmission_pars_fragment from './ShaderChunk/transmission_pars_fragment.glsl.js';\r\nimport uv_pars_fragment from './ShaderChunk/uv_pars_fragment.glsl.js';\r\nimport uv_pars_vertex from './ShaderChunk/uv_pars_vertex.glsl.js';\r\nimport uv_vertex from './ShaderChunk/uv_vertex.glsl.js';\r\nimport uv2_pars_fragment from './ShaderChunk/uv2_pars_fragment.glsl.js';\r\nimport uv2_pars_vertex from './ShaderChunk/uv2_pars_vertex.glsl.js';\r\nimport uv2_vertex from './ShaderChunk/uv2_vertex.glsl.js';\r\nimport worldpos_vertex from './ShaderChunk/worldpos_vertex.glsl.js';\r\n\r\nimport background_frag from './ShaderLib/background_frag.glsl.js';\r\nimport background_vert from './ShaderLib/background_vert.glsl.js';\r\nimport cube_frag from './ShaderLib/cube_frag.glsl.js';\r\nimport cube_vert from './ShaderLib/cube_vert.glsl.js';\r\nimport depth_frag from './ShaderLib/depth_frag.glsl.js';\r\nimport depth_vert from './ShaderLib/depth_vert.glsl.js';\r\nimport distanceRGBA_frag from './ShaderLib/distanceRGBA_frag.glsl.js';\r\nimport distanceRGBA_vert from './ShaderLib/distanceRGBA_vert.glsl.js';\r\nimport equirect_frag from './ShaderLib/equirect_frag.glsl.js';\r\nimport equirect_vert from './ShaderLib/equirect_vert.glsl.js';\r\nimport linedashed_frag from './ShaderLib/linedashed_frag.glsl.js';\r\nimport linedashed_vert from './ShaderLib/linedashed_vert.glsl.js';\r\nimport meshbasic_frag from './ShaderLib/meshbasic_frag.glsl.js';\r\nimport meshbasic_vert from './ShaderLib/meshbasic_vert.glsl.js';\r\nimport meshlambert_frag from './ShaderLib/meshlambert_frag.glsl.js';\r\nimport meshlambert_vert from './ShaderLib/meshlambert_vert.glsl.js';\r\nimport meshmatcap_frag from './ShaderLib/meshmatcap_frag.glsl.js';\r\nimport meshmatcap_vert from './ShaderLib/meshmatcap_vert.glsl.js';\r\nimport meshnormal_frag from './ShaderLib/meshnormal_frag.glsl.js';\r\nimport meshnormal_vert from './ShaderLib/meshnormal_vert.glsl.js';\r\nimport meshphong_frag from './ShaderLib/meshphong_frag.glsl.js';\r\nimport meshphong_vert from './ShaderLib/meshphong_vert.glsl.js';\r\nimport meshphysical_frag from './ShaderLib/meshphysical_frag.glsl.js';\r\nimport meshphysical_vert from './ShaderLib/meshphysical_vert.glsl.js';\r\nimport meshtoon_frag from './ShaderLib/meshtoon_frag.glsl.js';\r\nimport meshtoon_vert from './ShaderLib/meshtoon_vert.glsl.js';\r\nimport points_frag from './ShaderLib/points_frag.glsl.js';\r\nimport points_vert from './ShaderLib/points_vert.glsl.js';\r\nimport shadow_frag from './ShaderLib/shadow_frag.glsl.js';\r\nimport shadow_vert from './ShaderLib/shadow_vert.glsl.js';\r\nimport sprite_frag from './ShaderLib/sprite_frag.glsl.js';\r\nimport sprite_vert from './ShaderLib/sprite_vert.glsl.js';\r\n\r\nexport const ShaderChunk = {\r\n\talphamap_fragment: alphamap_fragment,\r\n\talphamap_pars_fragment: alphamap_pars_fragment,\r\n\talphatest_fragment: alphatest_fragment,\r\n\taomap_fragment: aomap_fragment,\r\n\taomap_pars_fragment: aomap_pars_fragment,\r\n\tbegin_vertex: begin_vertex,\r\n\tbeginnormal_vertex: beginnormal_vertex,\r\n\tbsdfs: bsdfs,\r\n\tbumpmap_pars_fragment: bumpmap_pars_fragment,\r\n\tclipping_planes_fragment: clipping_planes_fragment,\r\n\tclipping_planes_pars_fragment: clipping_planes_pars_fragment,\r\n\tclipping_planes_pars_vertex: clipping_planes_pars_vertex,\r\n\tclipping_planes_vertex: clipping_planes_vertex,\r\n\tcolor_fragment: color_fragment,\r\n\tcolor_pars_fragment: color_pars_fragment,\r\n\tcolor_pars_vertex: color_pars_vertex,\r\n\tcolor_vertex: color_vertex,\r\n\tcommon: common,\r\n\tcube_uv_reflection_fragment: cube_uv_reflection_fragment,\r\n\tdefaultnormal_vertex: defaultnormal_vertex,\r\n\tdisplacementmap_pars_vertex: displacementmap_pars_vertex,\r\n\tdisplacementmap_vertex: displacementmap_vertex,\r\n\temissivemap_fragment: emissivemap_fragment,\r\n\temissivemap_pars_fragment: emissivemap_pars_fragment,\r\n\tencodings_fragment: encodings_fragment,\r\n\tencodings_pars_fragment: encodings_pars_fragment,\r\n\tenvmap_fragment: envmap_fragment,\r\n\tenvmap_common_pars_fragment: envmap_common_pars_fragment,\r\n\tenvmap_pars_fragment: envmap_pars_fragment,\r\n\tenvmap_pars_vertex: envmap_pars_vertex,\r\n\tenvmap_physical_pars_fragment: envmap_physical_pars_fragment,\r\n\tenvmap_vertex: envmap_vertex,\r\n\tfog_vertex: fog_vertex,\r\n\tfog_pars_vertex: fog_pars_vertex,\r\n\tfog_fragment: fog_fragment,\r\n\tfog_pars_fragment: fog_pars_fragment,\r\n\tgradientmap_pars_fragment: gradientmap_pars_fragment,\r\n\tlightmap_fragment: lightmap_fragment,\r\n\tlightmap_pars_fragment: lightmap_pars_fragment,\r\n\tlights_lambert_vertex: lights_lambert_vertex,\r\n\tlights_pars_begin: lights_pars_begin,\r\n\tlights_toon_fragment: lights_toon_fragment,\r\n\tlights_toon_pars_fragment: lights_toon_pars_fragment,\r\n\tlights_phong_fragment: lights_phong_fragment,\r\n\tlights_phong_pars_fragment: lights_phong_pars_fragment,\r\n\tlights_physical_fragment: lights_physical_fragment,\r\n\tlights_physical_pars_fragment: lights_physical_pars_fragment,\r\n\tlights_fragment_begin: lights_fragment_begin,\r\n\tlights_fragment_maps: lights_fragment_maps,\r\n\tlights_fragment_end: lights_fragment_end,\r\n\tlogdepthbuf_fragment: logdepthbuf_fragment,\r\n\tlogdepthbuf_pars_fragment: logdepthbuf_pars_fragment,\r\n\tlogdepthbuf_pars_vertex: logdepthbuf_pars_vertex,\r\n\tlogdepthbuf_vertex: logdepthbuf_vertex,\r\n\tmap_fragment: map_fragment,\r\n\tmap_pars_fragment: map_pars_fragment,\r\n\tmap_particle_fragment: map_particle_fragment,\r\n\tmap_particle_pars_fragment: map_particle_pars_fragment,\r\n\tmetalnessmap_fragment: metalnessmap_fragment,\r\n\tmetalnessmap_pars_fragment: metalnessmap_pars_fragment,\r\n\tmorphnormal_vertex: morphnormal_vertex,\r\n\tmorphtarget_pars_vertex: morphtarget_pars_vertex,\r\n\tmorphtarget_vertex: morphtarget_vertex,\r\n\tnormal_fragment_begin: normal_fragment_begin,\r\n\tnormal_fragment_maps: normal_fragment_maps,\r\n\tnormal_pars_fragment: normal_pars_fragment,\r\n\tnormal_pars_vertex: normal_pars_vertex,\r\n\tnormal_vertex: normal_vertex,\r\n\tnormalmap_pars_fragment: normalmap_pars_fragment,\r\n\tclearcoat_normal_fragment_begin: clearcoat_normal_fragment_begin,\r\n\tclearcoat_normal_fragment_maps: clearcoat_normal_fragment_maps,\r\n\tclearcoat_pars_fragment: clearcoat_pars_fragment,\r\n\tpacking: packing,\r\n\tpremultiplied_alpha_fragment: premultiplied_alpha_fragment,\r\n\tproject_vertex: project_vertex,\r\n\tdithering_fragment: dithering_fragment,\r\n\tdithering_pars_fragment: dithering_pars_fragment,\r\n\troughnessmap_fragment: roughnessmap_fragment,\r\n\troughnessmap_pars_fragment: roughnessmap_pars_fragment,\r\n\tshadowmap_pars_fragment: shadowmap_pars_fragment,\r\n\tshadowmap_pars_vertex: shadowmap_pars_vertex,\r\n\tshadowmap_vertex: shadowmap_vertex,\r\n\tshadowmask_pars_fragment: shadowmask_pars_fragment,\r\n\tskinbase_vertex: skinbase_vertex,\r\n\tskinning_pars_vertex: skinning_pars_vertex,\r\n\tskinning_vertex: skinning_vertex,\r\n\tskinnormal_vertex: skinnormal_vertex,\r\n\tspecularmap_fragment: specularmap_fragment,\r\n\tspecularmap_pars_fragment: specularmap_pars_fragment,\r\n\ttonemapping_fragment: tonemapping_fragment,\r\n\ttonemapping_pars_fragment: tonemapping_pars_fragment,\r\n\ttransmission_fragment: transmission_fragment,\r\n\ttransmission_pars_fragment: transmission_pars_fragment,\r\n\tuv_pars_fragment: uv_pars_fragment,\r\n\tuv_pars_vertex: uv_pars_vertex,\r\n\tuv_vertex: uv_vertex,\r\n\tuv2_pars_fragment: uv2_pars_fragment,\r\n\tuv2_pars_vertex: uv2_pars_vertex,\r\n\tuv2_vertex: uv2_vertex,\r\n\tworldpos_vertex: worldpos_vertex,\r\n\r\n\tbackground_frag: background_frag,\r\n\tbackground_vert: background_vert,\r\n\tcube_frag: cube_frag,\r\n\tcube_vert: cube_vert,\r\n\tdepth_frag: depth_frag,\r\n\tdepth_vert: depth_vert,\r\n\tdistanceRGBA_frag: distanceRGBA_frag,\r\n\tdistanceRGBA_vert: distanceRGBA_vert,\r\n\tequirect_frag: equirect_frag,\r\n\tequirect_vert: equirect_vert,\r\n\tlinedashed_frag: linedashed_frag,\r\n\tlinedashed_vert: linedashed_vert,\r\n\tmeshbasic_frag: meshbasic_frag,\r\n\tmeshbasic_vert: meshbasic_vert,\r\n\tmeshlambert_frag: meshlambert_frag,\r\n\tmeshlambert_vert: meshlambert_vert,\r\n\tmeshmatcap_frag: meshmatcap_frag,\r\n\tmeshmatcap_vert: meshmatcap_vert,\r\n\tmeshnormal_frag: meshnormal_frag,\r\n\tmeshnormal_vert: meshnormal_vert,\r\n\tmeshphong_frag: meshphong_frag,\r\n\tmeshphong_vert: meshphong_vert,\r\n\tmeshphysical_frag: meshphysical_frag,\r\n\tmeshphysical_vert: meshphysical_vert,\r\n\tmeshtoon_frag: meshtoon_frag,\r\n\tmeshtoon_vert: meshtoon_vert,\r\n\tpoints_frag: points_frag,\r\n\tpoints_vert: points_vert,\r\n\tshadow_frag: shadow_frag,\r\n\tshadow_vert: shadow_vert,\r\n\tsprite_frag: sprite_frag,\r\n\tsprite_vert: sprite_vert\r\n};\r\n", "import { Color } from '../../math/Color.js';\r\nimport { Vector2 } from '../../math/Vector2.js';\r\nimport { Matrix3 } from '../../math/Matrix3.js';\r\n\r\n/**\r\n * Uniforms library for shared webgl shaders\r\n */\r\n\r\nconst UniformsLib = {\r\n\r\n\tcommon: {\r\n\r\n\t\tdiffuse: { value: new Color( 0xffffff ) },\r\n\t\topacity: { value: 1.0 },\r\n\r\n\t\tmap: { value: null },\r\n\t\tuvTransform: { value: new Matrix3() },\r\n\t\tuv2Transform: { value: new Matrix3() },\r\n\r\n\t\talphaMap: { value: null },\r\n\r\n\t},\r\n\r\n\tspecularmap: {\r\n\r\n\t\tspecularMap: { value: null },\r\n\r\n\t},\r\n\r\n\tenvmap: {\r\n\r\n\t\tenvMap: { value: null },\r\n\t\tflipEnvMap: { value: - 1 },\r\n\t\treflectivity: { value: 1.0 }, // basic, lambert, phong\r\n\t\tior: { value: 1.5 }, // standard, physical\r\n\t\trefractionRatio: { value: 0.98 },\r\n\t\tmaxMipLevel: { value: 0 }\r\n\r\n\t},\r\n\r\n\taomap: {\r\n\r\n\t\taoMap: { value: null },\r\n\t\taoMapIntensity: { value: 1 }\r\n\r\n\t},\r\n\r\n\tlightmap: {\r\n\r\n\t\tlightMap: { value: null },\r\n\t\tlightMapIntensity: { value: 1 }\r\n\r\n\t},\r\n\r\n\temissivemap: {\r\n\r\n\t\temissiveMap: { value: null }\r\n\r\n\t},\r\n\r\n\tbumpmap: {\r\n\r\n\t\tbumpMap: { value: null },\r\n\t\tbumpScale: { value: 1 }\r\n\r\n\t},\r\n\r\n\tnormalmap: {\r\n\r\n\t\tnormalMap: { value: null },\r\n\t\tnormalScale: { value: new Vector2( 1, 1 ) }\r\n\r\n\t},\r\n\r\n\tdisplacementmap: {\r\n\r\n\t\tdisplacementMap: { value: null },\r\n\t\tdisplacementScale: { value: 1 },\r\n\t\tdisplacementBias: { value: 0 }\r\n\r\n\t},\r\n\r\n\troughnessmap: {\r\n\r\n\t\troughnessMap: { value: null }\r\n\r\n\t},\r\n\r\n\tmetalnessmap: {\r\n\r\n\t\tmetalnessMap: { value: null }\r\n\r\n\t},\r\n\r\n\tgradientmap: {\r\n\r\n\t\tgradientMap: { value: null }\r\n\r\n\t},\r\n\r\n\tfog: {\r\n\r\n\t\tfogDensity: { value: 0.00025 },\r\n\t\tfogNear: { value: 1 },\r\n\t\tfogFar: { value: 2000 },\r\n\t\tfogColor: { value: new Color( 0xffffff ) }\r\n\r\n\t},\r\n\r\n\tlights: {\r\n\r\n\t\tambientLightColor: { value: [] },\r\n\r\n\t\tlightProbe: { value: [] },\r\n\r\n\t\tdirectionalLights: { value: [], properties: {\r\n\t\t\tdirection: {},\r\n\t\t\tcolor: {}\r\n\t\t} },\r\n\r\n\t\tdirectionalLightShadows: { value: [], properties: {\r\n\t\t\tshadowBias: {},\r\n\t\t\tshadowNormalBias: {},\r\n\t\t\tshadowRadius: {},\r\n\t\t\tshadowMapSize: {}\r\n\t\t} },\r\n\r\n\t\tdirectionalShadowMap: { value: [] },\r\n\t\tdirectionalShadowMatrix: { value: [] },\r\n\r\n\t\tspotLights: { value: [], properties: {\r\n\t\t\tcolor: {},\r\n\t\t\tposition: {},\r\n\t\t\tdirection: {},\r\n\t\t\tdistance: {},\r\n\t\t\tconeCos: {},\r\n\t\t\tpenumbraCos: {},\r\n\t\t\tdecay: {}\r\n\t\t} },\r\n\r\n\t\tspotLightShadows: { value: [], properties: {\r\n\t\t\tshadowBias: {},\r\n\t\t\tshadowNormalBias: {},\r\n\t\t\tshadowRadius: {},\r\n\t\t\tshadowMapSize: {}\r\n\t\t} },\r\n\r\n\t\tspotShadowMap: { value: [] },\r\n\t\tspotShadowMatrix: { value: [] },\r\n\r\n\t\tpointLights: { value: [], properties: {\r\n\t\t\tcolor: {},\r\n\t\t\tposition: {},\r\n\t\t\tdecay: {},\r\n\t\t\tdistance: {}\r\n\t\t} },\r\n\r\n\t\tpointLightShadows: { value: [], properties: {\r\n\t\t\tshadowBias: {},\r\n\t\t\tshadowNormalBias: {},\r\n\t\t\tshadowRadius: {},\r\n\t\t\tshadowMapSize: {},\r\n\t\t\tshadowCameraNear: {},\r\n\t\t\tshadowCameraFar: {}\r\n\t\t} },\r\n\r\n\t\tpointShadowMap: { value: [] },\r\n\t\tpointShadowMatrix: { value: [] },\r\n\r\n\t\themisphereLights: { value: [], properties: {\r\n\t\t\tdirection: {},\r\n\t\t\tskyColor: {},\r\n\t\t\tgroundColor: {}\r\n\t\t} },\r\n\r\n\t\t// TODO (abelnation): RectAreaLight BRDF data needs to be moved from example to main src\r\n\t\trectAreaLights: { value: [], properties: {\r\n\t\t\tcolor: {},\r\n\t\t\tposition: {},\r\n\t\t\twidth: {},\r\n\t\t\theight: {}\r\n\t\t} },\r\n\r\n\t\tltc_1: { value: null },\r\n\t\tltc_2: { value: null }\r\n\r\n\t},\r\n\r\n\tpoints: {\r\n\r\n\t\tdiffuse: { value: new Color( 0xffffff ) },\r\n\t\topacity: { value: 1.0 },\r\n\t\tsize: { value: 1.0 },\r\n\t\tscale: { value: 1.0 },\r\n\t\tmap: { value: null },\r\n\t\talphaMap: { value: null },\r\n\t\tuvTransform: { value: new Matrix3() }\r\n\r\n\t},\r\n\r\n\tsprite: {\r\n\r\n\t\tdiffuse: { value: new Color( 0xffffff ) },\r\n\t\topacity: { value: 1.0 },\r\n\t\tcenter: { value: new Vector2( 0.5, 0.5 ) },\r\n\t\trotation: { value: 0.0 },\r\n\t\tmap: { value: null },\r\n\t\talphaMap: { value: null },\r\n\t\tuvTransform: { value: new Matrix3() }\r\n\r\n\t}\r\n\r\n};\r\n\r\nexport { UniformsLib };\r\n", "import { ShaderChunk } from './ShaderChunk.js';\r\nimport { mergeUniforms } from './UniformsUtils.js';\r\nimport { Vector2 } from '../../math/Vector2.js';\r\nimport { Vector3 } from '../../math/Vector3.js';\r\nimport { UniformsLib } from './UniformsLib.js';\r\nimport { Color } from '../../math/Color.js';\r\nimport { Matrix3 } from '../../math/Matrix3.js';\r\n\r\nconst ShaderLib = {\r\n\r\n\tbasic: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.specularmap,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.fog\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshbasic_vert,\r\n\t\tfragmentShader: ShaderChunk.meshbasic_frag\r\n\r\n\t},\r\n\r\n\tlambert: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.specularmap,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\t{\r\n\t\t\t\temissive: { value: new Color( 0x000000 ) }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshlambert_vert,\r\n\t\tfragmentShader: ShaderChunk.meshlambert_frag\r\n\r\n\t},\r\n\r\n\tphong: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.specularmap,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\t{\r\n\t\t\t\temissive: { value: new Color( 0x000000 ) },\r\n\t\t\t\tspecular: { value: new Color( 0x111111 ) },\r\n\t\t\t\tshininess: { value: 30 }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshphong_vert,\r\n\t\tfragmentShader: ShaderChunk.meshphong_frag\r\n\r\n\t},\r\n\r\n\tstandard: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.roughnessmap,\r\n\t\t\tUniformsLib.metalnessmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\t{\r\n\t\t\t\temissive: { value: new Color( 0x000000 ) },\r\n\t\t\t\troughness: { value: 1.0 },\r\n\t\t\t\tmetalness: { value: 0.0 },\r\n\t\t\t\tenvMapIntensity: { value: 1 } // temporary\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshphysical_vert,\r\n\t\tfragmentShader: ShaderChunk.meshphysical_frag\r\n\r\n\t},\r\n\r\n\ttoon: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.gradientmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\t{\r\n\t\t\t\temissive: { value: new Color( 0x000000 ) }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshtoon_vert,\r\n\t\tfragmentShader: ShaderChunk.meshtoon_frag\r\n\r\n\t},\r\n\r\n\tmatcap: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\t{\r\n\t\t\t\tmatcap: { value: null }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshmatcap_vert,\r\n\t\tfragmentShader: ShaderChunk.meshmatcap_frag\r\n\r\n\t},\r\n\r\n\tpoints: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.points,\r\n\t\t\tUniformsLib.fog\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.points_vert,\r\n\t\tfragmentShader: ShaderChunk.points_frag\r\n\r\n\t},\r\n\r\n\tdashed: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\t{\r\n\t\t\t\tscale: { value: 1 },\r\n\t\t\t\tdashSize: { value: 1 },\r\n\t\t\t\ttotalSize: { value: 2 }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.linedashed_vert,\r\n\t\tfragmentShader: ShaderChunk.linedashed_frag\r\n\r\n\t},\r\n\r\n\tdepth: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.displacementmap\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.depth_vert,\r\n\t\tfragmentShader: ShaderChunk.depth_frag\r\n\r\n\t},\r\n\r\n\tnormal: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\t{\r\n\t\t\t\topacity: { value: 1.0 }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.meshnormal_vert,\r\n\t\tfragmentShader: ShaderChunk.meshnormal_frag\r\n\r\n\t},\r\n\r\n\tsprite: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.sprite,\r\n\t\t\tUniformsLib.fog\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.sprite_vert,\r\n\t\tfragmentShader: ShaderChunk.sprite_frag\r\n\r\n\t},\r\n\r\n\tbackground: {\r\n\r\n\t\tuniforms: {\r\n\t\t\tuvTransform: { value: new Matrix3() },\r\n\t\t\tt2D: { value: null },\r\n\t\t},\r\n\r\n\t\tvertexShader: ShaderChunk.background_vert,\r\n\t\tfragmentShader: ShaderChunk.background_frag\r\n\r\n\t},\r\n\t/* -------------------------------------------------------------------------\r\n\t//\tCube map shader\r\n\t ------------------------------------------------------------------------- */\r\n\r\n\tcube: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\t{\r\n\t\t\t\topacity: { value: 1.0 }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.cube_vert,\r\n\t\tfragmentShader: ShaderChunk.cube_frag\r\n\r\n\t},\r\n\r\n\tequirect: {\r\n\r\n\t\tuniforms: {\r\n\t\t\ttEquirect: { value: null },\r\n\t\t},\r\n\r\n\t\tvertexShader: ShaderChunk.equirect_vert,\r\n\t\tfragmentShader: ShaderChunk.equirect_frag\r\n\r\n\t},\r\n\r\n\tdistanceRGBA: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\t{\r\n\t\t\t\treferencePosition: { value: new Vector3() },\r\n\t\t\t\tnearDistance: { value: 1 },\r\n\t\t\t\tfarDistance: { value: 1000 }\r\n\t\t\t}\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.distanceRGBA_vert,\r\n\t\tfragmentShader: ShaderChunk.distanceRGBA_frag\r\n\r\n\t},\r\n\r\n\tshadow: {\r\n\r\n\t\tuniforms: mergeUniforms( [\r\n\t\t\tUniformsLib.lights,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\t{\r\n\t\t\t\tcolor: { value: new Color( 0x00000 ) },\r\n\t\t\t\topacity: { value: 1.0 }\r\n\t\t\t},\r\n\t\t] ),\r\n\r\n\t\tvertexShader: ShaderChunk.shadow_vert,\r\n\t\tfragmentShader: ShaderChunk.shadow_frag\r\n\r\n\t}\r\n\r\n};\r\n\r\nShaderLib.physical = {\r\n\r\n\tuniforms: mergeUniforms( [\r\n\t\tShaderLib.standard.uniforms,\r\n\t\t{\r\n\t\t\tclearcoat: { value: 0 },\r\n\t\t\tclearcoatMap: { value: null },\r\n\t\t\tclearcoatRoughness: { value: 0 },\r\n\t\t\tclearcoatRoughnessMap: { value: null },\r\n\t\t\tclearcoatNormalScale: { value: new Vector2( 1, 1 ) },\r\n\t\t\tclearcoatNormalMap: { value: null },\r\n\t\t\tsheen: { value: new Color( 0x000000 ) },\r\n\t\t\ttransmission: { value: 0 },\r\n\t\t\ttransmissionMap: { value: null },\r\n\t\t\ttransmissionSamplerSize: { value: new Vector2() },\r\n\t\t\ttransmissionSamplerMap: { value: null },\r\n\t\t\tthickness: { value: 0 },\r\n\t\t\tthicknessMap: { value: null },\r\n\t\t\tattenuationDistance: { value: 0 },\r\n\t\t\tattenuationTint: { value: new Color( 0x000000 ) },\r\n\t\t\tspecularIntensity: { value: 0 },\r\n\t\t\tspecularIntensityMap: { value: null },\r\n\t\t\tspecularTint: { value: new Color( 1, 1, 1 ) },\r\n\t\t\tspecularTintMap: { value: null },\r\n\t\t}\r\n\t] ),\r\n\r\n\tvertexShader: ShaderChunk.meshphysical_vert,\r\n\tfragmentShader: ShaderChunk.meshphysical_frag\r\n\r\n};\r\n\r\n\r\nexport { ShaderLib };\r\n", "import { BackSide, FrontSide, CubeUVReflectionMapping } from '../../constants.js';\r\nimport { BoxGeometry } from '../../geometries/BoxGeometry.js';\r\nimport { PlaneGeometry } from '../../geometries/PlaneGeometry.js';\r\nimport { ShaderMaterial } from '../../materials/ShaderMaterial.js';\r\nimport { Color } from '../../math/Color.js';\r\nimport { Mesh } from '../../objects/Mesh.js';\r\nimport { ShaderLib } from '../shaders/ShaderLib.js';\r\nimport { cloneUniforms } from '../shaders/UniformsUtils.js';\r\n\r\nfunction WebGLBackground( renderer, cubemaps, state, objects, premultipliedAlpha ) {\r\n\r\n\tconst clearColor = new Color( 0x000000 );\r\n\tlet clearAlpha = 0;\r\n\r\n\tlet planeMesh;\r\n\tlet boxMesh;\r\n\r\n\tlet currentBackground = null;\r\n\tlet currentBackgroundVersion = 0;\r\n\tlet currentTonemapping = null;\r\n\r\n\tfunction render( renderList, scene ) {\r\n\r\n\t\tlet forceClear = false;\r\n\t\tlet background = scene.isScene === true ? scene.background : null;\r\n\r\n\t\tif ( background && background.isTexture ) {\r\n\r\n\t\t\tbackground = cubemaps.get( background );\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore background in AR\r\n\t\t// TODO: Reconsider this.\r\n\r\n\t\tconst xr = renderer.xr;\r\n\t\tconst session = xr.getSession && xr.getSession();\r\n\r\n\t\tif ( session && session.environmentBlendMode === 'additive' ) {\r\n\r\n\t\t\tbackground = null;\r\n\r\n\t\t}\r\n\r\n\t\tif ( background === null ) {\r\n\r\n\t\t\tsetClear( clearColor, clearAlpha );\r\n\r\n\t\t} else if ( background && background.isColor ) {\r\n\r\n\t\t\tsetClear( background, 1 );\r\n\t\t\tforceClear = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( renderer.autoClear || forceClear ) {\r\n\r\n\t\t\trenderer.clear( renderer.autoClearColor, renderer.autoClearDepth, renderer.autoClearStencil );\r\n\r\n\t\t}\r\n\r\n\t\tif ( background && ( background.isCubeTexture || background.mapping === CubeUVReflectionMapping ) ) {\r\n\r\n\t\t\tif ( boxMesh === undefined ) {\r\n\r\n\t\t\t\tboxMesh = new Mesh(\r\n\t\t\t\t\tnew BoxGeometry( 1, 1, 1 ),\r\n\t\t\t\t\tnew ShaderMaterial( {\r\n\t\t\t\t\t\tname: 'BackgroundCubeMaterial',\r\n\t\t\t\t\t\tuniforms: cloneUniforms( ShaderLib.cube.uniforms ),\r\n\t\t\t\t\t\tvertexShader: ShaderLib.cube.vertexShader,\r\n\t\t\t\t\t\tfragmentShader: ShaderLib.cube.fragmentShader,\r\n\t\t\t\t\t\tside: BackSide,\r\n\t\t\t\t\t\tdepthTest: false,\r\n\t\t\t\t\t\tdepthWrite: false,\r\n\t\t\t\t\t\tfog: false\r\n\t\t\t\t\t} )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tboxMesh.geometry.deleteAttribute( 'normal' );\r\n\t\t\t\tboxMesh.geometry.deleteAttribute( 'uv' );\r\n\r\n\t\t\t\tboxMesh.onBeforeRender = function ( renderer, scene, camera ) {\r\n\r\n\t\t\t\t\tthis.matrixWorld.copyPosition( camera.matrixWorld );\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// enable code injection for non-built-in material\r\n\t\t\t\tObject.defineProperty( boxMesh.material, 'envMap', {\r\n\r\n\t\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\t\treturn this.uniforms.envMap.value;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tobjects.update( boxMesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tboxMesh.material.uniforms.envMap.value = background;\r\n\t\t\tboxMesh.material.uniforms.flipEnvMap.value = ( background.isCubeTexture && background.isRenderTargetTexture === false ) ? - 1 : 1;\r\n\r\n\t\t\tif ( currentBackground !== background ||\r\n\t\t\t\tcurrentBackgroundVersion !== background.version ||\r\n\t\t\t\tcurrentTonemapping !== renderer.toneMapping ) {\r\n\r\n\t\t\t\tboxMesh.material.needsUpdate = true;\r\n\r\n\t\t\t\tcurrentBackground = background;\r\n\t\t\t\tcurrentBackgroundVersion = background.version;\r\n\t\t\t\tcurrentTonemapping = renderer.toneMapping;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// push to the pre-sorted opaque render list\r\n\t\t\trenderList.unshift( boxMesh, boxMesh.geometry, boxMesh.material, 0, 0, null );\r\n\r\n\t\t} else if ( background && background.isTexture ) {\r\n\r\n\t\t\tif ( planeMesh === undefined ) {\r\n\r\n\t\t\t\tplaneMesh = new Mesh(\r\n\t\t\t\t\tnew PlaneGeometry( 2, 2 ),\r\n\t\t\t\t\tnew ShaderMaterial( {\r\n\t\t\t\t\t\tname: 'BackgroundMaterial',\r\n\t\t\t\t\t\tuniforms: cloneUniforms( ShaderLib.background.uniforms ),\r\n\t\t\t\t\t\tvertexShader: ShaderLib.background.vertexShader,\r\n\t\t\t\t\t\tfragmentShader: ShaderLib.background.fragmentShader,\r\n\t\t\t\t\t\tside: FrontSide,\r\n\t\t\t\t\t\tdepthTest: false,\r\n\t\t\t\t\t\tdepthWrite: false,\r\n\t\t\t\t\t\tfog: false\r\n\t\t\t\t\t} )\r\n\t\t\t\t);\r\n\r\n\t\t\t\tplaneMesh.geometry.deleteAttribute( 'normal' );\r\n\r\n\t\t\t\t// enable code injection for non-built-in material\r\n\t\t\t\tObject.defineProperty( planeMesh.material, 'map', {\r\n\r\n\t\t\t\t\tget: function () {\r\n\r\n\t\t\t\t\t\treturn this.uniforms.t2D.value;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t\tobjects.update( planeMesh );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tplaneMesh.material.uniforms.t2D.value = background;\r\n\r\n\t\t\tif ( background.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\tbackground.updateMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tplaneMesh.material.uniforms.uvTransform.value.copy( background.matrix );\r\n\r\n\t\t\tif ( currentBackground !== background ||\r\n\t\t\t\tcurrentBackgroundVersion !== background.version ||\r\n\t\t\t\tcurrentTonemapping !== renderer.toneMapping ) {\r\n\r\n\t\t\t\tplaneMesh.material.needsUpdate = true;\r\n\r\n\t\t\t\tcurrentBackground = background;\r\n\t\t\t\tcurrentBackgroundVersion = background.version;\r\n\t\t\t\tcurrentTonemapping = renderer.toneMapping;\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// push to the pre-sorted opaque render list\r\n\t\t\trenderList.unshift( planeMesh, planeMesh.geometry, planeMesh.material, 0, 0, null );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setClear( color, alpha ) {\r\n\r\n\t\tstate.buffers.color.setClear( color.r, color.g, color.b, alpha, premultipliedAlpha );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tgetClearColor: function () {\r\n\r\n\t\t\treturn clearColor;\r\n\r\n\t\t},\r\n\t\tsetClearColor: function ( color, alpha = 1 ) {\r\n\r\n\t\t\tclearColor.set( color );\r\n\t\t\tclearAlpha = alpha;\r\n\t\t\tsetClear( clearColor, clearAlpha );\r\n\r\n\t\t},\r\n\t\tgetClearAlpha: function () {\r\n\r\n\t\t\treturn clearAlpha;\r\n\r\n\t\t},\r\n\t\tsetClearAlpha: function ( alpha ) {\r\n\r\n\t\t\tclearAlpha = alpha;\r\n\t\t\tsetClear( clearColor, clearAlpha );\r\n\r\n\t\t},\r\n\t\trender: render\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLBackground };\r\n", "\uFEFFfunction WebGLBindingStates( gl, extensions, attributes, capabilities ) {\r\n\r\n\tconst maxVertexAttributes = gl.getParameter( gl.MAX_VERTEX_ATTRIBS );\r\n\r\n\tconst extension = capabilities.isWebGL2 ? null : extensions.get( 'OES_vertex_array_object' );\r\n\tconst vaoAvailable = capabilities.isWebGL2 || extension !== null;\r\n\r\n\tconst bindingStates = {};\r\n\r\n\tconst defaultState = createBindingState( null );\r\n\tlet currentState = defaultState;\r\n\r\n\tfunction setup( object, material, program, geometry, index ) {\r\n\r\n\t\tlet updateBuffers = false;\r\n\r\n\t\tif ( vaoAvailable ) {\r\n\r\n\t\t\tconst state = getBindingState( geometry, program, material );\r\n\r\n\t\t\tif ( currentState !== state ) {\r\n\r\n\t\t\t\tcurrentState = state;\r\n\t\t\t\tbindVertexArrayObject( currentState.object );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tupdateBuffers = needsUpdate( geometry, index );\r\n\r\n\t\t\tif ( updateBuffers ) saveCache( geometry, index );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst wireframe = ( material.wireframe === true );\r\n\r\n\t\t\tif ( currentState.geometry !== geometry.id ||\r\n\t\t\t\tcurrentState.program !== program.id ||\r\n\t\t\t\tcurrentState.wireframe !== wireframe ) {\r\n\r\n\t\t\t\tcurrentState.geometry = geometry.id;\r\n\t\t\t\tcurrentState.program = program.id;\r\n\t\t\t\tcurrentState.wireframe = wireframe;\r\n\r\n\t\t\t\tupdateBuffers = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.isInstancedMesh === true ) {\r\n\r\n\t\t\tupdateBuffers = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tattributes.update( index, gl.ELEMENT_ARRAY_BUFFER );\r\n\r\n\t\t}\r\n\r\n\t\tif ( updateBuffers ) {\r\n\r\n\t\t\tsetupVertexAttributes( object, material, program, geometry );\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tgl.bindBuffer( gl.ELEMENT_ARRAY_BUFFER, attributes.get( index ).buffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction createVertexArrayObject() {\r\n\r\n\t\tif ( capabilities.isWebGL2 ) return gl.createVertexArray();\r\n\r\n\t\treturn extension.createVertexArrayOES();\r\n\r\n\t}\r\n\r\n\tfunction bindVertexArrayObject( vao ) {\r\n\r\n\t\tif ( capabilities.isWebGL2 ) return gl.bindVertexArray( vao );\r\n\r\n\t\treturn extension.bindVertexArrayOES( vao );\r\n\r\n\t}\r\n\r\n\tfunction deleteVertexArrayObject( vao ) {\r\n\r\n\t\tif ( capabilities.isWebGL2 ) return gl.deleteVertexArray( vao );\r\n\r\n\t\treturn extension.deleteVertexArrayOES( vao );\r\n\r\n\t}\r\n\r\n\tfunction getBindingState( geometry, program, material ) {\r\n\r\n\t\tconst wireframe = ( material.wireframe === true );\r\n\r\n\t\tlet programMap = bindingStates[ geometry.id ];\r\n\r\n\t\tif ( programMap === undefined ) {\r\n\r\n\t\t\tprogramMap = {};\r\n\t\t\tbindingStates[ geometry.id ] = programMap;\r\n\r\n\t\t}\r\n\r\n\t\tlet stateMap = programMap[ program.id ];\r\n\r\n\t\tif ( stateMap === undefined ) {\r\n\r\n\t\t\tstateMap = {};\r\n\t\t\tprogramMap[ program.id ] = stateMap;\r\n\r\n\t\t}\r\n\r\n\t\tlet state = stateMap[ wireframe ];\r\n\r\n\t\tif ( state === undefined ) {\r\n\r\n\t\t\tstate = createBindingState( createVertexArrayObject() );\r\n\t\t\tstateMap[ wireframe ] = state;\r\n\r\n\t\t}\r\n\r\n\t\treturn state;\r\n\r\n\t}\r\n\r\n\tfunction createBindingState( vao ) {\r\n\r\n\t\tconst newAttributes = [];\r\n\t\tconst enabledAttributes = [];\r\n\t\tconst attributeDivisors = [];\r\n\r\n\t\tfor ( let i = 0; i < maxVertexAttributes; i ++ ) {\r\n\r\n\t\t\tnewAttributes[ i ] = 0;\r\n\t\t\tenabledAttributes[ i ] = 0;\r\n\t\t\tattributeDivisors[ i ] = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\r\n\t\t\t// for backward compatibility on non-VAO support browser\r\n\t\t\tgeometry: null,\r\n\t\t\tprogram: null,\r\n\t\t\twireframe: false,\r\n\r\n\t\t\tnewAttributes: newAttributes,\r\n\t\t\tenabledAttributes: enabledAttributes,\r\n\t\t\tattributeDivisors: attributeDivisors,\r\n\t\t\tobject: vao,\r\n\t\t\tattributes: {},\r\n\t\t\tindex: null\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction needsUpdate( geometry, index ) {\r\n\r\n\t\tconst cachedAttributes = currentState.attributes;\r\n\t\tconst geometryAttributes = geometry.attributes;\r\n\r\n\t\tlet attributesNum = 0;\r\n\r\n\t\tfor ( const key in geometryAttributes ) {\r\n\r\n\t\t\tconst cachedAttribute = cachedAttributes[ key ];\r\n\t\t\tconst geometryAttribute = geometryAttributes[ key ];\r\n\r\n\t\t\tif ( cachedAttribute === undefined ) return true;\r\n\r\n\t\t\tif ( cachedAttribute.attribute !== geometryAttribute ) return true;\r\n\r\n\t\t\tif ( cachedAttribute.data !== geometryAttribute.data ) return true;\r\n\r\n\t\t\tattributesNum ++;\r\n\r\n\t\t}\r\n\r\n\t\tif ( currentState.attributesNum !== attributesNum ) return true;\r\n\r\n\t\tif ( currentState.index !== index ) return true;\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tfunction saveCache( geometry, index ) {\r\n\r\n\t\tconst cache = {};\r\n\t\tconst attributes = geometry.attributes;\r\n\t\tlet attributesNum = 0;\r\n\r\n\t\tfor ( const key in attributes ) {\r\n\r\n\t\t\tconst attribute = attributes[ key ];\r\n\r\n\t\t\tconst data = {};\r\n\t\t\tdata.attribute = attribute;\r\n\r\n\t\t\tif ( attribute.data ) {\r\n\r\n\t\t\t\tdata.data = attribute.data;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcache[ key ] = data;\r\n\r\n\t\t\tattributesNum ++;\r\n\r\n\t\t}\r\n\r\n\t\tcurrentState.attributes = cache;\r\n\t\tcurrentState.attributesNum = attributesNum;\r\n\r\n\t\tcurrentState.index = index;\r\n\r\n\t}\r\n\r\n\tfunction initAttributes() {\r\n\r\n\t\tconst newAttributes = currentState.newAttributes;\r\n\r\n\t\tfor ( let i = 0, il = newAttributes.length; i < il; i ++ ) {\r\n\r\n\t\t\tnewAttributes[ i ] = 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction enableAttribute( attribute ) {\r\n\r\n\t\tenableAttributeAndDivisor( attribute, 0 );\r\n\r\n\t}\r\n\r\n\tfunction enableAttributeAndDivisor( attribute, meshPerAttribute ) {\r\n\r\n\t\tconst newAttributes = currentState.newAttributes;\r\n\t\tconst enabledAttributes = currentState.enabledAttributes;\r\n\t\tconst attributeDivisors = currentState.attributeDivisors;\r\n\r\n\t\tnewAttributes[ attribute ] = 1;\r\n\r\n\t\tif ( enabledAttributes[ attribute ] === 0 ) {\r\n\r\n\t\t\tgl.enableVertexAttribArray( attribute );\r\n\t\t\tenabledAttributes[ attribute ] = 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( attributeDivisors[ attribute ] !== meshPerAttribute ) {\r\n\r\n\t\t\tconst extension = capabilities.isWebGL2 ? gl : extensions.get( 'ANGLE_instanced_arrays' );\r\n\r\n\t\t\textension[ capabilities.isWebGL2 ? 'vertexAttribDivisor' : 'vertexAttribDivisorANGLE' ]( attribute, meshPerAttribute );\r\n\t\t\tattributeDivisors[ attribute ] = meshPerAttribute;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction disableUnusedAttributes() {\r\n\r\n\t\tconst newAttributes = currentState.newAttributes;\r\n\t\tconst enabledAttributes = currentState.enabledAttributes;\r\n\r\n\t\tfor ( let i = 0, il = enabledAttributes.length; i < il; i ++ ) {\r\n\r\n\t\t\tif ( enabledAttributes[ i ] !== newAttributes[ i ] ) {\r\n\r\n\t\t\t\tgl.disableVertexAttribArray( i );\r\n\t\t\t\tenabledAttributes[ i ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction vertexAttribPointer( index, size, type, normalized, stride, offset ) {\r\n\r\n\t\tif ( capabilities.isWebGL2 === true && ( type === gl.INT || type === gl.UNSIGNED_INT ) ) {\r\n\r\n\t\t\tgl.vertexAttribIPointer( index, size, type, stride, offset );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgl.vertexAttribPointer( index, size, type, normalized, stride, offset );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setupVertexAttributes( object, material, program, geometry ) {\r\n\r\n\t\tif ( capabilities.isWebGL2 === false && ( object.isInstancedMesh || geometry.isInstancedBufferGeometry ) ) {\r\n\r\n\t\t\tif ( extensions.get( 'ANGLE_instanced_arrays' ) === null ) return;\r\n\r\n\t\t}\r\n\r\n\t\tinitAttributes();\r\n\r\n\t\tconst geometryAttributes = geometry.attributes;\r\n\r\n\t\tconst programAttributes = program.getAttributes();\r\n\r\n\t\tconst materialDefaultAttributeValues = material.defaultAttributeValues;\r\n\r\n\t\tfor ( const name in programAttributes ) {\r\n\r\n\t\t\tconst programAttribute = programAttributes[ name ];\r\n\r\n\t\t\tif ( programAttribute >= 0 ) {\r\n\r\n\t\t\t\tconst geometryAttribute = geometryAttributes[ name ];\r\n\r\n\t\t\t\tif ( geometryAttribute !== undefined ) {\r\n\r\n\t\t\t\t\tconst normalized = geometryAttribute.normalized;\r\n\t\t\t\t\tconst size = geometryAttribute.itemSize;\r\n\r\n\t\t\t\t\tconst attribute = attributes.get( geometryAttribute );\r\n\r\n\t\t\t\t\t// TODO Attribute may not be available on context restore\r\n\r\n\t\t\t\t\tif ( attribute === undefined ) continue;\r\n\r\n\t\t\t\t\tconst buffer = attribute.buffer;\r\n\t\t\t\t\tconst type = attribute.type;\r\n\t\t\t\t\tconst bytesPerElement = attribute.bytesPerElement;\r\n\r\n\t\t\t\t\tif ( geometryAttribute.isInterleavedBufferAttribute ) {\r\n\r\n\t\t\t\t\t\tconst data = geometryAttribute.data;\r\n\t\t\t\t\t\tconst stride = data.stride;\r\n\t\t\t\t\t\tconst offset = geometryAttribute.offset;\r\n\r\n\t\t\t\t\t\tif ( data && data.isInstancedInterleavedBuffer ) {\r\n\r\n\t\t\t\t\t\t\tenableAttributeAndDivisor( programAttribute, data.meshPerAttribute );\r\n\r\n\t\t\t\t\t\t\tif ( geometry._maxInstanceCount === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tgeometry._maxInstanceCount = data.meshPerAttribute * data.count;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tenableAttribute( programAttribute );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n\t\t\t\t\t\tvertexAttribPointer( programAttribute, size, type, normalized, stride * bytesPerElement, offset * bytesPerElement );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( geometryAttribute.isInstancedBufferAttribute ) {\r\n\r\n\t\t\t\t\t\t\tenableAttributeAndDivisor( programAttribute, geometryAttribute.meshPerAttribute );\r\n\r\n\t\t\t\t\t\t\tif ( geometry._maxInstanceCount === undefined ) {\r\n\r\n\t\t\t\t\t\t\t\tgeometry._maxInstanceCount = geometryAttribute.meshPerAttribute * geometryAttribute.count;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tenableAttribute( programAttribute );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n\t\t\t\t\t\tvertexAttribPointer( programAttribute, size, type, normalized, 0, 0 );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( name === 'instanceMatrix' ) {\r\n\r\n\t\t\t\t\tconst attribute = attributes.get( object.instanceMatrix );\r\n\r\n\t\t\t\t\t// TODO Attribute may not be available on context restore\r\n\r\n\t\t\t\t\tif ( attribute === undefined ) continue;\r\n\r\n\t\t\t\t\tconst buffer = attribute.buffer;\r\n\t\t\t\t\tconst type = attribute.type;\r\n\r\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 0, 1 );\r\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 1, 1 );\r\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 2, 1 );\r\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute + 3, 1 );\r\n\r\n\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n\r\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 0, 4, type, false, 64, 0 );\r\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 1, 4, type, false, 64, 16 );\r\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 2, 4, type, false, 64, 32 );\r\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute + 3, 4, type, false, 64, 48 );\r\n\r\n\t\t\t\t} else if ( name === 'instanceColor' ) {\r\n\r\n\t\t\t\t\tconst attribute = attributes.get( object.instanceColor );\r\n\r\n\t\t\t\t\t// TODO Attribute may not be available on context restore\r\n\r\n\t\t\t\t\tif ( attribute === undefined ) continue;\r\n\r\n\t\t\t\t\tconst buffer = attribute.buffer;\r\n\t\t\t\t\tconst type = attribute.type;\r\n\r\n\t\t\t\t\tenableAttributeAndDivisor( programAttribute, 1 );\r\n\r\n\t\t\t\t\tgl.bindBuffer( gl.ARRAY_BUFFER, buffer );\r\n\r\n\t\t\t\t\tgl.vertexAttribPointer( programAttribute, 3, type, false, 12, 0 );\r\n\r\n\t\t\t\t} else if ( materialDefaultAttributeValues !== undefined ) {\r\n\r\n\t\t\t\t\tconst value = materialDefaultAttributeValues[ name ];\r\n\r\n\t\t\t\t\tif ( value !== undefined ) {\r\n\r\n\t\t\t\t\t\tswitch ( value.length ) {\r\n\r\n\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\t\tgl.vertexAttrib2fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\tgl.vertexAttrib3fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\t\tgl.vertexAttrib4fv( programAttribute, value );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tgl.vertexAttrib1fv( programAttribute, value );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tdisableUnusedAttributes();\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\treset();\r\n\r\n\t\tfor ( const geometryId in bindingStates ) {\r\n\r\n\t\t\tconst programMap = bindingStates[ geometryId ];\r\n\r\n\t\t\tfor ( const programId in programMap ) {\r\n\r\n\t\t\t\tconst stateMap = programMap[ programId ];\r\n\r\n\t\t\t\tfor ( const wireframe in stateMap ) {\r\n\r\n\t\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\r\n\r\n\t\t\t\t\tdelete stateMap[ wireframe ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdelete programMap[ programId ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdelete bindingStates[ geometryId ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction releaseStatesOfGeometry( geometry ) {\r\n\r\n\t\tif ( bindingStates[ geometry.id ] === undefined ) return;\r\n\r\n\t\tconst programMap = bindingStates[ geometry.id ];\r\n\r\n\t\tfor ( const programId in programMap ) {\r\n\r\n\t\t\tconst stateMap = programMap[ programId ];\r\n\r\n\t\t\tfor ( const wireframe in stateMap ) {\r\n\r\n\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\r\n\r\n\t\t\t\tdelete stateMap[ wireframe ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdelete programMap[ programId ];\r\n\r\n\t\t}\r\n\r\n\t\tdelete bindingStates[ geometry.id ];\r\n\r\n\t}\r\n\r\n\tfunction releaseStatesOfProgram( program ) {\r\n\r\n\t\tfor ( const geometryId in bindingStates ) {\r\n\r\n\t\t\tconst programMap = bindingStates[ geometryId ];\r\n\r\n\t\t\tif ( programMap[ program.id ] === undefined ) continue;\r\n\r\n\t\t\tconst stateMap = programMap[ program.id ];\r\n\r\n\t\t\tfor ( const wireframe in stateMap ) {\r\n\r\n\t\t\t\tdeleteVertexArrayObject( stateMap[ wireframe ].object );\r\n\r\n\t\t\t\tdelete stateMap[ wireframe ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdelete programMap[ program.id ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction reset() {\r\n\r\n\t\tresetDefaultState();\r\n\r\n\t\tif ( currentState === defaultState ) return;\r\n\r\n\t\tcurrentState = defaultState;\r\n\t\tbindVertexArrayObject( currentState.object );\r\n\r\n\t}\r\n\r\n\t// for backward-compatilibity\r\n\r\n\tfunction resetDefaultState() {\r\n\r\n\t\tdefaultState.geometry = null;\r\n\t\tdefaultState.program = null;\r\n\t\tdefaultState.wireframe = false;\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tsetup: setup,\r\n\t\treset: reset,\r\n\t\tresetDefaultState: resetDefaultState,\r\n\t\tdispose: dispose,\r\n\t\treleaseStatesOfGeometry: releaseStatesOfGeometry,\r\n\t\treleaseStatesOfProgram: releaseStatesOfProgram,\r\n\r\n\t\tinitAttributes: initAttributes,\r\n\t\tenableAttribute: enableAttribute,\r\n\t\tdisableUnusedAttributes: disableUnusedAttributes\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLBindingStates };\r\n", "function WebGLBufferRenderer( gl, extensions, info, capabilities ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\r\n\tlet mode;\r\n\r\n\tfunction setMode( value ) {\r\n\r\n\t\tmode = value;\r\n\r\n\t}\r\n\r\n\tfunction render( start, count ) {\r\n\r\n\t\tgl.drawArrays( mode, start, count );\r\n\r\n\t\tinfo.update( count, mode, 1 );\r\n\r\n\t}\r\n\r\n\tfunction renderInstances( start, count, primcount ) {\r\n\r\n\t\tif ( primcount === 0 ) return;\r\n\r\n\t\tlet extension, methodName;\r\n\r\n\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\textension = gl;\r\n\t\t\tmethodName = 'drawArraysInstanced';\r\n\r\n\t\t} else {\r\n\r\n\t\t\textension = extensions.get( 'ANGLE_instanced_arrays' );\r\n\t\t\tmethodName = 'drawArraysInstancedANGLE';\r\n\r\n\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\textension[ methodName ]( mode, start, count, primcount );\r\n\r\n\t\tinfo.update( count, mode, primcount );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tthis.setMode = setMode;\r\n\tthis.render = render;\r\n\tthis.renderInstances = renderInstances;\r\n\r\n}\r\n\r\n\r\nexport { WebGLBufferRenderer };\r\n", "function WebGLCapabilities( gl, extensions, parameters ) {\r\n\r\n\tlet maxAnisotropy;\r\n\r\n\tfunction getMaxAnisotropy() {\r\n\r\n\t\tif ( maxAnisotropy !== undefined ) return maxAnisotropy;\r\n\r\n\t\tif ( extensions.has( 'EXT_texture_filter_anisotropic' ) === true ) {\r\n\r\n\t\t\tconst extension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\t\tmaxAnisotropy = gl.getParameter( extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmaxAnisotropy = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn maxAnisotropy;\r\n\r\n\t}\r\n\r\n\tfunction getMaxPrecision( precision ) {\r\n\r\n\t\tif ( precision === 'highp' ) {\r\n\r\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.HIGH_FLOAT ).precision > 0 &&\r\n\t\t\t\tgl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.HIGH_FLOAT ).precision > 0 ) {\r\n\r\n\t\t\t\treturn 'highp';\r\n\r\n\t\t\t}\r\n\r\n\t\t\tprecision = 'mediump';\r\n\r\n\t\t}\r\n\r\n\t\tif ( precision === 'mediump' ) {\r\n\r\n\t\t\tif ( gl.getShaderPrecisionFormat( gl.VERTEX_SHADER, gl.MEDIUM_FLOAT ).precision > 0 &&\r\n\t\t\t\tgl.getShaderPrecisionFormat( gl.FRAGMENT_SHADER, gl.MEDIUM_FLOAT ).precision > 0 ) {\r\n\r\n\t\t\t\treturn 'mediump';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn 'lowp';\r\n\r\n\t}\r\n\r\n\t/* eslint-disable no-undef */\r\n\tconst isWebGL2 = ( typeof WebGL2RenderingContext !== 'undefined' && gl instanceof WebGL2RenderingContext ) ||\r\n\t\t( typeof WebGL2ComputeRenderingContext !== 'undefined' && gl instanceof WebGL2ComputeRenderingContext );\r\n\t/* eslint-enable no-undef */\r\n\r\n\tlet precision = parameters.precision !== undefined ? parameters.precision : 'highp';\r\n\tconst maxPrecision = getMaxPrecision( precision );\r\n\r\n\tif ( maxPrecision !== precision ) {\r\n\r\n\t\tconsole.warn( 'THREE.WebGLRenderer:', precision, 'not supported, using', maxPrecision, 'instead.' );\r\n\t\tprecision = maxPrecision;\r\n\r\n\t}\r\n\r\n\tconst drawBuffers = isWebGL2 || extensions.has( 'WEBGL_draw_buffers' );\r\n\r\n\tconst logarithmicDepthBuffer = parameters.logarithmicDepthBuffer === true;\r\n\r\n\tconst maxTextures = gl.getParameter( gl.MAX_TEXTURE_IMAGE_UNITS );\r\n\tconst maxVertexTextures = gl.getParameter( gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS );\r\n\tconst maxTextureSize = gl.getParameter( gl.MAX_TEXTURE_SIZE );\r\n\tconst maxCubemapSize = gl.getParameter( gl.MAX_CUBE_MAP_TEXTURE_SIZE );\r\n\r\n\tconst maxAttributes = gl.getParameter( gl.MAX_VERTEX_ATTRIBS );\r\n\tconst maxVertexUniforms = gl.getParameter( gl.MAX_VERTEX_UNIFORM_VECTORS );\r\n\tconst maxVaryings = gl.getParameter( gl.MAX_VARYING_VECTORS );\r\n\tconst maxFragmentUniforms = gl.getParameter( gl.MAX_FRAGMENT_UNIFORM_VECTORS );\r\n\r\n\tconst vertexTextures = maxVertexTextures > 0;\r\n\tconst floatFragmentTextures = isWebGL2 || extensions.has( 'OES_texture_float' );\r\n\tconst floatVertexTextures = vertexTextures && floatFragmentTextures;\r\n\r\n\tconst maxSamples = isWebGL2 ? gl.getParameter( gl.MAX_SAMPLES ) : 0;\r\n\r\n\treturn {\r\n\r\n\t\tisWebGL2: isWebGL2,\r\n\r\n\t\tdrawBuffers: drawBuffers,\r\n\r\n\t\tgetMaxAnisotropy: getMaxAnisotropy,\r\n\t\tgetMaxPrecision: getMaxPrecision,\r\n\r\n\t\tprecision: precision,\r\n\t\tlogarithmicDepthBuffer: logarithmicDepthBuffer,\r\n\r\n\t\tmaxTextures: maxTextures,\r\n\t\tmaxVertexTextures: maxVertexTextures,\r\n\t\tmaxTextureSize: maxTextureSize,\r\n\t\tmaxCubemapSize: maxCubemapSize,\r\n\r\n\t\tmaxAttributes: maxAttributes,\r\n\t\tmaxVertexUniforms: maxVertexUniforms,\r\n\t\tmaxVaryings: maxVaryings,\r\n\t\tmaxFragmentUniforms: maxFragmentUniforms,\r\n\r\n\t\tvertexTextures: vertexTextures,\r\n\t\tfloatFragmentTextures: floatFragmentTextures,\r\n\t\tfloatVertexTextures: floatVertexTextures,\r\n\r\n\t\tmaxSamples: maxSamples\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLCapabilities };\r\n", "import { Matrix3 } from '../../math/Matrix3.js';\r\nimport { Plane } from '../../math/Plane.js';\r\n\r\nfunction WebGLClipping( properties ) {\r\n\r\n\tconst scope = this;\r\n\r\n\tlet globalState = null,\r\n\t\tnumGlobalPlanes = 0,\r\n\t\tlocalClippingEnabled = false,\r\n\t\trenderingShadows = false;\r\n\r\n\tconst plane = new Plane(),\r\n\t\tviewNormalMatrix = new Matrix3(),\r\n\r\n\t\tuniform = { value: null, needsUpdate: false };\r\n\r\n\tthis.uniform = uniform;\r\n\tthis.numPlanes = 0;\r\n\tthis.numIntersection = 0;\r\n\r\n\tthis.init = function ( planes, enableLocalClipping, camera ) {\r\n\r\n\t\tconst enabled =\r\n\t\t\tplanes.length !== 0 ||\r\n\t\t\tenableLocalClipping ||\r\n\t\t\t// enable state of previous frame - the clipping code has to\r\n\t\t\t// run another frame in order to reset the state:\r\n\t\t\tnumGlobalPlanes !== 0 ||\r\n\t\t\tlocalClippingEnabled;\r\n\r\n\t\tlocalClippingEnabled = enableLocalClipping;\r\n\r\n\t\tglobalState = projectPlanes( planes, camera, 0 );\r\n\t\tnumGlobalPlanes = planes.length;\r\n\r\n\t\treturn enabled;\r\n\r\n\t};\r\n\r\n\tthis.beginShadows = function () {\r\n\r\n\t\trenderingShadows = true;\r\n\t\tprojectPlanes( null );\r\n\r\n\t};\r\n\r\n\tthis.endShadows = function () {\r\n\r\n\t\trenderingShadows = false;\r\n\t\tresetGlobalState();\r\n\r\n\t};\r\n\r\n\tthis.setState = function ( material, camera, useCache ) {\r\n\r\n\t\tconst planes = material.clippingPlanes,\r\n\t\t\tclipIntersection = material.clipIntersection,\r\n\t\t\tclipShadows = material.clipShadows;\r\n\r\n\t\tconst materialProperties = properties.get( material );\r\n\r\n\t\tif ( ! localClippingEnabled || planes === null || planes.length === 0 || renderingShadows && ! clipShadows ) {\r\n\r\n\t\t\t// there's no local clipping\r\n\r\n\t\t\tif ( renderingShadows ) {\r\n\r\n\t\t\t\t// there's no global clipping\r\n\r\n\t\t\t\tprojectPlanes( null );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tresetGlobalState();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst nGlobal = renderingShadows ? 0 : numGlobalPlanes,\r\n\t\t\t\tlGlobal = nGlobal * 4;\r\n\r\n\t\t\tlet dstArray = materialProperties.clippingState || null;\r\n\r\n\t\t\tuniform.value = dstArray; // ensure unique state\r\n\r\n\t\t\tdstArray = projectPlanes( planes, camera, lGlobal, useCache );\r\n\r\n\t\t\tfor ( let i = 0; i !== lGlobal; ++ i ) {\r\n\r\n\t\t\t\tdstArray[ i ] = globalState[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterialProperties.clippingState = dstArray;\r\n\t\t\tthis.numIntersection = clipIntersection ? this.numPlanes : 0;\r\n\t\t\tthis.numPlanes += nGlobal;\r\n\r\n\t\t}\r\n\r\n\r\n\t};\r\n\r\n\tfunction resetGlobalState() {\r\n\r\n\t\tif ( uniform.value !== globalState ) {\r\n\r\n\t\t\tuniform.value = globalState;\r\n\t\t\tuniform.needsUpdate = numGlobalPlanes > 0;\r\n\r\n\t\t}\r\n\r\n\t\tscope.numPlanes = numGlobalPlanes;\r\n\t\tscope.numIntersection = 0;\r\n\r\n\t}\r\n\r\n\tfunction projectPlanes( planes, camera, dstOffset, skipTransform ) {\r\n\r\n\t\tconst nPlanes = planes !== null ? planes.length : 0;\r\n\t\tlet dstArray = null;\r\n\r\n\t\tif ( nPlanes !== 0 ) {\r\n\r\n\t\t\tdstArray = uniform.value;\r\n\r\n\t\t\tif ( skipTransform !== true || dstArray === null ) {\r\n\r\n\t\t\t\tconst flatSize = dstOffset + nPlanes * 4,\r\n\t\t\t\t\tviewMatrix = camera.matrixWorldInverse;\r\n\r\n\t\t\t\tviewNormalMatrix.getNormalMatrix( viewMatrix );\r\n\r\n\t\t\t\tif ( dstArray === null || dstArray.length < flatSize ) {\r\n\r\n\t\t\t\t\tdstArray = new Float32Array( flatSize );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let i = 0, i4 = dstOffset; i !== nPlanes; ++ i, i4 += 4 ) {\r\n\r\n\t\t\t\t\tplane.copy( planes[ i ] ).applyMatrix4( viewMatrix, viewNormalMatrix );\r\n\r\n\t\t\t\t\tplane.normal.toArray( dstArray, i4 );\r\n\t\t\t\t\tdstArray[ i4 + 3 ] = plane.constant;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniform.value = dstArray;\r\n\t\t\tuniform.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tscope.numPlanes = nPlanes;\r\n\t\tscope.numIntersection = 0;\r\n\r\n\t\treturn dstArray;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { WebGLClipping };\r\n", "let _canvas;\r\n\r\nclass ImageUtils {\r\n\r\n\tstatic getDataURL( image ) {\r\n\r\n\t\tif ( /^data:/i.test( image.src ) ) {\r\n\r\n\t\t\treturn image.src;\r\n\r\n\t\t}\r\n\r\n\t\tif ( typeof HTMLCanvasElement == 'undefined' ) {\r\n\r\n\t\t\treturn image.src;\r\n\r\n\t\t}\r\n\r\n\t\tlet canvas;\r\n\r\n\t\tif ( image instanceof HTMLCanvasElement ) {\r\n\r\n\t\t\tcanvas = image;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( _canvas === undefined ) _canvas = document.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\r\n\r\n\t\t\t_canvas.width = image.width;\r\n\t\t\t_canvas.height = image.height;\r\n\r\n\t\t\tconst context = _canvas.getContext( '2d' );\r\n\r\n\t\t\tif ( image instanceof ImageData ) {\r\n\r\n\t\t\t\tcontext.putImageData( image, 0, 0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcontext.drawImage( image, 0, 0, image.width, image.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcanvas = _canvas;\r\n\r\n\t\t}\r\n\r\n\t\tif ( canvas.width > 2048 || canvas.height > 2048 ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons', image );\r\n\r\n\t\t\treturn canvas.toDataURL( 'image/jpeg', 0.6 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn canvas.toDataURL( 'image/png' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ImageUtils };\r\n", "import { EventDispatcher } from '../core/EventDispatcher.js';\r\nimport {\r\n\tMirroredRepeatWrapping,\r\n\tClampToEdgeWrapping,\r\n\tRepeatWrapping,\r\n\tLinearEncoding,\r\n\tUnsignedByteType,\r\n\tRGBAFormat,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearFilter,\r\n\tUVMapping\r\n} from '../constants.js';\r\nimport * as MathUtils from '../math/MathUtils.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Matrix3 } from '../math/Matrix3.js';\r\nimport { ImageUtils } from '../extras/ImageUtils.js';\r\n\r\nlet textureId = 0;\r\n\r\nclass Texture extends EventDispatcher {\r\n\r\n\tconstructor( image = Texture.DEFAULT_IMAGE, mapping = Texture.DEFAULT_MAPPING, wrapS = ClampToEdgeWrapping, wrapT = ClampToEdgeWrapping, magFilter = LinearFilter, minFilter = LinearMipmapLinearFilter, format = RGBAFormat, type = UnsignedByteType, anisotropy = 1, encoding = LinearEncoding ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tObject.defineProperty( this, 'id', { value: textureId ++ } );\r\n\r\n\t\tthis.uuid = MathUtils.generateUUID();\r\n\r\n\t\tthis.name = '';\r\n\r\n\t\tthis.image = image;\r\n\t\tthis.mipmaps = [];\r\n\r\n\t\tthis.mapping = mapping;\r\n\r\n\t\tthis.wrapS = wrapS;\r\n\t\tthis.wrapT = wrapT;\r\n\r\n\t\tthis.magFilter = magFilter;\r\n\t\tthis.minFilter = minFilter;\r\n\r\n\t\tthis.anisotropy = anisotropy;\r\n\r\n\t\tthis.format = format;\r\n\t\tthis.internalFormat = null;\r\n\t\tthis.type = type;\r\n\r\n\t\tthis.offset = new Vector2( 0, 0 );\r\n\t\tthis.repeat = new Vector2( 1, 1 );\r\n\t\tthis.center = new Vector2( 0, 0 );\r\n\t\tthis.rotation = 0;\r\n\r\n\t\tthis.matrixAutoUpdate = true;\r\n\t\tthis.matrix = new Matrix3();\r\n\r\n\t\tthis.generateMipmaps = true;\r\n\t\tthis.premultiplyAlpha = false;\r\n\t\tthis.flipY = true;\r\n\t\tthis.unpackAlignment = 4;\t// valid values: 1, 2, 4, 8 (see http://www.khronos.org/opengles/sdk/docs/man/xhtml/glPixelStorei.xml)\r\n\r\n\t\t// Values of encoding !== THREE.LinearEncoding only supported on map, envMap and emissiveMap.\r\n\t\t//\r\n\t\t// Also changing the encoding after already used by a Material will not automatically make the Material\r\n\t\t// update. You need to explicitly call Material.needsUpdate to trigger it to recompile.\r\n\t\tthis.encoding = encoding;\r\n\r\n\t\tthis.version = 0;\r\n\t\tthis.onUpdate = null;\r\n\r\n\t\tthis.isRenderTargetTexture = false;\r\n\r\n\t}\r\n\r\n\tupdateMatrix() {\r\n\r\n\t\tthis.matrix.setUvTransform( this.offset.x, this.offset.y, this.repeat.x, this.repeat.y, this.rotation, this.center.x, this.center.y );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tthis.name = source.name;\r\n\r\n\t\tthis.image = source.image;\r\n\t\tthis.mipmaps = source.mipmaps.slice( 0 );\r\n\r\n\t\tthis.mapping = source.mapping;\r\n\r\n\t\tthis.wrapS = source.wrapS;\r\n\t\tthis.wrapT = source.wrapT;\r\n\r\n\t\tthis.magFilter = source.magFilter;\r\n\t\tthis.minFilter = source.minFilter;\r\n\r\n\t\tthis.anisotropy = source.anisotropy;\r\n\r\n\t\tthis.format = source.format;\r\n\t\tthis.internalFormat = source.internalFormat;\r\n\t\tthis.type = source.type;\r\n\r\n\t\tthis.offset.copy( source.offset );\r\n\t\tthis.repeat.copy( source.repeat );\r\n\t\tthis.center.copy( source.center );\r\n\t\tthis.rotation = source.rotation;\r\n\r\n\t\tthis.matrixAutoUpdate = source.matrixAutoUpdate;\r\n\t\tthis.matrix.copy( source.matrix );\r\n\r\n\t\tthis.generateMipmaps = source.generateMipmaps;\r\n\t\tthis.premultiplyAlpha = source.premultiplyAlpha;\r\n\t\tthis.flipY = source.flipY;\r\n\t\tthis.unpackAlignment = source.unpackAlignment;\r\n\t\tthis.encoding = source.encoding;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\ttoJSON( meta ) {\r\n\r\n\t\tconst isRootObject = ( meta === undefined || typeof meta === 'string' );\r\n\r\n\t\tif ( ! isRootObject && meta.textures[ this.uuid ] !== undefined ) {\r\n\r\n\t\t\treturn meta.textures[ this.uuid ];\r\n\r\n\t\t}\r\n\r\n\t\tconst output = {\r\n\r\n\t\t\tmetadata: {\r\n\t\t\t\tversion: 4.5,\r\n\t\t\t\ttype: 'Texture',\r\n\t\t\t\tgenerator: 'Texture.toJSON'\r\n\t\t\t},\r\n\r\n\t\t\tuuid: this.uuid,\r\n\t\t\tname: this.name,\r\n\r\n\t\t\tmapping: this.mapping,\r\n\r\n\t\t\trepeat: [ this.repeat.x, this.repeat.y ],\r\n\t\t\toffset: [ this.offset.x, this.offset.y ],\r\n\t\t\tcenter: [ this.center.x, this.center.y ],\r\n\t\t\trotation: this.rotation,\r\n\r\n\t\t\twrap: [ this.wrapS, this.wrapT ],\r\n\r\n\t\t\tformat: this.format,\r\n\t\t\ttype: this.type,\r\n\t\t\tencoding: this.encoding,\r\n\r\n\t\t\tminFilter: this.minFilter,\r\n\t\t\tmagFilter: this.magFilter,\r\n\t\t\tanisotropy: this.anisotropy,\r\n\r\n\t\t\tflipY: this.flipY,\r\n\r\n\t\t\tpremultiplyAlpha: this.premultiplyAlpha,\r\n\t\t\tunpackAlignment: this.unpackAlignment\r\n\r\n\t\t};\r\n\r\n\t\tif ( this.image !== undefined ) {\r\n\r\n\t\t\t// TODO: Move to THREE.Image\r\n\r\n\t\t\tconst image = this.image;\r\n\r\n\t\t\tif ( image.uuid === undefined ) {\r\n\r\n\t\t\t\timage.uuid = MathUtils.generateUUID(); // UGH\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( ! isRootObject && meta.images[ image.uuid ] === undefined ) {\r\n\r\n\t\t\t\tlet url;\r\n\r\n\t\t\t\tif ( Array.isArray( image ) ) {\r\n\r\n\t\t\t\t\t// process array of images e.g. CubeTexture\r\n\r\n\t\t\t\t\turl = [];\r\n\r\n\t\t\t\t\tfor ( let i = 0, l = image.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\t// check cube texture with data textures\r\n\r\n\t\t\t\t\t\tif ( image[ i ].isDataTexture ) {\r\n\r\n\t\t\t\t\t\t\turl.push( serializeImage( image[ i ].image ) );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\turl.push( serializeImage( image[ i ] ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// process single image\r\n\r\n\t\t\t\t\turl = serializeImage( image );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmeta.images[ image.uuid ] = {\r\n\t\t\t\t\tuuid: image.uuid,\r\n\t\t\t\t\turl: url\r\n\t\t\t\t};\r\n\r\n\t\t\t}\r\n\r\n\t\t\toutput.image = image.uuid;\r\n\r\n\t\t}\r\n\r\n\t\tif ( ! isRootObject ) {\r\n\r\n\t\t\tmeta.textures[ this.uuid ] = output;\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n\ttransformUv( uv ) {\r\n\r\n\t\tif ( this.mapping !== UVMapping ) return uv;\r\n\r\n\t\tuv.applyMatrix3( this.matrix );\r\n\r\n\t\tif ( uv.x < 0 || uv.x > 1 ) {\r\n\r\n\t\t\tswitch ( this.wrapS ) {\r\n\r\n\t\t\t\tcase RepeatWrapping:\r\n\r\n\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase ClampToEdgeWrapping:\r\n\r\n\t\t\t\t\tuv.x = uv.x < 0 ? 0 : 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MirroredRepeatWrapping:\r\n\r\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.x ) % 2 ) === 1 ) {\r\n\r\n\t\t\t\t\t\tuv.x = Math.ceil( uv.x ) - uv.x;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tuv.x = uv.x - Math.floor( uv.x );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( uv.y < 0 || uv.y > 1 ) {\r\n\r\n\t\t\tswitch ( this.wrapT ) {\r\n\r\n\t\t\t\tcase RepeatWrapping:\r\n\r\n\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase ClampToEdgeWrapping:\r\n\r\n\t\t\t\t\tuv.y = uv.y < 0 ? 0 : 1;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MirroredRepeatWrapping:\r\n\r\n\t\t\t\t\tif ( Math.abs( Math.floor( uv.y ) % 2 ) === 1 ) {\r\n\r\n\t\t\t\t\t\tuv.y = Math.ceil( uv.y ) - uv.y;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tuv.y = uv.y - Math.floor( uv.y );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.flipY ) {\r\n\r\n\t\t\tuv.y = 1 - uv.y;\r\n\r\n\t\t}\r\n\r\n\t\treturn uv;\r\n\r\n\t}\r\n\r\n\tset needsUpdate( value ) {\r\n\r\n\t\tif ( value === true ) this.version ++;\r\n\r\n\t}\r\n\r\n}\r\n\r\nTexture.DEFAULT_IMAGE = undefined;\r\nTexture.DEFAULT_MAPPING = UVMapping;\r\n\r\nTexture.prototype.isTexture = true;\r\n\r\nfunction serializeImage( image ) {\r\n\r\n\tif ( ( typeof HTMLImageElement !== 'undefined' && image instanceof HTMLImageElement ) ||\r\n\t\t( typeof HTMLCanvasElement !== 'undefined' && image instanceof HTMLCanvasElement ) ||\r\n\t\t( typeof ImageBitmap !== 'undefined' && image instanceof ImageBitmap ) ) {\r\n\r\n\t\t// default images\r\n\r\n\t\treturn ImageUtils.getDataURL( image );\r\n\r\n\t} else {\r\n\r\n\t\tif ( image.data ) {\r\n\r\n\t\t\t// images of DataTexture\r\n\r\n\t\t\treturn {\r\n\t\t\t\tdata: Array.prototype.slice.call( image.data ),\r\n\t\t\t\twidth: image.width,\r\n\t\t\t\theight: image.height,\r\n\t\t\t\ttype: image.data.constructor.name\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.Texture: Unable to serialize Texture.' );\r\n\t\t\treturn {};\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Texture };\r\n", "import { EventDispatcher } from '../core/EventDispatcher.js';\r\nimport { Texture } from '../textures/Texture.js';\r\nimport { LinearFilter } from '../constants.js';\r\nimport { Vector4 } from '../math/Vector4.js';\r\n\r\n/*\r\n In options, we can specify:\r\n * Texture parameters for an auto-generated target texture\r\n * depthBuffer/stencilBuffer: Booleans to indicate if we should generate these buffers\r\n*/\r\nclass WebGLRenderTarget extends EventDispatcher {\r\n\r\n\tconstructor( width, height, options = {} ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tthis.depth = 1;\r\n\r\n\t\tthis.scissor = new Vector4( 0, 0, width, height );\r\n\t\tthis.scissorTest = false;\r\n\r\n\t\tthis.viewport = new Vector4( 0, 0, width, height );\r\n\r\n\t\tthis.texture = new Texture( undefined, options.mapping, options.wrapS, options.wrapT, options.magFilter, options.minFilter, options.format, options.type, options.anisotropy, options.encoding );\r\n\t\tthis.texture.isRenderTargetTexture = true;\r\n\r\n\t\tthis.texture.image = { width: width, height: height, depth: 1 };\r\n\r\n\t\tthis.texture.generateMipmaps = options.generateMipmaps !== undefined ? options.generateMipmaps : false;\r\n\t\tthis.texture.minFilter = options.minFilter !== undefined ? options.minFilter : LinearFilter;\r\n\r\n\t\tthis.depthBuffer = options.depthBuffer !== undefined ? options.depthBuffer : true;\r\n\t\tthis.stencilBuffer = options.stencilBuffer !== undefined ? options.stencilBuffer : false;\r\n\t\tthis.depthTexture = options.depthTexture !== undefined ? options.depthTexture : null;\r\n\r\n\t}\r\n\r\n\tsetTexture( texture ) {\r\n\r\n\t\ttexture.image = {\r\n\t\t\twidth: this.width,\r\n\t\t\theight: this.height,\r\n\t\t\tdepth: this.depth\r\n\t\t};\r\n\r\n\t\tthis.texture = texture;\r\n\r\n\t}\r\n\r\n\tsetSize( width, height, depth = 1 ) {\r\n\r\n\t\tif ( this.width !== width || this.height !== height || this.depth !== depth ) {\r\n\r\n\t\t\tthis.width = width;\r\n\t\t\tthis.height = height;\r\n\t\t\tthis.depth = depth;\r\n\r\n\t\t\tthis.texture.image.width = width;\r\n\t\t\tthis.texture.image.height = height;\r\n\t\t\tthis.texture.image.depth = depth;\r\n\r\n\t\t\tthis.dispose();\r\n\r\n\t\t}\r\n\r\n\t\tthis.viewport.set( 0, 0, width, height );\r\n\t\tthis.scissor.set( 0, 0, width, height );\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tthis.width = source.width;\r\n\t\tthis.height = source.height;\r\n\t\tthis.depth = source.depth;\r\n\r\n\t\tthis.viewport.copy( source.viewport );\r\n\r\n\t\tthis.texture = source.texture.clone();\r\n\t\tthis.texture.image = { ...this.texture.image }; // See #20328.\r\n\r\n\t\tthis.depthBuffer = source.depthBuffer;\r\n\t\tthis.stencilBuffer = source.stencilBuffer;\r\n\t\tthis.depthTexture = source.depthTexture;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n}\r\n\r\nWebGLRenderTarget.prototype.isWebGLRenderTarget = true;\r\n\r\nexport { WebGLRenderTarget };\r\n", "import { Object3D } from '../core/Object3D.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { PerspectiveCamera } from './PerspectiveCamera.js';\r\n\r\nconst fov = 90, aspect = 1;\r\n\r\nclass CubeCamera extends Object3D {\r\n\r\n\tconstructor( near, far, renderTarget ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'CubeCamera';\r\n\r\n\t\tif ( renderTarget.isWebGLCubeRenderTarget !== true ) {\r\n\r\n\t\t\tconsole.error( 'THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tthis.renderTarget = renderTarget;\r\n\r\n\t\tconst cameraPX = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraPX.layers = this.layers;\r\n\t\tcameraPX.up.set( 0, - 1, 0 );\r\n\t\tcameraPX.lookAt( new Vector3( 1, 0, 0 ) );\r\n\t\tthis.add( cameraPX );\r\n\r\n\t\tconst cameraNX = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraNX.layers = this.layers;\r\n\t\tcameraNX.up.set( 0, - 1, 0 );\r\n\t\tcameraNX.lookAt( new Vector3( - 1, 0, 0 ) );\r\n\t\tthis.add( cameraNX );\r\n\r\n\t\tconst cameraPY = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraPY.layers = this.layers;\r\n\t\tcameraPY.up.set( 0, 0, 1 );\r\n\t\tcameraPY.lookAt( new Vector3( 0, 1, 0 ) );\r\n\t\tthis.add( cameraPY );\r\n\r\n\t\tconst cameraNY = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraNY.layers = this.layers;\r\n\t\tcameraNY.up.set( 0, 0, - 1 );\r\n\t\tcameraNY.lookAt( new Vector3( 0, - 1, 0 ) );\r\n\t\tthis.add( cameraNY );\r\n\r\n\t\tconst cameraPZ = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraPZ.layers = this.layers;\r\n\t\tcameraPZ.up.set( 0, - 1, 0 );\r\n\t\tcameraPZ.lookAt( new Vector3( 0, 0, 1 ) );\r\n\t\tthis.add( cameraPZ );\r\n\r\n\t\tconst cameraNZ = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tcameraNZ.layers = this.layers;\r\n\t\tcameraNZ.up.set( 0, - 1, 0 );\r\n\t\tcameraNZ.lookAt( new Vector3( 0, 0, - 1 ) );\r\n\t\tthis.add( cameraNZ );\r\n\r\n\t}\r\n\r\n\tupdate( renderer, scene ) {\r\n\r\n\t\tif ( this.parent === null ) this.updateMatrixWorld();\r\n\r\n\t\tconst renderTarget = this.renderTarget;\r\n\r\n\t\tconst [ cameraPX, cameraNX, cameraPY, cameraNY, cameraPZ, cameraNZ ] = this.children;\r\n\r\n\t\tconst currentXrEnabled = renderer.xr.enabled;\r\n\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\trenderer.xr.enabled = false;\r\n\r\n\t\tconst generateMipmaps = renderTarget.texture.generateMipmaps;\r\n\r\n\t\trenderTarget.texture.generateMipmaps = false;\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 0 );\r\n\t\trenderer.render( scene, cameraPX );\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 1 );\r\n\t\trenderer.render( scene, cameraNX );\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 2 );\r\n\t\trenderer.render( scene, cameraPY );\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 3 );\r\n\t\trenderer.render( scene, cameraNY );\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 4 );\r\n\t\trenderer.render( scene, cameraPZ );\r\n\r\n\t\trenderTarget.texture.generateMipmaps = generateMipmaps;\r\n\r\n\t\trenderer.setRenderTarget( renderTarget, 5 );\r\n\t\trenderer.render( scene, cameraNZ );\r\n\r\n\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t\trenderer.xr.enabled = currentXrEnabled;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { CubeCamera };\r\n", "import { Texture } from './Texture.js';\r\nimport { CubeReflectionMapping, RGBFormat } from '../constants.js';\r\n\r\nclass CubeTexture extends Texture {\r\n\r\n\tconstructor( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding ) {\r\n\r\n\t\timages = images !== undefined ? images : [];\r\n\t\tmapping = mapping !== undefined ? mapping : CubeReflectionMapping;\r\n\t\tformat = format !== undefined ? format : RGBFormat;\r\n\r\n\t\tsuper( images, mapping, wrapS, wrapT, magFilter, minFilter, format, type, anisotropy, encoding );\r\n\r\n\t\tthis.flipY = false;\r\n\r\n\t}\r\n\r\n\tget images() {\r\n\r\n\t\treturn this.image;\r\n\r\n\t}\r\n\r\n\tset images( value ) {\r\n\r\n\t\tthis.image = value;\r\n\r\n\t}\r\n\r\n}\r\n\r\nCubeTexture.prototype.isCubeTexture = true;\r\n\r\nexport { CubeTexture };\r\n", "import { BackSide, LinearFilter, LinearMipmapLinearFilter, NoBlending, RGBAFormat } from '../constants.js';\r\nimport { Mesh } from '../objects/Mesh.js';\r\nimport { BoxGeometry } from '../geometries/BoxGeometry.js';\r\nimport { ShaderMaterial } from '../materials/ShaderMaterial.js';\r\nimport { cloneUniforms } from './shaders/UniformsUtils.js';\r\nimport { WebGLRenderTarget } from './WebGLRenderTarget.js';\r\nimport { CubeCamera } from '../cameras/CubeCamera.js';\r\nimport { CubeTexture } from '../textures/CubeTexture.js';\r\n\r\nclass WebGLCubeRenderTarget extends WebGLRenderTarget {\r\n\r\n\tconstructor( size, options, dummy ) {\r\n\r\n\t\tif ( Number.isInteger( options ) ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )' );\r\n\r\n\t\t\toptions = dummy;\r\n\r\n\t\t}\r\n\r\n\t\tsuper( size, size, options );\r\n\r\n\t\toptions = options || {};\r\n\r\n\t\t// By convention -- likely based on the RenderMan spec from the 1990's -- cube maps are specified by WebGL (and three.js)\r\n\t\t// in a coordinate system in which positive-x is to the right when looking up the positive-z axis -- in other words,\r\n\t\t// in a left-handed coordinate system. By continuing this convention, preexisting cube maps continued to render correctly.\r\n\r\n\t\t// three.js uses a right-handed coordinate system. So environment maps used in three.js appear to have px and nx swapped\r\n\t\t// and the flag isRenderTargetTexture controls this conversion. The flip is not required when using WebGLCubeRenderTarget.texture\r\n\t\t// as a cube texture (this is detected when isRenderTargetTexture is set to true for cube textures).\r\n\r\n\t\tthis.texture = new CubeTexture( undefined, options.mapping, options.wrapS, options.wrapT, options.magFilter, options.minFilter, options.format, options.type, options.anisotropy, options.encoding );\r\n\t\tthis.texture.isRenderTargetTexture = true;\r\n\r\n\t\tthis.texture.generateMipmaps = options.generateMipmaps !== undefined ? options.generateMipmaps : false;\r\n\t\tthis.texture.minFilter = options.minFilter !== undefined ? options.minFilter : LinearFilter;\r\n\r\n\t\tthis.texture._needsFlipEnvMap = false;\r\n\r\n\t}\r\n\r\n\tfromEquirectangularTexture( renderer, texture ) {\r\n\r\n\t\tthis.texture.type = texture.type;\r\n\t\tthis.texture.format = RGBAFormat; // see #18859\r\n\t\tthis.texture.encoding = texture.encoding;\r\n\r\n\t\tthis.texture.generateMipmaps = texture.generateMipmaps;\r\n\t\tthis.texture.minFilter = texture.minFilter;\r\n\t\tthis.texture.magFilter = texture.magFilter;\r\n\r\n\t\tconst shader = {\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\ttEquirect: { value: null },\r\n\t\t\t},\r\n\r\n\t\t\tvertexShader: /* glsl */`\r\n\r\n\t\t\t\tvarying vec3 vWorldDirection;\r\n\r\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\r\n\r\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvoid main() {\r\n\r\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\r\n\r\n\t\t\t\t\t#include <begin_vertex>\r\n\t\t\t\t\t#include <project_vertex>\r\n\r\n\t\t\t\t}\r\n\t\t\t`,\r\n\r\n\t\t\tfragmentShader: /* glsl */`\r\n\r\n\t\t\t\tuniform sampler2D tEquirect;\r\n\r\n\t\t\t\tvarying vec3 vWorldDirection;\r\n\r\n\t\t\t\t#include <common>\r\n\r\n\t\t\t\tvoid main() {\r\n\r\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\r\n\r\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\r\n\r\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\r\n\r\n\t\t\t\t}\r\n\t\t\t`\r\n\t\t};\r\n\r\n\t\tconst geometry = new BoxGeometry( 5, 5, 5 );\r\n\r\n\t\tconst material = new ShaderMaterial( {\r\n\r\n\t\t\tname: 'CubemapFromEquirect',\r\n\r\n\t\t\tuniforms: cloneUniforms( shader.uniforms ),\r\n\t\t\tvertexShader: shader.vertexShader,\r\n\t\t\tfragmentShader: shader.fragmentShader,\r\n\t\t\tside: BackSide,\r\n\t\t\tblending: NoBlending\r\n\r\n\t\t} );\r\n\r\n\t\tmaterial.uniforms.tEquirect.value = texture;\r\n\r\n\t\tconst mesh = new Mesh( geometry, material );\r\n\r\n\t\tconst currentMinFilter = texture.minFilter;\r\n\r\n\t\t// Avoid blurred poles\r\n\t\tif ( texture.minFilter === LinearMipmapLinearFilter ) texture.minFilter = LinearFilter;\r\n\r\n\t\tconst camera = new CubeCamera( 1, 10, this );\r\n\t\tcamera.update( renderer, mesh );\r\n\r\n\t\ttexture.minFilter = currentMinFilter;\r\n\r\n\t\tmesh.geometry.dispose();\r\n\t\tmesh.material.dispose();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclear( renderer, color, depth, stencil ) {\r\n\r\n\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\trenderer.setRenderTarget( this, i );\r\n\r\n\t\t\trenderer.clear( color, depth, stencil );\r\n\r\n\t\t}\r\n\r\n\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t}\r\n\r\n}\r\n\r\nWebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget = true;\r\n\r\nexport { WebGLCubeRenderTarget };\r\n", "import { CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from '../../constants.js';\r\nimport { WebGLCubeRenderTarget } from '../WebGLCubeRenderTarget.js';\r\n\r\nfunction WebGLCubeMaps( renderer ) {\r\n\r\n\tlet cubemaps = new WeakMap();\r\n\r\n\tfunction mapTextureMapping( texture, mapping ) {\r\n\r\n\t\tif ( mapping === EquirectangularReflectionMapping ) {\r\n\r\n\t\t\ttexture.mapping = CubeReflectionMapping;\r\n\r\n\t\t} else if ( mapping === EquirectangularRefractionMapping ) {\r\n\r\n\t\t\ttexture.mapping = CubeRefractionMapping;\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tfunction get( texture ) {\r\n\r\n\t\tif ( texture && texture.isTexture && texture.isRenderTargetTexture === false ) {\r\n\r\n\t\t\tconst mapping = texture.mapping;\r\n\r\n\t\t\tif ( mapping === EquirectangularReflectionMapping || mapping === EquirectangularRefractionMapping ) {\r\n\r\n\t\t\t\tif ( cubemaps.has( texture ) ) {\r\n\r\n\t\t\t\t\tconst cubemap = cubemaps.get( texture ).texture;\r\n\t\t\t\t\treturn mapTextureMapping( cubemap, texture.mapping );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst image = texture.image;\r\n\r\n\t\t\t\t\tif ( image && image.height > 0 ) {\r\n\r\n\t\t\t\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\t\t\t\t\tconst renderTarget = new WebGLCubeRenderTarget( image.height / 2 );\r\n\t\t\t\t\t\trenderTarget.fromEquirectangularTexture( renderer, texture );\r\n\t\t\t\t\t\tcubemaps.set( texture, renderTarget );\r\n\r\n\t\t\t\t\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\t\t\t\treturn mapTextureMapping( renderTarget.texture, texture.mapping );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// image not yet ready. try the conversion next frame\r\n\r\n\t\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tfunction onTextureDispose( event ) {\r\n\r\n\t\tconst texture = event.target;\r\n\r\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\tconst cubemap = cubemaps.get( texture );\r\n\r\n\t\tif ( cubemap !== undefined ) {\r\n\r\n\t\t\tcubemaps.delete( texture );\r\n\t\t\tcubemap.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\tcubemaps = new WeakMap();\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tget: get,\r\n\t\tdispose: dispose\r\n\t};\r\n\r\n}\r\n\r\nexport { WebGLCubeMaps };\r\n", "import { ShaderMaterial } from './ShaderMaterial.js';\r\n\r\nclass RawShaderMaterial extends ShaderMaterial {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper( parameters );\r\n\r\n\t\tthis.type = 'RawShaderMaterial';\r\n\r\n\t}\r\n\r\n}\r\n\r\nRawShaderMaterial.prototype.isRawShaderMaterial = true;\r\n\r\nexport { RawShaderMaterial };\r\n", "import {\r\n\tCubeUVReflectionMapping,\r\n\tGammaEncoding,\r\n\tLinearEncoding,\r\n\tNoToneMapping,\r\n\tNearestFilter,\r\n\tNoBlending,\r\n\tRGBDEncoding,\r\n\tRGBEEncoding,\r\n\tRGBEFormat,\r\n\tRGBM16Encoding,\r\n\tRGBM7Encoding,\r\n\tUnsignedByteType,\r\n\tsRGBEncoding\r\n} from '../constants.js';\r\n\r\nimport { BufferAttribute } from '../core/BufferAttribute.js';\r\nimport { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Mesh } from '../objects/Mesh.js';\r\nimport { OrthographicCamera } from '../cameras/OrthographicCamera.js';\r\nimport { PerspectiveCamera } from '../cameras/PerspectiveCamera.js';\r\nimport { RawShaderMaterial } from '../materials/RawShaderMaterial.js';\r\nimport { Vector2 } from '../math/Vector2.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Color } from '../math/Color.js';\r\nimport { WebGLRenderTarget } from '../renderers/WebGLRenderTarget.js';\r\nimport { MeshBasicMaterial } from '../materials/MeshBasicMaterial.js';\r\nimport { BoxGeometry } from '../geometries/BoxGeometry.js';\r\nimport { BackSide } from '../constants.js';\r\n\r\nconst LOD_MIN = 4;\r\nconst LOD_MAX = 8;\r\nconst SIZE_MAX = Math.pow( 2, LOD_MAX );\r\n\r\n// The standard deviations (radians) associated with the extra mips. These are\r\n// chosen to approximate a Trowbridge-Reitz distribution function times the\r\n// geometric shadowing function. These sigma values squared must match the\r\n// variance #defines in cube_uv_reflection_fragment.glsl.js.\r\nconst EXTRA_LOD_SIGMA = [ 0.125, 0.215, 0.35, 0.446, 0.526, 0.582 ];\r\n\r\nconst TOTAL_LODS = LOD_MAX - LOD_MIN + 1 + EXTRA_LOD_SIGMA.length;\r\n\r\n// The maximum length of the blur for loop. Smaller sigmas will use fewer\r\n// samples and exit early, but not recompile the shader.\r\nconst MAX_SAMPLES = 20;\r\n\r\nconst ENCODINGS = {\r\n\t[ LinearEncoding ]: 0,\r\n\t[ sRGBEncoding ]: 1,\r\n\t[ RGBEEncoding ]: 2,\r\n\t[ RGBM7Encoding ]: 3,\r\n\t[ RGBM16Encoding ]: 4,\r\n\t[ RGBDEncoding ]: 5,\r\n\t[ GammaEncoding ]: 6\r\n};\r\n\r\nconst backgroundMaterial = new MeshBasicMaterial( {\r\n\tside: BackSide,\r\n\tdepthWrite: false,\r\n\tdepthTest: false,\r\n} );\r\nconst backgroundBox = new Mesh( new BoxGeometry(), backgroundMaterial );\r\n\r\nconst _flatCamera = /*@__PURE__*/ new OrthographicCamera();\r\nconst { _lodPlanes, _sizeLods, _sigmas } = /*@__PURE__*/ _createPlanes();\r\nconst _clearColor = /*@__PURE__*/ new Color();\r\nlet _oldTarget = null;\r\n\r\n// Golden Ratio\r\nconst PHI = ( 1 + Math.sqrt( 5 ) ) / 2;\r\nconst INV_PHI = 1 / PHI;\r\n\r\n// Vertices of a dodecahedron (except the opposites, which represent the\r\n// same axis), used as axis directions evenly spread on a sphere.\r\nconst _axisDirections = [\r\n\t/*@__PURE__*/ new Vector3( 1, 1, 1 ),\r\n\t/*@__PURE__*/ new Vector3( - 1, 1, 1 ),\r\n\t/*@__PURE__*/ new Vector3( 1, 1, - 1 ),\r\n\t/*@__PURE__*/ new Vector3( - 1, 1, - 1 ),\r\n\t/*@__PURE__*/ new Vector3( 0, PHI, INV_PHI ),\r\n\t/*@__PURE__*/ new Vector3( 0, PHI, - INV_PHI ),\r\n\t/*@__PURE__*/ new Vector3( INV_PHI, 0, PHI ),\r\n\t/*@__PURE__*/ new Vector3( - INV_PHI, 0, PHI ),\r\n\t/*@__PURE__*/ new Vector3( PHI, INV_PHI, 0 ),\r\n\t/*@__PURE__*/ new Vector3( - PHI, INV_PHI, 0 ) ];\r\n\r\n/**\r\n * This class generates a Prefiltered, Mipmapped Radiance Environment Map\r\n * (PMREM) from a cubeMap environment texture. This allows different levels of\r\n * blur to be quickly accessed based on material roughness. It is packed into a\r\n * special CubeUV format that allows us to perform custom interpolation so that\r\n * we can support nonlinear formats such as RGBE. Unlike a traditional mipmap\r\n * chain, it only goes down to the LOD_MIN level (above), and then creates extra\r\n * even more filtered 'mips' at the same LOD_MIN resolution, associated with\r\n * higher roughness levels. In this way we maintain resolution to smoothly\r\n * interpolate diffuse lighting while limiting sampling computation.\r\n *\r\n * Paper: Fast, Accurate Image-Based Lighting\r\n * https://drive.google.com/file/d/15y8r_UpKlU9SvV4ILb0C3qCPecS8pvLz/view\r\n*/\r\n\r\nfunction convertLinearToRGBE( color ) {\r\n\r\n\tconst maxComponent = Math.max( color.r, color.g, color.b );\r\n\tconst fExp = Math.min( Math.max( Math.ceil( Math.log2( maxComponent ) ), - 128.0 ), 127.0 );\r\n\tcolor.multiplyScalar( Math.pow( 2.0, - fExp ) );\r\n\r\n\tconst alpha = ( fExp + 128.0 ) / 255.0;\r\n\treturn alpha;\r\n\r\n}\r\n\r\nclass PMREMGenerator {\r\n\r\n\tconstructor( renderer ) {\r\n\r\n\t\tthis._renderer = renderer;\r\n\t\tthis._pingPongRenderTarget = null;\r\n\r\n\t\tthis._blurMaterial = _getBlurShader( MAX_SAMPLES );\r\n\t\tthis._equirectShader = null;\r\n\t\tthis._cubemapShader = null;\r\n\r\n\t\tthis._compileMaterial( this._blurMaterial );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a PMREM from a supplied Scene, which can be faster than using an\r\n\t * image if networking bandwidth is low. Optional sigma specifies a blur radius\r\n\t * in radians to be applied to the scene before PMREM generation. Optional near\r\n\t * and far planes ensure the scene is rendered in its entirety (the cubeCamera\r\n\t * is placed at the origin).\r\n\t */\r\n\tfromScene( scene, sigma = 0, near = 0.1, far = 100 ) {\r\n\r\n\t\t_oldTarget = this._renderer.getRenderTarget();\r\n\t\tconst cubeUVRenderTarget = this._allocateTargets();\r\n\r\n\t\tthis._sceneToCubeUV( scene, near, far, cubeUVRenderTarget );\r\n\t\tif ( sigma > 0 ) {\r\n\r\n\t\t\tthis._blur( cubeUVRenderTarget, 0, 0, sigma );\r\n\r\n\t\t}\r\n\r\n\t\tthis._applyPMREM( cubeUVRenderTarget );\r\n\t\tthis._cleanup( cubeUVRenderTarget );\r\n\r\n\t\treturn cubeUVRenderTarget;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a PMREM from an equirectangular texture, which can be either LDR\r\n\t * (RGBFormat) or HDR (RGBEFormat). The ideal input image size is 1k (1024 x 512),\r\n\t * as this matches best with the 256 x 256 cubemap output.\r\n\t */\r\n\tfromEquirectangular( equirectangular ) {\r\n\r\n\t\treturn this._fromTexture( equirectangular );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a PMREM from an cubemap texture, which can be either LDR\r\n\t * (RGBFormat) or HDR (RGBEFormat). The ideal input cube size is 256 x 256,\r\n\t * as this matches best with the 256 x 256 cubemap output.\r\n\t */\r\n\tfromCubemap( cubemap ) {\r\n\r\n\t\treturn this._fromTexture( cubemap );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Pre-compiles the cubemap shader. You can get faster start-up by invoking this method during\r\n\t * your texture's network fetch for increased concurrency.\r\n\t */\r\n\tcompileCubemapShader() {\r\n\r\n\t\tif ( this._cubemapShader === null ) {\r\n\r\n\t\t\tthis._cubemapShader = _getCubemapShader();\r\n\t\t\tthis._compileMaterial( this._cubemapShader );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Pre-compiles the equirectangular shader. You can get faster start-up by invoking this method during\r\n\t * your texture's network fetch for increased concurrency.\r\n\t */\r\n\tcompileEquirectangularShader() {\r\n\r\n\t\tif ( this._equirectShader === null ) {\r\n\r\n\t\t\tthis._equirectShader = _getEquirectShader();\r\n\t\t\tthis._compileMaterial( this._equirectShader );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes of the PMREMGenerator's internal memory. Note that PMREMGenerator is a static class,\r\n\t * so you should not need more than one PMREMGenerator object. If you do, calling dispose() on\r\n\t * one of them will cause any others to also become unusable.\r\n\t */\r\n\tdispose() {\r\n\r\n\t\tthis._blurMaterial.dispose();\r\n\r\n\t\tif ( this._cubemapShader !== null ) this._cubemapShader.dispose();\r\n\t\tif ( this._equirectShader !== null ) this._equirectShader.dispose();\r\n\r\n\t\tfor ( let i = 0; i < _lodPlanes.length; i ++ ) {\r\n\r\n\t\t\t_lodPlanes[ i ].dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// private interface\r\n\r\n\t_cleanup( outputTarget ) {\r\n\r\n\t\tthis._pingPongRenderTarget.dispose();\r\n\t\tthis._renderer.setRenderTarget( _oldTarget );\r\n\t\toutputTarget.scissorTest = false;\r\n\t\t_setViewport( outputTarget, 0, 0, outputTarget.width, outputTarget.height );\r\n\r\n\t}\r\n\r\n\t_fromTexture( texture ) {\r\n\r\n\t\t_oldTarget = this._renderer.getRenderTarget();\r\n\t\tconst cubeUVRenderTarget = this._allocateTargets( texture );\r\n\t\tthis._textureToCubeUV( texture, cubeUVRenderTarget );\r\n\t\tthis._applyPMREM( cubeUVRenderTarget );\r\n\t\tthis._cleanup( cubeUVRenderTarget );\r\n\r\n\t\treturn cubeUVRenderTarget;\r\n\r\n\t}\r\n\r\n\t_allocateTargets( texture ) { // warning: null texture is valid\r\n\r\n\t\tconst params = {\r\n\t\t\tmagFilter: NearestFilter,\r\n\t\t\tminFilter: NearestFilter,\r\n\t\t\tgenerateMipmaps: false,\r\n\t\t\ttype: UnsignedByteType,\r\n\t\t\tformat: RGBEFormat,\r\n\t\t\tencoding: _isLDR( texture ) ? texture.encoding : RGBEEncoding,\r\n\t\t\tdepthBuffer: false\r\n\t\t};\r\n\r\n\t\tconst cubeUVRenderTarget = _createRenderTarget( params );\r\n\t\tcubeUVRenderTarget.depthBuffer = texture ? false : true;\r\n\t\tthis._pingPongRenderTarget = _createRenderTarget( params );\r\n\t\treturn cubeUVRenderTarget;\r\n\r\n\t}\r\n\r\n\t_compileMaterial( material ) {\r\n\r\n\t\tconst tmpMesh = new Mesh( _lodPlanes[ 0 ], material );\r\n\t\tthis._renderer.compile( tmpMesh, _flatCamera );\r\n\r\n\t}\r\n\r\n\t_sceneToCubeUV( scene, near, far, cubeUVRenderTarget ) {\r\n\r\n\t\tconst fov = 90;\r\n\t\tconst aspect = 1;\r\n\t\tconst cubeCamera = new PerspectiveCamera( fov, aspect, near, far );\r\n\t\tconst upSign = [ 1, - 1, 1, 1, 1, 1 ];\r\n\t\tconst forwardSign = [ 1, 1, 1, - 1, - 1, - 1 ];\r\n\t\tconst renderer = this._renderer;\r\n\r\n\t\tconst originalAutoClear = renderer.autoClear;\r\n\t\tconst outputEncoding = renderer.outputEncoding;\r\n\t\tconst toneMapping = renderer.toneMapping;\r\n\t\trenderer.getClearColor( _clearColor );\r\n\r\n\t\trenderer.toneMapping = NoToneMapping;\r\n\t\trenderer.outputEncoding = LinearEncoding;\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\tlet useSolidColor = false;\r\n\t\tconst background = scene.background;\r\n\t\tif ( background ) {\r\n\r\n\t\t\tif ( background.isColor ) {\r\n\r\n\t\t\t\tbackgroundMaterial.color.copy( background ).convertSRGBToLinear();\r\n\t\t\t\tscene.background = null;\r\n\r\n\t\t\t\tconst alpha = convertLinearToRGBE( backgroundMaterial.color );\r\n\t\t\t\tbackgroundMaterial.opacity = alpha;\r\n\t\t\t\tuseSolidColor = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tbackgroundMaterial.color.copy( _clearColor ).convertSRGBToLinear();\r\n\r\n\t\t\tconst alpha = convertLinearToRGBE( backgroundMaterial.color );\r\n\t\t\tbackgroundMaterial.opacity = alpha;\r\n\t\t\tuseSolidColor = true;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tconst col = i % 3;\r\n\t\t\tif ( col == 0 ) {\r\n\r\n\t\t\t\tcubeCamera.up.set( 0, upSign[ i ], 0 );\r\n\t\t\t\tcubeCamera.lookAt( forwardSign[ i ], 0, 0 );\r\n\r\n\t\t\t} else if ( col == 1 ) {\r\n\r\n\t\t\t\tcubeCamera.up.set( 0, 0, upSign[ i ] );\r\n\t\t\t\tcubeCamera.lookAt( 0, forwardSign[ i ], 0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcubeCamera.up.set( 0, upSign[ i ], 0 );\r\n\t\t\t\tcubeCamera.lookAt( 0, 0, forwardSign[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_setViewport( cubeUVRenderTarget,\r\n\t\t\t\tcol * SIZE_MAX, i > 2 ? SIZE_MAX : 0, SIZE_MAX, SIZE_MAX );\r\n\t\t\trenderer.setRenderTarget( cubeUVRenderTarget );\r\n\r\n\t\t\tif ( useSolidColor ) {\r\n\r\n\t\t\t\trenderer.render( backgroundBox, cubeCamera );\r\n\r\n\t\t\t}\r\n\r\n\t\t\trenderer.render( scene, cubeCamera );\r\n\r\n\t\t}\r\n\r\n\t\trenderer.toneMapping = toneMapping;\r\n\t\trenderer.outputEncoding = outputEncoding;\r\n\t\trenderer.autoClear = originalAutoClear;\r\n\t\tscene.background = background;\r\n\r\n\t}\r\n\r\n\t_textureToCubeUV( texture, cubeUVRenderTarget ) {\r\n\r\n\t\tconst renderer = this._renderer;\r\n\r\n\t\tif ( texture.isCubeTexture ) {\r\n\r\n\t\t\tif ( this._cubemapShader == null ) {\r\n\r\n\t\t\t\tthis._cubemapShader = _getCubemapShader();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( this._equirectShader == null ) {\r\n\r\n\t\t\t\tthis._equirectShader = _getEquirectShader();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst material = texture.isCubeTexture ? this._cubemapShader : this._equirectShader;\r\n\t\tconst mesh = new Mesh( _lodPlanes[ 0 ], material );\r\n\r\n\t\tconst uniforms = material.uniforms;\r\n\r\n\t\tuniforms[ 'envMap' ].value = texture;\r\n\r\n\t\tif ( ! texture.isCubeTexture ) {\r\n\r\n\t\t\tuniforms[ 'texelSize' ].value.set( 1.0 / texture.image.width, 1.0 / texture.image.height );\r\n\r\n\t\t}\r\n\r\n\t\tuniforms[ 'inputEncoding' ].value = ENCODINGS[ texture.encoding ];\r\n\t\tuniforms[ 'outputEncoding' ].value = ENCODINGS[ cubeUVRenderTarget.texture.encoding ];\r\n\r\n\t\t_setViewport( cubeUVRenderTarget, 0, 0, 3 * SIZE_MAX, 2 * SIZE_MAX );\r\n\r\n\t\trenderer.setRenderTarget( cubeUVRenderTarget );\r\n\t\trenderer.render( mesh, _flatCamera );\r\n\r\n\t}\r\n\r\n\t_applyPMREM( cubeUVRenderTarget ) {\r\n\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst autoClear = renderer.autoClear;\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\tfor ( let i = 1; i < TOTAL_LODS; i ++ ) {\r\n\r\n\t\t\tconst sigma = Math.sqrt( _sigmas[ i ] * _sigmas[ i ] - _sigmas[ i - 1 ] * _sigmas[ i - 1 ] );\r\n\r\n\t\t\tconst poleAxis = _axisDirections[ ( i - 1 ) % _axisDirections.length ];\r\n\r\n\t\t\tthis._blur( cubeUVRenderTarget, i - 1, i, sigma, poleAxis );\r\n\r\n\t\t}\r\n\r\n\t\trenderer.autoClear = autoClear;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * This is a two-pass Gaussian blur for a cubemap. Normally this is done\r\n\t * vertically and horizontally, but this breaks down on a cube. Here we apply\r\n\t * the blur latitudinally (around the poles), and then longitudinally (towards\r\n\t * the poles) to approximate the orthogonally-separable blur. It is least\r\n\t * accurate at the poles, but still does a decent job.\r\n\t */\r\n\t_blur( cubeUVRenderTarget, lodIn, lodOut, sigma, poleAxis ) {\r\n\r\n\t\tconst pingPongRenderTarget = this._pingPongRenderTarget;\r\n\r\n\t\tthis._halfBlur(\r\n\t\t\tcubeUVRenderTarget,\r\n\t\t\tpingPongRenderTarget,\r\n\t\t\tlodIn,\r\n\t\t\tlodOut,\r\n\t\t\tsigma,\r\n\t\t\t'latitudinal',\r\n\t\t\tpoleAxis );\r\n\r\n\t\tthis._halfBlur(\r\n\t\t\tpingPongRenderTarget,\r\n\t\t\tcubeUVRenderTarget,\r\n\t\t\tlodOut,\r\n\t\t\tlodOut,\r\n\t\t\tsigma,\r\n\t\t\t'longitudinal',\r\n\t\t\tpoleAxis );\r\n\r\n\t}\r\n\r\n\t_halfBlur( targetIn, targetOut, lodIn, lodOut, sigmaRadians, direction, poleAxis ) {\r\n\r\n\t\tconst renderer = this._renderer;\r\n\t\tconst blurMaterial = this._blurMaterial;\r\n\r\n\t\tif ( direction !== 'latitudinal' && direction !== 'longitudinal' ) {\r\n\r\n\t\t\tconsole.error(\r\n\t\t\t\t'blur direction must be either latitudinal or longitudinal!' );\r\n\r\n\t\t}\r\n\r\n\t\t// Number of standard deviations at which to cut off the discrete approximation.\r\n\t\tconst STANDARD_DEVIATIONS = 3;\r\n\r\n\t\tconst blurMesh = new Mesh( _lodPlanes[ lodOut ], blurMaterial );\r\n\t\tconst blurUniforms = blurMaterial.uniforms;\r\n\r\n\t\tconst pixels = _sizeLods[ lodIn ] - 1;\r\n\t\tconst radiansPerPixel = isFinite( sigmaRadians ) ? Math.PI / ( 2 * pixels ) : 2 * Math.PI / ( 2 * MAX_SAMPLES - 1 );\r\n\t\tconst sigmaPixels = sigmaRadians / radiansPerPixel;\r\n\t\tconst samples = isFinite( sigmaRadians ) ? 1 + Math.floor( STANDARD_DEVIATIONS * sigmaPixels ) : MAX_SAMPLES;\r\n\r\n\t\tif ( samples > MAX_SAMPLES ) {\r\n\r\n\t\t\tconsole.warn( `sigmaRadians, ${\r\n\t\t\t\tsigmaRadians}, is too large and will clip, as it requested ${\r\n\t\t\t\tsamples} samples when the maximum is set to ${MAX_SAMPLES}` );\r\n\r\n\t\t}\r\n\r\n\t\tconst weights = [];\r\n\t\tlet sum = 0;\r\n\r\n\t\tfor ( let i = 0; i < MAX_SAMPLES; ++ i ) {\r\n\r\n\t\t\tconst x = i / sigmaPixels;\r\n\t\t\tconst weight = Math.exp( - x * x / 2 );\r\n\t\t\tweights.push( weight );\r\n\r\n\t\t\tif ( i == 0 ) {\r\n\r\n\t\t\t\tsum += weight;\r\n\r\n\t\t\t} else if ( i < samples ) {\r\n\r\n\t\t\t\tsum += 2 * weight;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfor ( let i = 0; i < weights.length; i ++ ) {\r\n\r\n\t\t\tweights[ i ] = weights[ i ] / sum;\r\n\r\n\t\t}\r\n\r\n\t\tblurUniforms[ 'envMap' ].value = targetIn.texture;\r\n\t\tblurUniforms[ 'samples' ].value = samples;\r\n\t\tblurUniforms[ 'weights' ].value = weights;\r\n\t\tblurUniforms[ 'latitudinal' ].value = direction === 'latitudinal';\r\n\r\n\t\tif ( poleAxis ) {\r\n\r\n\t\t\tblurUniforms[ 'poleAxis' ].value = poleAxis;\r\n\r\n\t\t}\r\n\r\n\t\tblurUniforms[ 'dTheta' ].value = radiansPerPixel;\r\n\t\tblurUniforms[ 'mipInt' ].value = LOD_MAX - lodIn;\r\n\t\tblurUniforms[ 'inputEncoding' ].value = ENCODINGS[ targetIn.texture.encoding ];\r\n\t\tblurUniforms[ 'outputEncoding' ].value = ENCODINGS[ targetIn.texture.encoding ];\r\n\r\n\t\tconst outputSize = _sizeLods[ lodOut ];\r\n\t\tconst x = 3 * Math.max( 0, SIZE_MAX - 2 * outputSize );\r\n\t\tconst y = ( lodOut === 0 ? 0 : 2 * SIZE_MAX ) + 2 * outputSize * ( lodOut > LOD_MAX - LOD_MIN ? lodOut - LOD_MAX + LOD_MIN : 0 );\r\n\r\n\t\t_setViewport( targetOut, x, y, 3 * outputSize, 2 * outputSize );\r\n\t\trenderer.setRenderTarget( targetOut );\r\n\t\trenderer.render( blurMesh, _flatCamera );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction _isLDR( texture ) {\r\n\r\n\tif ( texture === undefined || texture.type !== UnsignedByteType ) return false;\r\n\r\n\treturn texture.encoding === LinearEncoding || texture.encoding === sRGBEncoding || texture.encoding === GammaEncoding;\r\n\r\n}\r\n\r\nfunction _createPlanes() {\r\n\r\n\tconst _lodPlanes = [];\r\n\tconst _sizeLods = [];\r\n\tconst _sigmas = [];\r\n\r\n\tlet lod = LOD_MAX;\r\n\r\n\tfor ( let i = 0; i < TOTAL_LODS; i ++ ) {\r\n\r\n\t\tconst sizeLod = Math.pow( 2, lod );\r\n\t\t_sizeLods.push( sizeLod );\r\n\t\tlet sigma = 1.0 / sizeLod;\r\n\r\n\t\tif ( i > LOD_MAX - LOD_MIN ) {\r\n\r\n\t\t\tsigma = EXTRA_LOD_SIGMA[ i - LOD_MAX + LOD_MIN - 1 ];\r\n\r\n\t\t} else if ( i == 0 ) {\r\n\r\n\t\t\tsigma = 0;\r\n\r\n\t\t}\r\n\r\n\t\t_sigmas.push( sigma );\r\n\r\n\t\tconst texelSize = 1.0 / ( sizeLod - 1 );\r\n\t\tconst min = - texelSize / 2;\r\n\t\tconst max = 1 + texelSize / 2;\r\n\t\tconst uv1 = [ min, min, max, min, max, max, min, min, max, max, min, max ];\r\n\r\n\t\tconst cubeFaces = 6;\r\n\t\tconst vertices = 6;\r\n\t\tconst positionSize = 3;\r\n\t\tconst uvSize = 2;\r\n\t\tconst faceIndexSize = 1;\r\n\r\n\t\tconst position = new Float32Array( positionSize * vertices * cubeFaces );\r\n\t\tconst uv = new Float32Array( uvSize * vertices * cubeFaces );\r\n\t\tconst faceIndex = new Float32Array( faceIndexSize * vertices * cubeFaces );\r\n\r\n\t\tfor ( let face = 0; face < cubeFaces; face ++ ) {\r\n\r\n\t\t\tconst x = ( face % 3 ) * 2 / 3 - 1;\r\n\t\t\tconst y = face > 2 ? 0 : - 1;\r\n\t\t\tconst coordinates = [\r\n\t\t\t\tx, y, 0,\r\n\t\t\t\tx + 2 / 3, y, 0,\r\n\t\t\t\tx + 2 / 3, y + 1, 0,\r\n\t\t\t\tx, y, 0,\r\n\t\t\t\tx + 2 / 3, y + 1, 0,\r\n\t\t\t\tx, y + 1, 0\r\n\t\t\t];\r\n\t\t\tposition.set( coordinates, positionSize * vertices * face );\r\n\t\t\tuv.set( uv1, uvSize * vertices * face );\r\n\t\t\tconst fill = [ face, face, face, face, face, face ];\r\n\t\t\tfaceIndex.set( fill, faceIndexSize * vertices * face );\r\n\r\n\t\t}\r\n\r\n\t\tconst planes = new BufferGeometry();\r\n\t\tplanes.setAttribute( 'position', new BufferAttribute( position, positionSize ) );\r\n\t\tplanes.setAttribute( 'uv', new BufferAttribute( uv, uvSize ) );\r\n\t\tplanes.setAttribute( 'faceIndex', new BufferAttribute( faceIndex, faceIndexSize ) );\r\n\t\t_lodPlanes.push( planes );\r\n\r\n\t\tif ( lod > LOD_MIN ) {\r\n\r\n\t\t\tlod --;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn { _lodPlanes, _sizeLods, _sigmas };\r\n\r\n}\r\n\r\nfunction _createRenderTarget( params ) {\r\n\r\n\tconst cubeUVRenderTarget = new WebGLRenderTarget( 3 * SIZE_MAX, 3 * SIZE_MAX, params );\r\n\tcubeUVRenderTarget.texture.mapping = CubeUVReflectionMapping;\r\n\tcubeUVRenderTarget.texture.name = 'PMREM.cubeUv';\r\n\tcubeUVRenderTarget.scissorTest = true;\r\n\treturn cubeUVRenderTarget;\r\n\r\n}\r\n\r\nfunction _setViewport( target, x, y, width, height ) {\r\n\r\n\ttarget.viewport.set( x, y, width, height );\r\n\ttarget.scissor.set( x, y, width, height );\r\n\r\n}\r\n\r\nfunction _getBlurShader( maxSamples ) {\r\n\r\n\tconst weights = new Float32Array( maxSamples );\r\n\tconst poleAxis = new Vector3( 0, 1, 0 );\r\n\tconst shaderMaterial = new RawShaderMaterial( {\r\n\r\n\t\tname: 'SphericalGaussianBlur',\r\n\r\n\t\tdefines: { 'n': maxSamples },\r\n\r\n\t\tuniforms: {\r\n\t\t\t'envMap': { value: null },\r\n\t\t\t'samples': { value: 1 },\r\n\t\t\t'weights': { value: weights },\r\n\t\t\t'latitudinal': { value: false },\r\n\t\t\t'dTheta': { value: 0 },\r\n\t\t\t'mipInt': { value: 0 },\r\n\t\t\t'poleAxis': { value: poleAxis },\r\n\t\t\t'inputEncoding': { value: ENCODINGS[ LinearEncoding ] },\r\n\t\t\t'outputEncoding': { value: ENCODINGS[ LinearEncoding ] }\r\n\t\t},\r\n\r\n\t\tvertexShader: _getCommonVertexShader(),\r\n\r\n\t\tfragmentShader: /* glsl */`\r\n\r\n\t\t\tprecision mediump float;\r\n\t\t\tprecision mediump int;\r\n\r\n\t\t\tvarying vec3 vOutputDirection;\r\n\r\n\t\t\tuniform sampler2D envMap;\r\n\t\t\tuniform int samples;\r\n\t\t\tuniform float weights[ n ];\r\n\t\t\tuniform bool latitudinal;\r\n\t\t\tuniform float dTheta;\r\n\t\t\tuniform float mipInt;\r\n\t\t\tuniform vec3 poleAxis;\r\n\r\n\t\t\t${ _getEncodings() }\r\n\r\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\r\n\t\t\t#include <cube_uv_reflection_fragment>\r\n\r\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\r\n\r\n\t\t\t\tfloat cosTheta = cos( theta );\r\n\t\t\t\t// Rodrigues' axis-angle rotation\r\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\r\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\r\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\r\n\r\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvoid main() {\r\n\r\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\r\n\r\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\r\n\r\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\taxis = normalize( axis );\r\n\r\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\r\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\r\n\r\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\r\n\r\n\t\t\t\t\tif ( i >= samples ) {\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfloat theta = dTheta * float( i );\r\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\r\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\r\n\r\n\t\t\t}\r\n\t\t`,\r\n\r\n\t\tblending: NoBlending,\r\n\t\tdepthTest: false,\r\n\t\tdepthWrite: false\r\n\r\n\t} );\r\n\r\n\treturn shaderMaterial;\r\n\r\n}\r\n\r\nfunction _getEquirectShader() {\r\n\r\n\tconst texelSize = new Vector2( 1, 1 );\r\n\tconst shaderMaterial = new RawShaderMaterial( {\r\n\r\n\t\tname: 'EquirectangularToCubeUV',\r\n\r\n\t\tuniforms: {\r\n\t\t\t'envMap': { value: null },\r\n\t\t\t'texelSize': { value: texelSize },\r\n\t\t\t'inputEncoding': { value: ENCODINGS[ LinearEncoding ] },\r\n\t\t\t'outputEncoding': { value: ENCODINGS[ LinearEncoding ] }\r\n\t\t},\r\n\r\n\t\tvertexShader: _getCommonVertexShader(),\r\n\r\n\t\tfragmentShader: /* glsl */`\r\n\r\n\t\t\tprecision mediump float;\r\n\t\t\tprecision mediump int;\r\n\r\n\t\t\tvarying vec3 vOutputDirection;\r\n\r\n\t\t\tuniform sampler2D envMap;\r\n\t\t\tuniform vec2 texelSize;\r\n\r\n\t\t\t${ _getEncodings() }\r\n\r\n\t\t\t#include <common>\r\n\r\n\t\t\tvoid main() {\r\n\r\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\r\n\r\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\r\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\r\n\r\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\r\n\t\t\t\tuv -= f * texelSize;\r\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\r\n\t\t\t\tuv.x += texelSize.x;\r\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\r\n\t\t\t\tuv.y += texelSize.y;\r\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\r\n\t\t\t\tuv.x -= texelSize.x;\r\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\r\n\r\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\r\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\r\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\r\n\r\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\r\n\r\n\t\t\t}\r\n\t\t`,\r\n\r\n\t\tblending: NoBlending,\r\n\t\tdepthTest: false,\r\n\t\tdepthWrite: false\r\n\r\n\t} );\r\n\r\n\treturn shaderMaterial;\r\n\r\n}\r\n\r\nfunction _getCubemapShader() {\r\n\r\n\tconst shaderMaterial = new RawShaderMaterial( {\r\n\r\n\t\tname: 'CubemapToCubeUV',\r\n\r\n\t\tuniforms: {\r\n\t\t\t'envMap': { value: null },\r\n\t\t\t'inputEncoding': { value: ENCODINGS[ LinearEncoding ] },\r\n\t\t\t'outputEncoding': { value: ENCODINGS[ LinearEncoding ] }\r\n\t\t},\r\n\r\n\t\tvertexShader: _getCommonVertexShader(),\r\n\r\n\t\tfragmentShader: /* glsl */`\r\n\r\n\t\t\tprecision mediump float;\r\n\t\t\tprecision mediump int;\r\n\r\n\t\t\tvarying vec3 vOutputDirection;\r\n\r\n\t\t\tuniform samplerCube envMap;\r\n\r\n\t\t\t${ _getEncodings() }\r\n\r\n\t\t\tvoid main() {\r\n\r\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\r\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\r\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\r\n\r\n\t\t\t}\r\n\t\t`,\r\n\r\n\t\tblending: NoBlending,\r\n\t\tdepthTest: false,\r\n\t\tdepthWrite: false\r\n\r\n\t} );\r\n\r\n\treturn shaderMaterial;\r\n\r\n}\r\n\r\nfunction _getCommonVertexShader() {\r\n\r\n\treturn /* glsl */`\r\n\r\n\t\tprecision mediump float;\r\n\t\tprecision mediump int;\r\n\r\n\t\tattribute vec3 position;\r\n\t\tattribute vec2 uv;\r\n\t\tattribute float faceIndex;\r\n\r\n\t\tvarying vec3 vOutputDirection;\r\n\r\n\t\t// RH coordinate system; PMREM face-indexing convention\r\n\t\tvec3 getDirection( vec2 uv, float face ) {\r\n\r\n\t\t\tuv = 2.0 * uv - 1.0;\r\n\r\n\t\t\tvec3 direction = vec3( uv, 1.0 );\r\n\r\n\t\t\tif ( face == 0.0 ) {\r\n\r\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\r\n\r\n\t\t\t} else if ( face == 1.0 ) {\r\n\r\n\t\t\t\tdirection = direction.xzy;\r\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\r\n\r\n\t\t\t} else if ( face == 2.0 ) {\r\n\r\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\r\n\r\n\t\t\t} else if ( face == 3.0 ) {\r\n\r\n\t\t\t\tdirection = direction.zyx;\r\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\r\n\r\n\t\t\t} else if ( face == 4.0 ) {\r\n\r\n\t\t\t\tdirection = direction.xzy;\r\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\r\n\r\n\t\t\t} else if ( face == 5.0 ) {\r\n\r\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn direction;\r\n\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\r\n\t\t\tgl_Position = vec4( position, 1.0 );\r\n\r\n\t\t}\r\n\t`;\r\n\r\n}\r\n\r\nfunction _getEncodings() {\r\n\r\n\treturn /* glsl */`\r\n\r\n\t\tuniform int inputEncoding;\r\n\t\tuniform int outputEncoding;\r\n\r\n\t\t#include <encodings_pars_fragment>\r\n\r\n\t\tvec4 inputTexelToLinear( vec4 value ) {\r\n\r\n\t\t\tif ( inputEncoding == 0 ) {\r\n\r\n\t\t\t\treturn value;\r\n\r\n\t\t\t} else if ( inputEncoding == 1 ) {\r\n\r\n\t\t\t\treturn sRGBToLinear( value );\r\n\r\n\t\t\t} else if ( inputEncoding == 2 ) {\r\n\r\n\t\t\t\treturn RGBEToLinear( value );\r\n\r\n\t\t\t} else if ( inputEncoding == 3 ) {\r\n\r\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\r\n\r\n\t\t\t} else if ( inputEncoding == 4 ) {\r\n\r\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\r\n\r\n\t\t\t} else if ( inputEncoding == 5 ) {\r\n\r\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn GammaToLinear( value, 2.2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvec4 linearToOutputTexel( vec4 value ) {\r\n\r\n\t\t\tif ( outputEncoding == 0 ) {\r\n\r\n\t\t\t\treturn value;\r\n\r\n\t\t\t} else if ( outputEncoding == 1 ) {\r\n\r\n\t\t\t\treturn LinearTosRGB( value );\r\n\r\n\t\t\t} else if ( outputEncoding == 2 ) {\r\n\r\n\t\t\t\treturn LinearToRGBE( value );\r\n\r\n\t\t\t} else if ( outputEncoding == 3 ) {\r\n\r\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\r\n\r\n\t\t\t} else if ( outputEncoding == 4 ) {\r\n\r\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\r\n\r\n\t\t\t} else if ( outputEncoding == 5 ) {\r\n\r\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn LinearToGamma( value, 2.2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\r\n\r\n\t\t\treturn inputTexelToLinear( color );\r\n\r\n\t\t}\r\n\t`;\r\n\r\n}\r\n\r\nexport { PMREMGenerator };\r\n", "import { CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from '../../constants.js';\r\nimport { PMREMGenerator } from '../../extras/PMREMGenerator.js';\r\n\r\nfunction WebGLCubeUVMaps( renderer ) {\r\n\r\n\tlet cubeUVmaps = new WeakMap();\r\n\r\n\tlet pmremGenerator = null;\r\n\r\n\tfunction get( texture ) {\r\n\r\n\t\tif ( texture && texture.isTexture && texture.isRenderTargetTexture === false ) {\r\n\r\n\t\t\tconst mapping = texture.mapping;\r\n\r\n\t\t\tconst isEquirectMap = ( mapping === EquirectangularReflectionMapping || mapping === EquirectangularRefractionMapping );\r\n\t\t\tconst isCubeMap = ( mapping === CubeReflectionMapping || mapping === CubeRefractionMapping );\r\n\r\n\t\t\tif ( isEquirectMap || isCubeMap ) {\r\n\r\n\t\t\t\t// equirect/cube map to cubeUV conversion\r\n\r\n\t\t\t\tif ( cubeUVmaps.has( texture ) ) {\r\n\r\n\t\t\t\t\treturn cubeUVmaps.get( texture ).texture;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst image = texture.image;\r\n\r\n\t\t\t\t\tif ( ( isEquirectMap && image && image.height > 0 ) || ( isCubeMap && image && isCubeTextureComplete( image ) ) ) {\r\n\r\n\t\t\t\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\t\t\t\t\tif ( pmremGenerator === null ) pmremGenerator = new PMREMGenerator( renderer );\r\n\r\n\t\t\t\t\t\tconst renderTarget = isEquirectMap ? pmremGenerator.fromEquirectangular( texture ) : pmremGenerator.fromCubemap( texture );\r\n\t\t\t\t\t\tcubeUVmaps.set( texture, renderTarget );\r\n\r\n\t\t\t\t\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\t\t\t\treturn renderTarget.texture;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t// image not yet ready. try the conversion next frame\r\n\r\n\t\t\t\t\t\treturn null;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tfunction isCubeTextureComplete( image ) {\r\n\r\n\t\tlet count = 0;\r\n\t\tconst length = 6;\r\n\r\n\t\tfor ( let i = 0; i < length; i ++ ) {\r\n\r\n\t\t\tif ( image[ i ] !== undefined ) count ++;\r\n\r\n\t\t}\r\n\r\n\t\treturn count === length;\r\n\r\n\r\n\t}\r\n\r\n\tfunction onTextureDispose( event ) {\r\n\r\n\t\tconst texture = event.target;\r\n\r\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\tconst cubemapUV = cubeUVmaps.get( texture );\r\n\r\n\t\tif ( cubemapUV !== undefined ) {\r\n\r\n\t\t\tcubemapUV.delete( texture );\r\n\t\t\tcubemapUV.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\tcubeUVmaps = new WeakMap();\r\n\r\n\t\tif ( pmremGenerator !== null ) {\r\n\r\n\t\t\tpmremGenerator.dispose();\r\n\t\t\tpmremGenerator = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tget: get,\r\n\t\tdispose: dispose\r\n\t};\r\n\r\n}\r\n\r\nexport { WebGLCubeUVMaps };\r\n", "function WebGLExtensions( gl ) {\r\n\r\n\tconst extensions = {};\r\n\r\n\tfunction getExtension( name ) {\r\n\r\n\t\tif ( extensions[ name ] !== undefined ) {\r\n\r\n\t\t\treturn extensions[ name ];\r\n\r\n\t\t}\r\n\r\n\t\tlet extension;\r\n\r\n\t\tswitch ( name ) {\r\n\r\n\t\t\tcase 'WEBGL_depth_texture':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_depth_texture' ) || gl.getExtension( 'MOZ_WEBGL_depth_texture' ) || gl.getExtension( 'WEBKIT_WEBGL_depth_texture' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'EXT_texture_filter_anisotropic':\r\n\t\t\t\textension = gl.getExtension( 'EXT_texture_filter_anisotropic' ) || gl.getExtension( 'MOZ_EXT_texture_filter_anisotropic' ) || gl.getExtension( 'WEBKIT_EXT_texture_filter_anisotropic' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_s3tc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'MOZ_WEBGL_compressed_texture_s3tc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_s3tc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'WEBGL_compressed_texture_pvrtc':\r\n\t\t\t\textension = gl.getExtension( 'WEBGL_compressed_texture_pvrtc' ) || gl.getExtension( 'WEBKIT_WEBGL_compressed_texture_pvrtc' );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\textension = gl.getExtension( name );\r\n\r\n\t\t}\r\n\r\n\t\textensions[ name ] = extension;\r\n\r\n\t\treturn extension;\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\thas: function ( name ) {\r\n\r\n\t\t\treturn getExtension( name ) !== null;\r\n\r\n\t\t},\r\n\r\n\t\tinit: function ( capabilities ) {\r\n\r\n\t\t\tif ( capabilities.isWebGL2 ) {\r\n\r\n\t\t\t\tgetExtension( 'EXT_color_buffer_float' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgetExtension( 'WEBGL_depth_texture' );\r\n\t\t\t\tgetExtension( 'OES_texture_float' );\r\n\t\t\t\tgetExtension( 'OES_texture_half_float' );\r\n\t\t\t\tgetExtension( 'OES_texture_half_float_linear' );\r\n\t\t\t\tgetExtension( 'OES_standard_derivatives' );\r\n\t\t\t\tgetExtension( 'OES_element_index_uint' );\r\n\t\t\t\tgetExtension( 'OES_vertex_array_object' );\r\n\t\t\t\tgetExtension( 'ANGLE_instanced_arrays' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tgetExtension( 'OES_texture_float_linear' );\r\n\t\t\tgetExtension( 'EXT_color_buffer_half_float' );\r\n\r\n\t\t},\r\n\r\n\t\tget: function ( name ) {\r\n\r\n\t\t\tconst extension = getExtension( name );\r\n\r\n\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: ' + name + ' extension not supported.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn extension;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLExtensions };\r\n", "import { Uint16BufferAttribute, Uint32BufferAttribute } from '../../core/BufferAttribute.js';\r\nimport { arrayMax } from '../../utils.js';\r\n\r\nfunction WebGLGeometries( gl, attributes, info, bindingStates ) {\r\n\r\n\tconst geometries = {};\r\n\tconst wireframeAttributes = new WeakMap();\r\n\r\n\tfunction onGeometryDispose( event ) {\r\n\r\n\t\tconst geometry = event.target;\r\n\r\n\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\tattributes.remove( geometry.index );\r\n\r\n\t\t}\r\n\r\n\t\tfor ( const name in geometry.attributes ) {\r\n\r\n\t\t\tattributes.remove( geometry.attributes[ name ] );\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.removeEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\tdelete geometries[ geometry.id ];\r\n\r\n\t\tconst attribute = wireframeAttributes.get( geometry );\r\n\r\n\t\tif ( attribute ) {\r\n\r\n\t\t\tattributes.remove( attribute );\r\n\t\t\twireframeAttributes.delete( geometry );\r\n\r\n\t\t}\r\n\r\n\t\tbindingStates.releaseStatesOfGeometry( geometry );\r\n\r\n\t\tif ( geometry.isInstancedBufferGeometry === true ) {\r\n\r\n\t\t\tdelete geometry._maxInstanceCount;\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tinfo.memory.geometries --;\r\n\r\n\t}\r\n\r\n\tfunction get( object, geometry ) {\r\n\r\n\t\tif ( geometries[ geometry.id ] === true ) return geometry;\r\n\r\n\t\tgeometry.addEventListener( 'dispose', onGeometryDispose );\r\n\r\n\t\tgeometries[ geometry.id ] = true;\r\n\r\n\t\tinfo.memory.geometries ++;\r\n\r\n\t\treturn geometry;\r\n\r\n\t}\r\n\r\n\tfunction update( geometry ) {\r\n\r\n\t\tconst geometryAttributes = geometry.attributes;\r\n\r\n\t\t// Updating index buffer in VAO now. See WebGLBindingStates.\r\n\r\n\t\tfor ( const name in geometryAttributes ) {\r\n\r\n\t\t\tattributes.update( geometryAttributes[ name ], gl.ARRAY_BUFFER );\r\n\r\n\t\t}\r\n\r\n\t\t// morph targets\r\n\r\n\t\tconst morphAttributes = geometry.morphAttributes;\r\n\r\n\t\tfor ( const name in morphAttributes ) {\r\n\r\n\t\t\tconst array = morphAttributes[ name ];\r\n\r\n\t\t\tfor ( let i = 0, l = array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tattributes.update( array[ i ], gl.ARRAY_BUFFER );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction updateWireframeAttribute( geometry ) {\r\n\r\n\t\tconst indices = [];\r\n\r\n\t\tconst geometryIndex = geometry.index;\r\n\t\tconst geometryPosition = geometry.attributes.position;\r\n\t\tlet version = 0;\r\n\r\n\t\tif ( geometryIndex !== null ) {\r\n\r\n\t\t\tconst array = geometryIndex.array;\r\n\t\t\tversion = geometryIndex.version;\r\n\r\n\t\t\tfor ( let i = 0, l = array.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\tconst a = array[ i + 0 ];\r\n\t\t\t\tconst b = array[ i + 1 ];\r\n\t\t\t\tconst c = array[ i + 2 ];\r\n\r\n\t\t\t\tindices.push( a, b, b, c, c, a );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst array = geometryPosition.array;\r\n\t\t\tversion = geometryPosition.version;\r\n\r\n\t\t\tfor ( let i = 0, l = ( array.length / 3 ) - 1; i < l; i += 3 ) {\r\n\r\n\t\t\t\tconst a = i + 0;\r\n\t\t\t\tconst b = i + 1;\r\n\t\t\t\tconst c = i + 2;\r\n\r\n\t\t\t\tindices.push( a, b, b, c, c, a );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst attribute = new ( arrayMax( indices ) > 65535 ? Uint32BufferAttribute : Uint16BufferAttribute )( indices, 1 );\r\n\t\tattribute.version = version;\r\n\r\n\t\t// Updating index buffer in VAO now. See WebGLBindingStates\r\n\r\n\t\t//\r\n\r\n\t\tconst previousAttribute = wireframeAttributes.get( geometry );\r\n\r\n\t\tif ( previousAttribute ) attributes.remove( previousAttribute );\r\n\r\n\t\t//\r\n\r\n\t\twireframeAttributes.set( geometry, attribute );\r\n\r\n\t}\r\n\r\n\tfunction getWireframeAttribute( geometry ) {\r\n\r\n\t\tconst currentAttribute = wireframeAttributes.get( geometry );\r\n\r\n\t\tif ( currentAttribute ) {\r\n\r\n\t\t\tconst geometryIndex = geometry.index;\r\n\r\n\t\t\tif ( geometryIndex !== null ) {\r\n\r\n\t\t\t\t// if the attribute is obsolete, create a new one\r\n\r\n\t\t\t\tif ( currentAttribute.version < geometryIndex.version ) {\r\n\r\n\t\t\t\t\tupdateWireframeAttribute( geometry );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tupdateWireframeAttribute( geometry );\r\n\r\n\t\t}\r\n\r\n\t\treturn wireframeAttributes.get( geometry );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tget: get,\r\n\t\tupdate: update,\r\n\r\n\t\tgetWireframeAttribute: getWireframeAttribute\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLGeometries };\r\n", "function WebGLIndexedBufferRenderer( gl, extensions, info, capabilities ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\r\n\tlet mode;\r\n\r\n\tfunction setMode( value ) {\r\n\r\n\t\tmode = value;\r\n\r\n\t}\r\n\r\n\tlet type, bytesPerElement;\r\n\r\n\tfunction setIndex( value ) {\r\n\r\n\t\ttype = value.type;\r\n\t\tbytesPerElement = value.bytesPerElement;\r\n\r\n\t}\r\n\r\n\tfunction render( start, count ) {\r\n\r\n\t\tgl.drawElements( mode, count, type, start * bytesPerElement );\r\n\r\n\t\tinfo.update( count, mode, 1 );\r\n\r\n\t}\r\n\r\n\tfunction renderInstances( start, count, primcount ) {\r\n\r\n\t\tif ( primcount === 0 ) return;\r\n\r\n\t\tlet extension, methodName;\r\n\r\n\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\textension = gl;\r\n\t\t\tmethodName = 'drawElementsInstanced';\r\n\r\n\t\t} else {\r\n\r\n\t\t\textension = extensions.get( 'ANGLE_instanced_arrays' );\r\n\t\t\tmethodName = 'drawElementsInstancedANGLE';\r\n\r\n\t\t\tif ( extension === null ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.' );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\textension[ methodName ]( mode, count, type, start * bytesPerElement, primcount );\r\n\r\n\t\tinfo.update( count, mode, primcount );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tthis.setMode = setMode;\r\n\tthis.setIndex = setIndex;\r\n\tthis.render = render;\r\n\tthis.renderInstances = renderInstances;\r\n\r\n}\r\n\r\n\r\nexport { WebGLIndexedBufferRenderer };\r\n", "function WebGLInfo( gl ) {\r\n\r\n\tconst memory = {\r\n\t\tgeometries: 0,\r\n\t\ttextures: 0\r\n\t};\r\n\r\n\tconst render = {\r\n\t\tframe: 0,\r\n\t\tcalls: 0,\r\n\t\ttriangles: 0,\r\n\t\tpoints: 0,\r\n\t\tlines: 0\r\n\t};\r\n\r\n\tfunction update( count, mode, instanceCount ) {\r\n\r\n\t\trender.calls ++;\r\n\r\n\t\tswitch ( mode ) {\r\n\r\n\t\t\tcase gl.TRIANGLES:\r\n\t\t\t\trender.triangles += instanceCount * ( count / 3 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase gl.LINES:\r\n\t\t\t\trender.lines += instanceCount * ( count / 2 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase gl.LINE_STRIP:\r\n\t\t\t\trender.lines += instanceCount * ( count - 1 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase gl.LINE_LOOP:\r\n\t\t\t\trender.lines += instanceCount * count;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase gl.POINTS:\r\n\t\t\t\trender.points += instanceCount * count;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error( 'THREE.WebGLInfo: Unknown draw mode:', mode );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction reset() {\r\n\r\n\t\trender.frame ++;\r\n\t\trender.calls = 0;\r\n\t\trender.triangles = 0;\r\n\t\trender.points = 0;\r\n\t\trender.lines = 0;\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tmemory: memory,\r\n\t\trender: render,\r\n\t\tprograms: null,\r\n\t\tautoReset: true,\r\n\t\treset: reset,\r\n\t\tupdate: update\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLInfo };\r\n", "function numericalSort( a, b ) {\r\n\r\n\treturn a[ 0 ] - b[ 0 ];\r\n\r\n}\r\n\r\nfunction absNumericalSort( a, b ) {\r\n\r\n\treturn Math.abs( b[ 1 ] ) - Math.abs( a[ 1 ] );\r\n\r\n}\r\n\r\nfunction WebGLMorphtargets( gl ) {\r\n\r\n\tconst influencesList = {};\r\n\tconst morphInfluences = new Float32Array( 8 );\r\n\r\n\tconst workInfluences = [];\r\n\r\n\tfor ( let i = 0; i < 8; i ++ ) {\r\n\r\n\t\tworkInfluences[ i ] = [ i, 0 ];\r\n\r\n\t}\r\n\r\n\tfunction update( object, geometry, material, program ) {\r\n\r\n\t\tconst objectInfluences = object.morphTargetInfluences;\r\n\r\n\t\t// When object doesn't have morph target influences defined, we treat it as a 0-length array\r\n\t\t// This is important to make sure we set up morphTargetBaseInfluence / morphTargetInfluences\r\n\r\n\t\tconst length = objectInfluences === undefined ? 0 : objectInfluences.length;\r\n\r\n\t\tlet influences = influencesList[ geometry.id ];\r\n\r\n\t\tif ( influences === undefined || influences.length !== length ) {\r\n\r\n\t\t\t// initialise list\r\n\r\n\t\t\tinfluences = [];\r\n\r\n\t\t\tfor ( let i = 0; i < length; i ++ ) {\r\n\r\n\t\t\t\tinfluences[ i ] = [ i, 0 ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tinfluencesList[ geometry.id ] = influences;\r\n\r\n\t\t}\r\n\r\n\t\t// Collect influences\r\n\r\n\t\tfor ( let i = 0; i < length; i ++ ) {\r\n\r\n\t\t\tconst influence = influences[ i ];\r\n\r\n\t\t\tinfluence[ 0 ] = i;\r\n\t\t\tinfluence[ 1 ] = objectInfluences[ i ];\r\n\r\n\t\t}\r\n\r\n\t\tinfluences.sort( absNumericalSort );\r\n\r\n\t\tfor ( let i = 0; i < 8; i ++ ) {\r\n\r\n\t\t\tif ( i < length && influences[ i ][ 1 ] ) {\r\n\r\n\t\t\t\tworkInfluences[ i ][ 0 ] = influences[ i ][ 0 ];\r\n\t\t\t\tworkInfluences[ i ][ 1 ] = influences[ i ][ 1 ];\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tworkInfluences[ i ][ 0 ] = Number.MAX_SAFE_INTEGER;\r\n\t\t\t\tworkInfluences[ i ][ 1 ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tworkInfluences.sort( numericalSort );\r\n\r\n\t\tconst morphTargets = geometry.morphAttributes.position;\r\n\t\tconst morphNormals = geometry.morphAttributes.normal;\r\n\r\n\t\tlet morphInfluencesSum = 0;\r\n\r\n\t\tfor ( let i = 0; i < 8; i ++ ) {\r\n\r\n\t\t\tconst influence = workInfluences[ i ];\r\n\t\t\tconst index = influence[ 0 ];\r\n\t\t\tconst value = influence[ 1 ];\r\n\r\n\t\t\tif ( index !== Number.MAX_SAFE_INTEGER && value ) {\r\n\r\n\t\t\t\tif ( morphTargets && geometry.getAttribute( 'morphTarget' + i ) !== morphTargets[ index ] ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( 'morphTarget' + i, morphTargets[ index ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( morphNormals && geometry.getAttribute( 'morphNormal' + i ) !== morphNormals[ index ] ) {\r\n\r\n\t\t\t\t\tgeometry.setAttribute( 'morphNormal' + i, morphNormals[ index ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmorphInfluences[ i ] = value;\r\n\t\t\t\tmorphInfluencesSum += value;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( morphTargets && geometry.hasAttribute( 'morphTarget' + i ) === true ) {\r\n\r\n\t\t\t\t\tgeometry.deleteAttribute( 'morphTarget' + i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( morphNormals && geometry.hasAttribute( 'morphNormal' + i ) === true ) {\r\n\r\n\t\t\t\t\tgeometry.deleteAttribute( 'morphNormal' + i );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmorphInfluences[ i ] = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// GLSL shader uses formula baseinfluence * base + sum(target * influence)\r\n\t\t// This allows us to switch between absolute morphs and relative morphs without changing shader code\r\n\t\t// When baseinfluence = 1 - sum(influence), the above is equivalent to sum((target - base) * influence)\r\n\t\tconst morphBaseInfluence = geometry.morphTargetsRelative ? 1 : 1 - morphInfluencesSum;\r\n\r\n\t\tprogram.getUniforms().setValue( gl, 'morphTargetBaseInfluence', morphBaseInfluence );\r\n\t\tprogram.getUniforms().setValue( gl, 'morphTargetInfluences', morphInfluences );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tupdate: update\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLMorphtargets };\r\n", "import { WebGLRenderTarget } from './WebGLRenderTarget.js';\r\n\r\nclass WebGLMultisampleRenderTarget extends WebGLRenderTarget {\r\n\r\n\tconstructor( width, height, options ) {\r\n\r\n\t\tsuper( width, height, options );\r\n\r\n\t\tthis.samples = 4;\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy.call( this, source );\r\n\r\n\t\tthis.samples = source.samples;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nWebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget = true;\r\n\r\nexport { WebGLMultisampleRenderTarget };\r\n", "function WebGLObjects( gl, geometries, attributes, info ) {\r\n\r\n\tlet updateMap = new WeakMap();\r\n\r\n\tfunction update( object ) {\r\n\r\n\t\tconst frame = info.render.frame;\r\n\r\n\t\tconst geometry = object.geometry;\r\n\t\tconst buffergeometry = geometries.get( object, geometry );\r\n\r\n\t\t// Update once per frame\r\n\r\n\t\tif ( updateMap.get( buffergeometry ) !== frame ) {\r\n\r\n\t\t\tgeometries.update( buffergeometry );\r\n\r\n\t\t\tupdateMap.set( buffergeometry, frame );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.isInstancedMesh ) {\r\n\r\n\t\t\tif ( object.hasEventListener( 'dispose', onInstancedMeshDispose ) === false ) {\r\n\r\n\t\t\t\tobject.addEventListener( 'dispose', onInstancedMeshDispose );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tattributes.update( object.instanceMatrix, gl.ARRAY_BUFFER );\r\n\r\n\t\t\tif ( object.instanceColor !== null ) {\r\n\r\n\t\t\t\tattributes.update( object.instanceColor, gl.ARRAY_BUFFER );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn buffergeometry;\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\tupdateMap = new WeakMap();\r\n\r\n\t}\r\n\r\n\tfunction onInstancedMeshDispose( event ) {\r\n\r\n\t\tconst instancedMesh = event.target;\r\n\r\n\t\tinstancedMesh.removeEventListener( 'dispose', onInstancedMeshDispose );\r\n\r\n\t\tattributes.remove( instancedMesh.instanceMatrix );\r\n\r\n\t\tif ( instancedMesh.instanceColor !== null ) attributes.remove( instancedMesh.instanceColor );\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tupdate: update,\r\n\t\tdispose: dispose\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLObjects };\r\n", "import { Texture } from './Texture.js';\r\nimport { ClampToEdgeWrapping, NearestFilter } from '../constants.js';\r\n\r\nclass DataTexture2DArray extends Texture {\r\n\r\n\tconstructor( data = null, width = 1, height = 1, depth = 1 ) {\r\n\r\n\t\tsuper( null );\r\n\r\n\t\tthis.image = { data, width, height, depth };\r\n\r\n\t\tthis.magFilter = NearestFilter;\r\n\t\tthis.minFilter = NearestFilter;\r\n\r\n\t\tthis.wrapR = ClampToEdgeWrapping;\r\n\r\n\t\tthis.generateMipmaps = false;\r\n\t\tthis.flipY = false;\r\n\t\tthis.unpackAlignment = 1;\r\n\r\n\t\tthis.needsUpdate = true;\r\n\r\n\t}\r\n\r\n}\r\n\r\nDataTexture2DArray.prototype.isDataTexture2DArray = true;\r\n\r\nexport { DataTexture2DArray };\r\n", "import { Texture } from './Texture.js';\r\nimport { ClampToEdgeWrapping, NearestFilter } from '../constants.js';\r\n\r\nclass DataTexture3D extends Texture {\r\n\r\n\tconstructor( data = null, width = 1, height = 1, depth = 1 ) {\r\n\r\n\t\t// We're going to add .setXXX() methods for setting properties later.\r\n\t\t// Users can still set in DataTexture3D directly.\r\n\t\t//\r\n\t\t//\tconst texture = new THREE.DataTexture3D( data, width, height, depth );\r\n\t\t// \ttexture.anisotropy = 16;\r\n\t\t//\r\n\t\t// See #14839\r\n\r\n\t\tsuper( null );\r\n\r\n\t\tthis.image = { data, width, height, depth };\r\n\r\n\t\tthis.magFilter = NearestFilter;\r\n\t\tthis.minFilter = NearestFilter;\r\n\r\n\t\tthis.wrapR = ClampToEdgeWrapping;\r\n\r\n\t\tthis.generateMipmaps = false;\r\n\t\tthis.flipY = false;\r\n\t\tthis.unpackAlignment = 1;\r\n\r\n\t\tthis.needsUpdate = true;\r\n\r\n\t}\r\n\r\n}\r\n\r\nDataTexture3D.prototype.isDataTexture3D = true;\r\n\r\nexport { DataTexture3D };\r\n", "/**\r\n * Uniforms of a program.\r\n * Those form a tree structure with a special top-level container for the root,\r\n * which you get by calling 'new WebGLUniforms( gl, program )'.\r\n *\r\n *\r\n * Properties of inner nodes including the top-level container:\r\n *\r\n * .seq - array of nested uniforms\r\n * .map - nested uniforms by name\r\n *\r\n *\r\n * Methods of all nodes except the top-level container:\r\n *\r\n * .setValue( gl, value, [textures] )\r\n *\r\n * \t\tuploads a uniform value(s)\r\n *  \tthe 'textures' parameter is needed for sampler uniforms\r\n *\r\n *\r\n * Static methods of the top-level container (textures factorizations):\r\n *\r\n * .upload( gl, seq, values, textures )\r\n *\r\n * \t\tsets uniforms in 'seq' to 'values[id].value'\r\n *\r\n * .seqWithValue( seq, values ) : filteredSeq\r\n *\r\n * \t\tfilters 'seq' entries with corresponding entry in values\r\n *\r\n *\r\n * Methods of the top-level container (textures factorizations):\r\n *\r\n * .setValue( gl, name, value, textures )\r\n *\r\n * \t\tsets uniform with  name 'name' to 'value'\r\n *\r\n * .setOptional( gl, obj, prop )\r\n *\r\n * \t\tlike .set for an optional property of the object\r\n *\r\n */\r\n\r\nimport { CubeTexture } from '../../textures/CubeTexture.js';\r\nimport { Texture } from '../../textures/Texture.js';\r\nimport { DataTexture2DArray } from '../../textures/DataTexture2DArray.js';\r\nimport { DataTexture3D } from '../../textures/DataTexture3D.js';\r\n\r\nconst emptyTexture = new Texture();\r\nconst emptyTexture2dArray = new DataTexture2DArray();\r\nconst emptyTexture3d = new DataTexture3D();\r\nconst emptyCubeTexture = new CubeTexture();\r\n\r\n// --- Utilities ---\r\n\r\n// Array Caches (provide typed arrays for temporary by size)\r\n\r\nconst arrayCacheF32 = [];\r\nconst arrayCacheI32 = [];\r\n\r\n// Float32Array caches used for uploading Matrix uniforms\r\n\r\nconst mat4array = new Float32Array( 16 );\r\nconst mat3array = new Float32Array( 9 );\r\nconst mat2array = new Float32Array( 4 );\r\n\r\n// Flattening for arrays of vectors and matrices\r\n\r\nfunction flatten( array, nBlocks, blockSize ) {\r\n\r\n\tconst firstElem = array[ 0 ];\r\n\r\n\tif ( firstElem <= 0 || firstElem > 0 ) return array;\r\n\t// unoptimized: ! isNaN( firstElem )\r\n\t// see http://jacksondunstan.com/articles/983\r\n\r\n\tconst n = nBlocks * blockSize;\r\n\tlet r = arrayCacheF32[ n ];\r\n\r\n\tif ( r === undefined ) {\r\n\r\n\t\tr = new Float32Array( n );\r\n\t\tarrayCacheF32[ n ] = r;\r\n\r\n\t}\r\n\r\n\tif ( nBlocks !== 0 ) {\r\n\r\n\t\tfirstElem.toArray( r, 0 );\r\n\r\n\t\tfor ( let i = 1, offset = 0; i !== nBlocks; ++ i ) {\r\n\r\n\t\t\toffset += blockSize;\r\n\t\t\tarray[ i ].toArray( r, offset );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn r;\r\n\r\n}\r\n\r\nfunction arraysEqual( a, b ) {\r\n\r\n\tif ( a.length !== b.length ) return false;\r\n\r\n\tfor ( let i = 0, l = a.length; i < l; i ++ ) {\r\n\r\n\t\tif ( a[ i ] !== b[ i ] ) return false;\r\n\r\n\t}\r\n\r\n\treturn true;\r\n\r\n}\r\n\r\nfunction copyArray( a, b ) {\r\n\r\n\tfor ( let i = 0, l = b.length; i < l; i ++ ) {\r\n\r\n\t\ta[ i ] = b[ i ];\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Texture unit allocation\r\n\r\nfunction allocTexUnits( textures, n ) {\r\n\r\n\tlet r = arrayCacheI32[ n ];\r\n\r\n\tif ( r === undefined ) {\r\n\r\n\t\tr = new Int32Array( n );\r\n\t\tarrayCacheI32[ n ] = r;\r\n\r\n\t}\r\n\r\n\tfor ( let i = 0; i !== n; ++ i ) {\r\n\r\n\t\tr[ i ] = textures.allocateTextureUnit();\r\n\r\n\t}\r\n\r\n\treturn r;\r\n\r\n}\r\n\r\n// --- Setters ---\r\n\r\n// Note: Defining these methods externally, because they come in a bunch\r\n// and this way their names minify.\r\n\r\n// Single scalar\r\n\r\nfunction setValueV1f( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( cache[ 0 ] === v ) return;\r\n\r\n\tgl.uniform1f( this.addr, v );\r\n\r\n\tcache[ 0 ] = v;\r\n\r\n}\r\n\r\n// Single float vector (from flat array or THREE.VectorN)\r\n\r\nfunction setValueV2f( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( v.x !== undefined ) {\r\n\r\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y ) {\r\n\r\n\t\t\tgl.uniform2f( this.addr, v.x, v.y );\r\n\r\n\t\t\tcache[ 0 ] = v.x;\r\n\t\t\tcache[ 1 ] = v.y;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniform2fv( this.addr, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction setValueV3f( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( v.x !== undefined ) {\r\n\r\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y || cache[ 2 ] !== v.z ) {\r\n\r\n\t\t\tgl.uniform3f( this.addr, v.x, v.y, v.z );\r\n\r\n\t\t\tcache[ 0 ] = v.x;\r\n\t\t\tcache[ 1 ] = v.y;\r\n\t\t\tcache[ 2 ] = v.z;\r\n\r\n\t\t}\r\n\r\n\t} else if ( v.r !== undefined ) {\r\n\r\n\t\tif ( cache[ 0 ] !== v.r || cache[ 1 ] !== v.g || cache[ 2 ] !== v.b ) {\r\n\r\n\t\t\tgl.uniform3f( this.addr, v.r, v.g, v.b );\r\n\r\n\t\t\tcache[ 0 ] = v.r;\r\n\t\t\tcache[ 1 ] = v.g;\r\n\t\t\tcache[ 2 ] = v.b;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniform3fv( this.addr, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction setValueV4f( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( v.x !== undefined ) {\r\n\r\n\t\tif ( cache[ 0 ] !== v.x || cache[ 1 ] !== v.y || cache[ 2 ] !== v.z || cache[ 3 ] !== v.w ) {\r\n\r\n\t\t\tgl.uniform4f( this.addr, v.x, v.y, v.z, v.w );\r\n\r\n\t\t\tcache[ 0 ] = v.x;\r\n\t\t\tcache[ 1 ] = v.y;\r\n\t\t\tcache[ 2 ] = v.z;\r\n\t\t\tcache[ 3 ] = v.w;\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniform4fv( this.addr, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Single matrix (from flat array or THREE.MatrixN)\r\n\r\nfunction setValueM2( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst elements = v.elements;\r\n\r\n\tif ( elements === undefined ) {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniformMatrix2fv( this.addr, false, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, elements ) ) return;\r\n\r\n\t\tmat2array.set( elements );\r\n\r\n\t\tgl.uniformMatrix2fv( this.addr, false, mat2array );\r\n\r\n\t\tcopyArray( cache, elements );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction setValueM3( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst elements = v.elements;\r\n\r\n\tif ( elements === undefined ) {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniformMatrix3fv( this.addr, false, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, elements ) ) return;\r\n\r\n\t\tmat3array.set( elements );\r\n\r\n\t\tgl.uniformMatrix3fv( this.addr, false, mat3array );\r\n\r\n\t\tcopyArray( cache, elements );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction setValueM4( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst elements = v.elements;\r\n\r\n\tif ( elements === undefined ) {\r\n\r\n\t\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\t\tgl.uniformMatrix4fv( this.addr, false, v );\r\n\r\n\t\tcopyArray( cache, v );\r\n\r\n\t} else {\r\n\r\n\t\tif ( arraysEqual( cache, elements ) ) return;\r\n\r\n\t\tmat4array.set( elements );\r\n\r\n\t\tgl.uniformMatrix4fv( this.addr, false, mat4array );\r\n\r\n\t\tcopyArray( cache, elements );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Single integer / boolean\r\n\r\nfunction setValueV1i( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( cache[ 0 ] === v ) return;\r\n\r\n\tgl.uniform1i( this.addr, v );\r\n\r\n\tcache[ 0 ] = v;\r\n\r\n}\r\n\r\n// Single integer / boolean vector (from flat array)\r\n\r\nfunction setValueV2i( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform2iv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\nfunction setValueV3i( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform3iv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\nfunction setValueV4i( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform4iv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\n// Single unsigned integer\r\n\r\nfunction setValueV1ui( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( cache[ 0 ] === v ) return;\r\n\r\n\tgl.uniform1ui( this.addr, v );\r\n\r\n\tcache[ 0 ] = v;\r\n\r\n}\r\n\r\n// Single unsigned integer vector (from flat array)\r\n\r\nfunction setValueV2ui( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform2uiv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\nfunction setValueV3ui( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform3uiv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\nfunction setValueV4ui( gl, v ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( arraysEqual( cache, v ) ) return;\r\n\r\n\tgl.uniform4uiv( this.addr, v );\r\n\r\n\tcopyArray( cache, v );\r\n\r\n}\r\n\r\n\r\n// Single texture (2D / Cube)\r\n\r\nfunction setValueT1( gl, v, textures ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst unit = textures.allocateTextureUnit();\r\n\r\n\tif ( cache[ 0 ] !== unit ) {\r\n\r\n\t\tgl.uniform1i( this.addr, unit );\r\n\t\tcache[ 0 ] = unit;\r\n\r\n\t}\r\n\r\n\ttextures.safeSetTexture2D( v || emptyTexture, unit );\r\n\r\n}\r\n\r\nfunction setValueT3D1( gl, v, textures ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst unit = textures.allocateTextureUnit();\r\n\r\n\tif ( cache[ 0 ] !== unit ) {\r\n\r\n\t\tgl.uniform1i( this.addr, unit );\r\n\t\tcache[ 0 ] = unit;\r\n\r\n\t}\r\n\r\n\ttextures.setTexture3D( v || emptyTexture3d, unit );\r\n\r\n}\r\n\r\nfunction setValueT6( gl, v, textures ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst unit = textures.allocateTextureUnit();\r\n\r\n\tif ( cache[ 0 ] !== unit ) {\r\n\r\n\t\tgl.uniform1i( this.addr, unit );\r\n\t\tcache[ 0 ] = unit;\r\n\r\n\t}\r\n\r\n\ttextures.safeSetTextureCube( v || emptyCubeTexture, unit );\r\n\r\n}\r\n\r\nfunction setValueT2DArray1( gl, v, textures ) {\r\n\r\n\tconst cache = this.cache;\r\n\tconst unit = textures.allocateTextureUnit();\r\n\r\n\tif ( cache[ 0 ] !== unit ) {\r\n\r\n\t\tgl.uniform1i( this.addr, unit );\r\n\t\tcache[ 0 ] = unit;\r\n\r\n\t}\r\n\r\n\ttextures.setTexture2DArray( v || emptyTexture2dArray, unit );\r\n\r\n}\r\n\r\n// Helper to pick the right setter for the singular case\r\n\r\nfunction getSingularSetter( type ) {\r\n\r\n\tswitch ( type ) {\r\n\r\n\t\tcase 0x1406: return setValueV1f; // FLOAT\r\n\t\tcase 0x8b50: return setValueV2f; // _VEC2\r\n\t\tcase 0x8b51: return setValueV3f; // _VEC3\r\n\t\tcase 0x8b52: return setValueV4f; // _VEC4\r\n\r\n\t\tcase 0x8b5a: return setValueM2; // _MAT2\r\n\t\tcase 0x8b5b: return setValueM3; // _MAT3\r\n\t\tcase 0x8b5c: return setValueM4; // _MAT4\r\n\r\n\t\tcase 0x1404: case 0x8b56: return setValueV1i; // INT, BOOL\r\n\t\tcase 0x8b53: case 0x8b57: return setValueV2i; // _VEC2\r\n\t\tcase 0x8b54: case 0x8b58: return setValueV3i; // _VEC3\r\n\t\tcase 0x8b55: case 0x8b59: return setValueV4i; // _VEC4\r\n\r\n\t\tcase 0x1405: return setValueV1ui; // UINT\r\n\t\tcase 0x8dc6: return setValueV2ui; // _VEC2\r\n\t\tcase 0x8dc7: return setValueV3ui; // _VEC3\r\n\t\tcase 0x8dc8: return setValueV4ui; // _VEC4\r\n\r\n\t\tcase 0x8b5e: // SAMPLER_2D\r\n\t\tcase 0x8d66: // SAMPLER_EXTERNAL_OES\r\n\t\tcase 0x8dca: // INT_SAMPLER_2D\r\n\t\tcase 0x8dd2: // UNSIGNED_INT_SAMPLER_2D\r\n\t\tcase 0x8b62: // SAMPLER_2D_SHADOW\r\n\t\t\treturn setValueT1;\r\n\r\n\t\tcase 0x8b5f: // SAMPLER_3D\r\n\t\tcase 0x8dcb: // INT_SAMPLER_3D\r\n\t\tcase 0x8dd3: // UNSIGNED_INT_SAMPLER_3D\r\n\t\t\treturn setValueT3D1;\r\n\r\n\t\tcase 0x8b60: // SAMPLER_CUBE\r\n\t\tcase 0x8dcc: // INT_SAMPLER_CUBE\r\n\t\tcase 0x8dd4: // UNSIGNED_INT_SAMPLER_CUBE\r\n\t\tcase 0x8dc5: // SAMPLER_CUBE_SHADOW\r\n\t\t\treturn setValueT6;\r\n\r\n\t\tcase 0x8dc1: // SAMPLER_2D_ARRAY\r\n\t\tcase 0x8dcf: // INT_SAMPLER_2D_ARRAY\r\n\t\tcase 0x8dd7: // UNSIGNED_INT_SAMPLER_2D_ARRAY\r\n\t\tcase 0x8dc4: // SAMPLER_2D_ARRAY_SHADOW\r\n\t\t\treturn setValueT2DArray1;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n// Array of scalars\r\n\r\nfunction setValueV1fArray( gl, v ) {\r\n\r\n\tgl.uniform1fv( this.addr, v );\r\n\r\n}\r\n\r\n// Array of vectors (from flat array or array of THREE.VectorN)\r\n\r\nfunction setValueV2fArray( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 2 );\r\n\r\n\tgl.uniform2fv( this.addr, data );\r\n\r\n}\r\n\r\nfunction setValueV3fArray( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 3 );\r\n\r\n\tgl.uniform3fv( this.addr, data );\r\n\r\n}\r\n\r\nfunction setValueV4fArray( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 4 );\r\n\r\n\tgl.uniform4fv( this.addr, data );\r\n\r\n}\r\n\r\n// Array of matrices (from flat array or array of THREE.MatrixN)\r\n\r\nfunction setValueM2Array( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 4 );\r\n\r\n\tgl.uniformMatrix2fv( this.addr, false, data );\r\n\r\n}\r\n\r\nfunction setValueM3Array( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 9 );\r\n\r\n\tgl.uniformMatrix3fv( this.addr, false, data );\r\n\r\n}\r\n\r\nfunction setValueM4Array( gl, v ) {\r\n\r\n\tconst data = flatten( v, this.size, 16 );\r\n\r\n\tgl.uniformMatrix4fv( this.addr, false, data );\r\n\r\n}\r\n\r\n// Array of integer / boolean\r\n\r\nfunction setValueV1iArray( gl, v ) {\r\n\r\n\tgl.uniform1iv( this.addr, v );\r\n\r\n}\r\n\r\n// Array of integer / boolean vectors (from flat array)\r\n\r\nfunction setValueV2iArray( gl, v ) {\r\n\r\n\tgl.uniform2iv( this.addr, v );\r\n\r\n}\r\n\r\nfunction setValueV3iArray( gl, v ) {\r\n\r\n\tgl.uniform3iv( this.addr, v );\r\n\r\n}\r\n\r\nfunction setValueV4iArray( gl, v ) {\r\n\r\n\tgl.uniform4iv( this.addr, v );\r\n\r\n}\r\n\r\n// Array of unsigned integer\r\n\r\nfunction setValueV1uiArray( gl, v ) {\r\n\r\n\tgl.uniform1uiv( this.addr, v );\r\n\r\n}\r\n\r\n// Array of unsigned integer vectors (from flat array)\r\n\r\nfunction setValueV2uiArray( gl, v ) {\r\n\r\n\tgl.uniform2uiv( this.addr, v );\r\n\r\n}\r\n\r\nfunction setValueV3uiArray( gl, v ) {\r\n\r\n\tgl.uniform3uiv( this.addr, v );\r\n\r\n}\r\n\r\nfunction setValueV4uiArray( gl, v ) {\r\n\r\n\tgl.uniform4uiv( this.addr, v );\r\n\r\n}\r\n\r\n\r\n// Array of textures (2D / Cube)\r\n\r\nfunction setValueT1Array( gl, v, textures ) {\r\n\r\n\tconst n = v.length;\r\n\r\n\tconst units = allocTexUnits( textures, n );\r\n\r\n\tgl.uniform1iv( this.addr, units );\r\n\r\n\tfor ( let i = 0; i !== n; ++ i ) {\r\n\r\n\t\ttextures.safeSetTexture2D( v[ i ] || emptyTexture, units[ i ] );\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction setValueT6Array( gl, v, textures ) {\r\n\r\n\tconst n = v.length;\r\n\r\n\tconst units = allocTexUnits( textures, n );\r\n\r\n\tgl.uniform1iv( this.addr, units );\r\n\r\n\tfor ( let i = 0; i !== n; ++ i ) {\r\n\r\n\t\ttextures.safeSetTextureCube( v[ i ] || emptyCubeTexture, units[ i ] );\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Helper to pick the right setter for a pure (bottom-level) array\r\n\r\nfunction getPureArraySetter( type ) {\r\n\r\n\tswitch ( type ) {\r\n\r\n\t\tcase 0x1406: return setValueV1fArray; // FLOAT\r\n\t\tcase 0x8b50: return setValueV2fArray; // _VEC2\r\n\t\tcase 0x8b51: return setValueV3fArray; // _VEC3\r\n\t\tcase 0x8b52: return setValueV4fArray; // _VEC4\r\n\r\n\t\tcase 0x8b5a: return setValueM2Array; // _MAT2\r\n\t\tcase 0x8b5b: return setValueM3Array; // _MAT3\r\n\t\tcase 0x8b5c: return setValueM4Array; // _MAT4\r\n\r\n\t\tcase 0x1404: case 0x8b56: return setValueV1iArray; // INT, BOOL\r\n\t\tcase 0x8b53: case 0x8b57: return setValueV2iArray; // _VEC2\r\n\t\tcase 0x8b54: case 0x8b58: return setValueV3iArray; // _VEC3\r\n\t\tcase 0x8b55: case 0x8b59: return setValueV4iArray; // _VEC4\r\n\r\n\t\tcase 0x1405: return setValueV1uiArray; // UINT\r\n\t\tcase 0x8dc6: return setValueV2uiArray; // _VEC2\r\n\t\tcase 0x8dc7: return setValueV3uiArray; // _VEC3\r\n\t\tcase 0x8dc8: return setValueV4uiArray; // _VEC4\r\n\r\n\t\tcase 0x8b5e: // SAMPLER_2D\r\n\t\tcase 0x8d66: // SAMPLER_EXTERNAL_OES\r\n\t\tcase 0x8dca: // INT_SAMPLER_2D\r\n\t\tcase 0x8dd2: // UNSIGNED_INT_SAMPLER_2D\r\n\t\tcase 0x8b62: // SAMPLER_2D_SHADOW\r\n\t\t\treturn setValueT1Array;\r\n\r\n\t\tcase 0x8b60: // SAMPLER_CUBE\r\n\t\tcase 0x8dcc: // INT_SAMPLER_CUBE\r\n\t\tcase 0x8dd4: // UNSIGNED_INT_SAMPLER_CUBE\r\n\t\tcase 0x8dc5: // SAMPLER_CUBE_SHADOW\r\n\t\t\treturn setValueT6Array;\r\n\r\n\t}\r\n\r\n}\r\n\r\n// --- Uniform Classes ---\r\n\r\nfunction SingleUniform( id, activeInfo, addr ) {\r\n\r\n\tthis.id = id;\r\n\tthis.addr = addr;\r\n\tthis.cache = [];\r\n\tthis.setValue = getSingularSetter( activeInfo.type );\r\n\r\n\t// this.path = activeInfo.name; // DEBUG\r\n\r\n}\r\n\r\nfunction PureArrayUniform( id, activeInfo, addr ) {\r\n\r\n\tthis.id = id;\r\n\tthis.addr = addr;\r\n\tthis.cache = [];\r\n\tthis.size = activeInfo.size;\r\n\tthis.setValue = getPureArraySetter( activeInfo.type );\r\n\r\n\t// this.path = activeInfo.name; // DEBUG\r\n\r\n}\r\n\r\nPureArrayUniform.prototype.updateCache = function ( data ) {\r\n\r\n\tconst cache = this.cache;\r\n\r\n\tif ( data instanceof Float32Array && cache.length !== data.length ) {\r\n\r\n\t\tthis.cache = new Float32Array( data.length );\r\n\r\n\t}\r\n\r\n\tcopyArray( cache, data );\r\n\r\n};\r\n\r\nfunction StructuredUniform( id ) {\r\n\r\n\tthis.id = id;\r\n\r\n\tthis.seq = [];\r\n\tthis.map = {};\r\n\r\n}\r\n\r\nStructuredUniform.prototype.setValue = function ( gl, value, textures ) {\r\n\r\n\tconst seq = this.seq;\r\n\r\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\r\n\r\n\t\tconst u = seq[ i ];\r\n\t\tu.setValue( gl, value[ u.id ], textures );\r\n\r\n\t}\r\n\r\n};\r\n\r\n// --- Top-level ---\r\n\r\n// Parser - builds up the property tree from the path strings\r\n\r\nconst RePathPart = /(\\w+)(\\])?(\\[|\\.)?/g;\r\n\r\n// extracts\r\n// \t- the identifier (member name or array index)\r\n//  - followed by an optional right bracket (found when array index)\r\n//  - followed by an optional left bracket or dot (type of subscript)\r\n//\r\n// Note: These portions can be read in a non-overlapping fashion and\r\n// allow straightforward parsing of the hierarchy that WebGL encodes\r\n// in the uniform names.\r\n\r\nfunction addUniform( container, uniformObject ) {\r\n\r\n\tcontainer.seq.push( uniformObject );\r\n\tcontainer.map[ uniformObject.id ] = uniformObject;\r\n\r\n}\r\n\r\nfunction parseUniform( activeInfo, addr, container ) {\r\n\r\n\tconst path = activeInfo.name,\r\n\t\tpathLength = path.length;\r\n\r\n\t// reset RegExp object, because of the early exit of a previous run\r\n\tRePathPart.lastIndex = 0;\r\n\r\n\twhile ( true ) {\r\n\r\n\t\tconst match = RePathPart.exec( path ),\r\n\t\t\tmatchEnd = RePathPart.lastIndex;\r\n\r\n\t\tlet id = match[ 1 ];\r\n\t\tconst idIsIndex = match[ 2 ] === ']',\r\n\t\t\tsubscript = match[ 3 ];\r\n\r\n\t\tif ( idIsIndex ) id = id | 0; // convert to integer\r\n\r\n\t\tif ( subscript === undefined || subscript === '[' && matchEnd + 2 === pathLength ) {\r\n\r\n\t\t\t// bare name or \"pure\" bottom-level array \"[0]\" suffix\r\n\r\n\t\t\taddUniform( container, subscript === undefined ?\r\n\t\t\t\tnew SingleUniform( id, activeInfo, addr ) :\r\n\t\t\t\tnew PureArrayUniform( id, activeInfo, addr ) );\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// step into inner node / create it in case it doesn't exist\r\n\r\n\t\t\tconst map = container.map;\r\n\t\t\tlet next = map[ id ];\r\n\r\n\t\t\tif ( next === undefined ) {\r\n\r\n\t\t\t\tnext = new StructuredUniform( id );\r\n\t\t\t\taddUniform( container, next );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcontainer = next;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n// Root Container\r\n\r\nfunction WebGLUniforms( gl, program ) {\r\n\r\n\tthis.seq = [];\r\n\tthis.map = {};\r\n\r\n\tconst n = gl.getProgramParameter( program, gl.ACTIVE_UNIFORMS );\r\n\r\n\tfor ( let i = 0; i < n; ++ i ) {\r\n\r\n\t\tconst info = gl.getActiveUniform( program, i ),\r\n\t\t\taddr = gl.getUniformLocation( program, info.name );\r\n\r\n\t\tparseUniform( info, addr, this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nWebGLUniforms.prototype.setValue = function ( gl, name, value, textures ) {\r\n\r\n\tconst u = this.map[ name ];\r\n\r\n\tif ( u !== undefined ) u.setValue( gl, value, textures );\r\n\r\n};\r\n\r\nWebGLUniforms.prototype.setOptional = function ( gl, object, name ) {\r\n\r\n\tconst v = object[ name ];\r\n\r\n\tif ( v !== undefined ) this.setValue( gl, name, v );\r\n\r\n};\r\n\r\n\r\n// Static interface\r\n\r\nWebGLUniforms.upload = function ( gl, seq, values, textures ) {\r\n\r\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\r\n\r\n\t\tconst u = seq[ i ],\r\n\t\t\tv = values[ u.id ];\r\n\r\n\t\tif ( v.needsUpdate !== false ) {\r\n\r\n\t\t\t// note: always updating when .needsUpdate is undefined\r\n\t\t\tu.setValue( gl, v.value, textures );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\r\nWebGLUniforms.seqWithValue = function ( seq, values ) {\r\n\r\n\tconst r = [];\r\n\r\n\tfor ( let i = 0, n = seq.length; i !== n; ++ i ) {\r\n\r\n\t\tconst u = seq[ i ];\r\n\t\tif ( u.id in values ) r.push( u );\r\n\r\n\t}\r\n\r\n\treturn r;\r\n\r\n};\r\n\r\nexport { WebGLUniforms };\r\n", "function WebGLShader( gl, type, string ) {\r\n\r\n\tconst shader = gl.createShader( type );\r\n\r\n\tgl.shaderSource( shader, string );\r\n\tgl.compileShader( shader );\r\n\r\n\treturn shader;\r\n\r\n}\r\n\r\nexport { WebGLShader };\r\n", "import { WebGLUniforms } from './WebGLUniforms.js';\r\nimport { WebGLShader } from './WebGLShader.js';\r\nimport { ShaderChunk } from '../shaders/ShaderChunk.js';\r\nimport { NoToneMapping, AddOperation, MixOperation, MultiplyOperation, CubeRefractionMapping, CubeUVRefractionMapping, CubeUVReflectionMapping, CubeReflectionMapping, PCFSoftShadowMap, PCFShadowMap, VSMShadowMap, ACESFilmicToneMapping, CineonToneMapping, CustomToneMapping, ReinhardToneMapping, LinearToneMapping, GammaEncoding, RGBDEncoding, RGBM16Encoding, RGBM7Encoding, RGBEEncoding, sRGBEncoding, LinearEncoding, LogLuvEncoding, GLSL3 } from '../../constants.js';\r\n\r\nlet programIdCount = 0;\r\n\r\nfunction addLineNumbers( string ) {\r\n\r\n\tconst lines = string.split( '\\n' );\r\n\r\n\tfor ( let i = 0; i < lines.length; i ++ ) {\r\n\r\n\t\tlines[ i ] = ( i + 1 ) + ': ' + lines[ i ];\r\n\r\n\t}\r\n\r\n\treturn lines.join( '\\n' );\r\n\r\n}\r\n\r\nfunction getEncodingComponents( encoding ) {\r\n\r\n\tswitch ( encoding ) {\r\n\r\n\t\tcase LinearEncoding:\r\n\t\t\treturn [ 'Linear', '( value )' ];\r\n\t\tcase sRGBEncoding:\r\n\t\t\treturn [ 'sRGB', '( value )' ];\r\n\t\tcase RGBEEncoding:\r\n\t\t\treturn [ 'RGBE', '( value )' ];\r\n\t\tcase RGBM7Encoding:\r\n\t\t\treturn [ 'RGBM', '( value, 7.0 )' ];\r\n\t\tcase RGBM16Encoding:\r\n\t\t\treturn [ 'RGBM', '( value, 16.0 )' ];\r\n\t\tcase RGBDEncoding:\r\n\t\t\treturn [ 'RGBD', '( value, 256.0 )' ];\r\n\t\tcase GammaEncoding:\r\n\t\t\treturn [ 'Gamma', '( value, float( GAMMA_FACTOR ) )' ];\r\n\t\tcase LogLuvEncoding:\r\n\t\t\treturn [ 'LogLuv', '( value )' ];\r\n\t\tdefault:\r\n\t\t\tconsole.warn( 'THREE.WebGLProgram: Unsupported encoding:', encoding );\r\n\t\t\treturn [ 'Linear', '( value )' ];\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction getShaderErrors( gl, shader, type ) {\r\n\r\n\tconst status = gl.getShaderParameter( shader, gl.COMPILE_STATUS );\r\n\tconst errors = gl.getShaderInfoLog( shader ).trim();\r\n\r\n\tif ( status && errors === '' ) return '';\r\n\r\n\t// --enable-privileged-webgl-extension\r\n\t// console.log( '**' + type + '**', gl.getExtension( 'WEBGL_debug_shaders' ).getTranslatedShaderSource( shader ) );\r\n\r\n\treturn type.toUpperCase() + '\\n\\n' + errors + '\\n\\n' + addLineNumbers( gl.getShaderSource( shader ) );\r\n\r\n}\r\n\r\nfunction getTexelDecodingFunction( functionName, encoding ) {\r\n\r\n\tconst components = getEncodingComponents( encoding );\r\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return ' + components[ 0 ] + 'ToLinear' + components[ 1 ] + '; }';\r\n\r\n}\r\n\r\nfunction getTexelEncodingFunction( functionName, encoding ) {\r\n\r\n\tconst components = getEncodingComponents( encoding );\r\n\treturn 'vec4 ' + functionName + '( vec4 value ) { return LinearTo' + components[ 0 ] + components[ 1 ] + '; }';\r\n\r\n}\r\n\r\nfunction getToneMappingFunction( functionName, toneMapping ) {\r\n\r\n\tlet toneMappingName;\r\n\r\n\tswitch ( toneMapping ) {\r\n\r\n\t\tcase LinearToneMapping:\r\n\t\t\ttoneMappingName = 'Linear';\r\n\t\t\tbreak;\r\n\r\n\t\tcase ReinhardToneMapping:\r\n\t\t\ttoneMappingName = 'Reinhard';\r\n\t\t\tbreak;\r\n\r\n\t\tcase CineonToneMapping:\r\n\t\t\ttoneMappingName = 'OptimizedCineon';\r\n\t\t\tbreak;\r\n\r\n\t\tcase ACESFilmicToneMapping:\r\n\t\t\ttoneMappingName = 'ACESFilmic';\r\n\t\t\tbreak;\r\n\r\n\t\tcase CustomToneMapping:\r\n\t\t\ttoneMappingName = 'Custom';\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconsole.warn( 'THREE.WebGLProgram: Unsupported toneMapping:', toneMapping );\r\n\t\t\ttoneMappingName = 'Linear';\r\n\r\n\t}\r\n\r\n\treturn 'vec3 ' + functionName + '( vec3 color ) { return ' + toneMappingName + 'ToneMapping( color ); }';\r\n\r\n}\r\n\r\nfunction generateExtensions( parameters ) {\r\n\r\n\tconst chunks = [\r\n\t\t( parameters.extensionDerivatives || parameters.envMapCubeUV || parameters.bumpMap || parameters.tangentSpaceNormalMap || parameters.clearcoatNormalMap || parameters.flatShading || parameters.shaderID === 'physical' ) ? '#extension GL_OES_standard_derivatives : enable' : '',\r\n\t\t( parameters.extensionFragDepth || parameters.logarithmicDepthBuffer ) && parameters.rendererExtensionFragDepth ? '#extension GL_EXT_frag_depth : enable' : '',\r\n\t\t( parameters.extensionDrawBuffers && parameters.rendererExtensionDrawBuffers ) ? '#extension GL_EXT_draw_buffers : require' : '',\r\n\t\t( parameters.extensionShaderTextureLOD || parameters.envMap || parameters.transmission > 0.0 ) && parameters.rendererExtensionShaderTextureLod ? '#extension GL_EXT_shader_texture_lod : enable' : ''\r\n\t];\r\n\r\n\treturn chunks.filter( filterEmptyLine ).join( '\\n' );\r\n\r\n}\r\n\r\nfunction generateDefines( defines ) {\r\n\r\n\tconst chunks = [];\r\n\r\n\tfor ( const name in defines ) {\r\n\r\n\t\tconst value = defines[ name ];\r\n\r\n\t\tif ( value === false ) continue;\r\n\r\n\t\tchunks.push( '#define ' + name + ' ' + value );\r\n\r\n\t}\r\n\r\n\treturn chunks.join( '\\n' );\r\n\r\n}\r\n\r\nfunction fetchAttributeLocations( gl, program ) {\r\n\r\n\tconst attributes = {};\r\n\r\n\tconst n = gl.getProgramParameter( program, gl.ACTIVE_ATTRIBUTES );\r\n\r\n\tfor ( let i = 0; i < n; i ++ ) {\r\n\r\n\t\tconst info = gl.getActiveAttrib( program, i );\r\n\t\tconst name = info.name;\r\n\r\n\t\t// console.log( 'THREE.WebGLProgram: ACTIVE VERTEX ATTRIBUTE:', name, i );\r\n\r\n\t\tattributes[ name ] = gl.getAttribLocation( program, name );\r\n\r\n\t}\r\n\r\n\treturn attributes;\r\n\r\n}\r\n\r\nfunction filterEmptyLine( string ) {\r\n\r\n\treturn string !== '';\r\n\r\n}\r\n\r\nfunction replaceLightNums( string, parameters ) {\r\n\r\n\treturn string\r\n\t\t.replace( /NUM_DIR_LIGHTS/g, parameters.numDirLights )\r\n\t\t.replace( /NUM_SPOT_LIGHTS/g, parameters.numSpotLights )\r\n\t\t.replace( /NUM_RECT_AREA_LIGHTS/g, parameters.numRectAreaLights )\r\n\t\t.replace( /NUM_POINT_LIGHTS/g, parameters.numPointLights )\r\n\t\t.replace( /NUM_HEMI_LIGHTS/g, parameters.numHemiLights )\r\n\t\t.replace( /NUM_DIR_LIGHT_SHADOWS/g, parameters.numDirLightShadows )\r\n\t\t.replace( /NUM_SPOT_LIGHT_SHADOWS/g, parameters.numSpotLightShadows )\r\n\t\t.replace( /NUM_POINT_LIGHT_SHADOWS/g, parameters.numPointLightShadows );\r\n\r\n}\r\n\r\nfunction replaceClippingPlaneNums( string, parameters ) {\r\n\r\n\treturn string\r\n\t\t.replace( /NUM_CLIPPING_PLANES/g, parameters.numClippingPlanes )\r\n\t\t.replace( /UNION_CLIPPING_PLANES/g, ( parameters.numClippingPlanes - parameters.numClipIntersection ) );\r\n\r\n}\r\n\r\n// Resolve Includes\r\n\r\nconst includePattern = /^[ \\t]*#include +<([\\w\\d./]+)>/gm;\r\n\r\nfunction resolveIncludes( string ) {\r\n\r\n\treturn string.replace( includePattern, includeReplacer );\r\n\r\n}\r\n\r\nfunction includeReplacer( match, include ) {\r\n\r\n\tconst string = ShaderChunk[ include ];\r\n\r\n\tif ( string === undefined ) {\r\n\r\n\t\tthrow new Error( 'Can not resolve #include <' + include + '>' );\r\n\r\n\t}\r\n\r\n\treturn resolveIncludes( string );\r\n\r\n}\r\n\r\n// Unroll Loops\r\n\r\nconst deprecatedUnrollLoopPattern = /#pragma unroll_loop[\\s]+?for \\( int i \\= (\\d+)\\; i < (\\d+)\\; i \\+\\+ \\) \\{([\\s\\S]+?)(?=\\})\\}/g;\r\nconst unrollLoopPattern = /#pragma unroll_loop_start\\s+for\\s*\\(\\s*int\\s+i\\s*=\\s*(\\d+)\\s*;\\s*i\\s*<\\s*(\\d+)\\s*;\\s*i\\s*\\+\\+\\s*\\)\\s*{([\\s\\S]+?)}\\s+#pragma unroll_loop_end/g;\r\n\r\nfunction unrollLoops( string ) {\r\n\r\n\treturn string\r\n\t\t.replace( unrollLoopPattern, loopReplacer )\r\n\t\t.replace( deprecatedUnrollLoopPattern, deprecatedLoopReplacer );\r\n\r\n}\r\n\r\nfunction deprecatedLoopReplacer( match, start, end, snippet ) {\r\n\r\n\tconsole.warn( 'WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead.' );\r\n\treturn loopReplacer( match, start, end, snippet );\r\n\r\n}\r\n\r\nfunction loopReplacer( match, start, end, snippet ) {\r\n\r\n\tlet string = '';\r\n\r\n\tfor ( let i = parseInt( start ); i < parseInt( end ); i ++ ) {\r\n\r\n\t\tstring += snippet\r\n\t\t\t.replace( /\\[\\s*i\\s*\\]/g, '[ ' + i + ' ]' )\r\n\t\t\t.replace( /UNROLLED_LOOP_INDEX/g, i );\r\n\r\n\t}\r\n\r\n\treturn string;\r\n\r\n}\r\n\r\n//\r\n\r\nfunction generatePrecision( parameters ) {\r\n\r\n\tlet precisionstring = 'precision ' + parameters.precision + ' float;\\nprecision ' + parameters.precision + ' int;';\r\n\r\n\tif ( parameters.precision === 'highp' ) {\r\n\r\n\t\tprecisionstring += '\\n#define HIGH_PRECISION';\r\n\r\n\t} else if ( parameters.precision === 'mediump' ) {\r\n\r\n\t\tprecisionstring += '\\n#define MEDIUM_PRECISION';\r\n\r\n\t} else if ( parameters.precision === 'lowp' ) {\r\n\r\n\t\tprecisionstring += '\\n#define LOW_PRECISION';\r\n\r\n\t}\r\n\r\n\treturn precisionstring;\r\n\r\n}\r\n\r\nfunction generateShadowMapTypeDefine( parameters ) {\r\n\r\n\tlet shadowMapTypeDefine = 'SHADOWMAP_TYPE_BASIC';\r\n\r\n\tif ( parameters.shadowMapType === PCFShadowMap ) {\r\n\r\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF';\r\n\r\n\t} else if ( parameters.shadowMapType === PCFSoftShadowMap ) {\r\n\r\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_PCF_SOFT';\r\n\r\n\t} else if ( parameters.shadowMapType === VSMShadowMap ) {\r\n\r\n\t\tshadowMapTypeDefine = 'SHADOWMAP_TYPE_VSM';\r\n\r\n\t}\r\n\r\n\treturn shadowMapTypeDefine;\r\n\r\n}\r\n\r\nfunction generateEnvMapTypeDefine( parameters ) {\r\n\r\n\tlet envMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\r\n\tif ( parameters.envMap ) {\r\n\r\n\t\tswitch ( parameters.envMapMode ) {\r\n\r\n\t\t\tcase CubeReflectionMapping:\r\n\t\t\tcase CubeRefractionMapping:\r\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase CubeUVReflectionMapping:\r\n\t\t\tcase CubeUVRefractionMapping:\r\n\t\t\t\tenvMapTypeDefine = 'ENVMAP_TYPE_CUBE_UV';\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn envMapTypeDefine;\r\n\r\n}\r\n\r\nfunction generateEnvMapModeDefine( parameters ) {\r\n\r\n\tlet envMapModeDefine = 'ENVMAP_MODE_REFLECTION';\r\n\r\n\tif ( parameters.envMap ) {\r\n\r\n\t\tswitch ( parameters.envMapMode ) {\r\n\r\n\t\t\tcase CubeRefractionMapping:\r\n\t\t\tcase CubeUVRefractionMapping:\r\n\r\n\t\t\t\tenvMapModeDefine = 'ENVMAP_MODE_REFRACTION';\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn envMapModeDefine;\r\n\r\n}\r\n\r\nfunction generateEnvMapBlendingDefine( parameters ) {\r\n\r\n\tlet envMapBlendingDefine = 'ENVMAP_BLENDING_NONE';\r\n\r\n\tif ( parameters.envMap ) {\r\n\r\n\t\tswitch ( parameters.combine ) {\r\n\r\n\t\t\tcase MultiplyOperation:\r\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MULTIPLY';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase MixOperation:\r\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_MIX';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AddOperation:\r\n\t\t\t\tenvMapBlendingDefine = 'ENVMAP_BLENDING_ADD';\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn envMapBlendingDefine;\r\n\r\n}\r\n\r\nfunction WebGLProgram( renderer, cacheKey, parameters, bindingStates ) {\r\n\r\n\tconst gl = renderer.getContext();\r\n\r\n\tconst defines = parameters.defines;\r\n\r\n\tlet vertexShader = parameters.vertexShader;\r\n\tlet fragmentShader = parameters.fragmentShader;\r\n\r\n\tconst shadowMapTypeDefine = generateShadowMapTypeDefine( parameters );\r\n\tconst envMapTypeDefine = generateEnvMapTypeDefine( parameters );\r\n\tconst envMapModeDefine = generateEnvMapModeDefine( parameters );\r\n\tconst envMapBlendingDefine = generateEnvMapBlendingDefine( parameters );\r\n\r\n\r\n\tconst gammaFactorDefine = ( renderer.gammaFactor > 0 ) ? renderer.gammaFactor : 1.0;\r\n\r\n\tconst customExtensions = parameters.isWebGL2 ? '' : generateExtensions( parameters );\r\n\r\n\tconst customDefines = generateDefines( defines );\r\n\r\n\tconst program = gl.createProgram();\r\n\r\n\tlet prefixVertex, prefixFragment;\r\n\tlet versionString = parameters.glslVersion ? '#version ' + parameters.glslVersion + '\\n' : '';\r\n\r\n\tif ( parameters.isRawShaderMaterial ) {\r\n\r\n\t\tprefixVertex = [\r\n\r\n\t\t\tcustomDefines\r\n\r\n\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t\tif ( prefixVertex.length > 0 ) {\r\n\r\n\t\t\tprefixVertex += '\\n';\r\n\r\n\t\t}\r\n\r\n\t\tprefixFragment = [\r\n\r\n\t\t\tcustomExtensions,\r\n\t\t\tcustomDefines\r\n\r\n\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t\tif ( prefixFragment.length > 0 ) {\r\n\r\n\t\t\tprefixFragment += '\\n';\r\n\r\n\t\t}\r\n\r\n\t} else {\r\n\r\n\t\tprefixVertex = [\r\n\r\n\t\t\tgeneratePrecision( parameters ),\r\n\r\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\r\n\r\n\t\t\tcustomDefines,\r\n\r\n\t\t\tparameters.instancing ? '#define USE_INSTANCING' : '',\r\n\t\t\tparameters.instancingColor ? '#define USE_INSTANCING_COLOR' : '',\r\n\r\n\t\t\tparameters.supportsVertexTextures ? '#define VERTEX_TEXTURES' : '',\r\n\r\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t'#define MAX_BONES ' + parameters.maxBones,\r\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\r\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\r\n\r\n\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\r\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\r\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\r\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\r\n\r\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\r\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\r\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\r\n\t\t\tparameters.displacementMap && parameters.supportsVertexTextures ? '#define USE_DISPLACEMENTMAP' : '',\r\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\tparameters.specularIntensityMap ? '#define USE_SPECULARINTENSITYMAP' : '',\r\n\t\t\tparameters.specularTintMap ? '#define USE_SPECULARTINTMAP' : '',\r\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\r\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\r\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\t\t\tparameters.transmission ? '#define USE_TRANSMISSION' : '',\r\n\t\t\tparameters.transmissionMap ? '#define USE_TRANSMISSIONMAP' : '',\r\n\t\t\tparameters.thicknessMap ? '#define USE_THICKNESSMAP' : '',\r\n\r\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\r\n\t\t\tparameters.vertexColors ? '#define USE_COLOR' : '',\r\n\t\t\tparameters.vertexAlphas ? '#define USE_COLOR_ALPHA' : '',\r\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\r\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\r\n\r\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n\t\t\tparameters.skinning ? '#define USE_SKINNING' : '',\r\n\t\t\tparameters.useVertexTexture ? '#define BONE_TEXTURE' : '',\r\n\r\n\t\t\tparameters.morphTargets ? '#define USE_MORPHTARGETS' : '',\r\n\t\t\tparameters.morphNormals && parameters.flatShading === false ? '#define USE_MORPHNORMALS' : '',\r\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\r\n\t\t\tparameters.sizeAttenuation ? '#define USE_SIZEATTENUATION' : '',\r\n\r\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\t\t\t'uniform mat4 modelMatrix;',\r\n\t\t\t'uniform mat4 modelViewMatrix;',\r\n\t\t\t'uniform mat4 projectionMatrix;',\r\n\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t'uniform mat3 normalMatrix;',\r\n\t\t\t'uniform vec3 cameraPosition;',\r\n\t\t\t'uniform bool isOrthographic;',\r\n\r\n\t\t\t'#ifdef USE_INSTANCING',\r\n\r\n\t\t\t'\tattribute mat4 instanceMatrix;',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'#ifdef USE_INSTANCING_COLOR',\r\n\r\n\t\t\t'\tattribute vec3 instanceColor;',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'attribute vec3 position;',\r\n\t\t\t'attribute vec3 normal;',\r\n\t\t\t'attribute vec2 uv;',\r\n\r\n\t\t\t'#ifdef USE_TANGENT',\r\n\r\n\t\t\t'\tattribute vec4 tangent;',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'#if defined( USE_COLOR_ALPHA )',\r\n\r\n\t\t\t'\tattribute vec4 color;',\r\n\r\n\t\t\t'#elif defined( USE_COLOR )',\r\n\r\n\t\t\t'\tattribute vec3 color;',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'#ifdef USE_MORPHTARGETS',\r\n\r\n\t\t\t'\tattribute vec3 morphTarget0;',\r\n\t\t\t'\tattribute vec3 morphTarget1;',\r\n\t\t\t'\tattribute vec3 morphTarget2;',\r\n\t\t\t'\tattribute vec3 morphTarget3;',\r\n\r\n\t\t\t'\t#ifdef USE_MORPHNORMALS',\r\n\r\n\t\t\t'\t\tattribute vec3 morphNormal0;',\r\n\t\t\t'\t\tattribute vec3 morphNormal1;',\r\n\t\t\t'\t\tattribute vec3 morphNormal2;',\r\n\t\t\t'\t\tattribute vec3 morphNormal3;',\r\n\r\n\t\t\t'\t#else',\r\n\r\n\t\t\t'\t\tattribute vec3 morphTarget4;',\r\n\t\t\t'\t\tattribute vec3 morphTarget5;',\r\n\t\t\t'\t\tattribute vec3 morphTarget6;',\r\n\t\t\t'\t\tattribute vec3 morphTarget7;',\r\n\r\n\t\t\t'\t#endif',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'#ifdef USE_SKINNING',\r\n\r\n\t\t\t'\tattribute vec4 skinIndex;',\r\n\t\t\t'\tattribute vec4 skinWeight;',\r\n\r\n\t\t\t'#endif',\r\n\r\n\t\t\t'\\n'\r\n\r\n\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t\tprefixFragment = [\r\n\r\n\t\t\tcustomExtensions,\r\n\r\n\t\t\tgeneratePrecision( parameters ),\r\n\r\n\t\t\t'#define SHADER_NAME ' + parameters.shaderName,\r\n\r\n\t\t\tcustomDefines,\r\n\r\n\t\t\tparameters.alphaTest ? '#define ALPHATEST ' + parameters.alphaTest + ( parameters.alphaTest % 1 ? '' : '.0' ) : '', // add '.0' if integer\r\n\r\n\t\t\t'#define GAMMA_FACTOR ' + gammaFactorDefine,\r\n\r\n\t\t\t( parameters.useFog && parameters.fog ) ? '#define USE_FOG' : '',\r\n\t\t\t( parameters.useFog && parameters.fogExp2 ) ? '#define FOG_EXP2' : '',\r\n\r\n\t\t\tparameters.map ? '#define USE_MAP' : '',\r\n\t\t\tparameters.matcap ? '#define USE_MATCAP' : '',\r\n\t\t\tparameters.envMap ? '#define USE_ENVMAP' : '',\r\n\t\t\tparameters.envMap ? '#define ' + envMapTypeDefine : '',\r\n\t\t\tparameters.envMap ? '#define ' + envMapModeDefine : '',\r\n\t\t\tparameters.envMap ? '#define ' + envMapBlendingDefine : '',\r\n\t\t\tparameters.lightMap ? '#define USE_LIGHTMAP' : '',\r\n\t\t\tparameters.aoMap ? '#define USE_AOMAP' : '',\r\n\t\t\tparameters.emissiveMap ? '#define USE_EMISSIVEMAP' : '',\r\n\t\t\tparameters.bumpMap ? '#define USE_BUMPMAP' : '',\r\n\t\t\tparameters.normalMap ? '#define USE_NORMALMAP' : '',\r\n\t\t\t( parameters.normalMap && parameters.objectSpaceNormalMap ) ? '#define OBJECTSPACE_NORMALMAP' : '',\r\n\t\t\t( parameters.normalMap && parameters.tangentSpaceNormalMap ) ? '#define TANGENTSPACE_NORMALMAP' : '',\r\n\t\t\tparameters.clearcoatMap ? '#define USE_CLEARCOATMAP' : '',\r\n\t\t\tparameters.clearcoatRoughnessMap ? '#define USE_CLEARCOAT_ROUGHNESSMAP' : '',\r\n\t\t\tparameters.clearcoatNormalMap ? '#define USE_CLEARCOAT_NORMALMAP' : '',\r\n\t\t\tparameters.specularMap ? '#define USE_SPECULARMAP' : '',\r\n\t\t\tparameters.specularIntensityMap ? '#define USE_SPECULARINTENSITYMAP' : '',\r\n\t\t\tparameters.specularTintMap ? '#define USE_SPECULARTINTMAP' : '',\r\n\t\t\tparameters.roughnessMap ? '#define USE_ROUGHNESSMAP' : '',\r\n\t\t\tparameters.metalnessMap ? '#define USE_METALNESSMAP' : '',\r\n\t\t\tparameters.alphaMap ? '#define USE_ALPHAMAP' : '',\r\n\r\n\t\t\tparameters.sheen ? '#define USE_SHEEN' : '',\r\n\t\t\tparameters.transmission ? '#define USE_TRANSMISSION' : '',\r\n\t\t\tparameters.transmissionMap ? '#define USE_TRANSMISSIONMAP' : '',\r\n\t\t\tparameters.thicknessMap ? '#define USE_THICKNESSMAP' : '',\r\n\r\n\t\t\tparameters.vertexTangents ? '#define USE_TANGENT' : '',\r\n\t\t\tparameters.vertexColors || parameters.instancingColor ? '#define USE_COLOR' : '',\r\n\t\t\tparameters.vertexAlphas ? '#define USE_COLOR_ALPHA' : '',\r\n\t\t\tparameters.vertexUvs ? '#define USE_UV' : '',\r\n\t\t\tparameters.uvsVertexOnly ? '#define UVS_VERTEX_ONLY' : '',\r\n\r\n\t\t\tparameters.gradientMap ? '#define USE_GRADIENTMAP' : '',\r\n\r\n\t\t\tparameters.flatShading ? '#define FLAT_SHADED' : '',\r\n\r\n\t\t\tparameters.doubleSided ? '#define DOUBLE_SIDED' : '',\r\n\t\t\tparameters.flipSided ? '#define FLIP_SIDED' : '',\r\n\r\n\t\t\tparameters.shadowMapEnabled ? '#define USE_SHADOWMAP' : '',\r\n\t\t\tparameters.shadowMapEnabled ? '#define ' + shadowMapTypeDefine : '',\r\n\r\n\t\t\tparameters.premultipliedAlpha ? '#define PREMULTIPLIED_ALPHA' : '',\r\n\r\n\t\t\tparameters.physicallyCorrectLights ? '#define PHYSICALLY_CORRECT_LIGHTS' : '',\r\n\r\n\t\t\tparameters.logarithmicDepthBuffer ? '#define USE_LOGDEPTHBUF' : '',\r\n\t\t\t( parameters.logarithmicDepthBuffer && parameters.rendererExtensionFragDepth ) ? '#define USE_LOGDEPTHBUF_EXT' : '',\r\n\r\n\t\t\t( ( parameters.extensionShaderTextureLOD || parameters.envMap ) && parameters.rendererExtensionShaderTextureLod ) ? '#define TEXTURE_LOD_EXT' : '',\r\n\r\n\t\t\t'uniform mat4 viewMatrix;',\r\n\t\t\t'uniform vec3 cameraPosition;',\r\n\t\t\t'uniform bool isOrthographic;',\r\n\r\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? '#define TONE_MAPPING' : '',\r\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? ShaderChunk[ 'tonemapping_pars_fragment' ] : '', // this code is required here because it is used by the toneMapping() function defined below\r\n\t\t\t( parameters.toneMapping !== NoToneMapping ) ? getToneMappingFunction( 'toneMapping', parameters.toneMapping ) : '',\r\n\r\n\t\t\tparameters.dithering ? '#define DITHERING' : '',\r\n\r\n\t\t\tShaderChunk[ 'encodings_pars_fragment' ], // this code is required here because it is used by the various encoding/decoding function defined below\r\n\t\t\tparameters.map ? getTexelDecodingFunction( 'mapTexelToLinear', parameters.mapEncoding ) : '',\r\n\t\t\tparameters.matcap ? getTexelDecodingFunction( 'matcapTexelToLinear', parameters.matcapEncoding ) : '',\r\n\t\t\tparameters.envMap ? getTexelDecodingFunction( 'envMapTexelToLinear', parameters.envMapEncoding ) : '',\r\n\t\t\tparameters.emissiveMap ? getTexelDecodingFunction( 'emissiveMapTexelToLinear', parameters.emissiveMapEncoding ) : '',\r\n\t\t\tparameters.specularTintMap ? getTexelDecodingFunction( 'specularTintMapTexelToLinear', parameters.specularTintMapEncoding ) : '',\r\n\t\t\tparameters.lightMap ? getTexelDecodingFunction( 'lightMapTexelToLinear', parameters.lightMapEncoding ) : '',\r\n\t\t\tgetTexelEncodingFunction( 'linearToOutputTexel', parameters.outputEncoding ),\r\n\r\n\t\t\tparameters.depthPacking ? '#define DEPTH_PACKING ' + parameters.depthPacking : '',\r\n\r\n\t\t\t'\\n'\r\n\r\n\t\t].filter( filterEmptyLine ).join( '\\n' );\r\n\r\n\t}\r\n\r\n\tvertexShader = resolveIncludes( vertexShader );\r\n\tvertexShader = replaceLightNums( vertexShader, parameters );\r\n\tvertexShader = replaceClippingPlaneNums( vertexShader, parameters );\r\n\r\n\tfragmentShader = resolveIncludes( fragmentShader );\r\n\tfragmentShader = replaceLightNums( fragmentShader, parameters );\r\n\tfragmentShader = replaceClippingPlaneNums( fragmentShader, parameters );\r\n\r\n\tvertexShader = unrollLoops( vertexShader );\r\n\tfragmentShader = unrollLoops( fragmentShader );\r\n\r\n\tif ( parameters.isWebGL2 && parameters.isRawShaderMaterial !== true ) {\r\n\r\n\t\t// GLSL 3.0 conversion for built-in materials and ShaderMaterial\r\n\r\n\t\tversionString = '#version 300 es\\n';\r\n\r\n\t\tprefixVertex = [\r\n\t\t\t'#define attribute in',\r\n\t\t\t'#define varying out',\r\n\t\t\t'#define texture2D texture'\r\n\t\t].join( '\\n' ) + '\\n' + prefixVertex;\r\n\r\n\t\tprefixFragment = [\r\n\t\t\t'#define varying in',\r\n\t\t\t( parameters.glslVersion === GLSL3 ) ? '' : 'out highp vec4 pc_fragColor;',\r\n\t\t\t( parameters.glslVersion === GLSL3 ) ? '' : '#define gl_FragColor pc_fragColor',\r\n\t\t\t'#define gl_FragDepthEXT gl_FragDepth',\r\n\t\t\t'#define texture2D texture',\r\n\t\t\t'#define textureCube texture',\r\n\t\t\t'#define texture2DProj textureProj',\r\n\t\t\t'#define texture2DLodEXT textureLod',\r\n\t\t\t'#define texture2DProjLodEXT textureProjLod',\r\n\t\t\t'#define textureCubeLodEXT textureLod',\r\n\t\t\t'#define texture2DGradEXT textureGrad',\r\n\t\t\t'#define texture2DProjGradEXT textureProjGrad',\r\n\t\t\t'#define textureCubeGradEXT textureGrad'\r\n\t\t].join( '\\n' ) + '\\n' + prefixFragment;\r\n\r\n\t}\r\n\r\n\tconst vertexGlsl = versionString + prefixVertex + vertexShader;\r\n\tconst fragmentGlsl = versionString + prefixFragment + fragmentShader;\r\n\r\n\t// console.log( '*VERTEX*', vertexGlsl );\r\n\t// console.log( '*FRAGMENT*', fragmentGlsl );\r\n\r\n\tconst glVertexShader = WebGLShader( gl, gl.VERTEX_SHADER, vertexGlsl );\r\n\tconst glFragmentShader = WebGLShader( gl, gl.FRAGMENT_SHADER, fragmentGlsl );\r\n\r\n\tgl.attachShader( program, glVertexShader );\r\n\tgl.attachShader( program, glFragmentShader );\r\n\r\n\t// Force a particular attribute to index 0.\r\n\r\n\tif ( parameters.index0AttributeName !== undefined ) {\r\n\r\n\t\tgl.bindAttribLocation( program, 0, parameters.index0AttributeName );\r\n\r\n\t} else if ( parameters.morphTargets === true ) {\r\n\r\n\t\t// programs with morphTargets displace position out of attribute 0\r\n\t\tgl.bindAttribLocation( program, 0, 'position' );\r\n\r\n\t}\r\n\r\n\tgl.linkProgram( program );\r\n\r\n\t// check for link errors\r\n\tif ( renderer.debug.checkShaderErrors ) {\r\n\r\n\t\tconst programLog = gl.getProgramInfoLog( program ).trim();\r\n\t\tconst vertexLog = gl.getShaderInfoLog( glVertexShader ).trim();\r\n\t\tconst fragmentLog = gl.getShaderInfoLog( glFragmentShader ).trim();\r\n\r\n\t\tlet runnable = true;\r\n\t\tlet haveDiagnostics = true;\r\n\r\n\t\tif ( gl.getProgramParameter( program, gl.LINK_STATUS ) === false ) {\r\n\r\n\t\t\trunnable = false;\r\n\r\n\t\t\tconst vertexErrors = getShaderErrors( gl, glVertexShader, 'vertex' );\r\n\t\t\tconst fragmentErrors = getShaderErrors( gl, glFragmentShader, 'fragment' );\r\n\r\n\t\t\tconsole.error(\r\n\t\t\t\t'THREE.WebGLProgram: Shader Error ' + gl.getError() + ' - ' +\r\n\t\t\t\t'VALIDATE_STATUS ' + gl.getProgramParameter( program, gl.VALIDATE_STATUS ) + '\\n\\n' +\r\n\t\t\t\t'Program Info Log: ' + programLog + '\\n' +\r\n\t\t\t\tvertexErrors + '\\n' +\r\n\t\t\t\tfragmentErrors\r\n\t\t\t);\r\n\r\n\t\t} else if ( programLog !== '' ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLProgram: Program Info Log:', programLog );\r\n\r\n\t\t} else if ( vertexLog === '' || fragmentLog === '' ) {\r\n\r\n\t\t\thaveDiagnostics = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( haveDiagnostics ) {\r\n\r\n\t\t\tthis.diagnostics = {\r\n\r\n\t\t\t\trunnable: runnable,\r\n\r\n\t\t\t\tprogramLog: programLog,\r\n\r\n\t\t\t\tvertexShader: {\r\n\r\n\t\t\t\t\tlog: vertexLog,\r\n\t\t\t\t\tprefix: prefixVertex\r\n\r\n\t\t\t\t},\r\n\r\n\t\t\t\tfragmentShader: {\r\n\r\n\t\t\t\t\tlog: fragmentLog,\r\n\t\t\t\t\tprefix: prefixFragment\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Clean up\r\n\r\n\t// Crashes in iOS9 and iOS10. #18402\r\n\t// gl.detachShader( program, glVertexShader );\r\n\t// gl.detachShader( program, glFragmentShader );\r\n\r\n\tgl.deleteShader( glVertexShader );\r\n\tgl.deleteShader( glFragmentShader );\r\n\r\n\t// set up caching for uniform locations\r\n\r\n\tlet cachedUniforms;\r\n\r\n\tthis.getUniforms = function () {\r\n\r\n\t\tif ( cachedUniforms === undefined ) {\r\n\r\n\t\t\tcachedUniforms = new WebGLUniforms( gl, program );\r\n\r\n\t\t}\r\n\r\n\t\treturn cachedUniforms;\r\n\r\n\t};\r\n\r\n\t// set up caching for attribute locations\r\n\r\n\tlet cachedAttributes;\r\n\r\n\tthis.getAttributes = function () {\r\n\r\n\t\tif ( cachedAttributes === undefined ) {\r\n\r\n\t\t\tcachedAttributes = fetchAttributeLocations( gl, program );\r\n\r\n\t\t}\r\n\r\n\t\treturn cachedAttributes;\r\n\r\n\t};\r\n\r\n\t// free resource\r\n\r\n\tthis.destroy = function () {\r\n\r\n\t\tbindingStates.releaseStatesOfProgram( this );\r\n\r\n\t\tgl.deleteProgram( program );\r\n\t\tthis.program = undefined;\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tthis.name = parameters.shaderName;\r\n\tthis.id = programIdCount ++;\r\n\tthis.cacheKey = cacheKey;\r\n\tthis.usedTimes = 1;\r\n\tthis.program = program;\r\n\tthis.vertexShader = glVertexShader;\r\n\tthis.fragmentShader = glFragmentShader;\r\n\r\n\treturn this;\r\n\r\n}\r\n\r\nexport { WebGLProgram };\r\n", "import { BackSide, DoubleSide, CubeUVRefractionMapping, CubeUVReflectionMapping, LinearEncoding, ObjectSpaceNormalMap, TangentSpaceNormalMap, NoToneMapping } from '../../constants.js';\r\nimport { WebGLProgram } from './WebGLProgram.js';\r\nimport { ShaderLib } from '../shaders/ShaderLib.js';\r\nimport { UniformsUtils } from '../shaders/UniformsUtils.js';\r\n\r\nfunction WebGLPrograms( renderer, cubemaps, cubeuvmaps, extensions, capabilities, bindingStates, clipping ) {\r\n\r\n\tconst programs = [];\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\tconst logarithmicDepthBuffer = capabilities.logarithmicDepthBuffer;\r\n\tconst floatVertexTextures = capabilities.floatVertexTextures;\r\n\tconst maxVertexUniforms = capabilities.maxVertexUniforms;\r\n\tconst vertexTextures = capabilities.vertexTextures;\r\n\r\n\tlet precision = capabilities.precision;\r\n\r\n\tconst shaderIDs = {\r\n\t\tMeshDepthMaterial: 'depth',\r\n\t\tMeshDistanceMaterial: 'distanceRGBA',\r\n\t\tMeshNormalMaterial: 'normal',\r\n\t\tMeshBasicMaterial: 'basic',\r\n\t\tMeshLambertMaterial: 'lambert',\r\n\t\tMeshPhongMaterial: 'phong',\r\n\t\tMeshToonMaterial: 'toon',\r\n\t\tMeshStandardMaterial: 'physical',\r\n\t\tMeshPhysicalMaterial: 'physical',\r\n\t\tMeshMatcapMaterial: 'matcap',\r\n\t\tLineBasicMaterial: 'basic',\r\n\t\tLineDashedMaterial: 'dashed',\r\n\t\tPointsMaterial: 'points',\r\n\t\tShadowMaterial: 'shadow',\r\n\t\tSpriteMaterial: 'sprite'\r\n\t};\r\n\r\n\tconst parameterNames = [\r\n\t\t'precision', 'isWebGL2', 'supportsVertexTextures', 'outputEncoding', 'instancing', 'instancingColor',\r\n\t\t'map', 'mapEncoding', 'matcap', 'matcapEncoding', 'envMap', 'envMapMode', 'envMapEncoding', 'envMapCubeUV',\r\n\t\t'lightMap', 'lightMapEncoding', 'aoMap', 'emissiveMap', 'emissiveMapEncoding', 'bumpMap', 'normalMap',\r\n\t\t'objectSpaceNormalMap', 'tangentSpaceNormalMap', 'clearcoatMap', 'clearcoatRoughnessMap', 'clearcoatNormalMap', 'displacementMap',\r\n\t\t'specularMap', 'specularIntensityMap', 'specularTintMap', 'specularTintMapEncoding', 'roughnessMap', 'metalnessMap', 'gradientMap',\r\n\t\t'alphaMap', 'combine', 'vertexColors', 'vertexAlphas', 'vertexTangents', 'vertexUvs', 'uvsVertexOnly', 'fog', 'useFog', 'fogExp2',\r\n\t\t'flatShading', 'sizeAttenuation', 'logarithmicDepthBuffer', 'skinning',\r\n\t\t'maxBones', 'useVertexTexture', 'morphTargets', 'morphNormals', 'premultipliedAlpha',\r\n\t\t'numDirLights', 'numPointLights', 'numSpotLights', 'numHemiLights', 'numRectAreaLights',\r\n\t\t'numDirLightShadows', 'numPointLightShadows', 'numSpotLightShadows',\r\n\t\t'shadowMapEnabled', 'shadowMapType', 'toneMapping', 'physicallyCorrectLights',\r\n\t\t'alphaTest', 'doubleSided', 'flipSided', 'numClippingPlanes', 'numClipIntersection', 'depthPacking', 'dithering',\r\n\t\t'sheen', 'transmission', 'transmissionMap', 'thicknessMap'\r\n\t];\r\n\r\n\tfunction getMaxBones( object ) {\r\n\r\n\t\tconst skeleton = object.skeleton;\r\n\t\tconst bones = skeleton.bones;\r\n\r\n\t\tif ( floatVertexTextures ) {\r\n\r\n\t\t\treturn 1024;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// default for when object is not specified\r\n\t\t\t// ( for example when prebuilding shader to be used with multiple objects )\r\n\t\t\t//\r\n\t\t\t//  - leave some extra space for other uniforms\r\n\t\t\t//  - limit here is ANGLE's 254 max uniform vectors\r\n\t\t\t//    (up to 54 should be safe)\r\n\r\n\t\t\tconst nVertexUniforms = maxVertexUniforms;\r\n\t\t\tconst nVertexMatrices = Math.floor( ( nVertexUniforms - 20 ) / 4 );\r\n\r\n\t\t\tconst maxBones = Math.min( nVertexMatrices, bones.length );\r\n\r\n\t\t\tif ( maxBones < bones.length ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Skeleton has ' + bones.length + ' bones. This GPU supports ' + maxBones + '.' );\r\n\t\t\t\treturn 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn maxBones;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction getTextureEncodingFromMap( map ) {\r\n\r\n\t\tlet encoding;\r\n\r\n\t\tif ( map && map.isTexture ) {\r\n\r\n\t\t\tencoding = map.encoding;\r\n\r\n\t\t} else if ( map && map.isWebGLRenderTarget ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLPrograms.getTextureEncodingFromMap: don\\'t use render targets as textures. Use their .texture property instead.' );\r\n\t\t\tencoding = map.texture.encoding;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tencoding = LinearEncoding;\r\n\r\n\t\t}\r\n\r\n\t\treturn encoding;\r\n\r\n\t}\r\n\r\n\tfunction getParameters( material, lights, shadows, scene, object ) {\r\n\r\n\t\tconst fog = scene.fog;\r\n\t\tconst environment = material.isMeshStandardMaterial ? scene.environment : null;\r\n\r\n\t\tconst envMap = ( material.isMeshStandardMaterial ? cubeuvmaps : cubemaps ).get( material.envMap || environment );\r\n\r\n\t\tconst shaderID = shaderIDs[ material.type ];\r\n\r\n\t\t// heuristics to create shader parameters according to lights in the scene\r\n\t\t// (not to blow over maxLights budget)\r\n\r\n\t\tconst maxBones = object.isSkinnedMesh ? getMaxBones( object ) : 0;\r\n\r\n\t\tif ( material.precision !== null ) {\r\n\r\n\t\t\tprecision = capabilities.getMaxPrecision( material.precision );\r\n\r\n\t\t\tif ( precision !== material.precision ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLProgram.getParameters:', material.precision, 'not supported, using', precision, 'instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet vertexShader, fragmentShader;\r\n\r\n\t\tif ( shaderID ) {\r\n\r\n\t\t\tconst shader = ShaderLib[ shaderID ];\r\n\r\n\t\t\tvertexShader = shader.vertexShader;\r\n\t\t\tfragmentShader = shader.fragmentShader;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tvertexShader = material.vertexShader;\r\n\t\t\tfragmentShader = material.fragmentShader;\r\n\r\n\t\t}\r\n\r\n\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\tconst parameters = {\r\n\r\n\t\t\tisWebGL2: isWebGL2,\r\n\r\n\t\t\tshaderID: shaderID,\r\n\t\t\tshaderName: material.type,\r\n\r\n\t\t\tvertexShader: vertexShader,\r\n\t\t\tfragmentShader: fragmentShader,\r\n\t\t\tdefines: material.defines,\r\n\r\n\t\t\tisRawShaderMaterial: material.isRawShaderMaterial === true,\r\n\t\t\tglslVersion: material.glslVersion,\r\n\r\n\t\t\tprecision: precision,\r\n\r\n\t\t\tinstancing: object.isInstancedMesh === true,\r\n\t\t\tinstancingColor: object.isInstancedMesh === true && object.instanceColor !== null,\r\n\r\n\t\t\tsupportsVertexTextures: vertexTextures,\r\n\t\t\toutputEncoding: ( currentRenderTarget !== null ) ? getTextureEncodingFromMap( currentRenderTarget.texture ) : renderer.outputEncoding,\r\n\t\t\tmap: !! material.map,\r\n\t\t\tmapEncoding: getTextureEncodingFromMap( material.map ),\r\n\t\t\tmatcap: !! material.matcap,\r\n\t\t\tmatcapEncoding: getTextureEncodingFromMap( material.matcap ),\r\n\t\t\tenvMap: !! envMap,\r\n\t\t\tenvMapMode: envMap && envMap.mapping,\r\n\t\t\tenvMapEncoding: getTextureEncodingFromMap( envMap ),\r\n\t\t\tenvMapCubeUV: ( !! envMap ) && ( ( envMap.mapping === CubeUVReflectionMapping ) || ( envMap.mapping === CubeUVRefractionMapping ) ),\r\n\t\t\tlightMap: !! material.lightMap,\r\n\t\t\tlightMapEncoding: getTextureEncodingFromMap( material.lightMap ),\r\n\t\t\taoMap: !! material.aoMap,\r\n\t\t\temissiveMap: !! material.emissiveMap,\r\n\t\t\temissiveMapEncoding: getTextureEncodingFromMap( material.emissiveMap ),\r\n\t\t\tbumpMap: !! material.bumpMap,\r\n\t\t\tnormalMap: !! material.normalMap,\r\n\t\t\tobjectSpaceNormalMap: material.normalMapType === ObjectSpaceNormalMap,\r\n\t\t\ttangentSpaceNormalMap: material.normalMapType === TangentSpaceNormalMap,\r\n\t\t\tclearcoatMap: !! material.clearcoatMap,\r\n\t\t\tclearcoatRoughnessMap: !! material.clearcoatRoughnessMap,\r\n\t\t\tclearcoatNormalMap: !! material.clearcoatNormalMap,\r\n\t\t\tdisplacementMap: !! material.displacementMap,\r\n\t\t\troughnessMap: !! material.roughnessMap,\r\n\t\t\tmetalnessMap: !! material.metalnessMap,\r\n\t\t\tspecularMap: !! material.specularMap,\r\n\t\t\tspecularIntensityMap: !! material.specularIntensityMap,\r\n\t\t\tspecularTintMap: !! material.specularTintMap,\r\n\t\t\tspecularTintMapEncoding: getTextureEncodingFromMap( material.specularTintMap ),\r\n\t\t\talphaMap: !! material.alphaMap,\r\n\r\n\t\t\tgradientMap: !! material.gradientMap,\r\n\r\n\t\t\tsheen: !! material.sheen,\r\n\r\n\t\t\ttransmission: !! material.transmission,\r\n\t\t\ttransmissionMap: !! material.transmissionMap,\r\n\t\t\tthicknessMap: !! material.thicknessMap,\r\n\r\n\t\t\tcombine: material.combine,\r\n\r\n\t\t\tvertexTangents: ( !! material.normalMap && !! object.geometry && !! object.geometry.attributes.tangent ),\r\n\t\t\tvertexColors: material.vertexColors,\r\n\t\t\tvertexAlphas: material.vertexColors === true && !! object.geometry && !! object.geometry.attributes.color && object.geometry.attributes.color.itemSize === 4,\r\n\t\t\tvertexUvs: !! material.map || !! material.bumpMap || !! material.normalMap || !! material.specularMap || !! material.alphaMap || !! material.emissiveMap || !! material.roughnessMap || !! material.metalnessMap || !! material.clearcoatMap || !! material.clearcoatRoughnessMap || !! material.clearcoatNormalMap || !! material.displacementMap || !! material.transmissionMap || !! material.thicknessMap || !! material.specularIntensityMap || !! material.specularTintMap,\r\n\t\t\tuvsVertexOnly: ! ( !! material.map || !! material.bumpMap || !! material.normalMap || !! material.specularMap || !! material.alphaMap || !! material.emissiveMap || !! material.roughnessMap || !! material.metalnessMap || !! material.clearcoatNormalMap || !! material.transmission || !! material.transmissionMap || !! material.thicknessMap || !! material.specularIntensityMap || !! material.specularTintMap ) && !! material.displacementMap,\r\n\r\n\t\t\tfog: !! fog,\r\n\t\t\tuseFog: material.fog,\r\n\t\t\tfogExp2: ( fog && fog.isFogExp2 ),\r\n\r\n\t\t\tflatShading: !! material.flatShading,\r\n\r\n\t\t\tsizeAttenuation: material.sizeAttenuation,\r\n\t\t\tlogarithmicDepthBuffer: logarithmicDepthBuffer,\r\n\r\n\t\t\tskinning: object.isSkinnedMesh === true && maxBones > 0,\r\n\t\t\tmaxBones: maxBones,\r\n\t\t\tuseVertexTexture: floatVertexTextures,\r\n\r\n\t\t\tmorphTargets: !! object.geometry && !! object.geometry.morphAttributes.position,\r\n\t\t\tmorphNormals: !! object.geometry && !! object.geometry.morphAttributes.normal,\r\n\r\n\t\t\tnumDirLights: lights.directional.length,\r\n\t\t\tnumPointLights: lights.point.length,\r\n\t\t\tnumSpotLights: lights.spot.length,\r\n\t\t\tnumRectAreaLights: lights.rectArea.length,\r\n\t\t\tnumHemiLights: lights.hemi.length,\r\n\r\n\t\t\tnumDirLightShadows: lights.directionalShadowMap.length,\r\n\t\t\tnumPointLightShadows: lights.pointShadowMap.length,\r\n\t\t\tnumSpotLightShadows: lights.spotShadowMap.length,\r\n\r\n\t\t\tnumClippingPlanes: clipping.numPlanes,\r\n\t\t\tnumClipIntersection: clipping.numIntersection,\r\n\r\n\t\t\tdithering: material.dithering,\r\n\r\n\t\t\tshadowMapEnabled: renderer.shadowMap.enabled && shadows.length > 0,\r\n\t\t\tshadowMapType: renderer.shadowMap.type,\r\n\r\n\t\t\ttoneMapping: material.toneMapped ? renderer.toneMapping : NoToneMapping,\r\n\t\t\tphysicallyCorrectLights: renderer.physicallyCorrectLights,\r\n\r\n\t\t\tpremultipliedAlpha: material.premultipliedAlpha,\r\n\r\n\t\t\talphaTest: material.alphaTest,\r\n\t\t\tdoubleSided: material.side === DoubleSide,\r\n\t\t\tflipSided: material.side === BackSide,\r\n\r\n\t\t\tdepthPacking: ( material.depthPacking !== undefined ) ? material.depthPacking : false,\r\n\r\n\t\t\tindex0AttributeName: material.index0AttributeName,\r\n\r\n\t\t\textensionDerivatives: material.extensions && material.extensions.derivatives,\r\n\t\t\textensionFragDepth: material.extensions && material.extensions.fragDepth,\r\n\t\t\textensionDrawBuffers: material.extensions && material.extensions.drawBuffers,\r\n\t\t\textensionShaderTextureLOD: material.extensions && material.extensions.shaderTextureLOD,\r\n\r\n\t\t\trendererExtensionFragDepth: isWebGL2 || extensions.has( 'EXT_frag_depth' ),\r\n\t\t\trendererExtensionDrawBuffers: isWebGL2 || extensions.has( 'WEBGL_draw_buffers' ),\r\n\t\t\trendererExtensionShaderTextureLod: isWebGL2 || extensions.has( 'EXT_shader_texture_lod' ),\r\n\r\n\t\t\tcustomProgramCacheKey: material.customProgramCacheKey()\r\n\r\n\t\t};\r\n\r\n\t\treturn parameters;\r\n\r\n\t}\r\n\r\n\tfunction getProgramCacheKey( parameters ) {\r\n\r\n\t\tconst array = [];\r\n\r\n\t\tif ( parameters.shaderID ) {\r\n\r\n\t\t\tarray.push( parameters.shaderID );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tarray.push( parameters.fragmentShader );\r\n\t\t\tarray.push( parameters.vertexShader );\r\n\r\n\t\t}\r\n\r\n\t\tif ( parameters.defines !== undefined ) {\r\n\r\n\t\t\tfor ( const name in parameters.defines ) {\r\n\r\n\t\t\t\tarray.push( name );\r\n\t\t\t\tarray.push( parameters.defines[ name ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( parameters.isRawShaderMaterial === false ) {\r\n\r\n\t\t\tfor ( let i = 0; i < parameterNames.length; i ++ ) {\r\n\r\n\t\t\t\tarray.push( parameters[ parameterNames[ i ] ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tarray.push( renderer.outputEncoding );\r\n\t\t\tarray.push( renderer.gammaFactor );\r\n\r\n\t\t}\r\n\r\n\t\tarray.push( parameters.customProgramCacheKey );\r\n\r\n\t\treturn array.join();\r\n\r\n\t}\r\n\r\n\tfunction getUniforms( material ) {\r\n\r\n\t\tconst shaderID = shaderIDs[ material.type ];\r\n\t\tlet uniforms;\r\n\r\n\t\tif ( shaderID ) {\r\n\r\n\t\t\tconst shader = ShaderLib[ shaderID ];\r\n\t\t\tuniforms = UniformsUtils.clone( shader.uniforms );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tuniforms = material.uniforms;\r\n\r\n\t\t}\r\n\r\n\t\treturn uniforms;\r\n\r\n\t}\r\n\r\n\tfunction acquireProgram( parameters, cacheKey ) {\r\n\r\n\t\tlet program;\r\n\r\n\t\t// Check if code has been already compiled\r\n\t\tfor ( let p = 0, pl = programs.length; p < pl; p ++ ) {\r\n\r\n\t\t\tconst preexistingProgram = programs[ p ];\r\n\r\n\t\t\tif ( preexistingProgram.cacheKey === cacheKey ) {\r\n\r\n\t\t\t\tprogram = preexistingProgram;\r\n\t\t\t\t++ program.usedTimes;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( program === undefined ) {\r\n\r\n\t\t\tprogram = new WebGLProgram( renderer, cacheKey, parameters, bindingStates );\r\n\t\t\tprograms.push( program );\r\n\r\n\t\t}\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tfunction releaseProgram( program ) {\r\n\r\n\t\tif ( -- program.usedTimes === 0 ) {\r\n\r\n\t\t\t// Remove from unordered set\r\n\t\t\tconst i = programs.indexOf( program );\r\n\t\t\tprograms[ i ] = programs[ programs.length - 1 ];\r\n\t\t\tprograms.pop();\r\n\r\n\t\t\t// Free WebGL resources\r\n\t\t\tprogram.destroy();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tgetParameters: getParameters,\r\n\t\tgetProgramCacheKey: getProgramCacheKey,\r\n\t\tgetUniforms: getUniforms,\r\n\t\tacquireProgram: acquireProgram,\r\n\t\treleaseProgram: releaseProgram,\r\n\t\t// Exposed for resource monitoring & error feedback via renderer.info:\r\n\t\tprograms: programs\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLPrograms };\r\n", "function WebGLProperties() {\r\n\r\n\tlet properties = new WeakMap();\r\n\r\n\tfunction get( object ) {\r\n\r\n\t\tlet map = properties.get( object );\r\n\r\n\t\tif ( map === undefined ) {\r\n\r\n\t\t\tmap = {};\r\n\t\t\tproperties.set( object, map );\r\n\r\n\t\t}\r\n\r\n\t\treturn map;\r\n\r\n\t}\r\n\r\n\tfunction remove( object ) {\r\n\r\n\t\tproperties.delete( object );\r\n\r\n\t}\r\n\r\n\tfunction update( object, key, value ) {\r\n\r\n\t\tproperties.get( object )[ key ] = value;\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\tproperties = new WeakMap();\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tget: get,\r\n\t\tremove: remove,\r\n\t\tupdate: update,\r\n\t\tdispose: dispose\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLProperties };\r\n", "function painterSortStable( a, b ) {\r\n\r\n\tif ( a.groupOrder !== b.groupOrder ) {\r\n\r\n\t\treturn a.groupOrder - b.groupOrder;\r\n\r\n\t} else if ( a.renderOrder !== b.renderOrder ) {\r\n\r\n\t\treturn a.renderOrder - b.renderOrder;\r\n\r\n\t} else if ( a.program !== b.program ) {\r\n\r\n\t\treturn a.program.id - b.program.id;\r\n\r\n\t} else if ( a.material.id !== b.material.id ) {\r\n\r\n\t\treturn a.material.id - b.material.id;\r\n\r\n\t} else if ( a.z !== b.z ) {\r\n\r\n\t\treturn a.z - b.z;\r\n\r\n\t} else {\r\n\r\n\t\treturn a.id - b.id;\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction reversePainterSortStable( a, b ) {\r\n\r\n\tif ( a.groupOrder !== b.groupOrder ) {\r\n\r\n\t\treturn a.groupOrder - b.groupOrder;\r\n\r\n\t} else if ( a.renderOrder !== b.renderOrder ) {\r\n\r\n\t\treturn a.renderOrder - b.renderOrder;\r\n\r\n\t} else if ( a.z !== b.z ) {\r\n\r\n\t\treturn b.z - a.z;\r\n\r\n\t} else {\r\n\r\n\t\treturn a.id - b.id;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nfunction WebGLRenderList( properties ) {\r\n\r\n\tconst renderItems = [];\r\n\tlet renderItemsIndex = 0;\r\n\r\n\tconst opaque = [];\r\n\tconst transmissive = [];\r\n\tconst transparent = [];\r\n\r\n\tconst defaultProgram = { id: - 1 };\r\n\r\n\tfunction init() {\r\n\r\n\t\trenderItemsIndex = 0;\r\n\r\n\t\topaque.length = 0;\r\n\t\ttransmissive.length = 0;\r\n\t\ttransparent.length = 0;\r\n\r\n\t}\r\n\r\n\tfunction getNextRenderItem( object, geometry, material, groupOrder, z, group ) {\r\n\r\n\t\tlet renderItem = renderItems[ renderItemsIndex ];\r\n\t\tconst materialProperties = properties.get( material );\r\n\r\n\t\tif ( renderItem === undefined ) {\r\n\r\n\t\t\trenderItem = {\r\n\t\t\t\tid: object.id,\r\n\t\t\t\tobject: object,\r\n\t\t\t\tgeometry: geometry,\r\n\t\t\t\tmaterial: material,\r\n\t\t\t\tprogram: materialProperties.program || defaultProgram,\r\n\t\t\t\tgroupOrder: groupOrder,\r\n\t\t\t\trenderOrder: object.renderOrder,\r\n\t\t\t\tz: z,\r\n\t\t\t\tgroup: group\r\n\t\t\t};\r\n\r\n\t\t\trenderItems[ renderItemsIndex ] = renderItem;\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderItem.id = object.id;\r\n\t\t\trenderItem.object = object;\r\n\t\t\trenderItem.geometry = geometry;\r\n\t\t\trenderItem.material = material;\r\n\t\t\trenderItem.program = materialProperties.program || defaultProgram;\r\n\t\t\trenderItem.groupOrder = groupOrder;\r\n\t\t\trenderItem.renderOrder = object.renderOrder;\r\n\t\t\trenderItem.z = z;\r\n\t\t\trenderItem.group = group;\r\n\r\n\t\t}\r\n\r\n\t\trenderItemsIndex ++;\r\n\r\n\t\treturn renderItem;\r\n\r\n\t}\r\n\r\n\tfunction push( object, geometry, material, groupOrder, z, group ) {\r\n\r\n\t\tconst renderItem = getNextRenderItem( object, geometry, material, groupOrder, z, group );\r\n\r\n\t\tif ( material.transmission > 0.0 ) {\r\n\r\n\t\t\ttransmissive.push( renderItem );\r\n\r\n\t\t} else if ( material.transparent === true ) {\r\n\r\n\t\t\ttransparent.push( renderItem );\r\n\r\n\t\t} else {\r\n\r\n\t\t\topaque.push( renderItem );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction unshift( object, geometry, material, groupOrder, z, group ) {\r\n\r\n\t\tconst renderItem = getNextRenderItem( object, geometry, material, groupOrder, z, group );\r\n\r\n\t\tif ( material.transmission > 0.0 ) {\r\n\r\n\t\t\ttransmissive.unshift( renderItem );\r\n\r\n\t\t} else if ( material.transparent === true ) {\r\n\r\n\t\t\ttransparent.unshift( renderItem );\r\n\r\n\t\t} else {\r\n\r\n\t\t\topaque.unshift( renderItem );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction sort( customOpaqueSort, customTransparentSort ) {\r\n\r\n\t\tif ( opaque.length > 1 ) opaque.sort( customOpaqueSort || painterSortStable );\r\n\t\tif ( transmissive.length > 1 ) transmissive.sort( customTransparentSort || reversePainterSortStable );\r\n\t\tif ( transparent.length > 1 ) transparent.sort( customTransparentSort || reversePainterSortStable );\r\n\r\n\t}\r\n\r\n\tfunction finish() {\r\n\r\n\t\t// Clear references from inactive renderItems in the list\r\n\r\n\t\tfor ( let i = renderItemsIndex, il = renderItems.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst renderItem = renderItems[ i ];\r\n\r\n\t\t\tif ( renderItem.id === null ) break;\r\n\r\n\t\t\trenderItem.id = null;\r\n\t\t\trenderItem.object = null;\r\n\t\t\trenderItem.geometry = null;\r\n\t\t\trenderItem.material = null;\r\n\t\t\trenderItem.program = null;\r\n\t\t\trenderItem.group = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\topaque: opaque,\r\n\t\ttransmissive: transmissive,\r\n\t\ttransparent: transparent,\r\n\r\n\t\tinit: init,\r\n\t\tpush: push,\r\n\t\tunshift: unshift,\r\n\t\tfinish: finish,\r\n\r\n\t\tsort: sort\r\n\t};\r\n\r\n}\r\n\r\nfunction WebGLRenderLists( properties ) {\r\n\r\n\tlet lists = new WeakMap();\r\n\r\n\tfunction get( scene, renderCallDepth ) {\r\n\r\n\t\tlet list;\r\n\r\n\t\tif ( lists.has( scene ) === false ) {\r\n\r\n\t\t\tlist = new WebGLRenderList( properties );\r\n\t\t\tlists.set( scene, [ list ] );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( renderCallDepth >= lists.get( scene ).length ) {\r\n\r\n\t\t\t\tlist = new WebGLRenderList( properties );\r\n\t\t\t\tlists.get( scene ).push( list );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlist = lists.get( scene )[ renderCallDepth ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\tlists = new WeakMap();\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tget: get,\r\n\t\tdispose: dispose\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLRenderLists, WebGLRenderList };\r\n", "import { Color } from '../../math/Color.js';\r\nimport { Matrix4 } from '../../math/Matrix4.js';\r\nimport { Vector2 } from '../../math/Vector2.js';\r\nimport { Vector3 } from '../../math/Vector3.js';\r\nimport { UniformsLib } from '../shaders/UniformsLib.js';\r\n\r\nfunction UniformsCache() {\r\n\r\n\tconst lights = {};\r\n\r\n\treturn {\r\n\r\n\t\tget: function ( light ) {\r\n\r\n\t\t\tif ( lights[ light.id ] !== undefined ) {\r\n\r\n\t\t\t\treturn lights[ light.id ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet uniforms;\r\n\r\n\t\t\tswitch ( light.type ) {\r\n\r\n\t\t\t\tcase 'DirectionalLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tdirection: new Vector3(),\r\n\t\t\t\t\t\tcolor: new Color()\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'SpotLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tposition: new Vector3(),\r\n\t\t\t\t\t\tdirection: new Vector3(),\r\n\t\t\t\t\t\tcolor: new Color(),\r\n\t\t\t\t\t\tdistance: 0,\r\n\t\t\t\t\t\tconeCos: 0,\r\n\t\t\t\t\t\tpenumbraCos: 0,\r\n\t\t\t\t\t\tdecay: 0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tposition: new Vector3(),\r\n\t\t\t\t\t\tcolor: new Color(),\r\n\t\t\t\t\t\tdistance: 0,\r\n\t\t\t\t\t\tdecay: 0\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'HemisphereLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tdirection: new Vector3(),\r\n\t\t\t\t\t\tskyColor: new Color(),\r\n\t\t\t\t\t\tgroundColor: new Color()\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'RectAreaLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tcolor: new Color(),\r\n\t\t\t\t\t\tposition: new Vector3(),\r\n\t\t\t\t\t\thalfWidth: new Vector3(),\r\n\t\t\t\t\t\thalfHeight: new Vector3()\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlights[ light.id ] = uniforms;\r\n\r\n\t\t\treturn uniforms;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\nfunction ShadowUniformsCache() {\r\n\r\n\tconst lights = {};\r\n\r\n\treturn {\r\n\r\n\t\tget: function ( light ) {\r\n\r\n\t\t\tif ( lights[ light.id ] !== undefined ) {\r\n\r\n\t\t\t\treturn lights[ light.id ];\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet uniforms;\r\n\r\n\t\t\tswitch ( light.type ) {\r\n\r\n\t\t\t\tcase 'DirectionalLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tshadowBias: 0,\r\n\t\t\t\t\t\tshadowNormalBias: 0,\r\n\t\t\t\t\t\tshadowRadius: 1,\r\n\t\t\t\t\t\tshadowMapSize: new Vector2()\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'SpotLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tshadowBias: 0,\r\n\t\t\t\t\t\tshadowNormalBias: 0,\r\n\t\t\t\t\t\tshadowRadius: 1,\r\n\t\t\t\t\t\tshadowMapSize: new Vector2()\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'PointLight':\r\n\t\t\t\t\tuniforms = {\r\n\t\t\t\t\t\tshadowBias: 0,\r\n\t\t\t\t\t\tshadowNormalBias: 0,\r\n\t\t\t\t\t\tshadowRadius: 1,\r\n\t\t\t\t\t\tshadowMapSize: new Vector2(),\r\n\t\t\t\t\t\tshadowCameraNear: 1,\r\n\t\t\t\t\t\tshadowCameraFar: 1000\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t// TODO (abelnation): set RectAreaLight shadow uniforms\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlights[ light.id ] = uniforms;\r\n\r\n\t\t\treturn uniforms;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n}\r\n\r\n\r\n\r\nlet nextVersion = 0;\r\n\r\nfunction shadowCastingLightsFirst( lightA, lightB ) {\r\n\r\n\treturn ( lightB.castShadow ? 1 : 0 ) - ( lightA.castShadow ? 1 : 0 );\r\n\r\n}\r\n\r\nfunction WebGLLights( extensions, capabilities ) {\r\n\r\n\tconst cache = new UniformsCache();\r\n\r\n\tconst shadowCache = ShadowUniformsCache();\r\n\r\n\tconst state = {\r\n\r\n\t\tversion: 0,\r\n\r\n\t\thash: {\r\n\t\t\tdirectionalLength: - 1,\r\n\t\t\tpointLength: - 1,\r\n\t\t\tspotLength: - 1,\r\n\t\t\trectAreaLength: - 1,\r\n\t\t\themiLength: - 1,\r\n\r\n\t\t\tnumDirectionalShadows: - 1,\r\n\t\t\tnumPointShadows: - 1,\r\n\t\t\tnumSpotShadows: - 1\r\n\t\t},\r\n\r\n\t\tambient: [ 0, 0, 0 ],\r\n\t\tprobe: [],\r\n\t\tdirectional: [],\r\n\t\tdirectionalShadow: [],\r\n\t\tdirectionalShadowMap: [],\r\n\t\tdirectionalShadowMatrix: [],\r\n\t\tspot: [],\r\n\t\tspotShadow: [],\r\n\t\tspotShadowMap: [],\r\n\t\tspotShadowMatrix: [],\r\n\t\trectArea: [],\r\n\t\trectAreaLTC1: null,\r\n\t\trectAreaLTC2: null,\r\n\t\tpoint: [],\r\n\t\tpointShadow: [],\r\n\t\tpointShadowMap: [],\r\n\t\tpointShadowMatrix: [],\r\n\t\themi: []\r\n\r\n\t};\r\n\r\n\tfor ( let i = 0; i < 9; i ++ ) state.probe.push( new Vector3() );\r\n\r\n\tconst vector3 = new Vector3();\r\n\tconst matrix4 = new Matrix4();\r\n\tconst matrix42 = new Matrix4();\r\n\r\n\tfunction setup( lights ) {\r\n\r\n\t\tlet r = 0, g = 0, b = 0;\r\n\r\n\t\tfor ( let i = 0; i < 9; i ++ ) state.probe[ i ].set( 0, 0, 0 );\r\n\r\n\t\tlet directionalLength = 0;\r\n\t\tlet pointLength = 0;\r\n\t\tlet spotLength = 0;\r\n\t\tlet rectAreaLength = 0;\r\n\t\tlet hemiLength = 0;\r\n\r\n\t\tlet numDirectionalShadows = 0;\r\n\t\tlet numPointShadows = 0;\r\n\t\tlet numSpotShadows = 0;\r\n\r\n\t\tlights.sort( shadowCastingLightsFirst );\r\n\r\n\t\tfor ( let i = 0, l = lights.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst light = lights[ i ];\r\n\r\n\t\t\tconst color = light.color;\r\n\t\t\tconst intensity = light.intensity;\r\n\t\t\tconst distance = light.distance;\r\n\r\n\t\t\tconst shadowMap = ( light.shadow && light.shadow.map ) ? light.shadow.map.texture : null;\r\n\r\n\t\t\tif ( light.isAmbientLight ) {\r\n\r\n\t\t\t\tr += color.r * intensity;\r\n\t\t\t\tg += color.g * intensity;\r\n\t\t\t\tb += color.b * intensity;\r\n\r\n\t\t\t} else if ( light.isLightProbe ) {\r\n\r\n\t\t\t\tfor ( let j = 0; j < 9; j ++ ) {\r\n\r\n\t\t\t\t\tstate.probe[ j ].addScaledVector( light.sh.coefficients[ j ], intensity );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( light.isDirectionalLight ) {\r\n\r\n\t\t\t\tconst uniforms = cache.get( light );\r\n\r\n\t\t\t\tuniforms.color.copy( light.color ).multiplyScalar( light.intensity );\r\n\r\n\t\t\t\tif ( light.castShadow ) {\r\n\r\n\t\t\t\t\tconst shadow = light.shadow;\r\n\r\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\r\n\r\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\r\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\r\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\r\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\r\n\r\n\t\t\t\t\tstate.directionalShadow[ directionalLength ] = shadowUniforms;\r\n\t\t\t\t\tstate.directionalShadowMap[ directionalLength ] = shadowMap;\r\n\t\t\t\t\tstate.directionalShadowMatrix[ directionalLength ] = light.shadow.matrix;\r\n\r\n\t\t\t\t\tnumDirectionalShadows ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.directional[ directionalLength ] = uniforms;\r\n\r\n\t\t\t\tdirectionalLength ++;\r\n\r\n\t\t\t} else if ( light.isSpotLight ) {\r\n\r\n\t\t\t\tconst uniforms = cache.get( light );\r\n\r\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\r\n\r\n\t\t\t\tuniforms.color.copy( color ).multiplyScalar( intensity );\r\n\t\t\t\tuniforms.distance = distance;\r\n\r\n\t\t\t\tuniforms.coneCos = Math.cos( light.angle );\r\n\t\t\t\tuniforms.penumbraCos = Math.cos( light.angle * ( 1 - light.penumbra ) );\r\n\t\t\t\tuniforms.decay = light.decay;\r\n\r\n\t\t\t\tif ( light.castShadow ) {\r\n\r\n\t\t\t\t\tconst shadow = light.shadow;\r\n\r\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\r\n\r\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\r\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\r\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\r\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\r\n\r\n\t\t\t\t\tstate.spotShadow[ spotLength ] = shadowUniforms;\r\n\t\t\t\t\tstate.spotShadowMap[ spotLength ] = shadowMap;\r\n\t\t\t\t\tstate.spotShadowMatrix[ spotLength ] = light.shadow.matrix;\r\n\r\n\t\t\t\t\tnumSpotShadows ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.spot[ spotLength ] = uniforms;\r\n\r\n\t\t\t\tspotLength ++;\r\n\r\n\t\t\t} else if ( light.isRectAreaLight ) {\r\n\r\n\t\t\t\tconst uniforms = cache.get( light );\r\n\r\n\t\t\t\t// (a) intensity is the total visible light emitted\r\n\t\t\t\t//uniforms.color.copy( color ).multiplyScalar( intensity / ( light.width * light.height * Math.PI ) );\r\n\r\n\t\t\t\t// (b) intensity is the brightness of the light\r\n\t\t\t\tuniforms.color.copy( color ).multiplyScalar( intensity );\r\n\r\n\t\t\t\tuniforms.halfWidth.set( light.width * 0.5, 0.0, 0.0 );\r\n\t\t\t\tuniforms.halfHeight.set( 0.0, light.height * 0.5, 0.0 );\r\n\r\n\t\t\t\tstate.rectArea[ rectAreaLength ] = uniforms;\r\n\r\n\t\t\t\trectAreaLength ++;\r\n\r\n\t\t\t} else if ( light.isPointLight ) {\r\n\r\n\t\t\t\tconst uniforms = cache.get( light );\r\n\r\n\t\t\t\tuniforms.color.copy( light.color ).multiplyScalar( light.intensity );\r\n\t\t\t\tuniforms.distance = light.distance;\r\n\t\t\t\tuniforms.decay = light.decay;\r\n\r\n\t\t\t\tif ( light.castShadow ) {\r\n\r\n\t\t\t\t\tconst shadow = light.shadow;\r\n\r\n\t\t\t\t\tconst shadowUniforms = shadowCache.get( light );\r\n\r\n\t\t\t\t\tshadowUniforms.shadowBias = shadow.bias;\r\n\t\t\t\t\tshadowUniforms.shadowNormalBias = shadow.normalBias;\r\n\t\t\t\t\tshadowUniforms.shadowRadius = shadow.radius;\r\n\t\t\t\t\tshadowUniforms.shadowMapSize = shadow.mapSize;\r\n\t\t\t\t\tshadowUniforms.shadowCameraNear = shadow.camera.near;\r\n\t\t\t\t\tshadowUniforms.shadowCameraFar = shadow.camera.far;\r\n\r\n\t\t\t\t\tstate.pointShadow[ pointLength ] = shadowUniforms;\r\n\t\t\t\t\tstate.pointShadowMap[ pointLength ] = shadowMap;\r\n\t\t\t\t\tstate.pointShadowMatrix[ pointLength ] = light.shadow.matrix;\r\n\r\n\t\t\t\t\tnumPointShadows ++;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tstate.point[ pointLength ] = uniforms;\r\n\r\n\t\t\t\tpointLength ++;\r\n\r\n\t\t\t} else if ( light.isHemisphereLight ) {\r\n\r\n\t\t\t\tconst uniforms = cache.get( light );\r\n\r\n\t\t\t\tuniforms.skyColor.copy( light.color ).multiplyScalar( intensity );\r\n\t\t\t\tuniforms.groundColor.copy( light.groundColor ).multiplyScalar( intensity );\r\n\r\n\t\t\t\tstate.hemi[ hemiLength ] = uniforms;\r\n\r\n\t\t\t\themiLength ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( rectAreaLength > 0 ) {\r\n\r\n\t\t\tif ( capabilities.isWebGL2 ) {\r\n\r\n\t\t\t\t// WebGL 2\r\n\r\n\t\t\t\tstate.rectAreaLTC1 = UniformsLib.LTC_FLOAT_1;\r\n\t\t\t\tstate.rectAreaLTC2 = UniformsLib.LTC_FLOAT_2;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// WebGL 1\r\n\r\n\t\t\t\tif ( extensions.has( 'OES_texture_float_linear' ) === true ) {\r\n\r\n\t\t\t\t\tstate.rectAreaLTC1 = UniformsLib.LTC_FLOAT_1;\r\n\t\t\t\t\tstate.rectAreaLTC2 = UniformsLib.LTC_FLOAT_2;\r\n\r\n\t\t\t\t} else if ( extensions.has( 'OES_texture_half_float_linear' ) === true ) {\r\n\r\n\t\t\t\t\tstate.rectAreaLTC1 = UniformsLib.LTC_HALF_1;\r\n\t\t\t\t\tstate.rectAreaLTC2 = UniformsLib.LTC_HALF_2;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.ambient[ 0 ] = r;\r\n\t\tstate.ambient[ 1 ] = g;\r\n\t\tstate.ambient[ 2 ] = b;\r\n\r\n\t\tconst hash = state.hash;\r\n\r\n\t\tif ( hash.directionalLength !== directionalLength ||\r\n\t\t\thash.pointLength !== pointLength ||\r\n\t\t\thash.spotLength !== spotLength ||\r\n\t\t\thash.rectAreaLength !== rectAreaLength ||\r\n\t\t\thash.hemiLength !== hemiLength ||\r\n\t\t\thash.numDirectionalShadows !== numDirectionalShadows ||\r\n\t\t\thash.numPointShadows !== numPointShadows ||\r\n\t\t\thash.numSpotShadows !== numSpotShadows ) {\r\n\r\n\t\t\tstate.directional.length = directionalLength;\r\n\t\t\tstate.spot.length = spotLength;\r\n\t\t\tstate.rectArea.length = rectAreaLength;\r\n\t\t\tstate.point.length = pointLength;\r\n\t\t\tstate.hemi.length = hemiLength;\r\n\r\n\t\t\tstate.directionalShadow.length = numDirectionalShadows;\r\n\t\t\tstate.directionalShadowMap.length = numDirectionalShadows;\r\n\t\t\tstate.pointShadow.length = numPointShadows;\r\n\t\t\tstate.pointShadowMap.length = numPointShadows;\r\n\t\t\tstate.spotShadow.length = numSpotShadows;\r\n\t\t\tstate.spotShadowMap.length = numSpotShadows;\r\n\t\t\tstate.directionalShadowMatrix.length = numDirectionalShadows;\r\n\t\t\tstate.pointShadowMatrix.length = numPointShadows;\r\n\t\t\tstate.spotShadowMatrix.length = numSpotShadows;\r\n\r\n\t\t\thash.directionalLength = directionalLength;\r\n\t\t\thash.pointLength = pointLength;\r\n\t\t\thash.spotLength = spotLength;\r\n\t\t\thash.rectAreaLength = rectAreaLength;\r\n\t\t\thash.hemiLength = hemiLength;\r\n\r\n\t\t\thash.numDirectionalShadows = numDirectionalShadows;\r\n\t\t\thash.numPointShadows = numPointShadows;\r\n\t\t\thash.numSpotShadows = numSpotShadows;\r\n\r\n\t\t\tstate.version = nextVersion ++;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setupView( lights, camera ) {\r\n\r\n\t\tlet directionalLength = 0;\r\n\t\tlet pointLength = 0;\r\n\t\tlet spotLength = 0;\r\n\t\tlet rectAreaLength = 0;\r\n\t\tlet hemiLength = 0;\r\n\r\n\t\tconst viewMatrix = camera.matrixWorldInverse;\r\n\r\n\t\tfor ( let i = 0, l = lights.length; i < l; i ++ ) {\r\n\r\n\t\t\tconst light = lights[ i ];\r\n\r\n\t\t\tif ( light.isDirectionalLight ) {\r\n\r\n\t\t\t\tconst uniforms = state.directional[ directionalLength ];\r\n\r\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tvector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\tuniforms.direction.sub( vector3 );\r\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\r\n\r\n\t\t\t\tdirectionalLength ++;\r\n\r\n\t\t\t} else if ( light.isSpotLight ) {\r\n\r\n\t\t\t\tconst uniforms = state.spot[ spotLength ];\r\n\r\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\r\n\r\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tvector3.setFromMatrixPosition( light.target.matrixWorld );\r\n\t\t\t\tuniforms.direction.sub( vector3 );\r\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\r\n\r\n\t\t\t\tspotLength ++;\r\n\r\n\t\t\t} else if ( light.isRectAreaLight ) {\r\n\r\n\t\t\t\tconst uniforms = state.rectArea[ rectAreaLength ];\r\n\r\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\r\n\r\n\t\t\t\t// extract local rotation of light to derive width/height half vectors\r\n\t\t\t\tmatrix42.identity();\r\n\t\t\t\tmatrix4.copy( light.matrixWorld );\r\n\t\t\t\tmatrix4.premultiply( viewMatrix );\r\n\t\t\t\tmatrix42.extractRotation( matrix4 );\r\n\r\n\t\t\t\tuniforms.halfWidth.set( light.width * 0.5, 0.0, 0.0 );\r\n\t\t\t\tuniforms.halfHeight.set( 0.0, light.height * 0.5, 0.0 );\r\n\r\n\t\t\t\tuniforms.halfWidth.applyMatrix4( matrix42 );\r\n\t\t\t\tuniforms.halfHeight.applyMatrix4( matrix42 );\r\n\r\n\t\t\t\trectAreaLength ++;\r\n\r\n\t\t\t} else if ( light.isPointLight ) {\r\n\r\n\t\t\t\tconst uniforms = state.point[ pointLength ];\r\n\r\n\t\t\t\tuniforms.position.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tuniforms.position.applyMatrix4( viewMatrix );\r\n\r\n\t\t\t\tpointLength ++;\r\n\r\n\t\t\t} else if ( light.isHemisphereLight ) {\r\n\r\n\t\t\t\tconst uniforms = state.hemi[ hemiLength ];\r\n\r\n\t\t\t\tuniforms.direction.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\t\tuniforms.direction.transformDirection( viewMatrix );\r\n\t\t\t\tuniforms.direction.normalize();\r\n\r\n\t\t\t\themiLength ++;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tsetup: setup,\r\n\t\tsetupView: setupView,\r\n\t\tstate: state\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLLights };\r\n", "import { WebGLLights } from './WebGLLights.js';\r\n\r\nfunction WebGLRenderState( extensions, capabilities ) {\r\n\r\n\tconst lights = new WebGLLights( extensions, capabilities );\r\n\r\n\tconst lightsArray = [];\r\n\tconst shadowsArray = [];\r\n\r\n\tfunction init() {\r\n\r\n\t\tlightsArray.length = 0;\r\n\t\tshadowsArray.length = 0;\r\n\r\n\t}\r\n\r\n\tfunction pushLight( light ) {\r\n\r\n\t\tlightsArray.push( light );\r\n\r\n\t}\r\n\r\n\tfunction pushShadow( shadowLight ) {\r\n\r\n\t\tshadowsArray.push( shadowLight );\r\n\r\n\t}\r\n\r\n\tfunction setupLights() {\r\n\r\n\t\tlights.setup( lightsArray );\r\n\r\n\t}\r\n\r\n\tfunction setupLightsView( camera ) {\r\n\r\n\t\tlights.setupView( lightsArray, camera );\r\n\r\n\t}\r\n\r\n\tconst state = {\r\n\t\tlightsArray: lightsArray,\r\n\t\tshadowsArray: shadowsArray,\r\n\r\n\t\tlights: lights\r\n\t};\r\n\r\n\treturn {\r\n\t\tinit: init,\r\n\t\tstate: state,\r\n\t\tsetupLights: setupLights,\r\n\t\tsetupLightsView: setupLightsView,\r\n\r\n\t\tpushLight: pushLight,\r\n\t\tpushShadow: pushShadow\r\n\t};\r\n\r\n}\r\n\r\nfunction WebGLRenderStates( extensions, capabilities ) {\r\n\r\n\tlet renderStates = new WeakMap();\r\n\r\n\tfunction get( scene, renderCallDepth = 0 ) {\r\n\r\n\t\tlet renderState;\r\n\r\n\t\tif ( renderStates.has( scene ) === false ) {\r\n\r\n\t\t\trenderState = new WebGLRenderState( extensions, capabilities );\r\n\t\t\trenderStates.set( scene, [ renderState ] );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( renderCallDepth >= renderStates.get( scene ).length ) {\r\n\r\n\t\t\t\trenderState = new WebGLRenderState( extensions, capabilities );\r\n\t\t\t\trenderStates.get( scene ).push( renderState );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderState = renderStates.get( scene )[ renderCallDepth ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn renderState;\r\n\r\n\t}\r\n\r\n\tfunction dispose() {\r\n\r\n\t\trenderStates = new WeakMap();\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\tget: get,\r\n\t\tdispose: dispose\r\n\t};\r\n\r\n}\r\n\r\n\r\nexport { WebGLRenderStates };\r\n", "import { Material } from './Material.js';\r\nimport { BasicDepthPacking } from '../constants.js';\r\n\r\n/**\r\n * parameters = {\r\n *\r\n *  opacity: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  displacementMap: new THREE.Texture( <Image> ),\r\n *  displacementScale: <float>,\r\n *  displacementBias: <float>,\r\n *\r\n *  wireframe: <boolean>,\r\n *  wireframeLinewidth: <float>\r\n * }\r\n */\r\n\r\nclass MeshDepthMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'MeshDepthMaterial';\r\n\r\n\t\tthis.depthPacking = BasicDepthPacking;\r\n\r\n\t\tthis.map = null;\r\n\r\n\t\tthis.alphaMap = null;\r\n\r\n\t\tthis.displacementMap = null;\r\n\t\tthis.displacementScale = 1;\r\n\t\tthis.displacementBias = 0;\r\n\r\n\t\tthis.wireframe = false;\r\n\t\tthis.wireframeLinewidth = 1;\r\n\r\n\t\tthis.fog = false;\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.depthPacking = source.depthPacking;\r\n\r\n\t\tthis.map = source.map;\r\n\r\n\t\tthis.alphaMap = source.alphaMap;\r\n\r\n\t\tthis.displacementMap = source.displacementMap;\r\n\t\tthis.displacementScale = source.displacementScale;\r\n\t\tthis.displacementBias = source.displacementBias;\r\n\r\n\t\tthis.wireframe = source.wireframe;\r\n\t\tthis.wireframeLinewidth = source.wireframeLinewidth;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMeshDepthMaterial.prototype.isMeshDepthMaterial = true;\r\n\r\nexport { MeshDepthMaterial };\r\n", "import { Material } from './Material.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\n\r\n/**\r\n * parameters = {\r\n *\r\n *  referencePosition: <float>,\r\n *  nearDistance: <float>,\r\n *  farDistance: <float>,\r\n *\r\n *  map: new THREE.Texture( <Image> ),\r\n *\r\n *  alphaMap: new THREE.Texture( <Image> ),\r\n *\r\n *  displacementMap: new THREE.Texture( <Image> ),\r\n *  displacementScale: <float>,\r\n *  displacementBias: <float>\r\n *\r\n * }\r\n */\r\n\r\nclass MeshDistanceMaterial extends Material {\r\n\r\n\tconstructor( parameters ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'MeshDistanceMaterial';\r\n\r\n\t\tthis.referencePosition = new Vector3();\r\n\t\tthis.nearDistance = 1;\r\n\t\tthis.farDistance = 1000;\r\n\r\n\t\tthis.map = null;\r\n\r\n\t\tthis.alphaMap = null;\r\n\r\n\t\tthis.displacementMap = null;\r\n\t\tthis.displacementScale = 1;\r\n\t\tthis.displacementBias = 0;\r\n\r\n\t\tthis.fog = false;\r\n\r\n\t\tthis.setValues( parameters );\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.referencePosition.copy( source.referencePosition );\r\n\t\tthis.nearDistance = source.nearDistance;\r\n\t\tthis.farDistance = source.farDistance;\r\n\r\n\t\tthis.map = source.map;\r\n\r\n\t\tthis.alphaMap = source.alphaMap;\r\n\r\n\t\tthis.displacementMap = source.displacementMap;\r\n\t\tthis.displacementScale = source.displacementScale;\r\n\t\tthis.displacementBias = source.displacementBias;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nMeshDistanceMaterial.prototype.isMeshDistanceMaterial = true;\r\n\r\nexport { MeshDistanceMaterial };\r\n", "export default /* glsl */`\r\nuniform sampler2D shadow_pass;\r\nuniform vec2 resolution;\r\nuniform float radius;\r\nuniform float samples;\r\n\r\n#include <packing>\r\n\r\nvoid main() {\r\n\r\n\tfloat mean = 0.0;\r\n\tfloat squared_mean = 0.0;\r\n\r\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\r\n\t// float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\r\n\r\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\r\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\r\n\tfor ( float i = 0.0; i < samples; i ++ ) {\r\n\r\n\t\tfloat uvOffset = uvStart + i * uvStride;\r\n\r\n\t\t#ifdef HORIZONTAL_PASS\r\n\r\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\r\n\t\t\tmean += distribution.x;\r\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\r\n\r\n\t\t#else\r\n\r\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\r\n\t\t\tmean += depth;\r\n\t\t\tsquared_mean += depth * depth;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n\tmean = mean / samples;\r\n\tsquared_mean = squared_mean / samples;\r\n\r\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\r\n\r\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\r\n\r\n}\r\n`;\r\n", "export default /* glsl */`\r\nvoid main() {\r\n\r\n\tgl_Position = vec4( position, 1.0 );\r\n\r\n}\r\n`;\r\n", "import { FrontSide, BackSide, DoubleSide, RGBAFormat, NearestFilter, LinearFilter, PCFShadowMap, VSMShadowMap, RGBADepthPacking, NoBlending } from '../../constants.js';\r\nimport { WebGLRenderTarget } from '../WebGLRenderTarget.js';\r\nimport { MeshDepthMaterial } from '../../materials/MeshDepthMaterial.js';\r\nimport { MeshDistanceMaterial } from '../../materials/MeshDistanceMaterial.js';\r\nimport { ShaderMaterial } from '../../materials/ShaderMaterial.js';\r\nimport { BufferAttribute } from '../../core/BufferAttribute.js';\r\nimport { BufferGeometry } from '../../core/BufferGeometry.js';\r\nimport { Mesh } from '../../objects/Mesh.js';\r\nimport { Vector4 } from '../../math/Vector4.js';\r\nimport { Vector2 } from '../../math/Vector2.js';\r\nimport { Frustum } from '../../math/Frustum.js';\r\n\r\nimport vsm_frag from '../shaders/ShaderLib/vsm_frag.glsl.js';\r\nimport vsm_vert from '../shaders/ShaderLib/vsm_vert.glsl.js';\r\n\r\nfunction WebGLShadowMap( _renderer, _objects, _capabilities ) {\r\n\r\n\tlet _frustum = new Frustum();\r\n\r\n\tconst _shadowMapSize = new Vector2(),\r\n\t\t_viewportSize = new Vector2(),\r\n\r\n\t\t_viewport = new Vector4(),\r\n\r\n\t\t_depthMaterial = new MeshDepthMaterial( { depthPacking: RGBADepthPacking } ),\r\n\t\t_distanceMaterial = new MeshDistanceMaterial(),\r\n\r\n\t\t_materialCache = {},\r\n\r\n\t\t_maxTextureSize = _capabilities.maxTextureSize;\r\n\r\n\tconst shadowSide = { 0: BackSide, 1: FrontSide, 2: DoubleSide };\r\n\r\n\tconst shadowMaterialVertical = new ShaderMaterial( {\r\n\r\n\t\tuniforms: {\r\n\t\t\tshadow_pass: { value: null },\r\n\t\t\tresolution: { value: new Vector2() },\r\n\t\t\tradius: { value: 4.0 },\r\n\t\t\tsamples: { value: 8.0 }\r\n\t\t},\r\n\r\n\t\tvertexShader: vsm_vert,\r\n\r\n\t\tfragmentShader: vsm_frag\r\n\r\n\t} );\r\n\r\n\tconst shadowMaterialHorizontal = shadowMaterialVertical.clone();\r\n\tshadowMaterialHorizontal.defines.HORIZONTAL_PASS = 1;\r\n\r\n\tconst fullScreenTri = new BufferGeometry();\r\n\tfullScreenTri.setAttribute(\r\n\t\t'position',\r\n\t\tnew BufferAttribute(\r\n\t\t\tnew Float32Array( [ - 1, - 1, 0.5, 3, - 1, 0.5, - 1, 3, 0.5 ] ),\r\n\t\t\t3\r\n\t\t)\r\n\t);\r\n\r\n\tconst fullScreenMesh = new Mesh( fullScreenTri, shadowMaterialVertical );\r\n\r\n\tconst scope = this;\r\n\r\n\tthis.enabled = false;\r\n\r\n\tthis.autoUpdate = true;\r\n\tthis.needsUpdate = false;\r\n\r\n\tthis.type = PCFShadowMap;\r\n\r\n\tthis.render = function ( lights, scene, camera ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\t\tif ( scope.autoUpdate === false && scope.needsUpdate === false ) return;\r\n\r\n\t\tif ( lights.length === 0 ) return;\r\n\r\n\t\tconst currentRenderTarget = _renderer.getRenderTarget();\r\n\t\tconst activeCubeFace = _renderer.getActiveCubeFace();\r\n\t\tconst activeMipmapLevel = _renderer.getActiveMipmapLevel();\r\n\r\n\t\tconst _state = _renderer.state;\r\n\r\n\t\t// Set GL state for depth map.\r\n\t\t_state.setBlending( NoBlending );\r\n\t\t_state.buffers.color.setClear( 1, 1, 1, 1 );\r\n\t\t_state.buffers.depth.setTest( true );\r\n\t\t_state.setScissorTest( false );\r\n\r\n\t\t// render depth map\r\n\r\n\t\tfor ( let i = 0, il = lights.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst light = lights[ i ];\r\n\t\t\tconst shadow = light.shadow;\r\n\r\n\t\t\tif ( shadow === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLShadowMap:', light, 'has no shadow.' );\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( shadow.autoUpdate === false && shadow.needsUpdate === false ) continue;\r\n\r\n\t\t\t_shadowMapSize.copy( shadow.mapSize );\r\n\r\n\t\t\tconst shadowFrameExtents = shadow.getFrameExtents();\r\n\r\n\t\t\t_shadowMapSize.multiply( shadowFrameExtents );\r\n\r\n\t\t\t_viewportSize.copy( shadow.mapSize );\r\n\r\n\t\t\tif ( _shadowMapSize.x > _maxTextureSize || _shadowMapSize.y > _maxTextureSize ) {\r\n\r\n\t\t\t\tif ( _shadowMapSize.x > _maxTextureSize ) {\r\n\r\n\t\t\t\t\t_viewportSize.x = Math.floor( _maxTextureSize / shadowFrameExtents.x );\r\n\t\t\t\t\t_shadowMapSize.x = _viewportSize.x * shadowFrameExtents.x;\r\n\t\t\t\t\tshadow.mapSize.x = _viewportSize.x;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( _shadowMapSize.y > _maxTextureSize ) {\r\n\r\n\t\t\t\t\t_viewportSize.y = Math.floor( _maxTextureSize / shadowFrameExtents.y );\r\n\t\t\t\t\t_shadowMapSize.y = _viewportSize.y * shadowFrameExtents.y;\r\n\t\t\t\t\tshadow.mapSize.y = _viewportSize.y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( shadow.map === null && ! shadow.isPointLightShadow && this.type === VSMShadowMap ) {\r\n\r\n\t\t\t\tconst pars = { minFilter: LinearFilter, magFilter: LinearFilter, format: RGBAFormat };\r\n\r\n\t\t\t\tshadow.map = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\r\n\t\t\t\tshadow.map.texture.name = light.name + '.shadowMap';\r\n\r\n\t\t\t\tshadow.mapPass = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\r\n\r\n\t\t\t\tshadow.camera.updateProjectionMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( shadow.map === null ) {\r\n\r\n\t\t\t\tconst pars = { minFilter: NearestFilter, magFilter: NearestFilter, format: RGBAFormat };\r\n\r\n\t\t\t\tshadow.map = new WebGLRenderTarget( _shadowMapSize.x, _shadowMapSize.y, pars );\r\n\t\t\t\tshadow.map.texture.name = light.name + '.shadowMap';\r\n\r\n\t\t\t\tshadow.camera.updateProjectionMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_renderer.setRenderTarget( shadow.map );\r\n\t\t\t_renderer.clear();\r\n\r\n\t\t\tconst viewportCount = shadow.getViewportCount();\r\n\r\n\t\t\tfor ( let vp = 0; vp < viewportCount; vp ++ ) {\r\n\r\n\t\t\t\tconst viewport = shadow.getViewport( vp );\r\n\r\n\t\t\t\t_viewport.set(\r\n\t\t\t\t\t_viewportSize.x * viewport.x,\r\n\t\t\t\t\t_viewportSize.y * viewport.y,\r\n\t\t\t\t\t_viewportSize.x * viewport.z,\r\n\t\t\t\t\t_viewportSize.y * viewport.w\r\n\t\t\t\t);\r\n\r\n\t\t\t\t_state.viewport( _viewport );\r\n\r\n\t\t\t\tshadow.updateMatrices( light, vp );\r\n\r\n\t\t\t\t_frustum = shadow.getFrustum();\r\n\r\n\t\t\t\trenderObject( scene, camera, shadow.camera, light, this.type );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// do blur pass for VSM\r\n\r\n\t\t\tif ( ! shadow.isPointLightShadow && this.type === VSMShadowMap ) {\r\n\r\n\t\t\t\tVSMPass( shadow, camera );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tshadow.needsUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tscope.needsUpdate = false;\r\n\r\n\t\t_renderer.setRenderTarget( currentRenderTarget, activeCubeFace, activeMipmapLevel );\r\n\r\n\t};\r\n\r\n\tfunction VSMPass( shadow, camera ) {\r\n\r\n\t\tconst geometry = _objects.update( fullScreenMesh );\r\n\r\n\t\t// vertical pass\r\n\r\n\t\tshadowMaterialVertical.uniforms.shadow_pass.value = shadow.map.texture;\r\n\t\tshadowMaterialVertical.uniforms.resolution.value = shadow.mapSize;\r\n\t\tshadowMaterialVertical.uniforms.radius.value = shadow.radius;\r\n\t\tshadowMaterialVertical.uniforms.samples.value = shadow.blurSamples;\r\n\t\t_renderer.setRenderTarget( shadow.mapPass );\r\n\t\t_renderer.clear();\r\n\t\t_renderer.renderBufferDirect( camera, null, geometry, shadowMaterialVertical, fullScreenMesh, null );\r\n\r\n\t\t// horizontal pass\r\n\r\n\t\tshadowMaterialHorizontal.uniforms.shadow_pass.value = shadow.mapPass.texture;\r\n\t\tshadowMaterialHorizontal.uniforms.resolution.value = shadow.mapSize;\r\n\t\tshadowMaterialHorizontal.uniforms.radius.value = shadow.radius;\r\n\t\tshadowMaterialHorizontal.uniforms.samples.value = shadow.blurSamples;\r\n\t\t_renderer.setRenderTarget( shadow.map );\r\n\t\t_renderer.clear();\r\n\t\t_renderer.renderBufferDirect( camera, null, geometry, shadowMaterialHorizontal, fullScreenMesh, null );\r\n\r\n\t}\r\n\r\n\tfunction getDepthMaterial( object, geometry, material, light, shadowCameraNear, shadowCameraFar, type ) {\r\n\r\n\t\tlet result = null;\r\n\r\n\t\tconst customMaterial = ( light.isPointLight === true ) ? object.customDistanceMaterial : object.customDepthMaterial;\r\n\r\n\t\tif ( customMaterial !== undefined ) {\r\n\r\n\t\t\tresult = customMaterial;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tresult = ( light.isPointLight === true ) ? _distanceMaterial : _depthMaterial;\r\n\r\n\t\t}\r\n\r\n\t\tif ( _renderer.localClippingEnabled &&\r\n\t\t\t\tmaterial.clipShadows === true &&\r\n\t\t\t\tmaterial.clippingPlanes.length !== 0 ) {\r\n\r\n\t\t\t// in this case we need a unique material instance reflecting the\r\n\t\t\t// appropriate state\r\n\r\n\t\t\tconst keyA = result.uuid, keyB = material.uuid;\r\n\r\n\t\t\tlet materialsForVariant = _materialCache[ keyA ];\r\n\r\n\t\t\tif ( materialsForVariant === undefined ) {\r\n\r\n\t\t\t\tmaterialsForVariant = {};\r\n\t\t\t\t_materialCache[ keyA ] = materialsForVariant;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet cachedMaterial = materialsForVariant[ keyB ];\r\n\r\n\t\t\tif ( cachedMaterial === undefined ) {\r\n\r\n\t\t\t\tcachedMaterial = result.clone();\r\n\t\t\t\tmaterialsForVariant[ keyB ] = cachedMaterial;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tresult = cachedMaterial;\r\n\r\n\t\t}\r\n\r\n\t\tresult.visible = material.visible;\r\n\t\tresult.wireframe = material.wireframe;\r\n\r\n\t\tif ( type === VSMShadowMap ) {\r\n\r\n\t\t\tresult.side = ( material.shadowSide !== null ) ? material.shadowSide : material.side;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tresult.side = ( material.shadowSide !== null ) ? material.shadowSide : shadowSide[ material.side ];\r\n\r\n\t\t}\r\n\r\n\t\tresult.clipShadows = material.clipShadows;\r\n\t\tresult.clippingPlanes = material.clippingPlanes;\r\n\t\tresult.clipIntersection = material.clipIntersection;\r\n\r\n\t\tresult.wireframeLinewidth = material.wireframeLinewidth;\r\n\t\tresult.linewidth = material.linewidth;\r\n\r\n\t\tif ( light.isPointLight === true && result.isMeshDistanceMaterial === true ) {\r\n\r\n\t\t\tresult.referencePosition.setFromMatrixPosition( light.matrixWorld );\r\n\t\t\tresult.nearDistance = shadowCameraNear;\r\n\t\t\tresult.farDistance = shadowCameraFar;\r\n\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\tfunction renderObject( object, camera, shadowCamera, light, type ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tconst visible = object.layers.test( camera.layers );\r\n\r\n\t\tif ( visible && ( object.isMesh || object.isLine || object.isPoints ) ) {\r\n\r\n\t\t\tif ( ( object.castShadow || ( object.receiveShadow && type === VSMShadowMap ) ) && ( ! object.frustumCulled || _frustum.intersectsObject( object ) ) ) {\r\n\r\n\t\t\t\tobject.modelViewMatrix.multiplyMatrices( shadowCamera.matrixWorldInverse, object.matrixWorld );\r\n\r\n\t\t\t\tconst geometry = _objects.update( object );\r\n\t\t\t\tconst material = object.material;\r\n\r\n\t\t\t\tif ( Array.isArray( material ) ) {\r\n\r\n\t\t\t\t\tconst groups = geometry.groups;\r\n\r\n\t\t\t\t\tfor ( let k = 0, kl = groups.length; k < kl; k ++ ) {\r\n\r\n\t\t\t\t\t\tconst group = groups[ k ];\r\n\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\tif ( groupMaterial && groupMaterial.visible ) {\r\n\r\n\t\t\t\t\t\t\tconst depthMaterial = getDepthMaterial( object, geometry, groupMaterial, light, shadowCamera.near, shadowCamera.far, type );\r\n\r\n\t\t\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, null, geometry, depthMaterial, object, group );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( material.visible ) {\r\n\r\n\t\t\t\t\tconst depthMaterial = getDepthMaterial( object, geometry, material, light, shadowCamera.near, shadowCamera.far, type );\r\n\r\n\t\t\t\t\t_renderer.renderBufferDirect( shadowCamera, null, geometry, depthMaterial, object, null );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst children = object.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\trenderObject( children[ i ], camera, shadowCamera, light, type );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { WebGLShadowMap };\r\n", "import { NotEqualDepth, GreaterDepth, GreaterEqualDepth, EqualDepth, LessEqualDepth, LessDepth, AlwaysDepth, NeverDepth, CullFaceFront, CullFaceBack, CullFaceNone, DoubleSide, BackSide, CustomBlending, MultiplyBlending, SubtractiveBlending, AdditiveBlending, NoBlending, NormalBlending, AddEquation, SubtractEquation, ReverseSubtractEquation, MinEquation, MaxEquation, ZeroFactor, OneFactor, SrcColorFactor, SrcAlphaFactor, SrcAlphaSaturateFactor, DstColorFactor, DstAlphaFactor, OneMinusSrcColorFactor, OneMinusSrcAlphaFactor, OneMinusDstColorFactor, OneMinusDstAlphaFactor } from '../../constants.js';\r\nimport { Vector4 } from '../../math/Vector4.js';\r\n\r\nfunction WebGLState( gl, extensions, capabilities ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\r\n\tfunction ColorBuffer() {\r\n\r\n\t\tlet locked = false;\r\n\r\n\t\tconst color = new Vector4();\r\n\t\tlet currentColorMask = null;\r\n\t\tconst currentColorClear = new Vector4( 0, 0, 0, 0 );\r\n\r\n\t\treturn {\r\n\r\n\t\t\tsetMask: function ( colorMask ) {\r\n\r\n\t\t\t\tif ( currentColorMask !== colorMask && ! locked ) {\r\n\r\n\t\t\t\t\tgl.colorMask( colorMask, colorMask, colorMask, colorMask );\r\n\t\t\t\t\tcurrentColorMask = colorMask;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetLocked: function ( lock ) {\r\n\r\n\t\t\t\tlocked = lock;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetClear: function ( r, g, b, a, premultipliedAlpha ) {\r\n\r\n\t\t\t\tif ( premultipliedAlpha === true ) {\r\n\r\n\t\t\t\t\tr *= a; g *= a; b *= a;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolor.set( r, g, b, a );\r\n\r\n\t\t\t\tif ( currentColorClear.equals( color ) === false ) {\r\n\r\n\t\t\t\t\tgl.clearColor( r, g, b, a );\r\n\t\t\t\t\tcurrentColorClear.copy( color );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\treset: function () {\r\n\r\n\t\t\t\tlocked = false;\r\n\r\n\t\t\t\tcurrentColorMask = null;\r\n\t\t\t\tcurrentColorClear.set( - 1, 0, 0, 0 ); // set to invalid state\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction DepthBuffer() {\r\n\r\n\t\tlet locked = false;\r\n\r\n\t\tlet currentDepthMask = null;\r\n\t\tlet currentDepthFunc = null;\r\n\t\tlet currentDepthClear = null;\r\n\r\n\t\treturn {\r\n\r\n\t\t\tsetTest: function ( depthTest ) {\r\n\r\n\t\t\t\tif ( depthTest ) {\r\n\r\n\t\t\t\t\tenable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tdisable( gl.DEPTH_TEST );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetMask: function ( depthMask ) {\r\n\r\n\t\t\t\tif ( currentDepthMask !== depthMask && ! locked ) {\r\n\r\n\t\t\t\t\tgl.depthMask( depthMask );\r\n\t\t\t\t\tcurrentDepthMask = depthMask;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetFunc: function ( depthFunc ) {\r\n\r\n\t\t\t\tif ( currentDepthFunc !== depthFunc ) {\r\n\r\n\t\t\t\t\tif ( depthFunc ) {\r\n\r\n\t\t\t\t\t\tswitch ( depthFunc ) {\r\n\r\n\t\t\t\t\t\t\tcase NeverDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.NEVER );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase AlwaysDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.ALWAYS );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase LessDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LESS );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase LessEqualDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase EqualDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.EQUAL );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase GreaterEqualDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.GEQUAL );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase GreaterDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.GREATER );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase NotEqualDepth:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.NOTEQUAL );\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tgl.depthFunc( gl.LEQUAL );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcurrentDepthFunc = depthFunc;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetLocked: function ( lock ) {\r\n\r\n\t\t\t\tlocked = lock;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetClear: function ( depth ) {\r\n\r\n\t\t\t\tif ( currentDepthClear !== depth ) {\r\n\r\n\t\t\t\t\tgl.clearDepth( depth );\r\n\t\t\t\t\tcurrentDepthClear = depth;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\treset: function () {\r\n\r\n\t\t\t\tlocked = false;\r\n\r\n\t\t\t\tcurrentDepthMask = null;\r\n\t\t\t\tcurrentDepthFunc = null;\r\n\t\t\t\tcurrentDepthClear = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction StencilBuffer() {\r\n\r\n\t\tlet locked = false;\r\n\r\n\t\tlet currentStencilMask = null;\r\n\t\tlet currentStencilFunc = null;\r\n\t\tlet currentStencilRef = null;\r\n\t\tlet currentStencilFuncMask = null;\r\n\t\tlet currentStencilFail = null;\r\n\t\tlet currentStencilZFail = null;\r\n\t\tlet currentStencilZPass = null;\r\n\t\tlet currentStencilClear = null;\r\n\r\n\t\treturn {\r\n\r\n\t\t\tsetTest: function ( stencilTest ) {\r\n\r\n\t\t\t\tif ( ! locked ) {\r\n\r\n\t\t\t\t\tif ( stencilTest ) {\r\n\r\n\t\t\t\t\t\tenable( gl.STENCIL_TEST );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdisable( gl.STENCIL_TEST );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetMask: function ( stencilMask ) {\r\n\r\n\t\t\t\tif ( currentStencilMask !== stencilMask && ! locked ) {\r\n\r\n\t\t\t\t\tgl.stencilMask( stencilMask );\r\n\t\t\t\t\tcurrentStencilMask = stencilMask;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetFunc: function ( stencilFunc, stencilRef, stencilMask ) {\r\n\r\n\t\t\t\tif ( currentStencilFunc !== stencilFunc ||\r\n\t\t\t\t     currentStencilRef !== stencilRef ||\r\n\t\t\t\t     currentStencilFuncMask !== stencilMask ) {\r\n\r\n\t\t\t\t\tgl.stencilFunc( stencilFunc, stencilRef, stencilMask );\r\n\r\n\t\t\t\t\tcurrentStencilFunc = stencilFunc;\r\n\t\t\t\t\tcurrentStencilRef = stencilRef;\r\n\t\t\t\t\tcurrentStencilFuncMask = stencilMask;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetOp: function ( stencilFail, stencilZFail, stencilZPass ) {\r\n\r\n\t\t\t\tif ( currentStencilFail !== stencilFail ||\r\n\t\t\t\t     currentStencilZFail !== stencilZFail ||\r\n\t\t\t\t     currentStencilZPass !== stencilZPass ) {\r\n\r\n\t\t\t\t\tgl.stencilOp( stencilFail, stencilZFail, stencilZPass );\r\n\r\n\t\t\t\t\tcurrentStencilFail = stencilFail;\r\n\t\t\t\t\tcurrentStencilZFail = stencilZFail;\r\n\t\t\t\t\tcurrentStencilZPass = stencilZPass;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetLocked: function ( lock ) {\r\n\r\n\t\t\t\tlocked = lock;\r\n\r\n\t\t\t},\r\n\r\n\t\t\tsetClear: function ( stencil ) {\r\n\r\n\t\t\t\tif ( currentStencilClear !== stencil ) {\r\n\r\n\t\t\t\t\tgl.clearStencil( stencil );\r\n\t\t\t\t\tcurrentStencilClear = stencil;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\treset: function () {\r\n\r\n\t\t\t\tlocked = false;\r\n\r\n\t\t\t\tcurrentStencilMask = null;\r\n\t\t\t\tcurrentStencilFunc = null;\r\n\t\t\t\tcurrentStencilRef = null;\r\n\t\t\t\tcurrentStencilFuncMask = null;\r\n\t\t\t\tcurrentStencilFail = null;\r\n\t\t\t\tcurrentStencilZFail = null;\r\n\t\t\t\tcurrentStencilZPass = null;\r\n\t\t\t\tcurrentStencilClear = null;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tconst colorBuffer = new ColorBuffer();\r\n\tconst depthBuffer = new DepthBuffer();\r\n\tconst stencilBuffer = new StencilBuffer();\r\n\r\n\tlet enabledCapabilities = {};\r\n\r\n\tlet xrFramebuffer = null;\r\n\tlet currentBoundFramebuffers = {};\r\n\r\n\tlet currentProgram = null;\r\n\r\n\tlet currentBlendingEnabled = false;\r\n\tlet currentBlending = null;\r\n\tlet currentBlendEquation = null;\r\n\tlet currentBlendSrc = null;\r\n\tlet currentBlendDst = null;\r\n\tlet currentBlendEquationAlpha = null;\r\n\tlet currentBlendSrcAlpha = null;\r\n\tlet currentBlendDstAlpha = null;\r\n\tlet currentPremultipledAlpha = false;\r\n\r\n\tlet currentFlipSided = null;\r\n\tlet currentCullFace = null;\r\n\r\n\tlet currentLineWidth = null;\r\n\r\n\tlet currentPolygonOffsetFactor = null;\r\n\tlet currentPolygonOffsetUnits = null;\r\n\r\n\tconst maxTextures = gl.getParameter( gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS );\r\n\r\n\tlet lineWidthAvailable = false;\r\n\tlet version = 0;\r\n\tconst glVersion = gl.getParameter( gl.VERSION );\r\n\r\n\tif ( glVersion.indexOf( 'WebGL' ) !== - 1 ) {\r\n\r\n\t\tversion = parseFloat( /^WebGL (\\d)/.exec( glVersion )[ 1 ] );\r\n\t\tlineWidthAvailable = ( version >= 1.0 );\r\n\r\n\t} else if ( glVersion.indexOf( 'OpenGL ES' ) !== - 1 ) {\r\n\r\n\t\tversion = parseFloat( /^OpenGL ES (\\d)/.exec( glVersion )[ 1 ] );\r\n\t\tlineWidthAvailable = ( version >= 2.0 );\r\n\r\n\t}\r\n\r\n\tlet currentTextureSlot = null;\r\n\tlet currentBoundTextures = {};\r\n\r\n\tconst scissorParam = gl.getParameter( gl.SCISSOR_BOX );\r\n\tconst viewportParam = gl.getParameter( gl.VIEWPORT );\r\n\r\n\tconst currentScissor = new Vector4().fromArray( scissorParam );\r\n\tconst currentViewport = new Vector4().fromArray( viewportParam );\r\n\r\n\tfunction createTexture( type, target, count ) {\r\n\r\n\t\tconst data = new Uint8Array( 4 ); // 4 is required to match default unpack alignment of 4.\r\n\t\tconst texture = gl.createTexture();\r\n\r\n\t\tgl.bindTexture( type, texture );\r\n\t\tgl.texParameteri( type, gl.TEXTURE_MIN_FILTER, gl.NEAREST );\r\n\t\tgl.texParameteri( type, gl.TEXTURE_MAG_FILTER, gl.NEAREST );\r\n\r\n\t\tfor ( let i = 0; i < count; i ++ ) {\r\n\r\n\t\t\tgl.texImage2D( target + i, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE, data );\r\n\r\n\t\t}\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tconst emptyTextures = {};\r\n\temptyTextures[ gl.TEXTURE_2D ] = createTexture( gl.TEXTURE_2D, gl.TEXTURE_2D, 1 );\r\n\temptyTextures[ gl.TEXTURE_CUBE_MAP ] = createTexture( gl.TEXTURE_CUBE_MAP, gl.TEXTURE_CUBE_MAP_POSITIVE_X, 6 );\r\n\r\n\t// init\r\n\r\n\tcolorBuffer.setClear( 0, 0, 0, 1 );\r\n\tdepthBuffer.setClear( 1 );\r\n\tstencilBuffer.setClear( 0 );\r\n\r\n\tenable( gl.DEPTH_TEST );\r\n\tdepthBuffer.setFunc( LessEqualDepth );\r\n\r\n\tsetFlipSided( false );\r\n\tsetCullFace( CullFaceBack );\r\n\tenable( gl.CULL_FACE );\r\n\r\n\tsetBlending( NoBlending );\r\n\r\n\t//\r\n\r\n\tfunction enable( id ) {\r\n\r\n\t\tif ( enabledCapabilities[ id ] !== true ) {\r\n\r\n\t\t\tgl.enable( id );\r\n\t\t\tenabledCapabilities[ id ] = true;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction disable( id ) {\r\n\r\n\t\tif ( enabledCapabilities[ id ] !== false ) {\r\n\r\n\t\t\tgl.disable( id );\r\n\t\t\tenabledCapabilities[ id ] = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction bindXRFramebuffer( framebuffer ) {\r\n\r\n\t\tif ( framebuffer !== xrFramebuffer ) {\r\n\r\n\t\t\tgl.bindFramebuffer( gl.FRAMEBUFFER, framebuffer );\r\n\r\n\t\t\txrFramebuffer = framebuffer;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction bindFramebuffer( target, framebuffer ) {\r\n\r\n\t\tif ( framebuffer === null && xrFramebuffer !== null ) framebuffer = xrFramebuffer; // use active XR framebuffer if available\r\n\r\n\t\tif ( currentBoundFramebuffers[ target ] !== framebuffer ) {\r\n\r\n\t\t\tgl.bindFramebuffer( target, framebuffer );\r\n\r\n\t\t\tcurrentBoundFramebuffers[ target ] = framebuffer;\r\n\r\n\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\t// gl.DRAW_FRAMEBUFFER is equivalent to gl.FRAMEBUFFER\r\n\r\n\t\t\t\tif ( target === gl.DRAW_FRAMEBUFFER ) {\r\n\r\n\t\t\t\t\tcurrentBoundFramebuffers[ gl.FRAMEBUFFER ] = framebuffer;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( target === gl.FRAMEBUFFER ) {\r\n\r\n\t\t\t\t\tcurrentBoundFramebuffers[ gl.DRAW_FRAMEBUFFER ] = framebuffer;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tfunction useProgram( program ) {\r\n\r\n\t\tif ( currentProgram !== program ) {\r\n\r\n\t\t\tgl.useProgram( program );\r\n\r\n\t\t\tcurrentProgram = program;\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tconst equationToGL = {\r\n\t\t[ AddEquation ]: gl.FUNC_ADD,\r\n\t\t[ SubtractEquation ]: gl.FUNC_SUBTRACT,\r\n\t\t[ ReverseSubtractEquation ]: gl.FUNC_REVERSE_SUBTRACT\r\n\t};\r\n\r\n\tif ( isWebGL2 ) {\r\n\r\n\t\tequationToGL[ MinEquation ] = gl.MIN;\r\n\t\tequationToGL[ MaxEquation ] = gl.MAX;\r\n\r\n\t} else {\r\n\r\n\t\tconst extension = extensions.get( 'EXT_blend_minmax' );\r\n\r\n\t\tif ( extension !== null ) {\r\n\r\n\t\t\tequationToGL[ MinEquation ] = extension.MIN_EXT;\r\n\t\t\tequationToGL[ MaxEquation ] = extension.MAX_EXT;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tconst factorToGL = {\r\n\t\t[ ZeroFactor ]: gl.ZERO,\r\n\t\t[ OneFactor ]: gl.ONE,\r\n\t\t[ SrcColorFactor ]: gl.SRC_COLOR,\r\n\t\t[ SrcAlphaFactor ]: gl.SRC_ALPHA,\r\n\t\t[ SrcAlphaSaturateFactor ]: gl.SRC_ALPHA_SATURATE,\r\n\t\t[ DstColorFactor ]: gl.DST_COLOR,\r\n\t\t[ DstAlphaFactor ]: gl.DST_ALPHA,\r\n\t\t[ OneMinusSrcColorFactor ]: gl.ONE_MINUS_SRC_COLOR,\r\n\t\t[ OneMinusSrcAlphaFactor ]: gl.ONE_MINUS_SRC_ALPHA,\r\n\t\t[ OneMinusDstColorFactor ]: gl.ONE_MINUS_DST_COLOR,\r\n\t\t[ OneMinusDstAlphaFactor ]: gl.ONE_MINUS_DST_ALPHA\r\n\t};\r\n\r\n\tfunction setBlending( blending, blendEquation, blendSrc, blendDst, blendEquationAlpha, blendSrcAlpha, blendDstAlpha, premultipliedAlpha ) {\r\n\r\n\t\tif ( blending === NoBlending ) {\r\n\r\n\t\t\tif ( currentBlendingEnabled === true ) {\r\n\r\n\t\t\t\tdisable( gl.BLEND );\r\n\t\t\t\tcurrentBlendingEnabled = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( currentBlendingEnabled === false ) {\r\n\r\n\t\t\tenable( gl.BLEND );\r\n\t\t\tcurrentBlendingEnabled = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( blending !== CustomBlending ) {\r\n\r\n\t\t\tif ( blending !== currentBlending || premultipliedAlpha !== currentPremultipledAlpha ) {\r\n\r\n\t\t\t\tif ( currentBlendEquation !== AddEquation || currentBlendEquationAlpha !== AddEquation ) {\r\n\r\n\t\t\t\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\r\n\t\t\t\t\tcurrentBlendEquation = AddEquation;\r\n\t\t\t\t\tcurrentBlendEquationAlpha = AddEquation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( premultipliedAlpha ) {\r\n\r\n\t\t\t\t\tswitch ( blending ) {\r\n\r\n\t\t\t\t\t\tcase NormalBlending:\r\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ONE, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase AdditiveBlending:\r\n\t\t\t\t\t\t\tgl.blendFunc( gl.ONE, gl.ONE );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase SubtractiveBlending:\r\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ZERO, gl.ZERO, gl.ONE_MINUS_SRC_COLOR, gl.ONE_MINUS_SRC_ALPHA );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase MultiplyBlending:\r\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.ZERO, gl.SRC_COLOR, gl.ZERO, gl.SRC_ALPHA );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLState: Invalid blending: ', blending );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tswitch ( blending ) {\r\n\r\n\t\t\t\t\t\tcase NormalBlending:\r\n\t\t\t\t\t\t\tgl.blendFuncSeparate( gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase AdditiveBlending:\r\n\t\t\t\t\t\t\tgl.blendFunc( gl.SRC_ALPHA, gl.ONE );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase SubtractiveBlending:\r\n\t\t\t\t\t\t\tgl.blendFunc( gl.ZERO, gl.ONE_MINUS_SRC_COLOR );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase MultiplyBlending:\r\n\t\t\t\t\t\t\tgl.blendFunc( gl.ZERO, gl.SRC_COLOR );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.error( 'THREE.WebGLState: Invalid blending: ', blending );\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrentBlendSrc = null;\r\n\t\t\t\tcurrentBlendDst = null;\r\n\t\t\t\tcurrentBlendSrcAlpha = null;\r\n\t\t\t\tcurrentBlendDstAlpha = null;\r\n\r\n\t\t\t\tcurrentBlending = blending;\r\n\t\t\t\tcurrentPremultipledAlpha = premultipliedAlpha;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// custom blending\r\n\r\n\t\tblendEquationAlpha = blendEquationAlpha || blendEquation;\r\n\t\tblendSrcAlpha = blendSrcAlpha || blendSrc;\r\n\t\tblendDstAlpha = blendDstAlpha || blendDst;\r\n\r\n\t\tif ( blendEquation !== currentBlendEquation || blendEquationAlpha !== currentBlendEquationAlpha ) {\r\n\r\n\t\t\tgl.blendEquationSeparate( equationToGL[ blendEquation ], equationToGL[ blendEquationAlpha ] );\r\n\r\n\t\t\tcurrentBlendEquation = blendEquation;\r\n\t\t\tcurrentBlendEquationAlpha = blendEquationAlpha;\r\n\r\n\t\t}\r\n\r\n\t\tif ( blendSrc !== currentBlendSrc || blendDst !== currentBlendDst || blendSrcAlpha !== currentBlendSrcAlpha || blendDstAlpha !== currentBlendDstAlpha ) {\r\n\r\n\t\t\tgl.blendFuncSeparate( factorToGL[ blendSrc ], factorToGL[ blendDst ], factorToGL[ blendSrcAlpha ], factorToGL[ blendDstAlpha ] );\r\n\r\n\t\t\tcurrentBlendSrc = blendSrc;\r\n\t\t\tcurrentBlendDst = blendDst;\r\n\t\t\tcurrentBlendSrcAlpha = blendSrcAlpha;\r\n\t\t\tcurrentBlendDstAlpha = blendDstAlpha;\r\n\r\n\t\t}\r\n\r\n\t\tcurrentBlending = blending;\r\n\t\tcurrentPremultipledAlpha = null;\r\n\r\n\t}\r\n\r\n\tfunction setMaterial( material, frontFaceCW ) {\r\n\r\n\t\tmaterial.side === DoubleSide\r\n\t\t\t? disable( gl.CULL_FACE )\r\n\t\t\t: enable( gl.CULL_FACE );\r\n\r\n\t\tlet flipSided = ( material.side === BackSide );\r\n\t\tif ( frontFaceCW ) flipSided = ! flipSided;\r\n\r\n\t\tsetFlipSided( flipSided );\r\n\r\n\t\t( material.blending === NormalBlending && material.transparent === false )\r\n\t\t\t? setBlending( NoBlending )\r\n\t\t\t: setBlending( material.blending, material.blendEquation, material.blendSrc, material.blendDst, material.blendEquationAlpha, material.blendSrcAlpha, material.blendDstAlpha, material.premultipliedAlpha );\r\n\r\n\t\tdepthBuffer.setFunc( material.depthFunc );\r\n\t\tdepthBuffer.setTest( material.depthTest );\r\n\t\tdepthBuffer.setMask( material.depthWrite );\r\n\t\tcolorBuffer.setMask( material.colorWrite );\r\n\r\n\t\tconst stencilWrite = material.stencilWrite;\r\n\t\tstencilBuffer.setTest( stencilWrite );\r\n\t\tif ( stencilWrite ) {\r\n\r\n\t\t\tstencilBuffer.setMask( material.stencilWriteMask );\r\n\t\t\tstencilBuffer.setFunc( material.stencilFunc, material.stencilRef, material.stencilFuncMask );\r\n\t\t\tstencilBuffer.setOp( material.stencilFail, material.stencilZFail, material.stencilZPass );\r\n\r\n\t\t}\r\n\r\n\t\tsetPolygonOffset( material.polygonOffset, material.polygonOffsetFactor, material.polygonOffsetUnits );\r\n\r\n\t\tmaterial.alphaToCoverage === true\r\n\t\t\t? enable( gl.SAMPLE_ALPHA_TO_COVERAGE )\r\n\t\t\t: disable( gl.SAMPLE_ALPHA_TO_COVERAGE );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction setFlipSided( flipSided ) {\r\n\r\n\t\tif ( currentFlipSided !== flipSided ) {\r\n\r\n\t\t\tif ( flipSided ) {\r\n\r\n\t\t\t\tgl.frontFace( gl.CW );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tgl.frontFace( gl.CCW );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcurrentFlipSided = flipSided;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setCullFace( cullFace ) {\r\n\r\n\t\tif ( cullFace !== CullFaceNone ) {\r\n\r\n\t\t\tenable( gl.CULL_FACE );\r\n\r\n\t\t\tif ( cullFace !== currentCullFace ) {\r\n\r\n\t\t\t\tif ( cullFace === CullFaceBack ) {\r\n\r\n\t\t\t\t\tgl.cullFace( gl.BACK );\r\n\r\n\t\t\t\t} else if ( cullFace === CullFaceFront ) {\r\n\r\n\t\t\t\t\tgl.cullFace( gl.FRONT );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tgl.cullFace( gl.FRONT_AND_BACK );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdisable( gl.CULL_FACE );\r\n\r\n\t\t}\r\n\r\n\t\tcurrentCullFace = cullFace;\r\n\r\n\t}\r\n\r\n\tfunction setLineWidth( width ) {\r\n\r\n\t\tif ( width !== currentLineWidth ) {\r\n\r\n\t\t\tif ( lineWidthAvailable ) gl.lineWidth( width );\r\n\r\n\t\t\tcurrentLineWidth = width;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setPolygonOffset( polygonOffset, factor, units ) {\r\n\r\n\t\tif ( polygonOffset ) {\r\n\r\n\t\t\tenable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t\tif ( currentPolygonOffsetFactor !== factor || currentPolygonOffsetUnits !== units ) {\r\n\r\n\t\t\t\tgl.polygonOffset( factor, units );\r\n\r\n\t\t\t\tcurrentPolygonOffsetFactor = factor;\r\n\t\t\t\tcurrentPolygonOffsetUnits = units;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdisable( gl.POLYGON_OFFSET_FILL );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setScissorTest( scissorTest ) {\r\n\r\n\t\tif ( scissorTest ) {\r\n\r\n\t\t\tenable( gl.SCISSOR_TEST );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdisable( gl.SCISSOR_TEST );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// texture\r\n\r\n\tfunction activeTexture( webglSlot ) {\r\n\r\n\t\tif ( webglSlot === undefined ) webglSlot = gl.TEXTURE0 + maxTextures - 1;\r\n\r\n\t\tif ( currentTextureSlot !== webglSlot ) {\r\n\r\n\t\t\tgl.activeTexture( webglSlot );\r\n\t\t\tcurrentTextureSlot = webglSlot;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction bindTexture( webglType, webglTexture ) {\r\n\r\n\t\tif ( currentTextureSlot === null ) {\r\n\r\n\t\t\tactiveTexture();\r\n\r\n\t\t}\r\n\r\n\t\tlet boundTexture = currentBoundTextures[ currentTextureSlot ];\r\n\r\n\t\tif ( boundTexture === undefined ) {\r\n\r\n\t\t\tboundTexture = { type: undefined, texture: undefined };\r\n\t\t\tcurrentBoundTextures[ currentTextureSlot ] = boundTexture;\r\n\r\n\t\t}\r\n\r\n\t\tif ( boundTexture.type !== webglType || boundTexture.texture !== webglTexture ) {\r\n\r\n\t\t\tgl.bindTexture( webglType, webglTexture || emptyTextures[ webglType ] );\r\n\r\n\t\t\tboundTexture.type = webglType;\r\n\t\t\tboundTexture.texture = webglTexture;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction unbindTexture() {\r\n\r\n\t\tconst boundTexture = currentBoundTextures[ currentTextureSlot ];\r\n\r\n\t\tif ( boundTexture !== undefined && boundTexture.type !== undefined ) {\r\n\r\n\t\t\tgl.bindTexture( boundTexture.type, null );\r\n\r\n\t\t\tboundTexture.type = undefined;\r\n\t\t\tboundTexture.texture = undefined;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction compressedTexImage2D() {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tgl.compressedTexImage2D.apply( gl, arguments );\r\n\r\n\t\t} catch ( error ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction texImage2D() {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tgl.texImage2D.apply( gl, arguments );\r\n\r\n\t\t} catch ( error ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction texImage3D() {\r\n\r\n\t\ttry {\r\n\r\n\t\t\tgl.texImage3D.apply( gl, arguments );\r\n\r\n\t\t} catch ( error ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLState:', error );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction scissor( scissor ) {\r\n\r\n\t\tif ( currentScissor.equals( scissor ) === false ) {\r\n\r\n\t\t\tgl.scissor( scissor.x, scissor.y, scissor.z, scissor.w );\r\n\t\t\tcurrentScissor.copy( scissor );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction viewport( viewport ) {\r\n\r\n\t\tif ( currentViewport.equals( viewport ) === false ) {\r\n\r\n\t\t\tgl.viewport( viewport.x, viewport.y, viewport.z, viewport.w );\r\n\t\t\tcurrentViewport.copy( viewport );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction reset() {\r\n\r\n\t\t// reset state\r\n\r\n\t\tgl.disable( gl.BLEND );\r\n\t\tgl.disable( gl.CULL_FACE );\r\n\t\tgl.disable( gl.DEPTH_TEST );\r\n\t\tgl.disable( gl.POLYGON_OFFSET_FILL );\r\n\t\tgl.disable( gl.SCISSOR_TEST );\r\n\t\tgl.disable( gl.STENCIL_TEST );\r\n\t\tgl.disable( gl.SAMPLE_ALPHA_TO_COVERAGE );\r\n\r\n\t\tgl.blendEquation( gl.FUNC_ADD );\r\n\t\tgl.blendFunc( gl.ONE, gl.ZERO );\r\n\t\tgl.blendFuncSeparate( gl.ONE, gl.ZERO, gl.ONE, gl.ZERO );\r\n\r\n\t\tgl.colorMask( true, true, true, true );\r\n\t\tgl.clearColor( 0, 0, 0, 0 );\r\n\r\n\t\tgl.depthMask( true );\r\n\t\tgl.depthFunc( gl.LESS );\r\n\t\tgl.clearDepth( 1 );\r\n\r\n\t\tgl.stencilMask( 0xffffffff );\r\n\t\tgl.stencilFunc( gl.ALWAYS, 0, 0xffffffff );\r\n\t\tgl.stencilOp( gl.KEEP, gl.KEEP, gl.KEEP );\r\n\t\tgl.clearStencil( 0 );\r\n\r\n\t\tgl.cullFace( gl.BACK );\r\n\t\tgl.frontFace( gl.CCW );\r\n\r\n\t\tgl.polygonOffset( 0, 0 );\r\n\r\n\t\tgl.activeTexture( gl.TEXTURE0 );\r\n\r\n\t\tgl.bindFramebuffer( gl.FRAMEBUFFER, null );\r\n\r\n\t\tif ( isWebGL2 === true ) {\r\n\r\n\t\t\tgl.bindFramebuffer( gl.DRAW_FRAMEBUFFER, null );\r\n\t\t\tgl.bindFramebuffer( gl.READ_FRAMEBUFFER, null );\r\n\r\n\t\t}\r\n\r\n\t\tgl.useProgram( null );\r\n\r\n\t\tgl.lineWidth( 1 );\r\n\r\n\t\tgl.scissor( 0, 0, gl.canvas.width, gl.canvas.height );\r\n\t\tgl.viewport( 0, 0, gl.canvas.width, gl.canvas.height );\r\n\r\n\t\t// reset internals\r\n\r\n\t\tenabledCapabilities = {};\r\n\r\n\t\tcurrentTextureSlot = null;\r\n\t\tcurrentBoundTextures = {};\r\n\r\n\t\txrFramebuffer = null;\r\n\t\tcurrentBoundFramebuffers = {};\r\n\r\n\t\tcurrentProgram = null;\r\n\r\n\t\tcurrentBlendingEnabled = false;\r\n\t\tcurrentBlending = null;\r\n\t\tcurrentBlendEquation = null;\r\n\t\tcurrentBlendSrc = null;\r\n\t\tcurrentBlendDst = null;\r\n\t\tcurrentBlendEquationAlpha = null;\r\n\t\tcurrentBlendSrcAlpha = null;\r\n\t\tcurrentBlendDstAlpha = null;\r\n\t\tcurrentPremultipledAlpha = false;\r\n\r\n\t\tcurrentFlipSided = null;\r\n\t\tcurrentCullFace = null;\r\n\r\n\t\tcurrentLineWidth = null;\r\n\r\n\t\tcurrentPolygonOffsetFactor = null;\r\n\t\tcurrentPolygonOffsetUnits = null;\r\n\r\n\t\tcurrentScissor.set( 0, 0, gl.canvas.width, gl.canvas.height );\r\n\t\tcurrentViewport.set( 0, 0, gl.canvas.width, gl.canvas.height );\r\n\r\n\t\tcolorBuffer.reset();\r\n\t\tdepthBuffer.reset();\r\n\t\tstencilBuffer.reset();\r\n\r\n\t}\r\n\r\n\treturn {\r\n\r\n\t\tbuffers: {\r\n\t\t\tcolor: colorBuffer,\r\n\t\t\tdepth: depthBuffer,\r\n\t\t\tstencil: stencilBuffer\r\n\t\t},\r\n\r\n\t\tenable: enable,\r\n\t\tdisable: disable,\r\n\r\n\t\tbindFramebuffer: bindFramebuffer,\r\n\t\tbindXRFramebuffer: bindXRFramebuffer,\r\n\r\n\t\tuseProgram: useProgram,\r\n\r\n\t\tsetBlending: setBlending,\r\n\t\tsetMaterial: setMaterial,\r\n\r\n\t\tsetFlipSided: setFlipSided,\r\n\t\tsetCullFace: setCullFace,\r\n\r\n\t\tsetLineWidth: setLineWidth,\r\n\t\tsetPolygonOffset: setPolygonOffset,\r\n\r\n\t\tsetScissorTest: setScissorTest,\r\n\r\n\t\tactiveTexture: activeTexture,\r\n\t\tbindTexture: bindTexture,\r\n\t\tunbindTexture: unbindTexture,\r\n\t\tcompressedTexImage2D: compressedTexImage2D,\r\n\t\ttexImage2D: texImage2D,\r\n\t\ttexImage3D: texImage3D,\r\n\r\n\t\tscissor: scissor,\r\n\t\tviewport: viewport,\r\n\r\n\t\treset: reset\r\n\r\n\t};\r\n\r\n}\r\n\r\nexport { WebGLState };\r\n", "import { LinearFilter, LinearMipmapLinearFilter, LinearMipmapNearestFilter, NearestFilter, NearestMipmapLinearFilter, NearestMipmapNearestFilter, RGBFormat, RGBAFormat, DepthFormat, DepthStencilFormat, UnsignedShortType, UnsignedIntType, UnsignedInt248Type, FloatType, HalfFloatType, MirroredRepeatWrapping, ClampToEdgeWrapping, RepeatWrapping } from '../../constants.js';\r\nimport * as MathUtils from '../../math/MathUtils.js';\r\n\r\nfunction WebGLTextures( _gl, extensions, state, properties, capabilities, utils, info ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\tconst maxTextures = capabilities.maxTextures;\r\n\tconst maxCubemapSize = capabilities.maxCubemapSize;\r\n\tconst maxTextureSize = capabilities.maxTextureSize;\r\n\tconst maxSamples = capabilities.maxSamples;\r\n\r\n\tconst _videoTextures = new WeakMap();\r\n\tlet _canvas;\r\n\r\n\t// cordova iOS (as of 5.0) still uses UIWebView, which provides OffscreenCanvas,\r\n\t// also OffscreenCanvas.getContext(\"webgl\"), but not OffscreenCanvas.getContext(\"2d\")!\r\n\t// Some implementations may only implement OffscreenCanvas partially (e.g. lacking 2d).\r\n\r\n\tlet useOffscreenCanvas = false;\r\n\r\n\ttry {\r\n\r\n\t\tuseOffscreenCanvas = typeof OffscreenCanvas !== 'undefined'\r\n\t\t\t&& ( new OffscreenCanvas( 1, 1 ).getContext( '2d' ) ) !== null;\r\n\r\n\t} catch ( err ) {\r\n\r\n\t\t// Ignore any errors\r\n\r\n\t}\r\n\r\n\tfunction createCanvas( width, height ) {\r\n\r\n\t\t// Use OffscreenCanvas when available. Specially needed in web workers\r\n\r\n\t\treturn useOffscreenCanvas ?\r\n\t\t\tnew OffscreenCanvas( width, height ) :\r\n\t\t\tdocument.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\r\n\r\n\t}\r\n\r\n\tfunction resizeImage( image, needsPowerOfTwo, needsNewCanvas, maxSize ) {\r\n\r\n\t\tlet scale = 1;\r\n\r\n\t\t// handle case if texture exceeds max size\r\n\r\n\t\tif ( image.width > maxSize || image.height > maxSize ) {\r\n\r\n\t\t\tscale = maxSize / Math.max( image.width, image.height );\r\n\r\n\t\t}\r\n\r\n\t\t// only perform resize if necessary\r\n\r\n\t\tif ( scale < 1 || needsPowerOfTwo === true ) {\r\n\r\n\t\t\t// only perform resize for certain image types\r\n\r\n\t\t\tif ( ( typeof HTMLImageElement !== 'undefined' && image instanceof HTMLImageElement ) ||\r\n\t\t\t\t( typeof HTMLCanvasElement !== 'undefined' && image instanceof HTMLCanvasElement ) ||\r\n\t\t\t\t( typeof ImageBitmap !== 'undefined' && image instanceof ImageBitmap ) ) {\r\n\r\n\t\t\t\tconst floor = needsPowerOfTwo ? MathUtils.floorPowerOfTwo : Math.floor;\r\n\r\n\t\t\t\tconst width = floor( scale * image.width );\r\n\t\t\t\tconst height = floor( scale * image.height );\r\n\r\n\t\t\t\tif ( _canvas === undefined ) _canvas = createCanvas( width, height );\r\n\r\n\t\t\t\t// cube textures can't reuse the same canvas\r\n\r\n\t\t\t\tconst canvas = needsNewCanvas ? createCanvas( width, height ) : _canvas;\r\n\r\n\t\t\t\tcanvas.width = width;\r\n\t\t\t\tcanvas.height = height;\r\n\r\n\t\t\t\tconst context = canvas.getContext( '2d' );\r\n\t\t\t\tcontext.drawImage( image, 0, 0, width, height );\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture has been resized from (' + image.width + 'x' + image.height + ') to (' + width + 'x' + height + ').' );\r\n\r\n\t\t\t\treturn canvas;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( 'data' in image ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Image in DataTexture is too big (' + image.width + 'x' + image.height + ').' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn image;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn image;\r\n\r\n\t}\r\n\r\n\tfunction isPowerOfTwo( image ) {\r\n\r\n\t\treturn MathUtils.isPowerOfTwo( image.width ) && MathUtils.isPowerOfTwo( image.height );\r\n\r\n\t}\r\n\r\n\tfunction textureNeedsPowerOfTwo( texture ) {\r\n\r\n\t\tif ( isWebGL2 ) return false;\r\n\r\n\t\treturn ( texture.wrapS !== ClampToEdgeWrapping || texture.wrapT !== ClampToEdgeWrapping ) ||\r\n\t\t\t( texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter );\r\n\r\n\t}\r\n\r\n\tfunction textureNeedsGenerateMipmaps( texture, supportsMips ) {\r\n\r\n\t\treturn texture.generateMipmaps && supportsMips &&\r\n\t\t\ttexture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\r\n\r\n\t}\r\n\r\n\tfunction generateMipmap( target, texture, width, height, depth = 1 ) {\r\n\r\n\t\t_gl.generateMipmap( target );\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\ttextureProperties.__maxMipLevel = Math.log2( Math.max( width, height, depth ) );\r\n\r\n\t}\r\n\r\n\tfunction getInternalFormat( internalFormatName, glFormat, glType ) {\r\n\r\n\t\tif ( isWebGL2 === false ) return glFormat;\r\n\r\n\t\tif ( internalFormatName !== null ) {\r\n\r\n\t\t\tif ( _gl[ internalFormatName ] !== undefined ) return _gl[ internalFormatName ];\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format \\'' + internalFormatName + '\\'' );\r\n\r\n\t\t}\r\n\r\n\t\tlet internalFormat = glFormat;\r\n\r\n\t\tif ( glFormat === _gl.RED ) {\r\n\r\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.R32F;\r\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.R16F;\r\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.R8;\r\n\r\n\t\t}\r\n\r\n\t\tif ( glFormat === _gl.RGB ) {\r\n\r\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.RGB32F;\r\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.RGB16F;\r\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.RGB8;\r\n\r\n\t\t}\r\n\r\n\t\tif ( glFormat === _gl.RGBA ) {\r\n\r\n\t\t\tif ( glType === _gl.FLOAT ) internalFormat = _gl.RGBA32F;\r\n\t\t\tif ( glType === _gl.HALF_FLOAT ) internalFormat = _gl.RGBA16F;\r\n\t\t\tif ( glType === _gl.UNSIGNED_BYTE ) internalFormat = _gl.RGBA8;\r\n\r\n\t\t}\r\n\r\n\t\tif ( internalFormat === _gl.R16F || internalFormat === _gl.R32F ||\r\n\t\t\tinternalFormat === _gl.RGBA16F || internalFormat === _gl.RGBA32F ) {\r\n\r\n\t\t\textensions.get( 'EXT_color_buffer_float' );\r\n\r\n\t\t}\r\n\r\n\t\treturn internalFormat;\r\n\r\n\t}\r\n\r\n\t// Fallback filters for non-power-of-2 textures\r\n\r\n\tfunction filterFallback( f ) {\r\n\r\n\t\tif ( f === NearestFilter || f === NearestMipmapNearestFilter || f === NearestMipmapLinearFilter ) {\r\n\r\n\t\t\treturn _gl.NEAREST;\r\n\r\n\t\t}\r\n\r\n\t\treturn _gl.LINEAR;\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction onTextureDispose( event ) {\r\n\r\n\t\tconst texture = event.target;\r\n\r\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\tdeallocateTexture( texture );\r\n\r\n\t\tif ( texture.isVideoTexture ) {\r\n\r\n\t\t\t_videoTextures.delete( texture );\r\n\r\n\t\t}\r\n\r\n\t\tinfo.memory.textures --;\r\n\r\n\t}\r\n\r\n\tfunction onRenderTargetDispose( event ) {\r\n\r\n\t\tconst renderTarget = event.target;\r\n\r\n\t\trenderTarget.removeEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\tdeallocateRenderTarget( renderTarget );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction deallocateTexture( texture ) {\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( textureProperties.__webglInit === undefined ) return;\r\n\r\n\t\t_gl.deleteTexture( textureProperties.__webglTexture );\r\n\r\n\t\tproperties.remove( texture );\r\n\r\n\t}\r\n\r\n\tfunction deallocateRenderTarget( renderTarget ) {\r\n\r\n\t\tconst texture = renderTarget.texture;\r\n\r\n\t\tconst renderTargetProperties = properties.get( renderTarget );\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( ! renderTarget ) return;\r\n\r\n\t\tif ( textureProperties.__webglTexture !== undefined ) {\r\n\r\n\t\t\t_gl.deleteTexture( textureProperties.__webglTexture );\r\n\r\n\t\t\tinfo.memory.textures --;\r\n\r\n\t\t}\r\n\r\n\t\tif ( renderTarget.depthTexture ) {\r\n\r\n\t\t\trenderTarget.depthTexture.dispose();\r\n\r\n\t\t}\r\n\r\n\t\tif ( renderTarget.isWebGLCubeRenderTarget ) {\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer[ i ] );\r\n\t\t\t\tif ( renderTargetProperties.__webglDepthbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthbuffer[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.deleteFramebuffer( renderTargetProperties.__webglFramebuffer );\r\n\t\t\tif ( renderTargetProperties.__webglDepthbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthbuffer );\r\n\t\t\tif ( renderTargetProperties.__webglMultisampledFramebuffer ) _gl.deleteFramebuffer( renderTargetProperties.__webglMultisampledFramebuffer );\r\n\t\t\tif ( renderTargetProperties.__webglColorRenderbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglColorRenderbuffer );\r\n\t\t\tif ( renderTargetProperties.__webglDepthRenderbuffer ) _gl.deleteRenderbuffer( renderTargetProperties.__webglDepthRenderbuffer );\r\n\r\n\t\t}\r\n\r\n\t\tif ( renderTarget.isWebGLMultipleRenderTargets ) {\r\n\r\n\t\t\tfor ( let i = 0, il = texture.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst attachmentProperties = properties.get( texture[ i ] );\r\n\r\n\t\t\t\tif ( attachmentProperties.__webglTexture ) {\r\n\r\n\t\t\t\t\t_gl.deleteTexture( attachmentProperties.__webglTexture );\r\n\r\n\t\t\t\t\tinfo.memory.textures --;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tproperties.remove( texture[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tproperties.remove( texture );\r\n\t\tproperties.remove( renderTarget );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tlet textureUnits = 0;\r\n\r\n\tfunction resetTextureUnits() {\r\n\r\n\t\ttextureUnits = 0;\r\n\r\n\t}\r\n\r\n\tfunction allocateTextureUnit() {\r\n\r\n\t\tconst textureUnit = textureUnits;\r\n\r\n\t\tif ( textureUnit >= maxTextures ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLTextures: Trying to use ' + textureUnit + ' texture units while this GPU supports only ' + maxTextures );\r\n\r\n\t\t}\r\n\r\n\t\ttextureUnits += 1;\r\n\r\n\t\treturn textureUnit;\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction setTexture2D( texture, slot ) {\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.isVideoTexture ) updateVideoTexture( texture );\r\n\r\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\tconst image = texture.image;\r\n\r\n\t\t\tif ( image === undefined ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is undefined' );\r\n\r\n\t\t\t} else if ( image.complete === false ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture marked for update but image is incomplete' );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tuploadTexture( textureProperties, texture, slot );\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_2D, textureProperties.__webglTexture );\r\n\r\n\t}\r\n\r\n\tfunction setTexture2DArray( texture, slot ) {\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\tuploadTexture( textureProperties, texture, slot );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_2D_ARRAY, textureProperties.__webglTexture );\r\n\r\n\t}\r\n\r\n\tfunction setTexture3D( texture, slot ) {\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\tuploadTexture( textureProperties, texture, slot );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_3D, textureProperties.__webglTexture );\r\n\r\n\t}\r\n\r\n\tfunction setTextureCube( texture, slot ) {\r\n\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\tif ( texture.version > 0 && textureProperties.__version !== texture.version ) {\r\n\r\n\t\t\tuploadCubeTexture( textureProperties, texture, slot );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\r\n\r\n\t}\r\n\r\n\tconst wrappingToGL = {\r\n\t\t[ RepeatWrapping ]: _gl.REPEAT,\r\n\t\t[ ClampToEdgeWrapping ]: _gl.CLAMP_TO_EDGE,\r\n\t\t[ MirroredRepeatWrapping ]: _gl.MIRRORED_REPEAT\r\n\t};\r\n\r\n\tconst filterToGL = {\r\n\t\t[ NearestFilter ]: _gl.NEAREST,\r\n\t\t[ NearestMipmapNearestFilter ]: _gl.NEAREST_MIPMAP_NEAREST,\r\n\t\t[ NearestMipmapLinearFilter ]: _gl.NEAREST_MIPMAP_LINEAR,\r\n\r\n\t\t[ LinearFilter ]: _gl.LINEAR,\r\n\t\t[ LinearMipmapNearestFilter ]: _gl.LINEAR_MIPMAP_NEAREST,\r\n\t\t[ LinearMipmapLinearFilter ]: _gl.LINEAR_MIPMAP_LINEAR\r\n\t};\r\n\r\n\tfunction setTextureParameters( textureType, texture, supportsMips ) {\r\n\r\n\t\tif ( supportsMips ) {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, wrappingToGL[ texture.wrapS ] );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, wrappingToGL[ texture.wrapT ] );\r\n\r\n\t\t\tif ( textureType === _gl.TEXTURE_3D || textureType === _gl.TEXTURE_2D_ARRAY ) {\r\n\r\n\t\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_R, wrappingToGL[ texture.wrapR ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterToGL[ texture.magFilter ] );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterToGL[ texture.minFilter ] );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_S, _gl.CLAMP_TO_EDGE );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_T, _gl.CLAMP_TO_EDGE );\r\n\r\n\t\t\tif ( textureType === _gl.TEXTURE_3D || textureType === _gl.TEXTURE_2D_ARRAY ) {\r\n\r\n\t\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_WRAP_R, _gl.CLAMP_TO_EDGE );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( texture.wrapS !== ClampToEdgeWrapping || texture.wrapT !== ClampToEdgeWrapping ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MAG_FILTER, filterFallback( texture.magFilter ) );\r\n\t\t\t_gl.texParameteri( textureType, _gl.TEXTURE_MIN_FILTER, filterFallback( texture.minFilter ) );\r\n\r\n\t\t\tif ( texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( extensions.has( 'EXT_texture_filter_anisotropic' ) === true ) {\r\n\r\n\t\t\tconst extension = extensions.get( 'EXT_texture_filter_anisotropic' );\r\n\r\n\t\t\tif ( texture.type === FloatType && extensions.has( 'OES_texture_float_linear' ) === false ) return; // verify extension for WebGL 1 and WebGL 2\r\n\t\t\tif ( isWebGL2 === false && ( texture.type === HalfFloatType && extensions.has( 'OES_texture_half_float_linear' ) === false ) ) return; // verify extension for WebGL 1 only\r\n\r\n\t\t\tif ( texture.anisotropy > 1 || properties.get( texture ).__currentAnisotropy ) {\r\n\r\n\t\t\t\t_gl.texParameterf( textureType, extension.TEXTURE_MAX_ANISOTROPY_EXT, Math.min( texture.anisotropy, capabilities.getMaxAnisotropy() ) );\r\n\t\t\t\tproperties.get( texture ).__currentAnisotropy = texture.anisotropy;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction initTexture( textureProperties, texture ) {\r\n\r\n\t\tif ( textureProperties.__webglInit === undefined ) {\r\n\r\n\t\t\ttextureProperties.__webglInit = true;\r\n\r\n\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\r\n\r\n\t\t\ttextureProperties.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\tinfo.memory.textures ++;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction uploadTexture( textureProperties, texture, slot ) {\r\n\r\n\t\tlet textureType = _gl.TEXTURE_2D;\r\n\r\n\t\tif ( texture.isDataTexture2DArray ) textureType = _gl.TEXTURE_2D_ARRAY;\r\n\t\tif ( texture.isDataTexture3D ) textureType = _gl.TEXTURE_3D;\r\n\r\n\t\tinitTexture( textureProperties, texture );\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( textureType, textureProperties.__webglTexture );\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, _gl.NONE );\r\n\r\n\t\tconst needsPowerOfTwo = textureNeedsPowerOfTwo( texture ) && isPowerOfTwo( texture.image ) === false;\r\n\t\tconst image = resizeImage( texture.image, needsPowerOfTwo, false, maxTextureSize );\r\n\r\n\t\tconst supportsMips = isPowerOfTwo( image ) || isWebGL2,\r\n\t\t\tglFormat = utils.convert( texture.format );\r\n\r\n\t\tlet glType = utils.convert( texture.type ),\r\n\t\t\tglInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\r\n\r\n\t\tsetTextureParameters( textureType, texture, supportsMips );\r\n\r\n\t\tlet mipmap;\r\n\t\tconst mipmaps = texture.mipmaps;\r\n\r\n\t\tif ( texture.isDepthTexture ) {\r\n\r\n\t\t\t// populate depth texture with dummy data\r\n\r\n\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT;\r\n\r\n\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\tif ( texture.type === FloatType ) {\r\n\r\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT32F;\r\n\r\n\t\t\t\t} else if ( texture.type === UnsignedIntType ) {\r\n\r\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT24;\r\n\r\n\t\t\t\t} else if ( texture.type === UnsignedInt248Type ) {\r\n\r\n\t\t\t\t\tglInternalFormat = _gl.DEPTH24_STENCIL8;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT16; // WebGL2 requires sized internalformat for glTexImage2D\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( texture.type === FloatType ) {\r\n\r\n\t\t\t\t\tconsole.error( 'WebGLRenderer: Floating point depth texture requires WebGL2.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// validation checks for WebGL 1\r\n\r\n\t\t\tif ( texture.format === DepthFormat && glInternalFormat === _gl.DEPTH_COMPONENT ) {\r\n\r\n\t\t\t\t// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\r\n\t\t\t\t// DEPTH_COMPONENT and type is not UNSIGNED_SHORT or UNSIGNED_INT\r\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\r\n\t\t\t\tif ( texture.type !== UnsignedShortType && texture.type !== UnsignedIntType ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.' );\r\n\r\n\t\t\t\t\ttexture.type = UnsignedShortType;\r\n\t\t\t\t\tglType = utils.convert( texture.type );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( texture.format === DepthStencilFormat && glInternalFormat === _gl.DEPTH_COMPONENT ) {\r\n\r\n\t\t\t\t// Depth stencil textures need the DEPTH_STENCIL internal format\r\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\r\n\t\t\t\tglInternalFormat = _gl.DEPTH_STENCIL;\r\n\r\n\t\t\t\t// The error INVALID_OPERATION is generated by texImage2D if format and internalformat are\r\n\t\t\t\t// DEPTH_STENCIL and type is not UNSIGNED_INT_24_8_WEBGL.\r\n\t\t\t\t// (https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/)\r\n\t\t\t\tif ( texture.type !== UnsignedInt248Type ) {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.' );\r\n\r\n\t\t\t\t\ttexture.type = UnsignedInt248Type;\r\n\t\t\t\t\tglType = utils.convert( texture.type );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, image.width, image.height, 0, glFormat, glType, null );\r\n\r\n\t\t} else if ( texture.isDataTexture ) {\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && supportsMips ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, image.width, image.height, 0, glFormat, glType, image.data );\r\n\t\t\t\ttextureProperties.__maxMipLevel = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( texture.isCompressedTexture ) {\r\n\r\n\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tmipmap = mipmaps[ i ];\r\n\r\n\t\t\t\tif ( texture.format !== RGBAFormat && texture.format !== RGBFormat ) {\r\n\r\n\t\t\t\t\tif ( glFormat !== null ) {\r\n\r\n\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()' );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\r\n\r\n\t\t} else if ( texture.isDataTexture2DArray ) {\r\n\r\n\t\t\tstate.texImage3D( _gl.TEXTURE_2D_ARRAY, 0, glInternalFormat, image.width, image.height, image.depth, 0, glFormat, glType, image.data );\r\n\t\t\ttextureProperties.__maxMipLevel = 0;\r\n\r\n\t\t} else if ( texture.isDataTexture3D ) {\r\n\r\n\t\t\tstate.texImage3D( _gl.TEXTURE_3D, 0, glInternalFormat, image.width, image.height, image.depth, 0, glFormat, glType, image.data );\r\n\t\t\ttextureProperties.__maxMipLevel = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// regular Texture (image, video, canvas)\r\n\r\n\t\t\t// use manually created mipmaps if available\r\n\t\t\t// if there are no manual mipmaps\r\n\t\t\t// set 0 level mipmap and then use GL to generate other mipmap levels\r\n\r\n\t\t\tif ( mipmaps.length > 0 && supportsMips ) {\r\n\r\n\t\t\t\tfor ( let i = 0, il = mipmaps.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\tmipmap = mipmaps[ i ];\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, i, glInternalFormat, glFormat, glType, mipmap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.generateMipmaps = false;\r\n\t\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.texImage2D( _gl.TEXTURE_2D, 0, glInternalFormat, glFormat, glType, image );\r\n\t\t\t\ttextureProperties.__maxMipLevel = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\r\n\r\n\t\t\tgenerateMipmap( textureType, texture, image.width, image.height );\r\n\r\n\t\t}\r\n\r\n\t\ttextureProperties.__version = texture.version;\r\n\r\n\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\r\n\t}\r\n\r\n\tfunction uploadCubeTexture( textureProperties, texture, slot ) {\r\n\r\n\t\tif ( texture.image.length !== 6 ) return;\r\n\r\n\t\tinitTexture( textureProperties, texture );\r\n\r\n\t\tstate.activeTexture( _gl.TEXTURE0 + slot );\r\n\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, texture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, texture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, texture.unpackAlignment );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_COLORSPACE_CONVERSION_WEBGL, _gl.NONE );\r\n\r\n\t\tconst isCompressed = ( texture && ( texture.isCompressedTexture || texture.image[ 0 ].isCompressedTexture ) );\r\n\t\tconst isDataTexture = ( texture.image[ 0 ] && texture.image[ 0 ].isDataTexture );\r\n\r\n\t\tconst cubeImage = [];\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tif ( ! isCompressed && ! isDataTexture ) {\r\n\r\n\t\t\t\tcubeImage[ i ] = resizeImage( texture.image[ i ], false, true, maxCubemapSize );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcubeImage[ i ] = isDataTexture ? texture.image[ i ].image : texture.image[ i ];\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst image = cubeImage[ 0 ],\r\n\t\t\tsupportsMips = isPowerOfTwo( image ) || isWebGL2,\r\n\t\t\tglFormat = utils.convert( texture.format ),\r\n\t\t\tglType = utils.convert( texture.type ),\r\n\t\t\tglInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\r\n\r\n\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, supportsMips );\r\n\r\n\t\tlet mipmaps;\r\n\r\n\t\tif ( isCompressed ) {\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\tmipmaps = cubeImage[ i ].mipmaps;\r\n\r\n\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\r\n\r\n\t\t\t\t\tconst mipmap = mipmaps[ j ];\r\n\r\n\t\t\t\t\tif ( texture.format !== RGBAFormat && texture.format !== RGBFormat ) {\r\n\r\n\t\t\t\t\t\tif ( glFormat !== null ) {\r\n\r\n\t\t\t\t\t\t\tstate.compressedTexImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glInternalFormat, mipmap.width, mipmap.height, 0, mipmap.data );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()' );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j, glInternalFormat, mipmap.width, mipmap.height, 0, glFormat, glType, mipmap.data );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttextureProperties.__maxMipLevel = mipmaps.length - 1;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tmipmaps = texture.mipmaps;\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\tif ( isDataTexture ) {\r\n\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glInternalFormat, cubeImage[ i ].width, cubeImage[ i ].height, 0, glFormat, glType, cubeImage[ i ].data );\r\n\r\n\t\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\r\n\r\n\t\t\t\t\t\tconst mipmap = mipmaps[ j ];\r\n\t\t\t\t\t\tconst mipmapImage = mipmap.image[ i ].image;\r\n\r\n\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j + 1, glInternalFormat, mipmapImage.width, mipmapImage.height, 0, glFormat, glType, mipmapImage.data );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, glInternalFormat, glFormat, glType, cubeImage[ i ] );\r\n\r\n\t\t\t\t\tfor ( let j = 0; j < mipmaps.length; j ++ ) {\r\n\r\n\t\t\t\t\t\tconst mipmap = mipmaps[ j ];\r\n\r\n\t\t\t\t\t\tstate.texImage2D( _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, j + 1, glInternalFormat, glFormat, glType, mipmap.image[ i ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttextureProperties.__maxMipLevel = mipmaps.length;\r\n\r\n\t\t}\r\n\r\n\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\r\n\r\n\t\t\t// We assume images for cube map have the same size.\r\n\t\t\tgenerateMipmap( _gl.TEXTURE_CUBE_MAP, texture, image.width, image.height );\r\n\r\n\t\t}\r\n\r\n\t\ttextureProperties.__version = texture.version;\r\n\r\n\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\r\n\t}\r\n\r\n\t// Render targets\r\n\r\n\t// Setup storage for target texture and bind it to correct framebuffer\r\n\tfunction setupFrameBufferTexture( framebuffer, renderTarget, texture, attachment, textureTarget ) {\r\n\r\n\t\tconst glFormat = utils.convert( texture.format );\r\n\t\tconst glType = utils.convert( texture.type );\r\n\t\tconst glInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\r\n\r\n\t\tif ( textureTarget === _gl.TEXTURE_3D || textureTarget === _gl.TEXTURE_2D_ARRAY ) {\r\n\r\n\t\t\tstate.texImage3D( textureTarget, 0, glInternalFormat, renderTarget.width, renderTarget.height, renderTarget.depth, 0, glFormat, glType, null );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tstate.texImage2D( textureTarget, 0, glInternalFormat, renderTarget.width, renderTarget.height, 0, glFormat, glType, null );\r\n\r\n\t\t}\r\n\r\n\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, attachment, textureTarget, properties.get( texture ).__webglTexture, 0 );\r\n\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, null );\r\n\r\n\t}\r\n\r\n\t// Setup storage for internal depth/stencil buffers and bind to correct framebuffer\r\n\tfunction setupRenderBufferStorage( renderbuffer, renderTarget, isMultisample ) {\r\n\r\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\tif ( renderTarget.depthBuffer && ! renderTarget.stencilBuffer ) {\r\n\r\n\t\t\tlet glInternalFormat = _gl.DEPTH_COMPONENT16;\r\n\r\n\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\tconst depthTexture = renderTarget.depthTexture;\r\n\r\n\t\t\t\tif ( depthTexture && depthTexture.isDepthTexture ) {\r\n\r\n\t\t\t\t\tif ( depthTexture.type === FloatType ) {\r\n\r\n\t\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT32F;\r\n\r\n\t\t\t\t\t} else if ( depthTexture.type === UnsignedIntType ) {\r\n\r\n\t\t\t\t\t\tglInternalFormat = _gl.DEPTH_COMPONENT24;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\r\n\r\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, glInternalFormat, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t} else if ( renderTarget.depthBuffer && renderTarget.stencilBuffer ) {\r\n\r\n\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\r\n\r\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, _gl.DEPTH24_STENCIL8, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, _gl.DEPTH_STENCIL, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.RENDERBUFFER, renderbuffer );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// Use the first texture for MRT so far\r\n\t\t\tconst texture = renderTarget.isWebGLMultipleRenderTargets === true ? renderTarget.texture[ 0 ] : renderTarget.texture;\r\n\r\n\t\t\tconst glFormat = utils.convert( texture.format );\r\n\t\t\tconst glType = utils.convert( texture.type );\r\n\t\t\tconst glInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\r\n\r\n\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\r\n\r\n\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.renderbufferStorage( _gl.RENDERBUFFER, glInternalFormat, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\r\n\r\n\t}\r\n\r\n\t// Setup resources for a Depth Texture for a FBO (needs an extension)\r\n\tfunction setupDepthTexture( framebuffer, renderTarget ) {\r\n\r\n\t\tconst isCube = ( renderTarget && renderTarget.isWebGLCubeRenderTarget );\r\n\t\tif ( isCube ) throw new Error( 'Depth Texture with cube render targets is not supported' );\r\n\r\n\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\r\n\t\tif ( ! ( renderTarget.depthTexture && renderTarget.depthTexture.isDepthTexture ) ) {\r\n\r\n\t\t\tthrow new Error( 'renderTarget.depthTexture must be an instance of THREE.DepthTexture' );\r\n\r\n\t\t}\r\n\r\n\t\t// upload an empty depth texture with framebuffer size\r\n\t\tif ( ! properties.get( renderTarget.depthTexture ).__webglTexture ||\r\n\t\t\t\trenderTarget.depthTexture.image.width !== renderTarget.width ||\r\n\t\t\t\trenderTarget.depthTexture.image.height !== renderTarget.height ) {\r\n\r\n\t\t\trenderTarget.depthTexture.image.width = renderTarget.width;\r\n\t\t\trenderTarget.depthTexture.image.height = renderTarget.height;\r\n\t\t\trenderTarget.depthTexture.needsUpdate = true;\r\n\r\n\t\t}\r\n\r\n\t\tsetTexture2D( renderTarget.depthTexture, 0 );\r\n\r\n\t\tconst webglDepthTexture = properties.get( renderTarget.depthTexture ).__webglTexture;\r\n\r\n\t\tif ( renderTarget.depthTexture.format === DepthFormat ) {\r\n\r\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.DEPTH_ATTACHMENT, _gl.TEXTURE_2D, webglDepthTexture, 0 );\r\n\r\n\t\t} else if ( renderTarget.depthTexture.format === DepthStencilFormat ) {\r\n\r\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.DEPTH_STENCIL_ATTACHMENT, _gl.TEXTURE_2D, webglDepthTexture, 0 );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthrow new Error( 'Unknown depthTexture format' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Setup GL resources for a non-texture depth buffer\r\n\tfunction setupDepthRenderbuffer( renderTarget ) {\r\n\r\n\t\tconst renderTargetProperties = properties.get( renderTarget );\r\n\r\n\t\tconst isCube = ( renderTarget.isWebGLCubeRenderTarget === true );\r\n\r\n\t\tif ( renderTarget.depthTexture ) {\r\n\r\n\t\t\tif ( isCube ) throw new Error( 'target.depthTexture not supported in Cube render targets' );\r\n\r\n\t\t\tsetupDepthTexture( renderTargetProperties.__webglFramebuffer, renderTarget );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( isCube ) {\r\n\r\n\t\t\t\trenderTargetProperties.__webglDepthbuffer = [];\r\n\r\n\t\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglFramebuffer[ i ] );\r\n\t\t\t\t\trenderTargetProperties.__webglDepthbuffer[ i ] = _gl.createRenderbuffer();\r\n\t\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthbuffer[ i ], renderTarget, false );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglFramebuffer );\r\n\t\t\t\trenderTargetProperties.__webglDepthbuffer = _gl.createRenderbuffer();\r\n\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthbuffer, renderTarget, false );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, null );\r\n\r\n\t}\r\n\r\n\t// Set up GL resources for the render target\r\n\tfunction setupRenderTarget( renderTarget ) {\r\n\r\n\t\tconst texture = renderTarget.texture;\r\n\r\n\t\tconst renderTargetProperties = properties.get( renderTarget );\r\n\t\tconst textureProperties = properties.get( texture );\r\n\r\n\t\trenderTarget.addEventListener( 'dispose', onRenderTargetDispose );\r\n\r\n\t\tif ( renderTarget.isWebGLMultipleRenderTargets !== true ) {\r\n\r\n\t\t\ttextureProperties.__webglTexture = _gl.createTexture();\r\n\t\t\ttextureProperties.__version = texture.version;\r\n\t\t\tinfo.memory.textures ++;\r\n\r\n\t\t}\r\n\r\n\t\tconst isCube = ( renderTarget.isWebGLCubeRenderTarget === true );\r\n\t\tconst isMultipleRenderTargets = ( renderTarget.isWebGLMultipleRenderTargets === true );\r\n\t\tconst isMultisample = ( renderTarget.isWebGLMultisampleRenderTarget === true );\r\n\t\tconst isRenderTarget3D = texture.isDataTexture3D || texture.isDataTexture2DArray;\r\n\t\tconst supportsMips = isPowerOfTwo( renderTarget ) || isWebGL2;\r\n\r\n\t\t// Handles WebGL2 RGBFormat fallback - #18858\r\n\r\n\t\tif ( isWebGL2 && texture.format === RGBFormat && ( texture.type === FloatType || texture.type === HalfFloatType ) ) {\r\n\r\n\t\t\ttexture.format = RGBAFormat;\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.' );\r\n\r\n\t\t}\r\n\r\n\t\t// Setup framebuffer\r\n\r\n\t\tif ( isCube ) {\r\n\r\n\t\t\trenderTargetProperties.__webglFramebuffer = [];\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\trenderTargetProperties.__webglFramebuffer[ i ] = _gl.createFramebuffer();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderTargetProperties.__webglFramebuffer = _gl.createFramebuffer();\r\n\r\n\t\t\tif ( isMultipleRenderTargets ) {\r\n\r\n\t\t\t\tif ( capabilities.drawBuffers ) {\r\n\r\n\t\t\t\t\tconst textures = renderTarget.texture;\r\n\r\n\t\t\t\t\tfor ( let i = 0, il = textures.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst attachmentProperties = properties.get( textures[ i ] );\r\n\r\n\t\t\t\t\t\tif ( attachmentProperties.__webglTexture === undefined ) {\r\n\r\n\t\t\t\t\t\t\tattachmentProperties.__webglTexture = _gl.createTexture();\r\n\r\n\t\t\t\t\t\t\tinfo.memory.textures ++;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( isMultisample ) {\r\n\r\n\t\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\t\trenderTargetProperties.__webglMultisampledFramebuffer = _gl.createFramebuffer();\r\n\t\t\t\t\trenderTargetProperties.__webglColorRenderbuffer = _gl.createRenderbuffer();\r\n\r\n\t\t\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, renderTargetProperties.__webglColorRenderbuffer );\r\n\r\n\t\t\t\t\tconst glFormat = utils.convert( texture.format );\r\n\t\t\t\t\tconst glType = utils.convert( texture.type );\r\n\t\t\t\t\tconst glInternalFormat = getInternalFormat( texture.internalFormat, glFormat, glType );\r\n\t\t\t\t\tconst samples = getRenderTargetSamples( renderTarget );\r\n\t\t\t\t\t_gl.renderbufferStorageMultisample( _gl.RENDERBUFFER, samples, glInternalFormat, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer );\r\n\t\t\t\t\t_gl.framebufferRenderbuffer( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, _gl.RENDERBUFFER, renderTargetProperties.__webglColorRenderbuffer );\r\n\t\t\t\t\t_gl.bindRenderbuffer( _gl.RENDERBUFFER, null );\r\n\r\n\t\t\t\t\tif ( renderTarget.depthBuffer ) {\r\n\r\n\t\t\t\t\t\trenderTargetProperties.__webglDepthRenderbuffer = _gl.createRenderbuffer();\r\n\t\t\t\t\t\tsetupRenderBufferStorage( renderTargetProperties.__webglDepthRenderbuffer, renderTarget, true );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, null );\r\n\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Setup color buffer\r\n\r\n\t\tif ( isCube ) {\r\n\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, textureProperties.__webglTexture );\r\n\t\t\tsetTextureParameters( _gl.TEXTURE_CUBE_MAP, texture, supportsMips );\r\n\r\n\t\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\t\tsetupFrameBufferTexture( renderTargetProperties.__webglFramebuffer[ i ], renderTarget, texture, _gl.COLOR_ATTACHMENT0, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + i );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\r\n\r\n\t\t\t\tgenerateMipmap( _gl.TEXTURE_CUBE_MAP, texture, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_CUBE_MAP, null );\r\n\r\n\t\t} else if ( isMultipleRenderTargets ) {\r\n\r\n\t\t\tconst textures = renderTarget.texture;\r\n\r\n\t\t\tfor ( let i = 0, il = textures.length; i < il; i ++ ) {\r\n\r\n\t\t\t\tconst attachment = textures[ i ];\r\n\t\t\t\tconst attachmentProperties = properties.get( attachment );\r\n\r\n\t\t\t\tstate.bindTexture( _gl.TEXTURE_2D, attachmentProperties.__webglTexture );\r\n\t\t\t\tsetTextureParameters( _gl.TEXTURE_2D, attachment, supportsMips );\r\n\t\t\t\tsetupFrameBufferTexture( renderTargetProperties.__webglFramebuffer, renderTarget, attachment, _gl.COLOR_ATTACHMENT0 + i, _gl.TEXTURE_2D );\r\n\r\n\t\t\t\tif ( textureNeedsGenerateMipmaps( attachment, supportsMips ) ) {\r\n\r\n\t\t\t\t\tgenerateMipmap( _gl.TEXTURE_2D, attachment, renderTarget.width, renderTarget.height );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tstate.bindTexture( _gl.TEXTURE_2D, null );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tlet glTextureType = _gl.TEXTURE_2D;\r\n\r\n\t\t\tif ( isRenderTarget3D ) {\r\n\r\n\t\t\t\t// Render targets containing layers, i.e: Texture 3D and 2d arrays\r\n\r\n\t\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\t\tconst isTexture3D = texture.isDataTexture3D;\r\n\t\t\t\t\tglTextureType = isTexture3D ? _gl.TEXTURE_3D : _gl.TEXTURE_2D_ARRAY;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.warn( 'THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tstate.bindTexture( glTextureType, textureProperties.__webglTexture );\r\n\t\t\tsetTextureParameters( glTextureType, texture, supportsMips );\r\n\t\t\tsetupFrameBufferTexture( renderTargetProperties.__webglFramebuffer, renderTarget, texture, _gl.COLOR_ATTACHMENT0, glTextureType );\r\n\r\n\t\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\r\n\r\n\t\t\t\tgenerateMipmap( glTextureType, texture, renderTarget.width, renderTarget.height, renderTarget.depth );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tstate.bindTexture( glTextureType, null );\r\n\r\n\t\t}\r\n\r\n\t\t// Setup depth and stencil buffers\r\n\r\n\t\tif ( renderTarget.depthBuffer ) {\r\n\r\n\t\t\tsetupDepthRenderbuffer( renderTarget );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction updateRenderTargetMipmap( renderTarget ) {\r\n\r\n\t\tconst supportsMips = isPowerOfTwo( renderTarget ) || isWebGL2;\r\n\r\n\t\tconst textures = renderTarget.isWebGLMultipleRenderTargets === true ? renderTarget.texture : [ renderTarget.texture ];\r\n\r\n\t\tfor ( let i = 0, il = textures.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst texture = textures[ i ];\r\n\r\n\t\t\tif ( textureNeedsGenerateMipmaps( texture, supportsMips ) ) {\r\n\r\n\t\t\t\tconst target = renderTarget.isWebGLCubeRenderTarget ? _gl.TEXTURE_CUBE_MAP : _gl.TEXTURE_2D;\r\n\t\t\t\tconst webglTexture = properties.get( texture ).__webglTexture;\r\n\r\n\t\t\t\tstate.bindTexture( target, webglTexture );\r\n\t\t\t\tgenerateMipmap( target, texture, renderTarget.width, renderTarget.height );\r\n\t\t\t\tstate.bindTexture( target, null );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction updateMultisampleRenderTarget( renderTarget ) {\r\n\r\n\t\tif ( renderTarget.isWebGLMultisampleRenderTarget ) {\r\n\r\n\t\t\tif ( isWebGL2 ) {\r\n\r\n\t\t\t\tconst width = renderTarget.width;\r\n\t\t\t\tconst height = renderTarget.height;\r\n\t\t\t\tlet mask = _gl.COLOR_BUFFER_BIT;\r\n\r\n\t\t\t\tif ( renderTarget.depthBuffer ) mask |= _gl.DEPTH_BUFFER_BIT;\r\n\t\t\t\tif ( renderTarget.stencilBuffer ) mask |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n\t\t\t\tconst renderTargetProperties = properties.get( renderTarget );\r\n\r\n\t\t\t\tstate.bindFramebuffer( _gl.READ_FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer );\r\n\t\t\t\tstate.bindFramebuffer( _gl.DRAW_FRAMEBUFFER, renderTargetProperties.__webglFramebuffer );\r\n\r\n\t\t\t\t_gl.blitFramebuffer( 0, 0, width, height, 0, 0, width, height, mask, _gl.NEAREST );\r\n\r\n\t\t\t\tstate.bindFramebuffer( _gl.READ_FRAMEBUFFER, null );\r\n\t\t\t\tstate.bindFramebuffer( _gl.DRAW_FRAMEBUFFER, renderTargetProperties.__webglMultisampledFramebuffer );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction getRenderTargetSamples( renderTarget ) {\r\n\r\n\t\treturn ( isWebGL2 && renderTarget.isWebGLMultisampleRenderTarget ) ?\r\n\t\t\tMath.min( maxSamples, renderTarget.samples ) : 0;\r\n\r\n\t}\r\n\r\n\tfunction updateVideoTexture( texture ) {\r\n\r\n\t\tconst frame = info.render.frame;\r\n\r\n\t\t// Check the last frame we updated the VideoTexture\r\n\r\n\t\tif ( _videoTextures.get( texture ) !== frame ) {\r\n\r\n\t\t\t_videoTextures.set( texture, frame );\r\n\t\t\ttexture.update();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// backwards compatibility\r\n\r\n\tlet warnedTexture2D = false;\r\n\tlet warnedTextureCube = false;\r\n\r\n\tfunction safeSetTexture2D( texture, slot ) {\r\n\r\n\t\tif ( texture && texture.isWebGLRenderTarget ) {\r\n\r\n\t\t\tif ( warnedTexture2D === false ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLTextures.safeSetTexture2D: don\\'t use render targets as textures. Use their .texture property instead.' );\r\n\t\t\t\twarnedTexture2D = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture = texture.texture;\r\n\r\n\t\t}\r\n\r\n\t\tsetTexture2D( texture, slot );\r\n\r\n\t}\r\n\r\n\tfunction safeSetTextureCube( texture, slot ) {\r\n\r\n\t\tif ( texture && texture.isWebGLCubeRenderTarget ) {\r\n\r\n\t\t\tif ( warnedTextureCube === false ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLTextures.safeSetTextureCube: don\\'t use cube render targets as textures. Use their .texture property instead.' );\r\n\t\t\t\twarnedTextureCube = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\ttexture = texture.texture;\r\n\r\n\t\t}\r\n\r\n\r\n\t\tsetTextureCube( texture, slot );\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tthis.allocateTextureUnit = allocateTextureUnit;\r\n\tthis.resetTextureUnits = resetTextureUnits;\r\n\r\n\tthis.setTexture2D = setTexture2D;\r\n\tthis.setTexture2DArray = setTexture2DArray;\r\n\tthis.setTexture3D = setTexture3D;\r\n\tthis.setTextureCube = setTextureCube;\r\n\tthis.setupRenderTarget = setupRenderTarget;\r\n\tthis.updateRenderTargetMipmap = updateRenderTargetMipmap;\r\n\tthis.updateMultisampleRenderTarget = updateMultisampleRenderTarget;\r\n\r\n\tthis.safeSetTexture2D = safeSetTexture2D;\r\n\tthis.safeSetTextureCube = safeSetTextureCube;\r\n\r\n}\r\n\r\nexport { WebGLTextures };\r\n", "import { RGBA_ASTC_4x4_Format, RGBA_ASTC_5x4_Format, RGBA_ASTC_5x5_Format, RGBA_ASTC_6x5_Format, RGBA_ASTC_6x6_Format, RGBA_ASTC_8x5_Format, RGBA_ASTC_8x6_Format, RGBA_ASTC_8x8_Format, RGBA_ASTC_10x5_Format, RGBA_ASTC_10x6_Format, RGBA_ASTC_10x8_Format, RGBA_ASTC_10x10_Format, RGBA_ASTC_12x10_Format, RGBA_ASTC_12x12_Format, RGB_ETC1_Format, RGB_ETC2_Format, RGBA_ETC2_EAC_Format, RGBA_PVRTC_2BPPV1_Format, RGBA_PVRTC_4BPPV1_Format, RGB_PVRTC_2BPPV1_Format, RGB_PVRTC_4BPPV1_Format, RGBA_S3TC_DXT5_Format, RGBA_S3TC_DXT3_Format, RGBA_S3TC_DXT1_Format, RGB_S3TC_DXT1_Format, DepthFormat, DepthStencilFormat, LuminanceAlphaFormat, LuminanceFormat, RedFormat, RGBAFormat, RGBFormat, AlphaFormat, RedIntegerFormat, RGFormat, RGIntegerFormat, RGBIntegerFormat, RGBAIntegerFormat, HalfFloatType, FloatType, UnsignedIntType, IntType, UnsignedShortType, ShortType, ByteType, UnsignedInt248Type, UnsignedShort565Type, UnsignedShort5551Type, UnsignedShort4444Type, UnsignedByteType, SRGB8_ALPHA8_ASTC_4x4_Format, SRGB8_ALPHA8_ASTC_5x4_Format, SRGB8_ALPHA8_ASTC_5x5_Format, SRGB8_ALPHA8_ASTC_6x5_Format, SRGB8_ALPHA8_ASTC_6x6_Format, SRGB8_ALPHA8_ASTC_8x5_Format, SRGB8_ALPHA8_ASTC_8x6_Format, SRGB8_ALPHA8_ASTC_8x8_Format, SRGB8_ALPHA8_ASTC_10x5_Format, SRGB8_ALPHA8_ASTC_10x6_Format, SRGB8_ALPHA8_ASTC_10x8_Format, SRGB8_ALPHA8_ASTC_10x10_Format, SRGB8_ALPHA8_ASTC_12x10_Format, SRGB8_ALPHA8_ASTC_12x12_Format, RGBA_BPTC_Format } from '../../constants.js';\r\n\r\nfunction WebGLUtils( gl, extensions, capabilities ) {\r\n\r\n\tconst isWebGL2 = capabilities.isWebGL2;\r\n\r\n\tfunction convert( p ) {\r\n\r\n\t\tlet extension;\r\n\r\n\t\tif ( p === UnsignedByteType ) return gl.UNSIGNED_BYTE;\r\n\t\tif ( p === UnsignedShort4444Type ) return gl.UNSIGNED_SHORT_4_4_4_4;\r\n\t\tif ( p === UnsignedShort5551Type ) return gl.UNSIGNED_SHORT_5_5_5_1;\r\n\t\tif ( p === UnsignedShort565Type ) return gl.UNSIGNED_SHORT_5_6_5;\r\n\r\n\t\tif ( p === ByteType ) return gl.BYTE;\r\n\t\tif ( p === ShortType ) return gl.SHORT;\r\n\t\tif ( p === UnsignedShortType ) return gl.UNSIGNED_SHORT;\r\n\t\tif ( p === IntType ) return gl.INT;\r\n\t\tif ( p === UnsignedIntType ) return gl.UNSIGNED_INT;\r\n\t\tif ( p === FloatType ) return gl.FLOAT;\r\n\r\n\t\tif ( p === HalfFloatType ) {\r\n\r\n\t\t\tif ( isWebGL2 ) return gl.HALF_FLOAT;\r\n\r\n\t\t\textension = extensions.get( 'OES_texture_half_float' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\treturn extension.HALF_FLOAT_OES;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === AlphaFormat ) return gl.ALPHA;\r\n\t\tif ( p === RGBFormat ) return gl.RGB;\r\n\t\tif ( p === RGBAFormat ) return gl.RGBA;\r\n\t\tif ( p === LuminanceFormat ) return gl.LUMINANCE;\r\n\t\tif ( p === LuminanceAlphaFormat ) return gl.LUMINANCE_ALPHA;\r\n\t\tif ( p === DepthFormat ) return gl.DEPTH_COMPONENT;\r\n\t\tif ( p === DepthStencilFormat ) return gl.DEPTH_STENCIL;\r\n\t\tif ( p === RedFormat ) return gl.RED;\r\n\r\n\t\t// WebGL2 formats.\r\n\r\n\t\tif ( p === RedIntegerFormat ) return gl.RED_INTEGER;\r\n\t\tif ( p === RGFormat ) return gl.RG;\r\n\t\tif ( p === RGIntegerFormat ) return gl.RG_INTEGER;\r\n\t\tif ( p === RGBIntegerFormat ) return gl.RGB_INTEGER;\r\n\t\tif ( p === RGBAIntegerFormat ) return gl.RGBA_INTEGER;\r\n\r\n\t\tif ( p === RGB_S3TC_DXT1_Format || p === RGBA_S3TC_DXT1_Format ||\r\n\t\t\tp === RGBA_S3TC_DXT3_Format || p === RGBA_S3TC_DXT5_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_s3tc' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\tif ( p === RGB_S3TC_DXT1_Format ) return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n\t\t\t\tif ( p === RGBA_S3TC_DXT1_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n\t\t\t\tif ( p === RGBA_S3TC_DXT3_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n\t\t\t\tif ( p === RGBA_S3TC_DXT5_Format ) return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === RGB_PVRTC_4BPPV1_Format || p === RGB_PVRTC_2BPPV1_Format ||\r\n\t\t\tp === RGBA_PVRTC_4BPPV1_Format || p === RGBA_PVRTC_2BPPV1_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_pvrtc' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\tif ( p === RGB_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n\t\t\t\tif ( p === RGB_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n\t\t\t\tif ( p === RGBA_PVRTC_4BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n\t\t\t\tif ( p === RGBA_PVRTC_2BPPV1_Format ) return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === RGB_ETC1_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_etc1' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\treturn extension.COMPRESSED_RGB_ETC1_WEBGL;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === RGB_ETC2_Format || p === RGBA_ETC2_EAC_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_etc' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\tif ( p === RGB_ETC2_Format ) return extension.COMPRESSED_RGB8_ETC2;\r\n\t\t\t\tif ( p === RGBA_ETC2_EAC_Format ) return extension.COMPRESSED_RGBA8_ETC2_EAC;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === RGBA_ASTC_4x4_Format || p === RGBA_ASTC_5x4_Format || p === RGBA_ASTC_5x5_Format ||\r\n\t\t\tp === RGBA_ASTC_6x5_Format || p === RGBA_ASTC_6x6_Format || p === RGBA_ASTC_8x5_Format ||\r\n\t\t\tp === RGBA_ASTC_8x6_Format || p === RGBA_ASTC_8x8_Format || p === RGBA_ASTC_10x5_Format ||\r\n\t\t\tp === RGBA_ASTC_10x6_Format || p === RGBA_ASTC_10x8_Format || p === RGBA_ASTC_10x10_Format ||\r\n\t\t\tp === RGBA_ASTC_12x10_Format || p === RGBA_ASTC_12x12_Format ||\r\n\t\t\tp === SRGB8_ALPHA8_ASTC_4x4_Format || p === SRGB8_ALPHA8_ASTC_5x4_Format || p === SRGB8_ALPHA8_ASTC_5x5_Format ||\r\n\t\t\tp === SRGB8_ALPHA8_ASTC_6x5_Format || p === SRGB8_ALPHA8_ASTC_6x6_Format || p === SRGB8_ALPHA8_ASTC_8x5_Format ||\r\n\t\t\tp === SRGB8_ALPHA8_ASTC_8x6_Format || p === SRGB8_ALPHA8_ASTC_8x8_Format || p === SRGB8_ALPHA8_ASTC_10x5_Format ||\r\n\t\t\tp === SRGB8_ALPHA8_ASTC_10x6_Format || p === SRGB8_ALPHA8_ASTC_10x8_Format || p === SRGB8_ALPHA8_ASTC_10x10_Format ||\r\n\t\t\tp === SRGB8_ALPHA8_ASTC_12x10_Format || p === SRGB8_ALPHA8_ASTC_12x12_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_compressed_texture_astc' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\t// TODO Complete?\r\n\r\n\t\t\t\treturn p;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === RGBA_BPTC_Format ) {\r\n\r\n\t\t\textension = extensions.get( 'EXT_texture_compression_bptc' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\t// TODO Complete?\r\n\r\n\t\t\t\treturn p;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( p === UnsignedInt248Type ) {\r\n\r\n\t\t\tif ( isWebGL2 ) return gl.UNSIGNED_INT_24_8;\r\n\r\n\t\t\textension = extensions.get( 'WEBGL_depth_texture' );\r\n\r\n\t\t\tif ( extension !== null ) {\r\n\r\n\t\t\t\treturn extension.UNSIGNED_INT_24_8_WEBGL;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn null;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn { convert: convert };\r\n\r\n}\r\n\r\n\r\nexport { WebGLUtils };\r\n", "import { PerspectiveCamera } from './PerspectiveCamera.js';\r\n\r\nclass ArrayCamera extends PerspectiveCamera {\r\n\r\n\tconstructor( array = [] ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.cameras = array;\r\n\r\n\t}\r\n\r\n}\r\n\r\nArrayCamera.prototype.isArrayCamera = true;\r\n\r\n\r\nexport { ArrayCamera };\r\n", "import { Object3D } from '../core/Object3D.js';\r\n\r\nclass Group extends Object3D {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Group';\r\n\r\n\t}\r\n\r\n}\r\n\r\nGroup.prototype.isGroup = true;\r\n\r\nexport { Group };\r\n", "import { Vector3 } from '../../math/Vector3.js';\r\nimport { Group } from '../../objects/Group.js';\r\n\r\nconst _moveEvent = { type: 'move' };\r\n\r\nclass WebXRController {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis._targetRay = null;\r\n\t\tthis._grip = null;\r\n\t\tthis._hand = null;\r\n\r\n\t}\r\n\r\n\tgetHandSpace() {\r\n\r\n\t\tif ( this._hand === null ) {\r\n\r\n\t\t\tthis._hand = new Group();\r\n\t\t\tthis._hand.matrixAutoUpdate = false;\r\n\t\t\tthis._hand.visible = false;\r\n\r\n\t\t\tthis._hand.joints = {};\r\n\t\t\tthis._hand.inputState = { pinching: false };\r\n\r\n\t\t}\r\n\r\n\t\treturn this._hand;\r\n\r\n\t}\r\n\r\n\tgetTargetRaySpace() {\r\n\r\n\t\tif ( this._targetRay === null ) {\r\n\r\n\t\t\tthis._targetRay = new Group();\r\n\t\t\tthis._targetRay.matrixAutoUpdate = false;\r\n\t\t\tthis._targetRay.visible = false;\r\n\t\t\tthis._targetRay.hasLinearVelocity = false;\r\n\t\t\tthis._targetRay.linearVelocity = new Vector3();\r\n\t\t\tthis._targetRay.hasAngularVelocity = false;\r\n\t\t\tthis._targetRay.angularVelocity = new Vector3();\r\n\r\n\t\t}\r\n\r\n\t\treturn this._targetRay;\r\n\r\n\t}\r\n\r\n\tgetGripSpace() {\r\n\r\n\t\tif ( this._grip === null ) {\r\n\r\n\t\t\tthis._grip = new Group();\r\n\t\t\tthis._grip.matrixAutoUpdate = false;\r\n\t\t\tthis._grip.visible = false;\r\n\t\t\tthis._grip.hasLinearVelocity = false;\r\n\t\t\tthis._grip.linearVelocity = new Vector3();\r\n\t\t\tthis._grip.hasAngularVelocity = false;\r\n\t\t\tthis._grip.angularVelocity = new Vector3();\r\n\r\n\t\t}\r\n\r\n\t\treturn this._grip;\r\n\r\n\t}\r\n\r\n\tdispatchEvent( event ) {\r\n\r\n\t\tif ( this._targetRay !== null ) {\r\n\r\n\t\t\tthis._targetRay.dispatchEvent( event );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._grip !== null ) {\r\n\r\n\t\t\tthis._grip.dispatchEvent( event );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._hand !== null ) {\r\n\r\n\t\t\tthis._hand.dispatchEvent( event );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdisconnect( inputSource ) {\r\n\r\n\t\tthis.dispatchEvent( { type: 'disconnected', data: inputSource } );\r\n\r\n\t\tif ( this._targetRay !== null ) {\r\n\r\n\t\t\tthis._targetRay.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._grip !== null ) {\r\n\r\n\t\t\tthis._grip.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._hand !== null ) {\r\n\r\n\t\t\tthis._hand.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tupdate( inputSource, frame, referenceSpace ) {\r\n\r\n\t\tlet inputPose = null;\r\n\t\tlet gripPose = null;\r\n\t\tlet handPose = null;\r\n\r\n\t\tconst targetRay = this._targetRay;\r\n\t\tconst grip = this._grip;\r\n\t\tconst hand = this._hand;\r\n\r\n\t\tif ( inputSource && frame.session.visibilityState !== 'visible-blurred' ) {\r\n\r\n\t\t\tif ( targetRay !== null ) {\r\n\r\n\t\t\t\tinputPose = frame.getPose( inputSource.targetRaySpace, referenceSpace );\r\n\r\n\t\t\t\tif ( inputPose !== null ) {\r\n\r\n\t\t\t\t\ttargetRay.matrix.fromArray( inputPose.transform.matrix );\r\n\t\t\t\t\ttargetRay.matrix.decompose( targetRay.position, targetRay.rotation, targetRay.scale );\r\n\r\n\t\t\t\t\tif ( inputPose.linearVelocity ) {\r\n\r\n\t\t\t\t\t\ttargetRay.hasLinearVelocity = true;\r\n\t\t\t\t\t\ttargetRay.linearVelocity.copy( inputPose.linearVelocity );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\ttargetRay.hasLinearVelocity = false;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( inputPose.angularVelocity ) {\r\n\r\n\t\t\t\t\t\ttargetRay.hasAngularVelocity = true;\r\n\t\t\t\t\t\ttargetRay.angularVelocity.copy( inputPose.angularVelocity );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\ttargetRay.hasAngularVelocity = false;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.dispatchEvent( _moveEvent );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( hand && inputSource.hand ) {\r\n\r\n\t\t\t\thandPose = true;\r\n\r\n\t\t\t\tfor ( const inputjoint of inputSource.hand.values() ) {\r\n\r\n\t\t\t\t\t// Update the joints groups with the XRJoint poses\r\n\t\t\t\t\tconst jointPose = frame.getJointPose( inputjoint, referenceSpace );\r\n\r\n\t\t\t\t\tif ( hand.joints[ inputjoint.jointName ] === undefined ) {\r\n\r\n\t\t\t\t\t\t// The transform of this joint will be updated with the joint pose on each frame\r\n\t\t\t\t\t\tconst joint = new Group();\r\n\t\t\t\t\t\tjoint.matrixAutoUpdate = false;\r\n\t\t\t\t\t\tjoint.visible = false;\r\n\t\t\t\t\t\thand.joints[ inputjoint.jointName ] = joint;\r\n\t\t\t\t\t\t// ??\r\n\t\t\t\t\t\thand.add( joint );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst joint = hand.joints[ inputjoint.jointName ];\r\n\r\n\t\t\t\t\tif ( jointPose !== null ) {\r\n\r\n\t\t\t\t\t\tjoint.matrix.fromArray( jointPose.transform.matrix );\r\n\t\t\t\t\t\tjoint.matrix.decompose( joint.position, joint.rotation, joint.scale );\r\n\t\t\t\t\t\tjoint.jointRadius = jointPose.radius;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tjoint.visible = jointPose !== null;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Custom events\r\n\r\n\t\t\t\t// Check pinchz\r\n\t\t\t\tconst indexTip = hand.joints[ 'index-finger-tip' ];\r\n\t\t\t\tconst thumbTip = hand.joints[ 'thumb-tip' ];\r\n\t\t\t\tconst distance = indexTip.position.distanceTo( thumbTip.position );\r\n\r\n\t\t\t\tconst distanceToPinch = 0.02;\r\n\t\t\t\tconst threshold = 0.005;\r\n\r\n\t\t\t\tif ( hand.inputState.pinching && distance > distanceToPinch + threshold ) {\r\n\r\n\t\t\t\t\thand.inputState.pinching = false;\r\n\t\t\t\t\tthis.dispatchEvent( {\r\n\t\t\t\t\t\ttype: 'pinchend',\r\n\t\t\t\t\t\thandedness: inputSource.handedness,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else if ( ! hand.inputState.pinching && distance <= distanceToPinch - threshold ) {\r\n\r\n\t\t\t\t\thand.inputState.pinching = true;\r\n\t\t\t\t\tthis.dispatchEvent( {\r\n\t\t\t\t\t\ttype: 'pinchstart',\r\n\t\t\t\t\t\thandedness: inputSource.handedness,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( grip !== null && inputSource.gripSpace ) {\r\n\r\n\t\t\t\t\tgripPose = frame.getPose( inputSource.gripSpace, referenceSpace );\r\n\r\n\t\t\t\t\tif ( gripPose !== null ) {\r\n\r\n\t\t\t\t\t\tgrip.matrix.fromArray( gripPose.transform.matrix );\r\n\t\t\t\t\t\tgrip.matrix.decompose( grip.position, grip.rotation, grip.scale );\r\n\r\n\t\t\t\t\t\tif ( gripPose.linearVelocity ) {\r\n\r\n\t\t\t\t\t\t\tgrip.hasLinearVelocity = true;\r\n\t\t\t\t\t\t\tgrip.linearVelocity.copy( gripPose.linearVelocity );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tgrip.hasLinearVelocity = false;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( gripPose.angularVelocity ) {\r\n\r\n\t\t\t\t\t\t\tgrip.hasAngularVelocity = true;\r\n\t\t\t\t\t\t\tgrip.angularVelocity.copy( gripPose.angularVelocity );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tgrip.hasAngularVelocity = false;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( targetRay !== null ) {\r\n\r\n\t\t\ttargetRay.visible = ( inputPose !== null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( grip !== null ) {\r\n\r\n\t\t\tgrip.visible = ( gripPose !== null );\r\n\r\n\t\t}\r\n\r\n\t\tif ( hand !== null ) {\r\n\r\n\t\t\thand.visible = ( handPose !== null );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { WebXRController };\r\n", "import { ArrayCamera } from '../../cameras/ArrayCamera.js';\r\nimport { EventDispatcher } from '../../core/EventDispatcher.js';\r\nimport { PerspectiveCamera } from '../../cameras/PerspectiveCamera.js';\r\nimport { Vector3 } from '../../math/Vector3.js';\r\nimport { Vector4 } from '../../math/Vector4.js';\r\nimport { WebGLAnimation } from '../webgl/WebGLAnimation.js';\r\nimport { WebXRController } from './WebXRController.js';\r\n\r\nclass WebXRManager extends EventDispatcher {\r\n\r\n\tconstructor( renderer, gl ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst scope = this;\r\n\t\tconst state = renderer.state;\r\n\r\n\t\tlet session = null;\r\n\t\tlet framebufferScaleFactor = 1.0;\r\n\r\n\t\tlet referenceSpace = null;\r\n\t\tlet referenceSpaceType = 'local-floor';\r\n\r\n\t\tlet pose = null;\r\n\t\tlet glBinding = null;\r\n\t\tlet glFramebuffer = null;\r\n\t\tlet glProjLayer = null;\r\n\t\tlet glBaseLayer = null;\r\n\t\tlet isMultisample = false;\r\n\t\tlet glMultisampledFramebuffer = null;\r\n\t\tlet glColorRenderbuffer = null;\r\n\t\tlet glDepthRenderbuffer = null;\r\n\t\tlet xrFrame = null;\r\n\t\tlet depthStyle = null;\r\n\t\tlet clearStyle = null;\r\n\r\n\t\tconst controllers = [];\r\n\t\tconst inputSourcesMap = new Map();\r\n\r\n\t\t//\r\n\r\n\t\tconst cameraL = new PerspectiveCamera();\r\n\t\tcameraL.layers.enable( 1 );\r\n\t\tcameraL.viewport = new Vector4();\r\n\r\n\t\tconst cameraR = new PerspectiveCamera();\r\n\t\tcameraR.layers.enable( 2 );\r\n\t\tcameraR.viewport = new Vector4();\r\n\r\n\t\tconst cameras = [ cameraL, cameraR ];\r\n\r\n\t\tconst cameraVR = new ArrayCamera();\r\n\t\tcameraVR.layers.enable( 1 );\r\n\t\tcameraVR.layers.enable( 2 );\r\n\r\n\t\tlet _currentDepthNear = null;\r\n\t\tlet _currentDepthFar = null;\r\n\r\n\t\t//\r\n\r\n\t\tthis.cameraAutoUpdate = true;\r\n\t\tthis.enabled = false;\r\n\r\n\t\tthis.isPresenting = false;\r\n\r\n\t\tthis.getController = function ( index ) {\r\n\r\n\t\t\tlet controller = controllers[ index ];\r\n\r\n\t\t\tif ( controller === undefined ) {\r\n\r\n\t\t\t\tcontroller = new WebXRController();\r\n\t\t\t\tcontrollers[ index ] = controller;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn controller.getTargetRaySpace();\r\n\r\n\t\t};\r\n\r\n\t\tthis.getControllerGrip = function ( index ) {\r\n\r\n\t\t\tlet controller = controllers[ index ];\r\n\r\n\t\t\tif ( controller === undefined ) {\r\n\r\n\t\t\t\tcontroller = new WebXRController();\r\n\t\t\t\tcontrollers[ index ] = controller;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn controller.getGripSpace();\r\n\r\n\t\t};\r\n\r\n\t\tthis.getHand = function ( index ) {\r\n\r\n\t\t\tlet controller = controllers[ index ];\r\n\r\n\t\t\tif ( controller === undefined ) {\r\n\r\n\t\t\t\tcontroller = new WebXRController();\r\n\t\t\t\tcontrollers[ index ] = controller;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn controller.getHandSpace();\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\r\n\t\tfunction onSessionEvent( event ) {\r\n\r\n\t\t\tconst controller = inputSourcesMap.get( event.inputSource );\r\n\r\n\t\t\tif ( controller ) {\r\n\r\n\t\t\t\tcontroller.dispatchEvent( { type: event.type, data: event.inputSource } );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onSessionEnd() {\r\n\r\n\t\t\tinputSourcesMap.forEach( function ( controller, inputSource ) {\r\n\r\n\t\t\t\tcontroller.disconnect( inputSource );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tinputSourcesMap.clear();\r\n\r\n\t\t\t_currentDepthNear = null;\r\n\t\t\t_currentDepthFar = null;\r\n\r\n\t\t\t// restore framebuffer/rendering state\r\n\r\n\t\t\tstate.bindXRFramebuffer( null );\r\n\t\t\trenderer.setRenderTarget( renderer.getRenderTarget() );\r\n\r\n\t\t\tif ( glFramebuffer ) gl.deleteFramebuffer( glFramebuffer );\r\n\t\t\tif ( glMultisampledFramebuffer ) gl.deleteFramebuffer( glMultisampledFramebuffer );\r\n\t\t\tif ( glColorRenderbuffer ) gl.deleteRenderbuffer( glColorRenderbuffer );\r\n\t\t\tif ( glDepthRenderbuffer ) gl.deleteRenderbuffer( glDepthRenderbuffer );\r\n\t\t\tglFramebuffer = null;\r\n\t\t\tglMultisampledFramebuffer = null;\r\n\t\t\tglColorRenderbuffer = null;\r\n\t\t\tglDepthRenderbuffer = null;\r\n\t\t\tglBaseLayer = null;\r\n\t\t\tglProjLayer = null;\r\n\t\t\tglBinding = null;\r\n\t\t\tsession = null;\r\n\r\n\t\t\t//\r\n\r\n\t\t\tanimation.stop();\r\n\r\n\t\t\tscope.isPresenting = false;\r\n\r\n\t\t\tscope.dispatchEvent( { type: 'sessionend' } );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setFramebufferScaleFactor = function ( value ) {\r\n\r\n\t\t\tframebufferScaleFactor = value;\r\n\r\n\t\t\tif ( scope.isPresenting === true ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebXRManager: Cannot change framebuffer scale while presenting.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tthis.setReferenceSpaceType = function ( value ) {\r\n\r\n\t\t\treferenceSpaceType = value;\r\n\r\n\t\t\tif ( scope.isPresenting === true ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebXRManager: Cannot change reference space type while presenting.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tthis.getReferenceSpace = function () {\r\n\r\n\t\t\treturn referenceSpace;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getBaseLayer = function () {\r\n\r\n\t\t\treturn glProjLayer !== null ? glProjLayer : glBaseLayer;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getBinding = function () {\r\n\r\n\t\t\treturn glBinding;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getFrame = function () {\r\n\r\n\t\t\treturn xrFrame;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getSession = function () {\r\n\r\n\t\t\treturn session;\r\n\r\n\t\t};\r\n\r\n\t\tthis.setSession = async function ( value ) {\r\n\r\n\t\t\tsession = value;\r\n\r\n\t\t\tif ( session !== null ) {\r\n\r\n\t\t\t\tsession.addEventListener( 'select', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'selectstart', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'selectend', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'squeeze', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'squeezestart', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'squeezeend', onSessionEvent );\r\n\t\t\t\tsession.addEventListener( 'end', onSessionEnd );\r\n\t\t\t\tsession.addEventListener( 'inputsourceschange', onInputSourcesChange );\r\n\r\n\t\t\t\tconst attributes = gl.getContextAttributes();\r\n\r\n\t\t\t\tif ( attributes.xrCompatible !== true ) {\r\n\r\n\t\t\t\t\tawait gl.makeXRCompatible();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( session.renderState.layers === undefined ) {\r\n\r\n\t\t\t\t\tconst layerInit = {\r\n\t\t\t\t\t\tantialias: attributes.antialias,\r\n\t\t\t\t\t\talpha: attributes.alpha,\r\n\t\t\t\t\t\tdepth: attributes.depth,\r\n\t\t\t\t\t\tstencil: attributes.stencil,\r\n\t\t\t\t\t\tframebufferScaleFactor: framebufferScaleFactor\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tglBaseLayer = new XRWebGLLayer( session, gl, layerInit );\r\n\r\n\t\t\t\t\tsession.updateRenderState( { baseLayer: glBaseLayer } );\r\n\r\n\t\t\t\t} else if ( gl instanceof WebGLRenderingContext ) {\r\n\r\n\t\t\t\t\t// Use old style webgl layer because we can't use MSAA\r\n\t\t\t\t\t// WebGL2 support.\r\n\r\n\t\t\t\t\tconst layerInit = {\r\n\t\t\t\t\t\tantialias: true,\r\n\t\t\t\t\t\talpha: attributes.alpha,\r\n\t\t\t\t\t\tdepth: attributes.depth,\r\n\t\t\t\t\t\tstencil: attributes.stencil,\r\n\t\t\t\t\t\tframebufferScaleFactor: framebufferScaleFactor\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tglBaseLayer = new XRWebGLLayer( session, gl, layerInit );\r\n\r\n\t\t\t\t\tsession.updateRenderState( { layers: [ glBaseLayer ] } );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tisMultisample = attributes.antialias;\r\n\t\t\t\t\tlet depthFormat = null;\r\n\r\n\r\n\t\t\t\t\tif ( attributes.depth ) {\r\n\r\n\t\t\t\t\t\tclearStyle = gl.DEPTH_BUFFER_BIT;\r\n\r\n\t\t\t\t\t\tif ( attributes.stencil ) clearStyle |= gl.STENCIL_BUFFER_BIT;\r\n\r\n\t\t\t\t\t\tdepthStyle = attributes.stencil ? gl.DEPTH_STENCIL_ATTACHMENT : gl.DEPTH_ATTACHMENT;\r\n\t\t\t\t\t\tdepthFormat = attributes.stencil ? gl.DEPTH24_STENCIL8 : gl.DEPTH_COMPONENT24;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst projectionlayerInit = {\r\n\t\t\t\t\t\tcolorFormat: attributes.alpha ? gl.RGBA8 : gl.RGB8,\r\n\t\t\t\t\t\tdepthFormat: depthFormat,\r\n\t\t\t\t\t\tscaleFactor: framebufferScaleFactor\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tglBinding = new XRWebGLBinding( session, gl );\r\n\r\n\t\t\t\t\tglProjLayer = glBinding.createProjectionLayer( projectionlayerInit );\r\n\r\n\t\t\t\t\tglFramebuffer = gl.createFramebuffer();\r\n\r\n\t\t\t\t\tsession.updateRenderState( { layers: [ glProjLayer ] } );\r\n\r\n\t\t\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\t\t\tglMultisampledFramebuffer = gl.createFramebuffer();\r\n\t\t\t\t\t\tglColorRenderbuffer = gl.createRenderbuffer();\r\n\t\t\t\t\t\tgl.bindRenderbuffer( gl.RENDERBUFFER, glColorRenderbuffer );\r\n\t\t\t\t\t\tgl.renderbufferStorageMultisample(\r\n\t\t\t\t\t\t\tgl.RENDERBUFFER,\r\n\t\t\t\t\t\t\t4,\r\n\t\t\t\t\t\t\tgl.RGBA8,\r\n\t\t\t\t\t\t\tglProjLayer.textureWidth,\r\n\t\t\t\t\t\t\tglProjLayer.textureHeight );\r\n\t\t\t\t\t\tstate.bindFramebuffer( gl.FRAMEBUFFER, glMultisampledFramebuffer );\r\n\t\t\t\t\t\tgl.framebufferRenderbuffer( gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.RENDERBUFFER, glColorRenderbuffer );\r\n\t\t\t\t\t\tgl.bindRenderbuffer( gl.RENDERBUFFER, null );\r\n\r\n\t\t\t\t\t\tif ( depthFormat !== null ) {\r\n\r\n\t\t\t\t\t\t\tglDepthRenderbuffer = gl.createRenderbuffer();\r\n\t\t\t\t\t\t\tgl.bindRenderbuffer( gl.RENDERBUFFER, glDepthRenderbuffer );\r\n\t\t\t\t\t\t\tgl.renderbufferStorageMultisample( gl.RENDERBUFFER, 4, depthFormat, glProjLayer.textureWidth, glProjLayer.textureHeight );\r\n\t\t\t\t\t\t\tgl.framebufferRenderbuffer( gl.FRAMEBUFFER, depthStyle, gl.RENDERBUFFER, glDepthRenderbuffer );\r\n\t\t\t\t\t\t\tgl.bindRenderbuffer( gl.RENDERBUFFER, null );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tstate.bindFramebuffer( gl.FRAMEBUFFER, null );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treferenceSpace = await session.requestReferenceSpace( referenceSpaceType );\r\n\r\n\t\t\t\tanimation.setContext( session );\r\n\t\t\t\tanimation.start();\r\n\r\n\t\t\t\tscope.isPresenting = true;\r\n\r\n\t\t\t\tscope.dispatchEvent( { type: 'sessionstart' } );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tfunction onInputSourcesChange( event ) {\r\n\r\n\t\t\tconst inputSources = session.inputSources;\r\n\r\n\t\t\t// Assign inputSources to available controllers\r\n\r\n\t\t\tfor ( let i = 0; i < controllers.length; i ++ ) {\r\n\r\n\t\t\t\tinputSourcesMap.set( inputSources[ i ], controllers[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Notify disconnected\r\n\r\n\t\t\tfor ( let i = 0; i < event.removed.length; i ++ ) {\r\n\r\n\t\t\t\tconst inputSource = event.removed[ i ];\r\n\t\t\t\tconst controller = inputSourcesMap.get( inputSource );\r\n\r\n\t\t\t\tif ( controller ) {\r\n\r\n\t\t\t\t\tcontroller.dispatchEvent( { type: 'disconnected', data: inputSource } );\r\n\t\t\t\t\tinputSourcesMap.delete( inputSource );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Notify connected\r\n\r\n\t\t\tfor ( let i = 0; i < event.added.length; i ++ ) {\r\n\r\n\t\t\t\tconst inputSource = event.added[ i ];\r\n\t\t\t\tconst controller = inputSourcesMap.get( inputSource );\r\n\r\n\t\t\t\tif ( controller ) {\r\n\r\n\t\t\t\t\tcontroller.dispatchEvent( { type: 'connected', data: inputSource } );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tconst cameraLPos = new Vector3();\r\n\t\tconst cameraRPos = new Vector3();\r\n\r\n\t\t/**\r\n\t\t * Assumes 2 cameras that are parallel and share an X-axis, and that\r\n\t\t * the cameras' projection and world matrices have already been set.\r\n\t\t * And that near and far planes are identical for both cameras.\r\n\t\t * Visualization of this technique: https://computergraphics.stackexchange.com/a/4765\r\n\t\t */\r\n\t\tfunction setProjectionFromUnion( camera, cameraL, cameraR ) {\r\n\r\n\t\t\tcameraLPos.setFromMatrixPosition( cameraL.matrixWorld );\r\n\t\t\tcameraRPos.setFromMatrixPosition( cameraR.matrixWorld );\r\n\r\n\t\t\tconst ipd = cameraLPos.distanceTo( cameraRPos );\r\n\r\n\t\t\tconst projL = cameraL.projectionMatrix.elements;\r\n\t\t\tconst projR = cameraR.projectionMatrix.elements;\r\n\r\n\t\t\t// VR systems will have identical far and near planes, and\r\n\t\t\t// most likely identical top and bottom frustum extents.\r\n\t\t\t// Use the left camera for these values.\r\n\t\t\tconst near = projL[ 14 ] / ( projL[ 10 ] - 1 );\r\n\t\t\tconst far = projL[ 14 ] / ( projL[ 10 ] + 1 );\r\n\t\t\tconst topFov = ( projL[ 9 ] + 1 ) / projL[ 5 ];\r\n\t\t\tconst bottomFov = ( projL[ 9 ] - 1 ) / projL[ 5 ];\r\n\r\n\t\t\tconst leftFov = ( projL[ 8 ] - 1 ) / projL[ 0 ];\r\n\t\t\tconst rightFov = ( projR[ 8 ] + 1 ) / projR[ 0 ];\r\n\t\t\tconst left = near * leftFov;\r\n\t\t\tconst right = near * rightFov;\r\n\r\n\t\t\t// Calculate the new camera's position offset from the\r\n\t\t\t// left camera. xOffset should be roughly half `ipd`.\r\n\t\t\tconst zOffset = ipd / ( - leftFov + rightFov );\r\n\t\t\tconst xOffset = zOffset * - leftFov;\r\n\r\n\t\t\t// TODO: Better way to apply this offset?\r\n\t\t\tcameraL.matrixWorld.decompose( camera.position, camera.quaternion, camera.scale );\r\n\t\t\tcamera.translateX( xOffset );\r\n\t\t\tcamera.translateZ( zOffset );\r\n\t\t\tcamera.matrixWorld.compose( camera.position, camera.quaternion, camera.scale );\r\n\t\t\tcamera.matrixWorldInverse.copy( camera.matrixWorld ).invert();\r\n\r\n\t\t\t// Find the union of the frustum values of the cameras and scale\r\n\t\t\t// the values so that the near plane's position does not change in world space,\r\n\t\t\t// although must now be relative to the new union camera.\r\n\t\t\tconst near2 = near + zOffset;\r\n\t\t\tconst far2 = far + zOffset;\r\n\t\t\tconst left2 = left - xOffset;\r\n\t\t\tconst right2 = right + ( ipd - xOffset );\r\n\t\t\tconst top2 = topFov * far / far2 * near2;\r\n\t\t\tconst bottom2 = bottomFov * far / far2 * near2;\r\n\r\n\t\t\tcamera.projectionMatrix.makePerspective( left2, right2, top2, bottom2, near2, far2 );\r\n\r\n\t\t}\r\n\r\n\t\tfunction updateCamera( camera, parent ) {\r\n\r\n\t\t\tif ( parent === null ) {\r\n\r\n\t\t\t\tcamera.matrixWorld.copy( camera.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcamera.matrixWorld.multiplyMatrices( parent.matrixWorld, camera.matrix );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcamera.matrixWorldInverse.copy( camera.matrixWorld ).invert();\r\n\r\n\t\t}\r\n\r\n\t\tthis.updateCamera = function ( camera ) {\r\n\r\n\t\t\tif ( session === null ) return;\r\n\r\n\t\t\tcameraVR.near = cameraR.near = cameraL.near = camera.near;\r\n\t\t\tcameraVR.far = cameraR.far = cameraL.far = camera.far;\r\n\r\n\t\t\tif ( _currentDepthNear !== cameraVR.near || _currentDepthFar !== cameraVR.far ) {\r\n\r\n\t\t\t\t// Note that the new renderState won't apply until the next frame. See #18320\r\n\r\n\t\t\t\tsession.updateRenderState( {\r\n\t\t\t\t\tdepthNear: cameraVR.near,\r\n\t\t\t\t\tdepthFar: cameraVR.far\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t_currentDepthNear = cameraVR.near;\r\n\t\t\t\t_currentDepthFar = cameraVR.far;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst parent = camera.parent;\r\n\t\t\tconst cameras = cameraVR.cameras;\r\n\r\n\t\t\tupdateCamera( cameraVR, parent );\r\n\r\n\t\t\tfor ( let i = 0; i < cameras.length; i ++ ) {\r\n\r\n\t\t\t\tupdateCamera( cameras[ i ], parent );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcameraVR.matrixWorld.decompose( cameraVR.position, cameraVR.quaternion, cameraVR.scale );\r\n\r\n\t\t\t// update user camera and its children\r\n\r\n\t\t\tcamera.position.copy( cameraVR.position );\r\n\t\t\tcamera.quaternion.copy( cameraVR.quaternion );\r\n\t\t\tcamera.scale.copy( cameraVR.scale );\r\n\t\t\tcamera.matrix.copy( cameraVR.matrix );\r\n\t\t\tcamera.matrixWorld.copy( cameraVR.matrixWorld );\r\n\r\n\t\t\tconst children = camera.children;\r\n\r\n\t\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tchildren[ i ].updateMatrixWorld( true );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// update projection matrix for proper view frustum culling\r\n\r\n\t\t\tif ( cameras.length === 2 ) {\r\n\r\n\t\t\t\tsetProjectionFromUnion( cameraVR, cameraL, cameraR );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// assume single camera setup (AR)\r\n\r\n\t\t\t\tcameraVR.projectionMatrix.copy( cameraL.projectionMatrix );\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tthis.getCamera = function () {\r\n\r\n\t\t\treturn cameraVR;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getFoveation = function () {\r\n\r\n\t\t\tif ( glProjLayer !== null ) {\r\n\r\n\t\t\t\treturn glProjLayer.fixedFoveation;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( glBaseLayer !== null ) {\r\n\r\n\t\t\t\treturn glBaseLayer.fixedFoveation;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\r\n\t\t};\r\n\r\n\t\tthis.setFoveation = function ( foveation ) {\r\n\r\n\t\t\t// 0 = no foveation = full resolution\r\n\t\t\t// 1 = maximum foveation = the edges render at lower resolution\r\n\r\n\t\t\tif ( glProjLayer !== null ) {\r\n\r\n\t\t\t\tglProjLayer.fixedFoveation = foveation;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( glBaseLayer !== null && glBaseLayer.fixedFoveation !== undefined ) {\r\n\r\n\t\t\t\tglBaseLayer.fixedFoveation = foveation;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\t// Animation Loop\r\n\r\n\t\tlet onAnimationFrameCallback = null;\r\n\r\n\t\tfunction onAnimationFrame( time, frame ) {\r\n\r\n\t\t\tpose = frame.getViewerPose( referenceSpace );\r\n\t\t\txrFrame = frame;\r\n\r\n\t\t\tif ( pose !== null ) {\r\n\r\n\t\t\t\tconst views = pose.views;\r\n\r\n\t\t\t\tif ( glBaseLayer !== null ) {\r\n\r\n\t\t\t\t\tstate.bindXRFramebuffer( glBaseLayer.framebuffer );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet cameraVRNeedsUpdate = false;\r\n\r\n\t\t\t\t// check if it's necessary to rebuild cameraVR's camera list\r\n\r\n\t\t\t\tif ( views.length !== cameraVR.cameras.length ) {\r\n\r\n\t\t\t\t\tcameraVR.cameras.length = 0;\r\n\r\n\t\t\t\t\tcameraVRNeedsUpdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor ( let i = 0; i < views.length; i ++ ) {\r\n\r\n\t\t\t\t\tconst view = views[ i ];\r\n\r\n\t\t\t\t\tlet viewport = null;\r\n\r\n\t\t\t\t\tif ( glBaseLayer !== null ) {\r\n\r\n\t\t\t\t\t\tviewport = glBaseLayer.getViewport( view );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconst glSubImage = glBinding.getViewSubImage( glProjLayer, view );\r\n\r\n\t\t\t\t\t\tstate.bindXRFramebuffer( glFramebuffer );\r\n\r\n\t\t\t\t\t\tif ( glSubImage.depthStencilTexture !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tgl.framebufferTexture2D( gl.FRAMEBUFFER, depthStyle, gl.TEXTURE_2D, glSubImage.depthStencilTexture, 0 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgl.framebufferTexture2D( gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, glSubImage.colorTexture, 0 );\r\n\r\n\t\t\t\t\t\tviewport = glSubImage.viewport;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst camera = cameras[ i ];\r\n\r\n\t\t\t\t\tcamera.matrix.fromArray( view.transform.matrix );\r\n\t\t\t\t\tcamera.projectionMatrix.fromArray( view.projectionMatrix );\r\n\t\t\t\t\tcamera.viewport.set( viewport.x, viewport.y, viewport.width, viewport.height );\r\n\r\n\t\t\t\t\tif ( i === 0 ) {\r\n\r\n\t\t\t\t\t\tcameraVR.matrix.copy( camera.matrix );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( cameraVRNeedsUpdate === true ) {\r\n\r\n\t\t\t\t\t\tcameraVR.cameras.push( camera );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\t\tstate.bindXRFramebuffer( glMultisampledFramebuffer );\r\n\r\n\t\t\t\t\tif ( clearStyle !== null ) gl.clear( clearStyle );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tconst inputSources = session.inputSources;\r\n\r\n\t\t\tfor ( let i = 0; i < controllers.length; i ++ ) {\r\n\r\n\t\t\t\tconst controller = controllers[ i ];\r\n\t\t\t\tconst inputSource = inputSources[ i ];\r\n\r\n\t\t\t\tcontroller.update( inputSource, frame, referenceSpace );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( onAnimationFrameCallback ) onAnimationFrameCallback( time, frame );\r\n\r\n\t\t\tif ( isMultisample ) {\r\n\r\n\t\t\t\tconst width = glProjLayer.textureWidth;\r\n\t\t\t\tconst height = glProjLayer.textureHeight;\r\n\r\n\t\t\t\tstate.bindFramebuffer( gl.READ_FRAMEBUFFER, glMultisampledFramebuffer );\r\n\t\t\t\tstate.bindFramebuffer( gl.DRAW_FRAMEBUFFER, glFramebuffer );\r\n\t\t\t\t// Invalidate the depth here to avoid flush of the depth data to main memory.\r\n\t\t\t\tgl.invalidateFramebuffer( gl.READ_FRAMEBUFFER, [ depthStyle ] );\r\n\t\t\t\tgl.invalidateFramebuffer( gl.DRAW_FRAMEBUFFER, [ depthStyle ] );\r\n\t\t\t\tgl.blitFramebuffer( 0, 0, width, height, 0, 0, width, height, gl.COLOR_BUFFER_BIT, gl.NEAREST );\r\n\t\t\t\t// Invalidate the MSAA buffer because it's not needed anymore.\r\n\t\t\t\tgl.invalidateFramebuffer( gl.READ_FRAMEBUFFER, [ gl.COLOR_ATTACHMENT0 ] );\r\n\t\t\t\tstate.bindFramebuffer( gl.READ_FRAMEBUFFER, null );\r\n\t\t\t\tstate.bindFramebuffer( gl.DRAW_FRAMEBUFFER, null );\r\n\r\n\t\t\t\tstate.bindFramebuffer( gl.FRAMEBUFFER, glMultisampledFramebuffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t\txrFrame = null;\r\n\r\n\t\t}\r\n\r\n\t\tconst animation = new WebGLAnimation();\r\n\r\n\t\tanimation.setAnimationLoop( onAnimationFrame );\r\n\r\n\t\tthis.setAnimationLoop = function ( callback ) {\r\n\r\n\t\t\tonAnimationFrameCallback = callback;\r\n\r\n\t\t};\r\n\r\n\t\tthis.dispose = function () {};\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { WebXRManager };\r\n", "import { BackSide } from '../../constants.js';\r\n\r\nfunction WebGLMaterials( properties ) {\r\n\r\n\tfunction refreshFogUniforms( uniforms, fog ) {\r\n\r\n\t\tuniforms.fogColor.value.copy( fog.color );\r\n\r\n\t\tif ( fog.isFog ) {\r\n\r\n\t\t\tuniforms.fogNear.value = fog.near;\r\n\t\t\tuniforms.fogFar.value = fog.far;\r\n\r\n\t\t} else if ( fog.isFogExp2 ) {\r\n\r\n\t\t\tuniforms.fogDensity.value = fog.density;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshMaterialUniforms( uniforms, material, pixelRatio, height, transmissionRenderTarget ) {\r\n\r\n\t\tif ( material.isMeshBasicMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshLambertMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsLambert( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshToonMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsToon( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshPhongMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsPhong( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshStandardMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\r\n\t\t\tif ( material.isMeshPhysicalMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsPhysical( uniforms, material, transmissionRenderTarget );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trefreshUniformsStandard( uniforms, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material.isMeshMatcapMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsMatcap( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshDepthMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsDepth( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshDistanceMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsDistance( uniforms, material );\r\n\r\n\t\t} else if ( material.isMeshNormalMaterial ) {\r\n\r\n\t\t\trefreshUniformsCommon( uniforms, material );\r\n\t\t\trefreshUniformsNormal( uniforms, material );\r\n\r\n\t\t} else if ( material.isLineBasicMaterial ) {\r\n\r\n\t\t\trefreshUniformsLine( uniforms, material );\r\n\r\n\t\t\tif ( material.isLineDashedMaterial ) {\r\n\r\n\t\t\t\trefreshUniformsDash( uniforms, material );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material.isPointsMaterial ) {\r\n\r\n\t\t\trefreshUniformsPoints( uniforms, material, pixelRatio, height );\r\n\r\n\t\t} else if ( material.isSpriteMaterial ) {\r\n\r\n\t\t\trefreshUniformsSprites( uniforms, material );\r\n\r\n\t\t} else if ( material.isShadowMaterial ) {\r\n\r\n\t\t\tuniforms.color.value.copy( material.color );\r\n\t\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\t} else if ( material.isShaderMaterial ) {\r\n\r\n\t\t\tmaterial.uniformsNeedUpdate = false; // #15581\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsCommon( uniforms, material ) {\r\n\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t\tif ( material.color ) {\r\n\r\n\t\t\tuniforms.diffuse.value.copy( material.color );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.emissive ) {\r\n\r\n\t\t\tuniforms.emissive.value.copy( material.emissive ).multiplyScalar( material.emissiveIntensity );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuniforms.map.value = material.map;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.alphaMap ) {\r\n\r\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.specularMap ) {\r\n\r\n\t\t\tuniforms.specularMap.value = material.specularMap;\r\n\r\n\t\t}\r\n\r\n\t\tconst envMap = properties.get( material ).envMap;\r\n\r\n\t\tif ( envMap ) {\r\n\r\n\t\t\tuniforms.envMap.value = envMap;\r\n\r\n\t\t\tuniforms.flipEnvMap.value = ( envMap.isCubeTexture && envMap.isRenderTargetTexture === false ) ? - 1 : 1;\r\n\r\n\t\t\tuniforms.reflectivity.value = material.reflectivity;\r\n\t\t\tuniforms.ior.value = material.ior;\r\n\t\t\tuniforms.refractionRatio.value = material.refractionRatio;\r\n\r\n\t\t\tconst maxMipLevel = properties.get( envMap ).__maxMipLevel;\r\n\r\n\t\t\tif ( maxMipLevel !== undefined ) {\r\n\r\n\t\t\t\tuniforms.maxMipLevel.value = maxMipLevel;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.lightMap ) {\r\n\r\n\t\t\tuniforms.lightMap.value = material.lightMap;\r\n\t\t\tuniforms.lightMapIntensity.value = material.lightMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.aoMap ) {\r\n\r\n\t\t\tuniforms.aoMap.value = material.aoMap;\r\n\t\t\tuniforms.aoMapIntensity.value = material.aoMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities\r\n\t\t// 1. color map\r\n\t\t// 2. specular map\r\n\t\t// 3. displacementMap map\r\n\t\t// 4. normal map\r\n\t\t// 5. bump map\r\n\t\t// 6. roughnessMap map\r\n\t\t// 7. metalnessMap map\r\n\t\t// 8. alphaMap map\r\n\t\t// 9. emissiveMap map\r\n\t\t// 10. clearcoat map\r\n\t\t// 11. clearcoat normal map\r\n\t\t// 12. clearcoat roughnessMap map\r\n\t\t// 13. specular intensity map\r\n\t\t// 14. specular tint map\r\n\r\n\t\tlet uvScaleMap;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t} else if ( material.specularMap ) {\r\n\r\n\t\t\tuvScaleMap = material.specularMap;\r\n\r\n\t\t} else if ( material.displacementMap ) {\r\n\r\n\t\t\tuvScaleMap = material.displacementMap;\r\n\r\n\t\t} else if ( material.normalMap ) {\r\n\r\n\t\t\tuvScaleMap = material.normalMap;\r\n\r\n\t\t} else if ( material.bumpMap ) {\r\n\r\n\t\t\tuvScaleMap = material.bumpMap;\r\n\r\n\t\t} else if ( material.roughnessMap ) {\r\n\r\n\t\t\tuvScaleMap = material.roughnessMap;\r\n\r\n\t\t} else if ( material.metalnessMap ) {\r\n\r\n\t\t\tuvScaleMap = material.metalnessMap;\r\n\r\n\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t} else if ( material.emissiveMap ) {\r\n\r\n\t\t\tuvScaleMap = material.emissiveMap;\r\n\r\n\t\t} else if ( material.clearcoatMap ) {\r\n\r\n\t\t\tuvScaleMap = material.clearcoatMap;\r\n\r\n\t\t} else if ( material.clearcoatNormalMap ) {\r\n\r\n\t\t\tuvScaleMap = material.clearcoatNormalMap;\r\n\r\n\t\t} else if ( material.clearcoatRoughnessMap ) {\r\n\r\n\t\t\tuvScaleMap = material.clearcoatRoughnessMap;\r\n\r\n\t\t} else if ( material.specularIntensityMap ) {\r\n\r\n\t\t\tuvScaleMap = material.specularIntensityMap;\r\n\r\n\t\t} else if ( material.specularTintMap ) {\r\n\r\n\t\t\tuvScaleMap = material.specularTintMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\t// backwards compatibility\r\n\t\t\tif ( uvScaleMap.isWebGLRenderTarget ) {\r\n\r\n\t\t\t\tuvScaleMap = uvScaleMap.texture;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\tuvScaleMap.updateMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities for uv2\r\n\t\t// 1. ao map\r\n\t\t// 2. light map\r\n\r\n\t\tlet uv2ScaleMap;\r\n\r\n\t\tif ( material.aoMap ) {\r\n\r\n\t\t\tuv2ScaleMap = material.aoMap;\r\n\r\n\t\t} else if ( material.lightMap ) {\r\n\r\n\t\t\tuv2ScaleMap = material.lightMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uv2ScaleMap !== undefined ) {\r\n\r\n\t\t\t// backwards compatibility\r\n\t\t\tif ( uv2ScaleMap.isWebGLRenderTarget ) {\r\n\r\n\t\t\t\tuv2ScaleMap = uv2ScaleMap.texture;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( uv2ScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\tuv2ScaleMap.updateMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniforms.uv2Transform.value.copy( uv2ScaleMap.matrix );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLine( uniforms, material ) {\r\n\r\n\t\tuniforms.diffuse.value.copy( material.color );\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsDash( uniforms, material ) {\r\n\r\n\t\tuniforms.dashSize.value = material.dashSize;\r\n\t\tuniforms.totalSize.value = material.dashSize + material.gapSize;\r\n\t\tuniforms.scale.value = material.scale;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsPoints( uniforms, material, pixelRatio, height ) {\r\n\r\n\t\tuniforms.diffuse.value.copy( material.color );\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\t\tuniforms.size.value = material.size * pixelRatio;\r\n\t\tuniforms.scale.value = height * 0.5;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuniforms.map.value = material.map;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.alphaMap ) {\r\n\r\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities\r\n\t\t// 1. color map\r\n\t\t// 2. alpha map\r\n\r\n\t\tlet uvScaleMap;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\tuvScaleMap.updateMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsSprites( uniforms, material ) {\r\n\r\n\t\tuniforms.diffuse.value.copy( material.color );\r\n\t\tuniforms.opacity.value = material.opacity;\r\n\t\tuniforms.rotation.value = material.rotation;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuniforms.map.value = material.map;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.alphaMap ) {\r\n\r\n\t\t\tuniforms.alphaMap.value = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\t// uv repeat and offset setting priorities\r\n\t\t// 1. color map\r\n\t\t// 2. alpha map\r\n\r\n\t\tlet uvScaleMap;\r\n\r\n\t\tif ( material.map ) {\r\n\r\n\t\t\tuvScaleMap = material.map;\r\n\r\n\t\t} else if ( material.alphaMap ) {\r\n\r\n\t\t\tuvScaleMap = material.alphaMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( uvScaleMap !== undefined ) {\r\n\r\n\t\t\tif ( uvScaleMap.matrixAutoUpdate === true ) {\r\n\r\n\t\t\t\tuvScaleMap.updateMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tuniforms.uvTransform.value.copy( uvScaleMap.matrix );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsLambert( uniforms, material ) {\r\n\r\n\t\tif ( material.emissiveMap ) {\r\n\r\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsPhong( uniforms, material ) {\r\n\r\n\t\tuniforms.specular.value.copy( material.specular );\r\n\t\tuniforms.shininess.value = Math.max( material.shininess, 1e-4 ); // to prevent pow( 0.0, 0.0 )\r\n\r\n\t\tif ( material.emissiveMap ) {\r\n\r\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsToon( uniforms, material ) {\r\n\r\n\t\tif ( material.gradientMap ) {\r\n\r\n\t\t\tuniforms.gradientMap.value = material.gradientMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.emissiveMap ) {\r\n\r\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsStandard( uniforms, material ) {\r\n\r\n\t\tuniforms.roughness.value = material.roughness;\r\n\t\tuniforms.metalness.value = material.metalness;\r\n\r\n\t\tif ( material.roughnessMap ) {\r\n\r\n\t\t\tuniforms.roughnessMap.value = material.roughnessMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.metalnessMap ) {\r\n\r\n\t\t\tuniforms.metalnessMap.value = material.metalnessMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.emissiveMap ) {\r\n\r\n\t\t\tuniforms.emissiveMap.value = material.emissiveMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t\tconst envMap = properties.get( material ).envMap;\r\n\r\n\t\tif ( envMap ) {\r\n\r\n\t\t\t//uniforms.envMap.value = material.envMap; // part of uniforms common\r\n\t\t\tuniforms.envMapIntensity.value = material.envMapIntensity;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsPhysical( uniforms, material, transmissionRenderTarget ) {\r\n\r\n\t\trefreshUniformsStandard( uniforms, material );\r\n\r\n\t\tuniforms.ior.value = material.ior; // also part of uniforms common\r\n\r\n\t\tuniforms.clearcoat.value = material.clearcoat;\r\n\t\tuniforms.clearcoatRoughness.value = material.clearcoatRoughness;\r\n\r\n\t\tif ( material.sheen ) uniforms.sheen.value.copy( material.sheen );\r\n\r\n\t\tif ( material.clearcoatMap ) {\r\n\r\n\t\t\tuniforms.clearcoatMap.value = material.clearcoatMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.clearcoatRoughnessMap ) {\r\n\r\n\t\t\tuniforms.clearcoatRoughnessMap.value = material.clearcoatRoughnessMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.clearcoatNormalMap ) {\r\n\r\n\t\t\tuniforms.clearcoatNormalScale.value.copy( material.clearcoatNormalScale );\r\n\t\t\tuniforms.clearcoatNormalMap.value = material.clearcoatNormalMap;\r\n\r\n\t\t\tif ( material.side === BackSide ) {\r\n\r\n\t\t\t\tuniforms.clearcoatNormalScale.value.negate();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.transmission.value = material.transmission;\r\n\r\n\t\tif ( material.transmissionMap ) {\r\n\r\n\t\t\tuniforms.transmissionMap.value = material.transmissionMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.transmission > 0.0 ) {\r\n\r\n\t\t\tuniforms.transmissionSamplerMap.value = transmissionRenderTarget.texture;\r\n\t\t\tuniforms.transmissionSamplerSize.value.set( transmissionRenderTarget.width, transmissionRenderTarget.height );\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.thickness.value = material.thickness;\r\n\r\n\t\tif ( material.thicknessMap ) {\r\n\r\n\t\t\tuniforms.thicknessMap.value = material.thicknessMap;\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.attenuationDistance.value = material.attenuationDistance;\r\n\t\tuniforms.attenuationTint.value.copy( material.attenuationTint );\r\n\r\n\t\tuniforms.specularIntensity.value = material.specularIntensity;\r\n\t\tuniforms.specularTint.value.copy( material.specularTint );\r\n\r\n\t\tif ( material.specularIntensityMap ) {\r\n\r\n\t\t\tuniforms.specularIntensityMap.value = material.specularIntensityMap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.specularTintMap ) {\r\n\r\n\t\t\tuniforms.specularTintMap.value = material.specularTintMap;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsMatcap( uniforms, material ) {\r\n\r\n\t\tif ( material.matcap ) {\r\n\r\n\t\t\tuniforms.matcap.value = material.matcap;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsDepth( uniforms, material ) {\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsDistance( uniforms, material ) {\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t\tuniforms.referencePosition.value.copy( material.referencePosition );\r\n\t\tuniforms.nearDistance.value = material.nearDistance;\r\n\t\tuniforms.farDistance.value = material.farDistance;\r\n\r\n\t}\r\n\r\n\tfunction refreshUniformsNormal( uniforms, material ) {\r\n\r\n\t\tif ( material.bumpMap ) {\r\n\r\n\t\t\tuniforms.bumpMap.value = material.bumpMap;\r\n\t\t\tuniforms.bumpScale.value = material.bumpScale;\r\n\t\t\tif ( material.side === BackSide ) uniforms.bumpScale.value *= - 1;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.normalMap ) {\r\n\r\n\t\t\tuniforms.normalMap.value = material.normalMap;\r\n\t\t\tuniforms.normalScale.value.copy( material.normalScale );\r\n\t\t\tif ( material.side === BackSide ) uniforms.normalScale.value.negate();\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.displacementMap ) {\r\n\r\n\t\t\tuniforms.displacementMap.value = material.displacementMap;\r\n\t\t\tuniforms.displacementScale.value = material.displacementScale;\r\n\t\t\tuniforms.displacementBias.value = material.displacementBias;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn {\r\n\t\trefreshFogUniforms: refreshFogUniforms,\r\n\t\trefreshMaterialUniforms: refreshMaterialUniforms\r\n\t};\r\n\r\n}\r\n\r\nexport { WebGLMaterials };\r\n", "import {\r\n\tBackSide,\r\n\tDoubleSide,\r\n\tFrontSide,\r\n\tRGBAFormat,\r\n\tHalfFloatType,\r\n\tFloatType,\r\n\tUnsignedByteType,\r\n\tLinearEncoding,\r\n\tNoToneMapping,\r\n\tLinearMipmapLinearFilter,\r\n\tNearestFilter,\r\n\tClampToEdgeWrapping\r\n} from '../constants.js';\r\nimport { Frustum } from '../math/Frustum.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Vector4 } from '../math/Vector4.js';\r\nimport { WebGLAnimation } from './webgl/WebGLAnimation.js';\r\nimport { WebGLAttributes } from './webgl/WebGLAttributes.js';\r\nimport { WebGLBackground } from './webgl/WebGLBackground.js';\r\nimport { WebGLBindingStates } from './webgl/WebGLBindingStates.js';\r\nimport { WebGLBufferRenderer } from './webgl/WebGLBufferRenderer.js';\r\nimport { WebGLCapabilities } from './webgl/WebGLCapabilities.js';\r\nimport { WebGLClipping } from './webgl/WebGLClipping.js';\r\nimport { WebGLCubeMaps } from './webgl/WebGLCubeMaps.js';\r\nimport { WebGLCubeUVMaps } from './webgl/WebGLCubeUVMaps.js';\r\nimport { WebGLExtensions } from './webgl/WebGLExtensions.js';\r\nimport { WebGLGeometries } from './webgl/WebGLGeometries.js';\r\nimport { WebGLIndexedBufferRenderer } from './webgl/WebGLIndexedBufferRenderer.js';\r\nimport { WebGLInfo } from './webgl/WebGLInfo.js';\r\nimport { WebGLMorphtargets } from './webgl/WebGLMorphtargets.js';\r\nimport { WebGLMultisampleRenderTarget } from './WebGLMultisampleRenderTarget.js';\r\nimport { WebGLObjects } from './webgl/WebGLObjects.js';\r\nimport { WebGLPrograms } from './webgl/WebGLPrograms.js';\r\nimport { WebGLProperties } from './webgl/WebGLProperties.js';\r\nimport { WebGLRenderLists } from './webgl/WebGLRenderLists.js';\r\nimport { WebGLRenderStates } from './webgl/WebGLRenderStates.js';\r\nimport { WebGLRenderTarget } from './WebGLRenderTarget.js';\r\nimport { WebGLShadowMap } from './webgl/WebGLShadowMap.js';\r\nimport { WebGLState } from './webgl/WebGLState.js';\r\nimport { WebGLTextures } from './webgl/WebGLTextures.js';\r\nimport { WebGLUniforms } from './webgl/WebGLUniforms.js';\r\nimport { WebGLUtils } from './webgl/WebGLUtils.js';\r\nimport { WebXRManager } from './webxr/WebXRManager.js';\r\nimport { WebGLMaterials } from './webgl/WebGLMaterials.js';\r\n\r\nfunction createCanvasElement() {\r\n\r\n\tconst canvas = document.createElementNS( 'http://www.w3.org/1999/xhtml', 'canvas' );\r\n\tcanvas.style.display = 'block';\r\n\treturn canvas;\r\n\r\n}\r\n\r\nfunction WebGLRenderer( parameters = {} ) {\r\n\r\n\tconst _canvas = parameters.canvas !== undefined ? parameters.canvas : createCanvasElement(),\r\n\t\t_context = parameters.context !== undefined ? parameters.context : null,\r\n\r\n\t\t_alpha = parameters.alpha !== undefined ? parameters.alpha : false,\r\n\t\t_depth = parameters.depth !== undefined ? parameters.depth : true,\r\n\t\t_stencil = parameters.stencil !== undefined ? parameters.stencil : true,\r\n\t\t_antialias = parameters.antialias !== undefined ? parameters.antialias : false,\r\n\t\t_premultipliedAlpha = parameters.premultipliedAlpha !== undefined ? parameters.premultipliedAlpha : true,\r\n\t\t_preserveDrawingBuffer = parameters.preserveDrawingBuffer !== undefined ? parameters.preserveDrawingBuffer : false,\r\n\t\t_powerPreference = parameters.powerPreference !== undefined ? parameters.powerPreference : 'default',\r\n\t\t_failIfMajorPerformanceCaveat = parameters.failIfMajorPerformanceCaveat !== undefined ? parameters.failIfMajorPerformanceCaveat : false;\r\n\r\n\tlet currentRenderList = null;\r\n\tlet currentRenderState = null;\r\n\r\n\t// render() can be called from within a callback triggered by another render.\r\n\t// We track this so that the nested render call gets its list and state isolated from the parent render call.\r\n\r\n\tconst renderListStack = [];\r\n\tconst renderStateStack = [];\r\n\r\n\t// public properties\r\n\r\n\tthis.domElement = _canvas;\r\n\r\n\t// Debug configuration container\r\n\tthis.debug = {\r\n\r\n\t\t/**\r\n\t\t * Enables error checking and reporting when shader programs are being compiled\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tcheckShaderErrors: true\r\n\t};\r\n\r\n\t// clearing\r\n\r\n\tthis.autoClear = true;\r\n\tthis.autoClearColor = true;\r\n\tthis.autoClearDepth = true;\r\n\tthis.autoClearStencil = true;\r\n\r\n\t// scene graph\r\n\r\n\tthis.sortObjects = true;\r\n\r\n\t// user-defined clipping\r\n\r\n\tthis.clippingPlanes = [];\r\n\tthis.localClippingEnabled = false;\r\n\r\n\t// physically based shading\r\n\r\n\tthis.gammaFactor = 2.0;\t// for backwards compatibility\r\n\tthis.outputEncoding = LinearEncoding;\r\n\r\n\t// physical lights\r\n\r\n\tthis.physicallyCorrectLights = false;\r\n\r\n\t// tone mapping\r\n\r\n\tthis.toneMapping = NoToneMapping;\r\n\tthis.toneMappingExposure = 1.0;\r\n\r\n\t// internal properties\r\n\r\n\tconst _this = this;\r\n\r\n\tlet _isContextLost = false;\r\n\r\n\t// internal state cache\r\n\r\n\tlet _currentActiveCubeFace = 0;\r\n\tlet _currentActiveMipmapLevel = 0;\r\n\tlet _currentRenderTarget = null;\r\n\tlet _currentMaterialId = - 1;\r\n\r\n\tlet _currentCamera = null;\r\n\r\n\tconst _currentViewport = new Vector4();\r\n\tconst _currentScissor = new Vector4();\r\n\tlet _currentScissorTest = null;\r\n\r\n\t//\r\n\r\n\tlet _width = _canvas.width;\r\n\tlet _height = _canvas.height;\r\n\r\n\tlet _pixelRatio = 1;\r\n\tlet _opaqueSort = null;\r\n\tlet _transparentSort = null;\r\n\r\n\tconst _viewport = new Vector4( 0, 0, _width, _height );\r\n\tconst _scissor = new Vector4( 0, 0, _width, _height );\r\n\tlet _scissorTest = false;\r\n\r\n\t//\r\n\r\n\tconst _currentDrawBuffers = [];\r\n\r\n\t// frustum\r\n\r\n\tconst _frustum = new Frustum();\r\n\r\n\t// clipping\r\n\r\n\tlet _clippingEnabled = false;\r\n\tlet _localClippingEnabled = false;\r\n\r\n\t// transmission\r\n\r\n\tlet _transmissionRenderTarget = null;\r\n\r\n\t// camera matrices cache\r\n\r\n\tconst _projScreenMatrix = new Matrix4();\r\n\r\n\tconst _vector3 = new Vector3();\r\n\r\n\tconst _emptyScene = { background: null, fog: null, environment: null, overrideMaterial: null, isScene: true };\r\n\r\n\tfunction getTargetPixelRatio() {\r\n\r\n\t\treturn _currentRenderTarget === null ? _pixelRatio : 1;\r\n\r\n\t}\r\n\r\n\t// initialize\r\n\r\n\tlet _gl = _context;\r\n\r\n\tfunction getContext( contextNames, contextAttributes ) {\r\n\r\n\t\tfor ( let i = 0; i < contextNames.length; i ++ ) {\r\n\r\n\t\t\tconst contextName = contextNames[ i ];\r\n\t\t\tconst context = _canvas.getContext( contextName, contextAttributes );\r\n\t\t\tif ( context !== null ) return context;\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\ttry {\r\n\r\n\t\tconst contextAttributes = {\r\n\t\t\talpha: _alpha,\r\n\t\t\tdepth: _depth,\r\n\t\t\tstencil: _stencil,\r\n\t\t\tantialias: _antialias,\r\n\t\t\tpremultipliedAlpha: _premultipliedAlpha,\r\n\t\t\tpreserveDrawingBuffer: _preserveDrawingBuffer,\r\n\t\t\tpowerPreference: _powerPreference,\r\n\t\t\tfailIfMajorPerformanceCaveat: _failIfMajorPerformanceCaveat\r\n\t\t};\r\n\r\n\t\t// event listeners must be registered before WebGL context is created, see #12753\r\n\r\n\t\t_canvas.addEventListener( 'webglcontextlost', onContextLost, false );\r\n\t\t_canvas.addEventListener( 'webglcontextrestored', onContextRestore, false );\r\n\r\n\t\tif ( _gl === null ) {\r\n\r\n\t\t\tconst contextNames = [ 'webgl2', 'webgl', 'experimental-webgl' ];\r\n\r\n\t\t\tif ( _this.isWebGL1Renderer === true ) {\r\n\r\n\t\t\t\tcontextNames.shift();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_gl = getContext( contextNames, contextAttributes );\r\n\r\n\t\t\tif ( _gl === null ) {\r\n\r\n\t\t\t\tif ( getContext( contextNames ) ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'Error creating WebGL context with your selected attributes.' );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthrow new Error( 'Error creating WebGL context.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Some experimental-webgl implementations do not have getShaderPrecisionFormat\r\n\r\n\t\tif ( _gl.getShaderPrecisionFormat === undefined ) {\r\n\r\n\t\t\t_gl.getShaderPrecisionFormat = function () {\r\n\r\n\t\t\t\treturn { 'rangeMin': 1, 'rangeMax': 1, 'precision': 1 };\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t} catch ( error ) {\r\n\r\n\t\tconsole.error( 'THREE.WebGLRenderer: ' + error.message );\r\n\t\tthrow error;\r\n\r\n\t}\r\n\r\n\tlet extensions, capabilities, state, info;\r\n\tlet properties, textures, cubemaps, cubeuvmaps, attributes, geometries, objects;\r\n\tlet programCache, materials, renderLists, renderStates, clipping, shadowMap;\r\n\r\n\tlet background, morphtargets, bufferRenderer, indexedBufferRenderer;\r\n\r\n\tlet utils, bindingStates;\r\n\r\n\tfunction initGLContext() {\r\n\r\n\t\textensions = new WebGLExtensions( _gl );\r\n\r\n\t\tcapabilities = new WebGLCapabilities( _gl, extensions, parameters );\r\n\r\n\t\textensions.init( capabilities );\r\n\r\n\t\tutils = new WebGLUtils( _gl, extensions, capabilities );\r\n\r\n\t\tstate = new WebGLState( _gl, extensions, capabilities );\r\n\r\n\t\t_currentDrawBuffers[ 0 ] = _gl.BACK;\r\n\r\n\t\tinfo = new WebGLInfo( _gl );\r\n\t\tproperties = new WebGLProperties();\r\n\t\ttextures = new WebGLTextures( _gl, extensions, state, properties, capabilities, utils, info );\r\n\t\tcubemaps = new WebGLCubeMaps( _this );\r\n\t\tcubeuvmaps = new WebGLCubeUVMaps( _this );\r\n\t\tattributes = new WebGLAttributes( _gl, capabilities );\r\n\t\tbindingStates = new WebGLBindingStates( _gl, extensions, attributes, capabilities );\r\n\t\tgeometries = new WebGLGeometries( _gl, attributes, info, bindingStates );\r\n\t\tobjects = new WebGLObjects( _gl, geometries, attributes, info );\r\n\t\tmorphtargets = new WebGLMorphtargets( _gl );\r\n\t\tclipping = new WebGLClipping( properties );\r\n\t\tprogramCache = new WebGLPrograms( _this, cubemaps, cubeuvmaps, extensions, capabilities, bindingStates, clipping );\r\n\t\tmaterials = new WebGLMaterials( properties );\r\n\t\trenderLists = new WebGLRenderLists( properties );\r\n\t\trenderStates = new WebGLRenderStates( extensions, capabilities );\r\n\t\tbackground = new WebGLBackground( _this, cubemaps, state, objects, _premultipliedAlpha );\r\n\t\tshadowMap = new WebGLShadowMap( _this, objects, capabilities );\r\n\r\n\t\tbufferRenderer = new WebGLBufferRenderer( _gl, extensions, info, capabilities );\r\n\t\tindexedBufferRenderer = new WebGLIndexedBufferRenderer( _gl, extensions, info, capabilities );\r\n\r\n\t\tinfo.programs = programCache.programs;\r\n\r\n\t\t_this.capabilities = capabilities;\r\n\t\t_this.extensions = extensions;\r\n\t\t_this.properties = properties;\r\n\t\t_this.renderLists = renderLists;\r\n\t\t_this.shadowMap = shadowMap;\r\n\t\t_this.state = state;\r\n\t\t_this.info = info;\r\n\r\n\t}\r\n\r\n\tinitGLContext();\r\n\r\n\t// xr\r\n\r\n\tconst xr = new WebXRManager( _this, _gl );\r\n\r\n\tthis.xr = xr;\r\n\r\n\t// API\r\n\r\n\tthis.getContext = function () {\r\n\r\n\t\treturn _gl;\r\n\r\n\t};\r\n\r\n\tthis.getContextAttributes = function () {\r\n\r\n\t\treturn _gl.getContextAttributes();\r\n\r\n\t};\r\n\r\n\tthis.forceContextLoss = function () {\r\n\r\n\t\tconst extension = extensions.get( 'WEBGL_lose_context' );\r\n\t\tif ( extension ) extension.loseContext();\r\n\r\n\t};\r\n\r\n\tthis.forceContextRestore = function () {\r\n\r\n\t\tconst extension = extensions.get( 'WEBGL_lose_context' );\r\n\t\tif ( extension ) extension.restoreContext();\r\n\r\n\t};\r\n\r\n\tthis.getPixelRatio = function () {\r\n\r\n\t\treturn _pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setPixelRatio = function ( value ) {\r\n\r\n\t\tif ( value === undefined ) return;\r\n\r\n\t\t_pixelRatio = value;\r\n\r\n\t\tthis.setSize( _width, _height, false );\r\n\r\n\t};\r\n\r\n\tthis.getSize = function ( target ) {\r\n\r\n\t\treturn target.set( _width, _height );\r\n\r\n\t};\r\n\r\n\tthis.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\tif ( xr.isPresenting ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer: Can\\'t change size while VR device is presenting.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t_width = width;\r\n\t\t_height = height;\r\n\r\n\t\t_canvas.width = Math.floor( width * _pixelRatio );\r\n\t\t_canvas.height = Math.floor( height * _pixelRatio );\r\n\r\n\t\tif ( updateStyle !== false ) {\r\n\r\n\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t_canvas.style.height = height + 'px';\r\n\r\n\t\t}\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.getDrawingBufferSize = function ( target ) {\r\n\r\n\t\treturn target.set( _width * _pixelRatio, _height * _pixelRatio ).floor();\r\n\r\n\t};\r\n\r\n\tthis.setDrawingBufferSize = function ( width, height, pixelRatio ) {\r\n\r\n\t\t_width = width;\r\n\t\t_height = height;\r\n\r\n\t\t_pixelRatio = pixelRatio;\r\n\r\n\t\t_canvas.width = Math.floor( width * pixelRatio );\r\n\t\t_canvas.height = Math.floor( height * pixelRatio );\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.getCurrentViewport = function ( target ) {\r\n\r\n\t\treturn target.copy( _currentViewport );\r\n\r\n\t};\r\n\r\n\tthis.getViewport = function ( target ) {\r\n\r\n\t\treturn target.copy( _viewport );\r\n\r\n\t};\r\n\r\n\tthis.setViewport = function ( x, y, width, height ) {\r\n\r\n\t\tif ( x.isVector4 ) {\r\n\r\n\t\t\t_viewport.set( x.x, x.y, x.z, x.w );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_viewport.set( x, y, width, height );\r\n\r\n\t\t}\r\n\r\n\t\tstate.viewport( _currentViewport.copy( _viewport ).multiplyScalar( _pixelRatio ).floor() );\r\n\r\n\t};\r\n\r\n\tthis.getScissor = function ( target ) {\r\n\r\n\t\treturn target.copy( _scissor );\r\n\r\n\t};\r\n\r\n\tthis.setScissor = function ( x, y, width, height ) {\r\n\r\n\t\tif ( x.isVector4 ) {\r\n\r\n\t\t\t_scissor.set( x.x, x.y, x.z, x.w );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_scissor.set( x, y, width, height );\r\n\r\n\t\t}\r\n\r\n\t\tstate.scissor( _currentScissor.copy( _scissor ).multiplyScalar( _pixelRatio ).floor() );\r\n\r\n\t};\r\n\r\n\tthis.getScissorTest = function () {\r\n\r\n\t\treturn _scissorTest;\r\n\r\n\t};\r\n\r\n\tthis.setScissorTest = function ( boolean ) {\r\n\r\n\t\tstate.setScissorTest( _scissorTest = boolean );\r\n\r\n\t};\r\n\r\n\tthis.setOpaqueSort = function ( method ) {\r\n\r\n\t\t_opaqueSort = method;\r\n\r\n\t};\r\n\r\n\tthis.setTransparentSort = function ( method ) {\r\n\r\n\t\t_transparentSort = method;\r\n\r\n\t};\r\n\r\n\t// Clearing\r\n\r\n\tthis.getClearColor = function ( target ) {\r\n\r\n\t\treturn target.copy( background.getClearColor() );\r\n\r\n\t};\r\n\r\n\tthis.setClearColor = function () {\r\n\r\n\t\tbackground.setClearColor.apply( background, arguments );\r\n\r\n\t};\r\n\r\n\tthis.getClearAlpha = function () {\r\n\r\n\t\treturn background.getClearAlpha();\r\n\r\n\t};\r\n\r\n\tthis.setClearAlpha = function () {\r\n\r\n\t\tbackground.setClearAlpha.apply( background, arguments );\r\n\r\n\t};\r\n\r\n\tthis.clear = function ( color, depth, stencil ) {\r\n\r\n\t\tlet bits = 0;\r\n\r\n\t\tif ( color === undefined || color ) bits |= _gl.COLOR_BUFFER_BIT;\r\n\t\tif ( depth === undefined || depth ) bits |= _gl.DEPTH_BUFFER_BIT;\r\n\t\tif ( stencil === undefined || stencil ) bits |= _gl.STENCIL_BUFFER_BIT;\r\n\r\n\t\t_gl.clear( bits );\r\n\r\n\t};\r\n\r\n\tthis.clearColor = function () {\r\n\r\n\t\tthis.clear( true, false, false );\r\n\r\n\t};\r\n\r\n\tthis.clearDepth = function () {\r\n\r\n\t\tthis.clear( false, true, false );\r\n\r\n\t};\r\n\r\n\tthis.clearStencil = function () {\r\n\r\n\t\tthis.clear( false, false, true );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tthis.dispose = function () {\r\n\r\n\t\t_canvas.removeEventListener( 'webglcontextlost', onContextLost, false );\r\n\t\t_canvas.removeEventListener( 'webglcontextrestored', onContextRestore, false );\r\n\r\n\t\trenderLists.dispose();\r\n\t\trenderStates.dispose();\r\n\t\tproperties.dispose();\r\n\t\tcubemaps.dispose();\r\n\t\tcubeuvmaps.dispose();\r\n\t\tobjects.dispose();\r\n\t\tbindingStates.dispose();\r\n\r\n\t\txr.dispose();\r\n\r\n\t\txr.removeEventListener( 'sessionstart', onXRSessionStart );\r\n\t\txr.removeEventListener( 'sessionend', onXRSessionEnd );\r\n\r\n\t\tif ( _transmissionRenderTarget ) {\r\n\r\n\t\t\t_transmissionRenderTarget.dispose();\r\n\t\t\t_transmissionRenderTarget = null;\r\n\r\n\t\t}\r\n\r\n\t\tanimation.stop();\r\n\r\n\t};\r\n\r\n\t// Events\r\n\r\n\tfunction onContextLost( event ) {\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tconsole.log( 'THREE.WebGLRenderer: Context Lost.' );\r\n\r\n\t\t_isContextLost = true;\r\n\r\n\t}\r\n\r\n\tfunction onContextRestore( /* event */ ) {\r\n\r\n\t\tconsole.log( 'THREE.WebGLRenderer: Context Restored.' );\r\n\r\n\t\t_isContextLost = false;\r\n\r\n\t\tconst infoAutoReset = info.autoReset;\r\n\t\tconst shadowMapEnabled = shadowMap.enabled;\r\n\t\tconst shadowMapAutoUpdate = shadowMap.autoUpdate;\r\n\t\tconst shadowMapNeedsUpdate = shadowMap.needsUpdate;\r\n\t\tconst shadowMapType = shadowMap.type;\r\n\r\n\t\tinitGLContext();\r\n\r\n\t\tinfo.autoReset = infoAutoReset;\r\n\t\tshadowMap.enabled = shadowMapEnabled;\r\n\t\tshadowMap.autoUpdate = shadowMapAutoUpdate;\r\n\t\tshadowMap.needsUpdate = shadowMapNeedsUpdate;\r\n\t\tshadowMap.type = shadowMapType;\r\n\r\n\t}\r\n\r\n\tfunction onMaterialDispose( event ) {\r\n\r\n\t\tconst material = event.target;\r\n\r\n\t\tmaterial.removeEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\tdeallocateMaterial( material );\r\n\r\n\t}\r\n\r\n\t// Buffer deallocation\r\n\r\n\tfunction deallocateMaterial( material ) {\r\n\r\n\t\treleaseMaterialProgramReferences( material );\r\n\r\n\t\tproperties.remove( material );\r\n\r\n\t}\r\n\r\n\r\n\tfunction releaseMaterialProgramReferences( material ) {\r\n\r\n\t\tconst programs = properties.get( material ).programs;\r\n\r\n\t\tif ( programs !== undefined ) {\r\n\r\n\t\t\tprograms.forEach( function ( program ) {\r\n\r\n\t\t\t\tprogramCache.releaseProgram( program );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Buffer rendering\r\n\r\n\tfunction renderObjectImmediate( object, program ) {\r\n\r\n\t\tobject.render( function ( object ) {\r\n\r\n\t\t\t_this.renderBufferImmediate( object, program );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tthis.renderBufferImmediate = function ( object, program ) {\r\n\r\n\t\tbindingStates.initAttributes();\r\n\r\n\t\tconst buffers = properties.get( object );\r\n\r\n\t\tif ( object.hasPositions && ! buffers.position ) buffers.position = _gl.createBuffer();\r\n\t\tif ( object.hasNormals && ! buffers.normal ) buffers.normal = _gl.createBuffer();\r\n\t\tif ( object.hasUvs && ! buffers.uv ) buffers.uv = _gl.createBuffer();\r\n\t\tif ( object.hasColors && ! buffers.color ) buffers.color = _gl.createBuffer();\r\n\r\n\t\tconst programAttributes = program.getAttributes();\r\n\r\n\t\tif ( object.hasPositions ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.position );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.positionArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tbindingStates.enableAttribute( programAttributes.position );\r\n\t\t\t_gl.vertexAttribPointer( programAttributes.position, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasNormals ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.normal );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.normalArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tbindingStates.enableAttribute( programAttributes.normal );\r\n\t\t\t_gl.vertexAttribPointer( programAttributes.normal, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasUvs ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.uv );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.uvArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tbindingStates.enableAttribute( programAttributes.uv );\r\n\t\t\t_gl.vertexAttribPointer( programAttributes.uv, 2, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.hasColors ) {\r\n\r\n\t\t\t_gl.bindBuffer( _gl.ARRAY_BUFFER, buffers.color );\r\n\t\t\t_gl.bufferData( _gl.ARRAY_BUFFER, object.colorArray, _gl.DYNAMIC_DRAW );\r\n\r\n\t\t\tbindingStates.enableAttribute( programAttributes.color );\r\n\t\t\t_gl.vertexAttribPointer( programAttributes.color, 3, _gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t}\r\n\r\n\t\tbindingStates.disableUnusedAttributes();\r\n\r\n\t\t_gl.drawArrays( _gl.TRIANGLES, 0, object.count );\r\n\r\n\t\tobject.count = 0;\r\n\r\n\t};\r\n\r\n\tthis.renderBufferDirect = function ( camera, scene, geometry, material, object, group ) {\r\n\r\n\t\tif ( scene === null ) scene = _emptyScene; // renderBufferDirect second parameter used to be fog (could be null)\r\n\r\n\t\tconst frontFaceCW = ( object.isMesh && object.matrixWorld.determinant() < 0 );\r\n\r\n\t\tconst program = setProgram( camera, scene, material, object );\r\n\r\n\t\tstate.setMaterial( material, frontFaceCW );\r\n\r\n\t\t//\r\n\r\n\t\tlet index = geometry.index;\r\n\t\tconst position = geometry.attributes.position;\r\n\r\n\t\t//\r\n\r\n\t\tif ( index === null ) {\r\n\r\n\t\t\tif ( position === undefined || position.count === 0 ) return;\r\n\r\n\t\t} else if ( index.count === 0 ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tlet rangeFactor = 1;\r\n\r\n\t\tif ( material.wireframe === true ) {\r\n\r\n\t\t\tindex = geometries.getWireframeAttribute( geometry );\r\n\t\t\trangeFactor = 2;\r\n\r\n\t\t}\r\n\r\n\t\tif ( geometry.morphAttributes.position !== undefined || geometry.morphAttributes.normal !== undefined ) {\r\n\r\n\t\t\tmorphtargets.update( object, geometry, material, program );\r\n\r\n\t\t}\r\n\r\n\t\tbindingStates.setup( object, material, program, geometry, index );\r\n\r\n\t\tlet attribute;\r\n\t\tlet renderer = bufferRenderer;\r\n\r\n\t\tif ( index !== null ) {\r\n\r\n\t\t\tattribute = attributes.get( index );\r\n\r\n\t\t\trenderer = indexedBufferRenderer;\r\n\t\t\trenderer.setIndex( attribute );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tconst dataCount = ( index !== null ) ? index.count : position.count;\r\n\r\n\t\tconst rangeStart = geometry.drawRange.start * rangeFactor;\r\n\t\tconst rangeCount = geometry.drawRange.count * rangeFactor;\r\n\r\n\t\tconst groupStart = group !== null ? group.start * rangeFactor : 0;\r\n\t\tconst groupCount = group !== null ? group.count * rangeFactor : Infinity;\r\n\r\n\t\tconst drawStart = Math.max( rangeStart, groupStart );\r\n\t\tconst drawEnd = Math.min( dataCount, rangeStart + rangeCount, groupStart + groupCount ) - 1;\r\n\r\n\t\tconst drawCount = Math.max( 0, drawEnd - drawStart + 1 );\r\n\r\n\t\tif ( drawCount === 0 ) return;\r\n\r\n\t\t//\r\n\r\n\t\tif ( object.isMesh ) {\r\n\r\n\t\t\tif ( material.wireframe === true ) {\r\n\r\n\t\t\t\tstate.setLineWidth( material.wireframeLinewidth * getTargetPixelRatio() );\r\n\t\t\t\trenderer.setMode( _gl.LINES );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setMode( _gl.TRIANGLES );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object.isLine ) {\r\n\r\n\t\t\tlet lineWidth = material.linewidth;\r\n\r\n\t\t\tif ( lineWidth === undefined ) lineWidth = 1; // Not using Line*Material\r\n\r\n\t\t\tstate.setLineWidth( lineWidth * getTargetPixelRatio() );\r\n\r\n\t\t\tif ( object.isLineSegments ) {\r\n\r\n\t\t\t\trenderer.setMode( _gl.LINES );\r\n\r\n\t\t\t} else if ( object.isLineLoop ) {\r\n\r\n\t\t\t\trenderer.setMode( _gl.LINE_LOOP );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\trenderer.setMode( _gl.LINE_STRIP );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( object.isPoints ) {\r\n\r\n\t\t\trenderer.setMode( _gl.POINTS );\r\n\r\n\t\t} else if ( object.isSprite ) {\r\n\r\n\t\t\trenderer.setMode( _gl.TRIANGLES );\r\n\r\n\t\t}\r\n\r\n\t\tif ( object.isInstancedMesh ) {\r\n\r\n\t\t\trenderer.renderInstances( drawStart, drawCount, object.count );\r\n\r\n\t\t} else if ( geometry.isInstancedBufferGeometry ) {\r\n\r\n\t\t\tconst instanceCount = Math.min( geometry.instanceCount, geometry._maxInstanceCount );\r\n\r\n\t\t\trenderer.renderInstances( drawStart, drawCount, instanceCount );\r\n\r\n\t\t} else {\r\n\r\n\t\t\trenderer.render( drawStart, drawCount );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// Compile\r\n\r\n\tthis.compile = function ( scene, camera ) {\r\n\r\n\t\tcurrentRenderState = renderStates.get( scene );\r\n\t\tcurrentRenderState.init();\r\n\r\n\t\trenderStateStack.push( currentRenderState );\r\n\r\n\t\tscene.traverseVisible( function ( object ) {\r\n\r\n\t\t\tif ( object.isLight && object.layers.test( camera.layers ) ) {\r\n\r\n\t\t\t\tcurrentRenderState.pushLight( object );\r\n\r\n\t\t\t\tif ( object.castShadow ) {\r\n\r\n\t\t\t\t\tcurrentRenderState.pushShadow( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tcurrentRenderState.setupLights();\r\n\r\n\t\tscene.traverse( function ( object ) {\r\n\r\n\t\t\tconst material = object.material;\r\n\r\n\t\t\tif ( material ) {\r\n\r\n\t\t\t\tif ( Array.isArray( material ) ) {\r\n\r\n\t\t\t\t\tfor ( let i = 0; i < material.length; i ++ ) {\r\n\r\n\t\t\t\t\t\tconst material2 = material[ i ];\r\n\r\n\t\t\t\t\t\tgetProgram( material2, scene, object );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tgetProgram( material, scene, object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\trenderStateStack.pop();\r\n\t\tcurrentRenderState = null;\r\n\r\n\t};\r\n\r\n\t// Animation Loop\r\n\r\n\tlet onAnimationFrameCallback = null;\r\n\r\n\tfunction onAnimationFrame( time ) {\r\n\r\n\t\tif ( onAnimationFrameCallback ) onAnimationFrameCallback( time );\r\n\r\n\t}\r\n\r\n\tfunction onXRSessionStart() {\r\n\r\n\t\tanimation.stop();\r\n\r\n\t}\r\n\r\n\tfunction onXRSessionEnd() {\r\n\r\n\t\tanimation.start();\r\n\r\n\t}\r\n\r\n\tconst animation = new WebGLAnimation();\r\n\tanimation.setAnimationLoop( onAnimationFrame );\r\n\r\n\tif ( typeof window !== 'undefined' ) animation.setContext( window );\r\n\r\n\tthis.setAnimationLoop = function ( callback ) {\r\n\r\n\t\tonAnimationFrameCallback = callback;\r\n\t\txr.setAnimationLoop( callback );\r\n\r\n\t\t( callback === null ) ? animation.stop() : animation.start();\r\n\r\n\t};\r\n\r\n\txr.addEventListener( 'sessionstart', onXRSessionStart );\r\n\txr.addEventListener( 'sessionend', onXRSessionEnd );\r\n\r\n\t// Rendering\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( camera !== undefined && camera.isCamera !== true ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( _isContextLost === true ) return;\r\n\r\n\t\t// update scene graph\r\n\r\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\r\n\t\t// update camera matrices and frustum\r\n\r\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\tif ( xr.enabled === true && xr.isPresenting === true ) {\r\n\r\n\t\t\tif ( xr.cameraAutoUpdate === true ) xr.updateCamera( camera );\r\n\r\n\t\t\tcamera = xr.getCamera(); // use XR camera for rendering\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\t\tif ( scene.isScene === true ) scene.onBeforeRender( _this, scene, camera, _currentRenderTarget );\r\n\r\n\t\tcurrentRenderState = renderStates.get( scene, renderStateStack.length );\r\n\t\tcurrentRenderState.init();\r\n\r\n\t\trenderStateStack.push( currentRenderState );\r\n\r\n\t\t_projScreenMatrix.multiplyMatrices( camera.projectionMatrix, camera.matrixWorldInverse );\r\n\t\t_frustum.setFromProjectionMatrix( _projScreenMatrix );\r\n\r\n\t\t_localClippingEnabled = this.localClippingEnabled;\r\n\t\t_clippingEnabled = clipping.init( this.clippingPlanes, _localClippingEnabled, camera );\r\n\r\n\t\tcurrentRenderList = renderLists.get( scene, renderListStack.length );\r\n\t\tcurrentRenderList.init();\r\n\r\n\t\trenderListStack.push( currentRenderList );\r\n\r\n\t\tprojectObject( scene, camera, 0, _this.sortObjects );\r\n\r\n\t\tcurrentRenderList.finish();\r\n\r\n\t\tif ( _this.sortObjects === true ) {\r\n\r\n\t\t\tcurrentRenderList.sort( _opaqueSort, _transparentSort );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( _clippingEnabled === true ) clipping.beginShadows();\r\n\r\n\t\tconst shadowsArray = currentRenderState.state.shadowsArray;\r\n\r\n\t\tshadowMap.render( shadowsArray, scene, camera );\r\n\r\n\t\tcurrentRenderState.setupLights();\r\n\t\tcurrentRenderState.setupLightsView( camera );\r\n\r\n\t\tif ( _clippingEnabled === true ) clipping.endShadows();\r\n\r\n\t\t//\r\n\r\n\t\tif ( this.info.autoReset === true ) this.info.reset();\r\n\r\n\t\t//\r\n\r\n\t\tbackground.render( currentRenderList, scene );\r\n\r\n\t\t// render scene\r\n\r\n\t\tconst opaqueObjects = currentRenderList.opaque;\r\n\t\tconst transmissiveObjects = currentRenderList.transmissive;\r\n\t\tconst transparentObjects = currentRenderList.transparent;\r\n\r\n\t\tif ( opaqueObjects.length > 0 ) renderObjects( opaqueObjects, scene, camera );\r\n\t\tif ( transmissiveObjects.length > 0 ) renderTransmissiveObjects( opaqueObjects, transmissiveObjects, scene, camera );\r\n\t\tif ( transparentObjects.length > 0 ) renderObjects( transparentObjects, scene, camera );\r\n\r\n\t\t//\r\n\r\n\t\tif ( _currentRenderTarget !== null ) {\r\n\r\n\t\t\t// resolve multisample renderbuffers to a single-sample texture if necessary\r\n\r\n\t\t\ttextures.updateMultisampleRenderTarget( _currentRenderTarget );\r\n\r\n\t\t\t// Generate mipmap if we're using any kind of mipmap filtering\r\n\r\n\t\t\ttextures.updateRenderTargetMipmap( _currentRenderTarget );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tif ( scene.isScene === true ) scene.onAfterRender( _this, scene, camera );\r\n\r\n\t\t// Ensure depth buffer writing is enabled so it can be cleared on next render\r\n\r\n\t\tstate.buffers.depth.setTest( true );\r\n\t\tstate.buffers.depth.setMask( true );\r\n\t\tstate.buffers.color.setMask( true );\r\n\r\n\t\tstate.setPolygonOffset( false );\r\n\r\n\t\t// _gl.finish();\r\n\r\n\t\tbindingStates.resetDefaultState();\r\n\t\t_currentMaterialId = - 1;\r\n\t\t_currentCamera = null;\r\n\r\n\t\trenderStateStack.pop();\r\n\r\n\t\tif ( renderStateStack.length > 0 ) {\r\n\r\n\t\t\tcurrentRenderState = renderStateStack[ renderStateStack.length - 1 ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcurrentRenderState = null;\r\n\r\n\t\t}\r\n\r\n\t\trenderListStack.pop();\r\n\r\n\t\tif ( renderListStack.length > 0 ) {\r\n\r\n\t\t\tcurrentRenderList = renderListStack[ renderListStack.length - 1 ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\tcurrentRenderList = null;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction projectObject( object, camera, groupOrder, sortObjects ) {\r\n\r\n\t\tif ( object.visible === false ) return;\r\n\r\n\t\tconst visible = object.layers.test( camera.layers );\r\n\r\n\t\tif ( visible ) {\r\n\r\n\t\t\tif ( object.isGroup ) {\r\n\r\n\t\t\t\tgroupOrder = object.renderOrder;\r\n\r\n\t\t\t} else if ( object.isLOD ) {\r\n\r\n\t\t\t\tif ( object.autoUpdate === true ) object.update( camera );\r\n\r\n\t\t\t} else if ( object.isLight ) {\r\n\r\n\t\t\t\tcurrentRenderState.pushLight( object );\r\n\r\n\t\t\t\tif ( object.castShadow ) {\r\n\r\n\t\t\t\t\tcurrentRenderState.pushShadow( object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object.isSprite ) {\r\n\r\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsSprite( object ) ) {\r\n\r\n\t\t\t\t\tif ( sortObjects ) {\r\n\r\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\r\n\t\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst geometry = objects.update( object );\r\n\t\t\t\t\tconst material = object.material;\r\n\r\n\t\t\t\t\tif ( material.visible ) {\r\n\r\n\t\t\t\t\t\tcurrentRenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object.isImmediateRenderObject ) {\r\n\r\n\t\t\t\tif ( sortObjects ) {\r\n\r\n\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\r\n\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcurrentRenderList.push( object, null, object.material, groupOrder, _vector3.z, null );\r\n\r\n\t\t\t} else if ( object.isMesh || object.isLine || object.isPoints ) {\r\n\r\n\t\t\t\tif ( object.isSkinnedMesh ) {\r\n\r\n\t\t\t\t\t// update skeleton only once in a frame\r\n\r\n\t\t\t\t\tif ( object.skeleton.frame !== info.render.frame ) {\r\n\r\n\t\t\t\t\t\tobject.skeleton.update();\r\n\t\t\t\t\t\tobject.skeleton.frame = info.render.frame;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( ! object.frustumCulled || _frustum.intersectsObject( object ) ) {\r\n\r\n\t\t\t\t\tif ( sortObjects ) {\r\n\r\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld )\r\n\t\t\t\t\t\t\t.applyMatrix4( _projScreenMatrix );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst geometry = objects.update( object );\r\n\t\t\t\t\tconst material = object.material;\r\n\r\n\t\t\t\t\tif ( Array.isArray( material ) ) {\r\n\r\n\t\t\t\t\t\tconst groups = geometry.groups;\r\n\r\n\t\t\t\t\t\tfor ( let i = 0, l = groups.length; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t\t\tconst group = groups[ i ];\r\n\t\t\t\t\t\t\tconst groupMaterial = material[ group.materialIndex ];\r\n\r\n\t\t\t\t\t\t\tif ( groupMaterial && groupMaterial.visible ) {\r\n\r\n\t\t\t\t\t\t\t\tcurrentRenderList.push( object, geometry, groupMaterial, groupOrder, _vector3.z, group );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else if ( material.visible ) {\r\n\r\n\t\t\t\t\t\tcurrentRenderList.push( object, geometry, material, groupOrder, _vector3.z, null );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tconst children = object.children;\r\n\r\n\t\tfor ( let i = 0, l = children.length; i < l; i ++ ) {\r\n\r\n\t\t\tprojectObject( children[ i ], camera, groupOrder, sortObjects );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderTransmissiveObjects( opaqueObjects, transmissiveObjects, scene, camera ) {\r\n\r\n\t\tif ( _transmissionRenderTarget === null ) {\r\n\r\n\t\t\tconst needsAntialias = _antialias === true && capabilities.isWebGL2 === true;\r\n\t\t\tconst renderTargetType = needsAntialias ? WebGLMultisampleRenderTarget : WebGLRenderTarget;\r\n\r\n\t\t\t_transmissionRenderTarget = new renderTargetType( 1024, 1024, {\r\n\t\t\t\tgenerateMipmaps: true,\r\n\t\t\t\ttype: utils.convert( HalfFloatType ) !== null ? HalfFloatType : UnsignedByteType,\r\n\t\t\t\tminFilter: LinearMipmapLinearFilter,\r\n\t\t\t\tmagFilter: NearestFilter,\r\n\t\t\t\twrapS: ClampToEdgeWrapping,\r\n\t\t\t\twrapT: ClampToEdgeWrapping\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tconst currentRenderTarget = _this.getRenderTarget();\r\n\t\t_this.setRenderTarget( _transmissionRenderTarget );\r\n\t\t_this.clear();\r\n\r\n\t\t// Turn off the features which can affect the frag color for opaque objects pass.\r\n\t\t// Otherwise they are applied twice in opaque objects pass and transmission objects pass.\r\n\t\tconst currentToneMapping = _this.toneMapping;\r\n\t\t_this.toneMapping = NoToneMapping;\r\n\r\n\t\trenderObjects( opaqueObjects, scene, camera );\r\n\r\n\t\t_this.toneMapping = currentToneMapping;\r\n\r\n\t\ttextures.updateMultisampleRenderTarget( _transmissionRenderTarget );\r\n\t\ttextures.updateRenderTargetMipmap( _transmissionRenderTarget );\r\n\r\n\t\t_this.setRenderTarget( currentRenderTarget );\r\n\r\n\t\trenderObjects( transmissiveObjects, scene, camera );\r\n\r\n\t}\r\n\r\n\tfunction renderObjects( renderList, scene, camera ) {\r\n\r\n\t\tconst overrideMaterial = scene.isScene === true ? scene.overrideMaterial : null;\r\n\r\n\t\tif ( camera.isArrayCamera ) {\r\n\r\n\t\t\tconst cameras = camera.cameras;\r\n\r\n\t\t\tfor ( let i = 0, l = cameras.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tconst camera2 = cameras[ i ];\r\n\r\n\t\t\t\tstate.viewport( _currentViewport.copy( camera2.viewport ) );\r\n\r\n\t\t\t\tcurrentRenderState.setupLightsView( camera2 );\r\n\r\n\t\t\t\tfor ( let j = 0, jl = renderList.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\t\tconst renderItem = renderList[ j ];\r\n\r\n\t\t\t\t\tconst object = renderItem.object;\r\n\t\t\t\t\tconst geometry = renderItem.geometry;\r\n\t\t\t\t\tconst material = overrideMaterial === null ? renderItem.material : overrideMaterial;\r\n\t\t\t\t\tconst group = renderItem.group;\r\n\r\n\t\t\t\t\tif ( object.layers.test( camera2.layers ) ) {\r\n\r\n\t\t\t\t\t\trenderObject( object, scene, camera2, geometry, material, group );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tfor ( let j = 0, jl = renderList.length; j < jl; j ++ ) {\r\n\r\n\t\t\t\tconst renderItem = renderList[ j ];\r\n\r\n\t\t\t\tconst object = renderItem.object;\r\n\t\t\t\tconst geometry = renderItem.geometry;\r\n\t\t\t\tconst material = overrideMaterial === null ? renderItem.material : overrideMaterial;\r\n\t\t\t\tconst group = renderItem.group;\r\n\r\n\t\t\t\trenderObject( object, scene, camera, geometry, material, group );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderObject( object, scene, camera, geometry, material, group ) {\r\n\r\n\t\tobject.onBeforeRender( _this, scene, camera, geometry, material, group );\r\n\r\n\t\tobject.modelViewMatrix.multiplyMatrices( camera.matrixWorldInverse, object.matrixWorld );\r\n\t\tobject.normalMatrix.getNormalMatrix( object.modelViewMatrix );\r\n\r\n\t\tif ( object.isImmediateRenderObject ) {\r\n\r\n\t\t\tconst program = setProgram( camera, scene, material, object );\r\n\r\n\t\t\tstate.setMaterial( material );\r\n\r\n\t\t\tbindingStates.reset();\r\n\r\n\t\t\trenderObjectImmediate( object, program );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( material.transparent === true && material.side === DoubleSide ) {\r\n\r\n\t\t\t\tmaterial.side = BackSide;\r\n\t\t\t\tmaterial.needsUpdate = true;\r\n\t\t\t\t_this.renderBufferDirect( camera, scene, geometry, material, object, group );\r\n\r\n\t\t\t\tmaterial.side = FrontSide;\r\n\t\t\t\tmaterial.needsUpdate = true;\r\n\t\t\t\t_this.renderBufferDirect( camera, scene, geometry, material, object, group );\r\n\r\n\t\t\t\tmaterial.side = DoubleSide;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_this.renderBufferDirect( camera, scene, geometry, material, object, group );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tobject.onAfterRender( _this, scene, camera, geometry, material, group );\r\n\r\n\t}\r\n\r\n\tfunction getProgram( material, scene, object ) {\r\n\r\n\t\tif ( scene.isScene !== true ) scene = _emptyScene; // scene could be a Mesh, Line, Points, ...\r\n\r\n\t\tconst materialProperties = properties.get( material );\r\n\r\n\t\tconst lights = currentRenderState.state.lights;\r\n\t\tconst shadowsArray = currentRenderState.state.shadowsArray;\r\n\r\n\t\tconst lightsStateVersion = lights.state.version;\r\n\r\n\t\tconst parameters = programCache.getParameters( material, lights.state, shadowsArray, scene, object );\r\n\t\tconst programCacheKey = programCache.getProgramCacheKey( parameters );\r\n\r\n\t\tlet programs = materialProperties.programs;\r\n\r\n\t\t// always update environment and fog - changing these trigger an getProgram call, but it's possible that the program doesn't change\r\n\r\n\t\tmaterialProperties.environment = material.isMeshStandardMaterial ? scene.environment : null;\r\n\t\tmaterialProperties.fog = scene.fog;\r\n\t\tmaterialProperties.envMap = ( material.isMeshStandardMaterial ? cubeuvmaps : cubemaps ).get( material.envMap || materialProperties.environment );\r\n\r\n\t\tif ( programs === undefined ) {\r\n\r\n\t\t\t// new material\r\n\r\n\t\t\tmaterial.addEventListener( 'dispose', onMaterialDispose );\r\n\r\n\t\t\tprograms = new Map();\r\n\t\t\tmaterialProperties.programs = programs;\r\n\r\n\t\t}\r\n\r\n\t\tlet program = programs.get( programCacheKey );\r\n\r\n\t\tif ( program !== undefined ) {\r\n\r\n\t\t\t// early out if program and light state is identical\r\n\r\n\t\t\tif ( materialProperties.currentProgram === program && materialProperties.lightsStateVersion === lightsStateVersion ) {\r\n\r\n\t\t\t\tupdateCommonMaterialProperties( material, parameters );\r\n\r\n\t\t\t\treturn program;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tparameters.uniforms = programCache.getUniforms( material );\r\n\r\n\t\t\tmaterial.onBuild( parameters, _this );\r\n\r\n\t\t\tmaterial.onBeforeCompile( parameters, _this );\r\n\r\n\t\t\tprogram = programCache.acquireProgram( parameters, programCacheKey );\r\n\t\t\tprograms.set( programCacheKey, program );\r\n\r\n\t\t\tmaterialProperties.uniforms = parameters.uniforms;\r\n\r\n\t\t}\r\n\r\n\t\tconst uniforms = materialProperties.uniforms;\r\n\r\n\t\tif ( ( ! material.isShaderMaterial && ! material.isRawShaderMaterial ) || material.clipping === true ) {\r\n\r\n\t\t\tuniforms.clippingPlanes = clipping.uniform;\r\n\r\n\t\t}\r\n\r\n\t\tupdateCommonMaterialProperties( material, parameters );\r\n\r\n\t\t// store the light setup it was created for\r\n\r\n\t\tmaterialProperties.needsLights = materialNeedsLights( material );\r\n\t\tmaterialProperties.lightsStateVersion = lightsStateVersion;\r\n\r\n\t\tif ( materialProperties.needsLights ) {\r\n\r\n\t\t\t// wire up the material to this renderer's lighting state\r\n\r\n\t\t\tuniforms.ambientLightColor.value = lights.state.ambient;\r\n\t\t\tuniforms.lightProbe.value = lights.state.probe;\r\n\t\t\tuniforms.directionalLights.value = lights.state.directional;\r\n\t\t\tuniforms.directionalLightShadows.value = lights.state.directionalShadow;\r\n\t\t\tuniforms.spotLights.value = lights.state.spot;\r\n\t\t\tuniforms.spotLightShadows.value = lights.state.spotShadow;\r\n\t\t\tuniforms.rectAreaLights.value = lights.state.rectArea;\r\n\t\t\tuniforms.ltc_1.value = lights.state.rectAreaLTC1;\r\n\t\t\tuniforms.ltc_2.value = lights.state.rectAreaLTC2;\r\n\t\t\tuniforms.pointLights.value = lights.state.point;\r\n\t\t\tuniforms.pointLightShadows.value = lights.state.pointShadow;\r\n\t\t\tuniforms.hemisphereLights.value = lights.state.hemi;\r\n\r\n\t\t\tuniforms.directionalShadowMap.value = lights.state.directionalShadowMap;\r\n\t\t\tuniforms.directionalShadowMatrix.value = lights.state.directionalShadowMatrix;\r\n\t\t\tuniforms.spotShadowMap.value = lights.state.spotShadowMap;\r\n\t\t\tuniforms.spotShadowMatrix.value = lights.state.spotShadowMatrix;\r\n\t\t\tuniforms.pointShadowMap.value = lights.state.pointShadowMap;\r\n\t\t\tuniforms.pointShadowMatrix.value = lights.state.pointShadowMatrix;\r\n\t\t\t// TODO (abelnation): add area lights shadow info to uniforms\r\n\r\n\t\t}\r\n\r\n\t\tconst progUniforms = program.getUniforms();\r\n\t\tconst uniformsList = WebGLUniforms.seqWithValue( progUniforms.seq, uniforms );\r\n\r\n\t\tmaterialProperties.currentProgram = program;\r\n\t\tmaterialProperties.uniformsList = uniformsList;\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tfunction updateCommonMaterialProperties( material, parameters ) {\r\n\r\n\t\tconst materialProperties = properties.get( material );\r\n\r\n\t\tmaterialProperties.outputEncoding = parameters.outputEncoding;\r\n\t\tmaterialProperties.instancing = parameters.instancing;\r\n\t\tmaterialProperties.skinning = parameters.skinning;\r\n\t\tmaterialProperties.morphTargets = parameters.morphTargets;\r\n\t\tmaterialProperties.morphNormals = parameters.morphNormals;\r\n\t\tmaterialProperties.numClippingPlanes = parameters.numClippingPlanes;\r\n\t\tmaterialProperties.numIntersection = parameters.numClipIntersection;\r\n\t\tmaterialProperties.vertexAlphas = parameters.vertexAlphas;\r\n\t\tmaterialProperties.vertexTangents = parameters.vertexTangents;\r\n\r\n\t}\r\n\r\n\tfunction setProgram( camera, scene, material, object ) {\r\n\r\n\t\tif ( scene.isScene !== true ) scene = _emptyScene; // scene could be a Mesh, Line, Points, ...\r\n\r\n\t\ttextures.resetTextureUnits();\r\n\r\n\t\tconst fog = scene.fog;\r\n\t\tconst environment = material.isMeshStandardMaterial ? scene.environment : null;\r\n\t\tconst encoding = ( _currentRenderTarget === null ) ? _this.outputEncoding : _currentRenderTarget.texture.encoding;\r\n\t\tconst envMap = ( material.isMeshStandardMaterial ? cubeuvmaps : cubemaps ).get( material.envMap || environment );\r\n\t\tconst vertexAlphas = material.vertexColors === true && !! object.geometry && !! object.geometry.attributes.color && object.geometry.attributes.color.itemSize === 4;\r\n\t\tconst vertexTangents = !! object.geometry && !! object.geometry.attributes.tangent;\r\n\t\tconst morphTargets = !! object.geometry && !! object.geometry.morphAttributes.position;\r\n\t\tconst morphNormals = !! object.geometry && !! object.geometry.morphAttributes.normal;\r\n\r\n\t\tconst materialProperties = properties.get( material );\r\n\t\tconst lights = currentRenderState.state.lights;\r\n\r\n\t\tif ( _clippingEnabled === true ) {\r\n\r\n\t\t\tif ( _localClippingEnabled === true || camera !== _currentCamera ) {\r\n\r\n\t\t\t\tconst useCache =\r\n\t\t\t\t\tcamera === _currentCamera &&\r\n\t\t\t\t\tmaterial.id === _currentMaterialId;\r\n\r\n\t\t\t\t// we might want to call this function with some ClippingGroup\r\n\t\t\t\t// object instead of the material, once it becomes feasible\r\n\t\t\t\t// (#8465, #8379)\r\n\t\t\t\tclipping.setState( material, camera, useCache );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tlet needsProgramChange = false;\r\n\r\n\t\tif ( material.version === materialProperties.__version ) {\r\n\r\n\t\t\tif ( materialProperties.needsLights && ( materialProperties.lightsStateVersion !== lights.state.version ) ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.outputEncoding !== encoding ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( object.isInstancedMesh && materialProperties.instancing === false ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( ! object.isInstancedMesh && materialProperties.instancing === true ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( object.isSkinnedMesh && materialProperties.skinning === false ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( ! object.isSkinnedMesh && materialProperties.skinning === true ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.envMap !== envMap ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( material.fog && materialProperties.fog !== fog ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.numClippingPlanes !== undefined &&\r\n\t\t\t\t( materialProperties.numClippingPlanes !== clipping.numPlanes ||\r\n\t\t\t\tmaterialProperties.numIntersection !== clipping.numIntersection ) ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.vertexAlphas !== vertexAlphas ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.vertexTangents !== vertexTangents ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.morphTargets !== morphTargets ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t} else if ( materialProperties.morphNormals !== morphNormals ) {\r\n\r\n\t\t\t\tneedsProgramChange = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tneedsProgramChange = true;\r\n\t\t\tmaterialProperties.__version = material.version;\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tlet program = materialProperties.currentProgram;\r\n\r\n\t\tif ( needsProgramChange === true ) {\r\n\r\n\t\t\tprogram = getProgram( material, scene, object );\r\n\r\n\t\t}\r\n\r\n\t\tlet refreshProgram = false;\r\n\t\tlet refreshMaterial = false;\r\n\t\tlet refreshLights = false;\r\n\r\n\t\tconst p_uniforms = program.getUniforms(),\r\n\t\t\tm_uniforms = materialProperties.uniforms;\r\n\r\n\t\tif ( state.useProgram( program.program ) ) {\r\n\r\n\t\t\trefreshProgram = true;\r\n\t\t\trefreshMaterial = true;\r\n\t\t\trefreshLights = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.id !== _currentMaterialId ) {\r\n\r\n\t\t\t_currentMaterialId = material.id;\r\n\r\n\t\t\trefreshMaterial = true;\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshProgram || _currentCamera !== camera ) {\r\n\r\n\t\t\tp_uniforms.setValue( _gl, 'projectionMatrix', camera.projectionMatrix );\r\n\r\n\t\t\tif ( capabilities.logarithmicDepthBuffer ) {\r\n\r\n\t\t\t\tp_uniforms.setValue( _gl, 'logDepthBufFC',\r\n\t\t\t\t\t2.0 / ( Math.log( camera.far + 1.0 ) / Math.LN2 ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _currentCamera !== camera ) {\r\n\r\n\t\t\t\t_currentCamera = camera;\r\n\r\n\t\t\t\t// lighting uniforms depend on the camera so enforce an update\r\n\t\t\t\t// now, in case this material supports lights - or later, when\r\n\t\t\t\t// the next material that does gets activated:\r\n\r\n\t\t\t\trefreshMaterial = true;\t\t// set to true on material change\r\n\t\t\t\trefreshLights = true;\t\t// remains set until update done\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// load material specific uniforms\r\n\t\t\t// (shader material also gets them for the sake of genericity)\r\n\r\n\t\t\tif ( material.isShaderMaterial ||\r\n\t\t\t\tmaterial.isMeshPhongMaterial ||\r\n\t\t\t\tmaterial.isMeshToonMaterial ||\r\n\t\t\t\tmaterial.isMeshStandardMaterial ||\r\n\t\t\t\tmaterial.envMap ) {\r\n\r\n\t\t\t\tconst uCamPos = p_uniforms.map.cameraPosition;\r\n\r\n\t\t\t\tif ( uCamPos !== undefined ) {\r\n\r\n\t\t\t\t\tuCamPos.setValue( _gl,\r\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( camera.matrixWorld ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material.isMeshPhongMaterial ||\r\n\t\t\t\tmaterial.isMeshToonMaterial ||\r\n\t\t\t\tmaterial.isMeshLambertMaterial ||\r\n\t\t\t\tmaterial.isMeshBasicMaterial ||\r\n\t\t\t\tmaterial.isMeshStandardMaterial ||\r\n\t\t\t\tmaterial.isShaderMaterial ) {\r\n\r\n\t\t\t\tp_uniforms.setValue( _gl, 'isOrthographic', camera.isOrthographicCamera === true );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( material.isMeshPhongMaterial ||\r\n\t\t\t\tmaterial.isMeshToonMaterial ||\r\n\t\t\t\tmaterial.isMeshLambertMaterial ||\r\n\t\t\t\tmaterial.isMeshBasicMaterial ||\r\n\t\t\t\tmaterial.isMeshStandardMaterial ||\r\n\t\t\t\tmaterial.isShaderMaterial ||\r\n\t\t\t\tmaterial.isShadowMaterial ||\r\n\t\t\t\tobject.isSkinnedMesh ) {\r\n\r\n\t\t\t\tp_uniforms.setValue( _gl, 'viewMatrix', camera.matrixWorldInverse );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// skinning uniforms must be set even if material didn't change\r\n\t\t// auto-setting of texture unit for bone texture must go before other textures\r\n\t\t// otherwise textures used for skinning can take over texture units reserved for other material textures\r\n\r\n\t\tif ( object.isSkinnedMesh ) {\r\n\r\n\t\t\tp_uniforms.setOptional( _gl, object, 'bindMatrix' );\r\n\t\t\tp_uniforms.setOptional( _gl, object, 'bindMatrixInverse' );\r\n\r\n\t\t\tconst skeleton = object.skeleton;\r\n\r\n\t\t\tif ( skeleton ) {\r\n\r\n\t\t\t\tif ( capabilities.floatVertexTextures ) {\r\n\r\n\t\t\t\t\tif ( skeleton.boneTexture === null ) skeleton.computeBoneTexture();\r\n\r\n\t\t\t\t\tp_uniforms.setValue( _gl, 'boneTexture', skeleton.boneTexture, textures );\r\n\t\t\t\t\tp_uniforms.setValue( _gl, 'boneTextureSize', skeleton.boneTextureSize );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tp_uniforms.setOptional( _gl, skeleton, 'boneMatrices' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshMaterial || materialProperties.receiveShadow !== object.receiveShadow ) {\r\n\r\n\t\t\tmaterialProperties.receiveShadow = object.receiveShadow;\r\n\t\t\tp_uniforms.setValue( _gl, 'receiveShadow', object.receiveShadow );\r\n\r\n\t\t}\r\n\r\n\t\tif ( refreshMaterial ) {\r\n\r\n\t\t\tp_uniforms.setValue( _gl, 'toneMappingExposure', _this.toneMappingExposure );\r\n\r\n\t\t\tif ( materialProperties.needsLights ) {\r\n\r\n\t\t\t\t// the current material requires lighting info\r\n\r\n\t\t\t\t// note: all lighting uniforms are always set correctly\r\n\t\t\t\t// they simply reference the renderer's state for their\r\n\t\t\t\t// values\r\n\t\t\t\t//\r\n\t\t\t\t// use the current material's .needsUpdate flags to set\r\n\t\t\t\t// the GL state when required\r\n\r\n\t\t\t\tmarkUniformsLightsNeedsUpdate( m_uniforms, refreshLights );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// refresh uniforms common to several materials\r\n\r\n\t\t\tif ( fog && material.fog ) {\r\n\r\n\t\t\t\tmaterials.refreshFogUniforms( m_uniforms, fog );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tmaterials.refreshMaterialUniforms( m_uniforms, material, _pixelRatio, _height, _transmissionRenderTarget );\r\n\r\n\t\t\tWebGLUniforms.upload( _gl, materialProperties.uniformsList, m_uniforms, textures );\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.isShaderMaterial && material.uniformsNeedUpdate === true ) {\r\n\r\n\t\t\tWebGLUniforms.upload( _gl, materialProperties.uniformsList, m_uniforms, textures );\r\n\t\t\tmaterial.uniformsNeedUpdate = false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( material.isSpriteMaterial ) {\r\n\r\n\t\t\tp_uniforms.setValue( _gl, 'center', object.center );\r\n\r\n\t\t}\r\n\r\n\t\t// common matrices\r\n\r\n\t\tp_uniforms.setValue( _gl, 'modelViewMatrix', object.modelViewMatrix );\r\n\t\tp_uniforms.setValue( _gl, 'normalMatrix', object.normalMatrix );\r\n\t\tp_uniforms.setValue( _gl, 'modelMatrix', object.matrixWorld );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\t// If uniforms are marked as clean, they don't need to be loaded to the GPU.\r\n\r\n\tfunction markUniformsLightsNeedsUpdate( uniforms, value ) {\r\n\r\n\t\tuniforms.ambientLightColor.needsUpdate = value;\r\n\t\tuniforms.lightProbe.needsUpdate = value;\r\n\r\n\t\tuniforms.directionalLights.needsUpdate = value;\r\n\t\tuniforms.directionalLightShadows.needsUpdate = value;\r\n\t\tuniforms.pointLights.needsUpdate = value;\r\n\t\tuniforms.pointLightShadows.needsUpdate = value;\r\n\t\tuniforms.spotLights.needsUpdate = value;\r\n\t\tuniforms.spotLightShadows.needsUpdate = value;\r\n\t\tuniforms.rectAreaLights.needsUpdate = value;\r\n\t\tuniforms.hemisphereLights.needsUpdate = value;\r\n\r\n\t}\r\n\r\n\tfunction materialNeedsLights( material ) {\r\n\r\n\t\treturn material.isMeshLambertMaterial || material.isMeshToonMaterial || material.isMeshPhongMaterial ||\r\n\t\t\tmaterial.isMeshStandardMaterial || material.isShadowMaterial ||\r\n\t\t\t( material.isShaderMaterial && material.lights === true );\r\n\r\n\t}\r\n\r\n\tthis.getActiveCubeFace = function () {\r\n\r\n\t\treturn _currentActiveCubeFace;\r\n\r\n\t};\r\n\r\n\tthis.getActiveMipmapLevel = function () {\r\n\r\n\t\treturn _currentActiveMipmapLevel;\r\n\r\n\t};\r\n\r\n\tthis.getRenderTarget = function () {\r\n\r\n\t\treturn _currentRenderTarget;\r\n\r\n\t};\r\n\r\n\tthis.setRenderTarget = function ( renderTarget, activeCubeFace = 0, activeMipmapLevel = 0 ) {\r\n\r\n\t\t_currentRenderTarget = renderTarget;\r\n\t\t_currentActiveCubeFace = activeCubeFace;\r\n\t\t_currentActiveMipmapLevel = activeMipmapLevel;\r\n\r\n\t\tif ( renderTarget && properties.get( renderTarget ).__webglFramebuffer === undefined ) {\r\n\r\n\t\t\ttextures.setupRenderTarget( renderTarget );\r\n\r\n\t\t}\r\n\r\n\t\tlet framebuffer = null;\r\n\t\tlet isCube = false;\r\n\t\tlet isRenderTarget3D = false;\r\n\r\n\t\tif ( renderTarget ) {\r\n\r\n\t\t\tconst texture = renderTarget.texture;\r\n\r\n\t\t\tif ( texture.isDataTexture3D || texture.isDataTexture2DArray ) {\r\n\r\n\t\t\t\tisRenderTarget3D = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst __webglFramebuffer = properties.get( renderTarget ).__webglFramebuffer;\r\n\r\n\t\t\tif ( renderTarget.isWebGLCubeRenderTarget ) {\r\n\r\n\t\t\t\tframebuffer = __webglFramebuffer[ activeCubeFace ];\r\n\t\t\t\tisCube = true;\r\n\r\n\t\t\t} else if ( renderTarget.isWebGLMultisampleRenderTarget ) {\r\n\r\n\t\t\t\tframebuffer = properties.get( renderTarget ).__webglMultisampledFramebuffer;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tframebuffer = __webglFramebuffer;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_currentViewport.copy( renderTarget.viewport );\r\n\t\t\t_currentScissor.copy( renderTarget.scissor );\r\n\t\t\t_currentScissorTest = renderTarget.scissorTest;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_currentViewport.copy( _viewport ).multiplyScalar( _pixelRatio ).floor();\r\n\t\t\t_currentScissor.copy( _scissor ).multiplyScalar( _pixelRatio ).floor();\r\n\t\t\t_currentScissorTest = _scissorTest;\r\n\r\n\t\t}\r\n\r\n\t\tconst framebufferBound = state.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\r\n\t\tif ( framebufferBound && capabilities.drawBuffers ) {\r\n\r\n\t\t\tlet needsUpdate = false;\r\n\r\n\t\t\tif ( renderTarget ) {\r\n\r\n\t\t\t\tif ( renderTarget.isWebGLMultipleRenderTargets ) {\r\n\r\n\t\t\t\t\tconst textures = renderTarget.texture;\r\n\r\n\t\t\t\t\tif ( _currentDrawBuffers.length !== textures.length || _currentDrawBuffers[ 0 ] !== _gl.COLOR_ATTACHMENT0 ) {\r\n\r\n\t\t\t\t\t\tfor ( let i = 0, il = textures.length; i < il; i ++ ) {\r\n\r\n\t\t\t\t\t\t\t_currentDrawBuffers[ i ] = _gl.COLOR_ATTACHMENT0 + i;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_currentDrawBuffers.length = textures.length;\r\n\r\n\t\t\t\t\t\tneedsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif ( _currentDrawBuffers.length !== 1 || _currentDrawBuffers[ 0 ] !== _gl.COLOR_ATTACHMENT0 ) {\r\n\r\n\t\t\t\t\t\t_currentDrawBuffers[ 0 ] = _gl.COLOR_ATTACHMENT0;\r\n\t\t\t\t\t\t_currentDrawBuffers.length = 1;\r\n\r\n\t\t\t\t\t\tneedsUpdate = true;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( _currentDrawBuffers.length !== 1 || _currentDrawBuffers[ 0 ] !== _gl.BACK ) {\r\n\r\n\t\t\t\t\t_currentDrawBuffers[ 0 ] = _gl.BACK;\r\n\t\t\t\t\t_currentDrawBuffers.length = 1;\r\n\r\n\t\t\t\t\tneedsUpdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( needsUpdate ) {\r\n\r\n\t\t\t\tif ( capabilities.isWebGL2 ) {\r\n\r\n\t\t\t\t\t_gl.drawBuffers( _currentDrawBuffers );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\textensions.get( 'WEBGL_draw_buffers' ).drawBuffersWEBGL( _currentDrawBuffers );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tstate.viewport( _currentViewport );\r\n\t\tstate.scissor( _currentScissor );\r\n\t\tstate.setScissorTest( _currentScissorTest );\r\n\r\n\t\tif ( isCube ) {\r\n\r\n\t\t\tconst textureProperties = properties.get( renderTarget.texture );\r\n\t\t\t_gl.framebufferTexture2D( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, _gl.TEXTURE_CUBE_MAP_POSITIVE_X + activeCubeFace, textureProperties.__webglTexture, activeMipmapLevel );\r\n\r\n\t\t} else if ( isRenderTarget3D ) {\r\n\r\n\t\t\tconst textureProperties = properties.get( renderTarget.texture );\r\n\t\t\tconst layer = activeCubeFace || 0;\r\n\t\t\t_gl.framebufferTextureLayer( _gl.FRAMEBUFFER, _gl.COLOR_ATTACHMENT0, textureProperties.__webglTexture, activeMipmapLevel || 0, layer );\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.readRenderTargetPixels = function ( renderTarget, x, y, width, height, buffer, activeCubeFaceIndex ) {\r\n\r\n\t\tif ( ! ( renderTarget && renderTarget.isWebGLRenderTarget ) ) {\r\n\r\n\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tlet framebuffer = properties.get( renderTarget ).__webglFramebuffer;\r\n\r\n\t\tif ( renderTarget.isWebGLCubeRenderTarget && activeCubeFaceIndex !== undefined ) {\r\n\r\n\t\t\tframebuffer = framebuffer[ activeCubeFaceIndex ];\r\n\r\n\t\t}\r\n\r\n\t\tif ( framebuffer ) {\r\n\r\n\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\r\n\t\t\ttry {\r\n\r\n\t\t\t\tconst texture = renderTarget.texture;\r\n\t\t\t\tconst textureFormat = texture.format;\r\n\t\t\t\tconst textureType = texture.type;\r\n\r\n\t\t\t\tif ( textureFormat !== RGBAFormat && utils.convert( textureFormat ) !== _gl.getParameter( _gl.IMPLEMENTATION_COLOR_READ_FORMAT ) ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst halfFloatSupportedByExt = ( textureType === HalfFloatType ) && ( extensions.has( 'EXT_color_buffer_half_float' ) || ( capabilities.isWebGL2 && extensions.has( 'EXT_color_buffer_float' ) ) );\r\n\r\n\t\t\t\tif ( textureType !== UnsignedByteType && utils.convert( textureType ) !== _gl.getParameter( _gl.IMPLEMENTATION_COLOR_READ_TYPE ) && // Edge and Chrome Mac < 52 (#9513)\r\n\t\t\t\t\t! ( textureType === FloatType && ( capabilities.isWebGL2 || extensions.has( 'OES_texture_float' ) || extensions.has( 'WEBGL_color_buffer_float' ) ) ) && // Chrome Mac >= 52 and Firefox\r\n\t\t\t\t\t! halfFloatSupportedByExt ) {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.' );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( _gl.checkFramebufferStatus( _gl.FRAMEBUFFER ) === _gl.FRAMEBUFFER_COMPLETE ) {\r\n\r\n\t\t\t\t\t// the following if statement ensures valid read requests (no out-of-bounds pixels, see #8604)\r\n\r\n\t\t\t\t\tif ( ( x >= 0 && x <= ( renderTarget.width - width ) ) && ( y >= 0 && y <= ( renderTarget.height - height ) ) ) {\r\n\r\n\t\t\t\t\t\t_gl.readPixels( x, y, width, height, utils.convert( textureFormat ), utils.convert( textureType ), buffer );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconsole.error( 'THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} finally {\r\n\r\n\t\t\t\t// restore framebuffer of current render target if necessary\r\n\r\n\t\t\t\tconst framebuffer = ( _currentRenderTarget !== null ) ? properties.get( _currentRenderTarget ).__webglFramebuffer : null;\r\n\t\t\t\tstate.bindFramebuffer( _gl.FRAMEBUFFER, framebuffer );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tthis.copyFramebufferToTexture = function ( position, texture, level = 0 ) {\r\n\r\n\t\tconst levelScale = Math.pow( 2, - level );\r\n\t\tconst width = Math.floor( texture.image.width * levelScale );\r\n\t\tconst height = Math.floor( texture.image.height * levelScale );\r\n\r\n\t\tlet glFormat = utils.convert( texture.format );\r\n\r\n\t\tif ( capabilities.isWebGL2 ) {\r\n\r\n\t\t\t// Workaround for https://bugs.chromium.org/p/chromium/issues/detail?id=1120100\r\n\t\t\t// Not needed in Chrome 93+\r\n\r\n\t\t\tif ( glFormat === _gl.RGB ) glFormat = _gl.RGB8;\r\n\t\t\tif ( glFormat === _gl.RGBA ) glFormat = _gl.RGBA8;\r\n\r\n\t\t}\r\n\r\n\t\ttextures.setTexture2D( texture, 0 );\r\n\r\n\t\t_gl.copyTexImage2D( _gl.TEXTURE_2D, level, glFormat, position.x, position.y, width, height, 0 );\r\n\r\n\t\tstate.unbindTexture();\r\n\r\n\t};\r\n\r\n\tthis.copyTextureToTexture = function ( position, srcTexture, dstTexture, level = 0 ) {\r\n\r\n\t\tconst width = srcTexture.image.width;\r\n\t\tconst height = srcTexture.image.height;\r\n\t\tconst glFormat = utils.convert( dstTexture.format );\r\n\t\tconst glType = utils.convert( dstTexture.type );\r\n\r\n\t\ttextures.setTexture2D( dstTexture, 0 );\r\n\r\n\t\t// As another texture upload may have changed pixelStorei\r\n\t\t// parameters, make sure they are correct for the dstTexture\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, dstTexture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, dstTexture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, dstTexture.unpackAlignment );\r\n\r\n\t\tif ( srcTexture.isDataTexture ) {\r\n\r\n\t\t\t_gl.texSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, width, height, glFormat, glType, srcTexture.image.data );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( srcTexture.isCompressedTexture ) {\r\n\r\n\t\t\t\t_gl.compressedTexSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, srcTexture.mipmaps[ 0 ].width, srcTexture.mipmaps[ 0 ].height, glFormat, srcTexture.mipmaps[ 0 ].data );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.texSubImage2D( _gl.TEXTURE_2D, level, position.x, position.y, glFormat, glType, srcTexture.image );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Generate mipmaps only when copying level 0\r\n\t\tif ( level === 0 && dstTexture.generateMipmaps ) _gl.generateMipmap( _gl.TEXTURE_2D );\r\n\r\n\t\tstate.unbindTexture();\r\n\r\n\t};\r\n\r\n\tthis.copyTextureToTexture3D = function ( sourceBox, position, srcTexture, dstTexture, level = 0 ) {\r\n\r\n\t\tif ( _this.isWebGL1Renderer ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst width = sourceBox.max.x - sourceBox.min.x + 1;\r\n\t\tconst height = sourceBox.max.y - sourceBox.min.y + 1;\r\n\t\tconst depth = sourceBox.max.z - sourceBox.min.z + 1;\r\n\t\tconst glFormat = utils.convert( dstTexture.format );\r\n\t\tconst glType = utils.convert( dstTexture.type );\r\n\t\tlet glTarget;\r\n\r\n\t\tif ( dstTexture.isDataTexture3D ) {\r\n\r\n\t\t\ttextures.setTexture3D( dstTexture, 0 );\r\n\t\t\tglTarget = _gl.TEXTURE_3D;\r\n\r\n\t\t} else if ( dstTexture.isDataTexture2DArray ) {\r\n\r\n\t\t\ttextures.setTexture2DArray( dstTexture, 0 );\r\n\t\t\tglTarget = _gl.TEXTURE_2D_ARRAY;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_FLIP_Y_WEBGL, dstTexture.flipY );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, dstTexture.premultiplyAlpha );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ALIGNMENT, dstTexture.unpackAlignment );\r\n\r\n\t\tconst unpackRowLen = _gl.getParameter( _gl.UNPACK_ROW_LENGTH );\r\n\t\tconst unpackImageHeight = _gl.getParameter( _gl.UNPACK_IMAGE_HEIGHT );\r\n\t\tconst unpackSkipPixels = _gl.getParameter( _gl.UNPACK_SKIP_PIXELS );\r\n\t\tconst unpackSkipRows = _gl.getParameter( _gl.UNPACK_SKIP_ROWS );\r\n\t\tconst unpackSkipImages = _gl.getParameter( _gl.UNPACK_SKIP_IMAGES );\r\n\r\n\t\tconst image = srcTexture.isCompressedTexture ? srcTexture.mipmaps[ 0 ] : srcTexture.image;\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ROW_LENGTH, image.width );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_IMAGE_HEIGHT, image.height );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_PIXELS, sourceBox.min.x );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_ROWS, sourceBox.min.y );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_IMAGES, sourceBox.min.z );\r\n\r\n\t\tif ( srcTexture.isDataTexture || srcTexture.isDataTexture3D ) {\r\n\r\n\t\t\t_gl.texSubImage3D( glTarget, level, position.x, position.y, position.z, width, height, depth, glFormat, glType, image.data );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( srcTexture.isCompressedTexture ) {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture.' );\r\n\t\t\t\t_gl.compressedTexSubImage3D( glTarget, level, position.x, position.y, position.z, width, height, depth, glFormat, image.data );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_gl.texSubImage3D( glTarget, level, position.x, position.y, position.z, width, height, depth, glFormat, glType, image );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t_gl.pixelStorei( _gl.UNPACK_ROW_LENGTH, unpackRowLen );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_IMAGE_HEIGHT, unpackImageHeight );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_PIXELS, unpackSkipPixels );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_ROWS, unpackSkipRows );\r\n\t\t_gl.pixelStorei( _gl.UNPACK_SKIP_IMAGES, unpackSkipImages );\r\n\r\n\t\t// Generate mipmaps only when copying level 0\r\n\t\tif ( level === 0 && dstTexture.generateMipmaps ) _gl.generateMipmap( glTarget );\r\n\r\n\t\tstate.unbindTexture();\r\n\r\n\t};\r\n\r\n\tthis.initTexture = function ( texture ) {\r\n\r\n\t\ttextures.setTexture2D( texture, 0 );\r\n\r\n\t\tstate.unbindTexture();\r\n\r\n\t};\r\n\r\n\tthis.resetState = function () {\r\n\r\n\t\t_currentActiveCubeFace = 0;\r\n\t\t_currentActiveMipmapLevel = 0;\r\n\t\t_currentRenderTarget = null;\r\n\r\n\t\tstate.reset();\r\n\t\tbindingStates.reset();\r\n\r\n\t};\r\n\r\n\tif ( typeof __THREE_DEVTOOLS__ !== 'undefined' ) {\r\n\r\n\t\t__THREE_DEVTOOLS__.dispatchEvent( new CustomEvent( 'observe', { detail: this } ) ); // eslint-disable-line no-undef\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { WebGLRenderer };\r\n", "import { Sphere } from '../math/Sphere.js';\r\nimport { Ray } from '../math/Ray.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\nimport { Object3D } from '../core/Object3D.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { LineBasicMaterial } from '../materials/LineBasicMaterial.js';\r\nimport { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\n\r\nconst _start = /*@__PURE__*/ new Vector3();\r\nconst _end = /*@__PURE__*/ new Vector3();\r\nconst _inverseMatrix = /*@__PURE__*/ new Matrix4();\r\nconst _ray = /*@__PURE__*/ new Ray();\r\nconst _sphere = /*@__PURE__*/ new Sphere();\r\n\r\nclass Line extends Object3D {\r\n\r\n\tconstructor( geometry = new BufferGeometry(), material = new LineBasicMaterial() ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'Line';\r\n\r\n\t\tthis.geometry = geometry;\r\n\t\tthis.material = material;\r\n\r\n\t\tthis.updateMorphTargets();\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.material = source.material;\r\n\t\tthis.geometry = source.geometry;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcomputeLineDistances() {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\t// we assume non-indexed geometry\r\n\r\n\t\t\tif ( geometry.index === null ) {\r\n\r\n\t\t\t\tconst positionAttribute = geometry.attributes.position;\r\n\t\t\t\tconst lineDistances = [ 0 ];\r\n\r\n\t\t\t\tfor ( let i = 1, l = positionAttribute.count; i < l; i ++ ) {\r\n\r\n\t\t\t\t\t_start.fromBufferAttribute( positionAttribute, i - 1 );\r\n\t\t\t\t\t_end.fromBufferAttribute( positionAttribute, i );\r\n\r\n\t\t\t\t\tlineDistances[ i ] = lineDistances[ i - 1 ];\r\n\t\t\t\t\tlineDistances[ i ] += _start.distanceTo( _end );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setAttribute( 'lineDistance', new Float32BufferAttribute( lineDistances, 1 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\traycast( raycaster, intersects ) {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\t\tconst matrixWorld = this.matrixWorld;\r\n\t\tconst threshold = raycaster.params.Line.threshold;\r\n\t\tconst drawRange = geometry.drawRange;\r\n\r\n\t\t// Checking boundingSphere distance to ray\r\n\r\n\t\tif ( geometry.boundingSphere === null ) geometry.computeBoundingSphere();\r\n\r\n\t\t_sphere.copy( geometry.boundingSphere );\r\n\t\t_sphere.applyMatrix4( matrixWorld );\r\n\t\t_sphere.radius += threshold;\r\n\r\n\t\tif ( raycaster.ray.intersectsSphere( _sphere ) === false ) return;\r\n\r\n\t\t//\r\n\r\n\t\t_inverseMatrix.copy( matrixWorld ).invert();\r\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\r\n\r\n\t\tconst localThreshold = threshold / ( ( this.scale.x + this.scale.y + this.scale.z ) / 3 );\r\n\t\tconst localThresholdSq = localThreshold * localThreshold;\r\n\r\n\t\tconst vStart = new Vector3();\r\n\t\tconst vEnd = new Vector3();\r\n\t\tconst interSegment = new Vector3();\r\n\t\tconst interRay = new Vector3();\r\n\t\tconst step = this.isLineSegments ? 2 : 1;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tconst index = geometry.index;\r\n\t\t\tconst attributes = geometry.attributes;\r\n\t\t\tconst positionAttribute = attributes.position;\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\tconst start = Math.max( 0, drawRange.start );\r\n\t\t\t\tconst end = Math.min( index.count, ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\tfor ( let i = start, l = end - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\tconst a = index.getX( i );\r\n\t\t\t\t\tconst b = index.getX( i + 1 );\r\n\r\n\t\t\t\t\tvStart.fromBufferAttribute( positionAttribute, a );\r\n\t\t\t\t\tvEnd.fromBufferAttribute( positionAttribute, b );\r\n\r\n\t\t\t\t\tconst distSq = _ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\tif ( distSq > localThresholdSq ) continue;\r\n\r\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\r\n\r\n\t\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst start = Math.max( 0, drawRange.start );\r\n\t\t\t\tconst end = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\r\n\r\n\t\t\t\tfor ( let i = start, l = end - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\tvStart.fromBufferAttribute( positionAttribute, i );\r\n\t\t\t\t\tvEnd.fromBufferAttribute( positionAttribute, i + 1 );\r\n\r\n\t\t\t\t\tconst distSq = _ray.distanceSqToSegment( vStart, vEnd, interRay, interSegment );\r\n\r\n\t\t\t\t\tif ( distSq > localThresholdSq ) continue;\r\n\r\n\t\t\t\t\tinterRay.applyMatrix4( this.matrixWorld ); //Move back to world space for distance calculation\r\n\r\n\t\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( interRay );\r\n\r\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) continue;\r\n\r\n\t\t\t\t\tintersects.push( {\r\n\r\n\t\t\t\t\t\tdistance: distance,\r\n\t\t\t\t\t\t// What do we want? intersection point on the ray or on the segment??\r\n\t\t\t\t\t\t// point: raycaster.ray.at( distance ),\r\n\t\t\t\t\t\tpoint: interSegment.clone().applyMatrix4( this.matrixWorld ),\r\n\t\t\t\t\t\tindex: i,\r\n\t\t\t\t\t\tface: null,\r\n\t\t\t\t\t\tfaceIndex: null,\r\n\t\t\t\t\t\tobject: this\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateMorphTargets() {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\tconst morphAttributes = geometry.morphAttributes;\r\n\t\t\tconst keys = Object.keys( morphAttributes );\r\n\r\n\t\t\tif ( keys.length > 0 ) {\r\n\r\n\t\t\t\tconst morphAttribute = morphAttributes[ keys[ 0 ] ];\r\n\r\n\t\t\t\tif ( morphAttribute !== undefined ) {\r\n\r\n\t\t\t\t\tthis.morphTargetInfluences = [];\r\n\t\t\t\t\tthis.morphTargetDictionary = {};\r\n\r\n\t\t\t\t\tfor ( let m = 0, ml = morphAttribute.length; m < ml; m ++ ) {\r\n\r\n\t\t\t\t\t\tconst name = morphAttribute[ m ].name || String( m );\r\n\r\n\t\t\t\t\t\tthis.morphTargetInfluences.push( 0 );\r\n\t\t\t\t\t\tthis.morphTargetDictionary[ name ] = m;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst morphTargets = geometry.morphTargets;\r\n\r\n\t\t\tif ( morphTargets !== undefined && morphTargets.length > 0 ) {\r\n\r\n\t\t\t\tconsole.error( 'THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nLine.prototype.isLine = true;\r\n\r\n\r\nexport { Line };\r\n", "import { Line } from './Line.js';\r\nimport { Vector3 } from '../math/Vector3.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\n\r\nconst _start = /*@__PURE__*/ new Vector3();\r\nconst _end = /*@__PURE__*/ new Vector3();\r\n\r\nclass LineSegments extends Line {\r\n\r\n\tconstructor( geometry, material ) {\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tthis.type = 'LineSegments';\r\n\r\n\t}\r\n\r\n\tcomputeLineDistances() {\r\n\r\n\t\tconst geometry = this.geometry;\r\n\r\n\t\tif ( geometry.isBufferGeometry ) {\r\n\r\n\t\t\t// we assume non-indexed geometry\r\n\r\n\t\t\tif ( geometry.index === null ) {\r\n\r\n\t\t\t\tconst positionAttribute = geometry.attributes.position;\r\n\t\t\t\tconst lineDistances = [];\r\n\r\n\t\t\t\tfor ( let i = 0, l = positionAttribute.count; i < l; i += 2 ) {\r\n\r\n\t\t\t\t\t_start.fromBufferAttribute( positionAttribute, i );\r\n\t\t\t\t\t_end.fromBufferAttribute( positionAttribute, i + 1 );\r\n\r\n\t\t\t\t\tlineDistances[ i ] = ( i === 0 ) ? 0 : lineDistances[ i - 1 ];\r\n\t\t\t\t\tlineDistances[ i + 1 ] = lineDistances[ i ] + _start.distanceTo( _end );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setAttribute( 'lineDistance', new Float32BufferAttribute( lineDistances, 1 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( geometry.isGeometry ) {\r\n\r\n\t\t\tconsole.error( 'THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.' );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nLineSegments.prototype.isLineSegments = true;\r\n\r\nexport { LineSegments };\r\n", "import { LineSegments } from '../objects/LineSegments.js';\r\nimport { LineBasicMaterial } from '../materials/LineBasicMaterial.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\nimport { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\nclass GridHelper extends LineSegments {\r\n\r\n\tconstructor( size = 10, divisions = 10, color1 = 0x444444, color2 = 0x888888 ) {\r\n\r\n\t\tcolor1 = new Color( color1 );\r\n\t\tcolor2 = new Color( color2 );\r\n\r\n\t\tconst center = divisions / 2;\r\n\t\tconst step = size / divisions;\r\n\t\tconst halfSize = size / 2;\r\n\r\n\t\tconst vertices = [], colors = [];\r\n\r\n\t\tfor ( let i = 0, j = 0, k = - halfSize; i <= divisions; i ++, k += step ) {\r\n\r\n\t\t\tvertices.push( - halfSize, 0, k, halfSize, 0, k );\r\n\t\t\tvertices.push( k, 0, - halfSize, k, 0, halfSize );\r\n\r\n\t\t\tconst color = i === center ? color1 : color2;\r\n\r\n\t\t\tcolor.toArray( colors, j ); j += 3;\r\n\t\t\tcolor.toArray( colors, j ); j += 3;\r\n\t\t\tcolor.toArray( colors, j ); j += 3;\r\n\t\t\tcolor.toArray( colors, j ); j += 3;\r\n\r\n\t\t}\r\n\r\n\t\tconst geometry = new BufferGeometry();\r\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\r\n\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( colors, 3 ) );\r\n\r\n\t\tconst material = new LineBasicMaterial( { vertexColors: true, toneMapped: false } );\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tthis.type = 'GridHelper';\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { GridHelper };\r\n", "import { LineSegments } from '../objects/LineSegments.js';\r\nimport { LineBasicMaterial } from '../materials/LineBasicMaterial.js';\r\nimport { Float32BufferAttribute } from '../core/BufferAttribute.js';\r\nimport { BufferGeometry } from '../core/BufferGeometry.js';\r\nimport { Color } from '../math/Color.js';\r\n\r\nclass AxesHelper extends LineSegments {\r\n\r\n\tconstructor( size = 1 ) {\r\n\r\n\t\tconst vertices = [\r\n\t\t\t0, 0, 0,\tsize, 0, 0,\r\n\t\t\t0, 0, 0,\t0, size, 0,\r\n\t\t\t0, 0, 0,\t0, 0, size\r\n\t\t];\r\n\r\n\t\tconst colors = [\r\n\t\t\t1, 0, 0,\t1, 0.6, 0,\r\n\t\t\t0, 1, 0,\t0.6, 1, 0,\r\n\t\t\t0, 0, 1,\t0, 0.6, 1\r\n\t\t];\r\n\r\n\t\tconst geometry = new BufferGeometry();\r\n\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\r\n\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( colors, 3 ) );\r\n\r\n\t\tconst material = new LineBasicMaterial( { vertexColors: true, toneMapped: false } );\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tthis.type = 'AxesHelper';\r\n\r\n\t}\r\n\r\n\tsetColors( xAxisColor, yAxisColor, zAxisColor ) {\r\n\r\n\t\tconst color = new Color();\r\n\t\tconst array = this.geometry.attributes.color.array;\r\n\r\n\t\tcolor.set( xAxisColor );\r\n\t\tcolor.toArray( array, 0 );\r\n\t\tcolor.toArray( array, 3 );\r\n\r\n\t\tcolor.set( yAxisColor );\r\n\t\tcolor.toArray( array, 6 );\r\n\t\tcolor.toArray( array, 9 );\r\n\r\n\t\tcolor.set( zAxisColor );\r\n\t\tcolor.toArray( array, 12 );\r\n\t\tcolor.toArray( array, 15 );\r\n\r\n\t\tthis.geometry.attributes.color.needsUpdate = true;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.geometry.dispose();\r\n\t\tthis.material.dispose();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { AxesHelper };\r\n", "import { BufferGeometry } from './BufferGeometry.js';\r\n\r\nclass InstancedBufferGeometry extends BufferGeometry {\r\n\r\n\tconstructor() {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.type = 'InstancedBufferGeometry';\r\n\t\tthis.instanceCount = Infinity;\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.instanceCount = source.instanceCount;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n\ttoJSON() {\r\n\r\n\t\tconst data = super.toJSON( this );\r\n\r\n\t\tdata.instanceCount = this.instanceCount;\r\n\r\n\t\tdata.isInstancedBufferGeometry = true;\r\n\r\n\t\treturn data;\r\n\r\n\t}\r\n\r\n}\r\n\r\nInstancedBufferGeometry.prototype.isInstancedBufferGeometry = true;\r\n\r\nexport { InstancedBufferGeometry };\r\n", "import { BufferAttribute } from '../core/BufferAttribute.js';\r\nimport { Mesh } from './Mesh.js';\r\nimport { Matrix4 } from '../math/Matrix4.js';\r\n\r\nconst _instanceLocalMatrix = /*@__PURE__*/ new Matrix4();\r\nconst _instanceWorldMatrix = /*@__PURE__*/ new Matrix4();\r\n\r\nconst _instanceIntersects = [];\r\n\r\nconst _mesh = /*@__PURE__*/ new Mesh();\r\n\r\nclass InstancedMesh extends Mesh {\r\n\r\n\tconstructor( geometry, material, count ) {\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tthis.instanceMatrix = new BufferAttribute( new Float32Array( count * 16 ), 16 );\r\n\t\tthis.instanceColor = null;\r\n\r\n\t\tthis.count = count;\r\n\r\n\t\tthis.frustumCulled = false;\r\n\r\n\t}\r\n\r\n\tcopy( source ) {\r\n\r\n\t\tsuper.copy( source );\r\n\r\n\t\tthis.instanceMatrix.copy( source.instanceMatrix );\r\n\r\n\t\tif ( source.instanceColor !== null ) this.instanceColor = source.instanceColor.clone();\r\n\r\n\t\tthis.count = source.count;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tgetColorAt( index, color ) {\r\n\r\n\t\tcolor.fromArray( this.instanceColor.array, index * 3 );\r\n\r\n\t}\r\n\r\n\tgetMatrixAt( index, matrix ) {\r\n\r\n\t\tmatrix.fromArray( this.instanceMatrix.array, index * 16 );\r\n\r\n\t}\r\n\r\n\traycast( raycaster, intersects ) {\r\n\r\n\t\tconst matrixWorld = this.matrixWorld;\r\n\t\tconst raycastTimes = this.count;\r\n\r\n\t\t_mesh.geometry = this.geometry;\r\n\t\t_mesh.material = this.material;\r\n\r\n\t\tif ( _mesh.material === undefined ) return;\r\n\r\n\t\tfor ( let instanceId = 0; instanceId < raycastTimes; instanceId ++ ) {\r\n\r\n\t\t\t// calculate the world matrix for each instance\r\n\r\n\t\t\tthis.getMatrixAt( instanceId, _instanceLocalMatrix );\r\n\r\n\t\t\t_instanceWorldMatrix.multiplyMatrices( matrixWorld, _instanceLocalMatrix );\r\n\r\n\t\t\t// the mesh represents this single instance\r\n\r\n\t\t\t_mesh.matrixWorld = _instanceWorldMatrix;\r\n\r\n\t\t\t_mesh.raycast( raycaster, _instanceIntersects );\r\n\r\n\t\t\t// process the result of raycast\r\n\r\n\t\t\tfor ( let i = 0, l = _instanceIntersects.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tconst intersect = _instanceIntersects[ i ];\r\n\t\t\t\tintersect.instanceId = instanceId;\r\n\t\t\t\tintersect.object = this;\r\n\t\t\t\tintersects.push( intersect );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_instanceIntersects.length = 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tsetColorAt( index, color ) {\r\n\r\n\t\tif ( this.instanceColor === null ) {\r\n\r\n\t\t\tthis.instanceColor = new BufferAttribute( new Float32Array( this.instanceMatrix.count * 3 ), 3 );\r\n\r\n\t\t}\r\n\r\n\t\tcolor.toArray( this.instanceColor.array, index * 3 );\r\n\r\n\t}\r\n\r\n\tsetMatrixAt( index, matrix ) {\r\n\r\n\t\tmatrix.toArray( this.instanceMatrix.array, index * 16 );\r\n\r\n\t}\r\n\r\n\tupdateMorphTargets() {\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.dispatchEvent( { type: 'dispose' } );\r\n\r\n\t}\r\n\r\n}\r\n\r\nInstancedMesh.prototype.isInstancedMesh = true;\r\n\r\nexport { InstancedMesh };\r\n", "/**\r\n * Ref: https://en.wikipedia.org/wiki/Spherical_coordinate_system\r\n *\r\n * The polar angle (phi) is measured from the positive y-axis. The positive y-axis is up.\r\n * The azimuthal angle (theta) is measured from the positive z-axis.\r\n */\r\n\r\nimport * as MathUtils from './MathUtils.js';\r\n\r\nclass Spherical {\r\n\r\n\tconstructor( radius = 1, phi = 0, theta = 0 ) {\r\n\r\n\t\tthis.radius = radius;\r\n\t\tthis.phi = phi; // polar angle\r\n\t\tthis.theta = theta; // azimuthal angle\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tset( radius, phi, theta ) {\r\n\r\n\t\tthis.radius = radius;\r\n\t\tthis.phi = phi;\r\n\t\tthis.theta = theta;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tcopy( other ) {\r\n\r\n\t\tthis.radius = other.radius;\r\n\t\tthis.phi = other.phi;\r\n\t\tthis.theta = other.theta;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t// restrict phi to be betwee EPS and PI-EPS\r\n\tmakeSafe() {\r\n\r\n\t\tconst EPS = 0.000001;\r\n\t\tthis.phi = Math.max( EPS, Math.min( Math.PI - EPS, this.phi ) );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tsetFromVector3( v ) {\r\n\r\n\t\treturn this.setFromCartesianCoords( v.x, v.y, v.z );\r\n\r\n\t}\r\n\r\n\tsetFromCartesianCoords( x, y, z ) {\r\n\r\n\t\tthis.radius = Math.sqrt( x * x + y * y + z * z );\r\n\r\n\t\tif ( this.radius === 0 ) {\r\n\r\n\t\t\tthis.theta = 0;\r\n\t\t\tthis.phi = 0;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.theta = Math.atan2( x, z );\r\n\t\t\tthis.phi = Math.acos( MathUtils.clamp( y / this.radius, - 1, 1 ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tclone() {\r\n\r\n\t\treturn new this.constructor().copy( this );\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Spherical };\r\n", "import { REVISION } from './constants.js';\r\n\r\nexport { WebGLMultipleRenderTargets } from './renderers/WebGLMultipleRenderTargets.js';\r\nexport { WebGLMultisampleRenderTarget } from './renderers/WebGLMultisampleRenderTarget.js';\r\nexport { WebGLCubeRenderTarget } from './renderers/WebGLCubeRenderTarget.js';\r\nexport { WebGLRenderTarget } from './renderers/WebGLRenderTarget.js';\r\nexport { WebGLRenderer } from './renderers/WebGLRenderer.js';\r\nexport { WebGL1Renderer } from './renderers/WebGL1Renderer.js';\r\nexport { ShaderLib } from './renderers/shaders/ShaderLib.js';\r\nexport { UniformsLib } from './renderers/shaders/UniformsLib.js';\r\nexport { UniformsUtils } from './renderers/shaders/UniformsUtils.js';\r\nexport { ShaderChunk } from './renderers/shaders/ShaderChunk.js';\r\nexport { FogExp2 } from './scenes/FogExp2.js';\r\nexport { Fog } from './scenes/Fog.js';\r\nexport { Scene } from './scenes/Scene.js';\r\nexport { Sprite } from './objects/Sprite.js';\r\nexport { LOD } from './objects/LOD.js';\r\nexport { SkinnedMesh } from './objects/SkinnedMesh.js';\r\nexport { Skeleton } from './objects/Skeleton.js';\r\nexport { Bone } from './objects/Bone.js';\r\nexport { Mesh } from './objects/Mesh.js';\r\nexport { InstancedMesh } from './objects/InstancedMesh.js';\r\nexport { LineSegments } from './objects/LineSegments.js';\r\nexport { LineLoop } from './objects/LineLoop.js';\r\nexport { Line } from './objects/Line.js';\r\nexport { Points } from './objects/Points.js';\r\nexport { Group } from './objects/Group.js';\r\nexport { VideoTexture } from './textures/VideoTexture.js';\r\nexport { DataTexture } from './textures/DataTexture.js';\r\nexport { DataTexture2DArray } from './textures/DataTexture2DArray.js';\r\nexport { DataTexture3D } from './textures/DataTexture3D.js';\r\nexport { CompressedTexture } from './textures/CompressedTexture.js';\r\nexport { CubeTexture } from './textures/CubeTexture.js';\r\nexport { CanvasTexture } from './textures/CanvasTexture.js';\r\nexport { DepthTexture } from './textures/DepthTexture.js';\r\nexport { Texture } from './textures/Texture.js';\r\nexport * from './geometries/Geometries.js';\r\nexport * from './materials/Materials.js';\r\nexport { AnimationLoader } from './loaders/AnimationLoader.js';\r\nexport { CompressedTextureLoader } from './loaders/CompressedTextureLoader.js';\r\nexport { CubeTextureLoader } from './loaders/CubeTextureLoader.js';\r\nexport { DataTextureLoader } from './loaders/DataTextureLoader.js';\r\nexport { TextureLoader } from './loaders/TextureLoader.js';\r\nexport { ObjectLoader } from './loaders/ObjectLoader.js';\r\nexport { MaterialLoader } from './loaders/MaterialLoader.js';\r\nexport { BufferGeometryLoader } from './loaders/BufferGeometryLoader.js';\r\nexport { DefaultLoadingManager, LoadingManager } from './loaders/LoadingManager.js';\r\nexport { ImageLoader } from './loaders/ImageLoader.js';\r\nexport { ImageBitmapLoader } from './loaders/ImageBitmapLoader.js';\r\nexport { FontLoader } from './loaders/FontLoader.js';\r\nexport { FileLoader } from './loaders/FileLoader.js';\r\nexport { Loader } from './loaders/Loader.js';\r\nexport { LoaderUtils } from './loaders/LoaderUtils.js';\r\nexport { Cache } from './loaders/Cache.js';\r\nexport { AudioLoader } from './loaders/AudioLoader.js';\r\nexport { SpotLight } from './lights/SpotLight.js';\r\nexport { PointLight } from './lights/PointLight.js';\r\nexport { RectAreaLight } from './lights/RectAreaLight.js';\r\nexport { HemisphereLight } from './lights/HemisphereLight.js';\r\nexport { HemisphereLightProbe } from './lights/HemisphereLightProbe.js';\r\nexport { DirectionalLight } from './lights/DirectionalLight.js';\r\nexport { AmbientLight } from './lights/AmbientLight.js';\r\nexport { AmbientLightProbe } from './lights/AmbientLightProbe.js';\r\nexport { Light } from './lights/Light.js';\r\nexport { LightProbe } from './lights/LightProbe.js';\r\nexport { StereoCamera } from './cameras/StereoCamera.js';\r\nexport { PerspectiveCamera } from './cameras/PerspectiveCamera.js';\r\nexport { OrthographicCamera } from './cameras/OrthographicCamera.js';\r\nexport { CubeCamera } from './cameras/CubeCamera.js';\r\nexport { ArrayCamera } from './cameras/ArrayCamera.js';\r\nexport { Camera } from './cameras/Camera.js';\r\nexport { AudioListener } from './audio/AudioListener.js';\r\nexport { PositionalAudio } from './audio/PositionalAudio.js';\r\nexport { AudioContext } from './audio/AudioContext.js';\r\nexport { AudioAnalyser } from './audio/AudioAnalyser.js';\r\nexport { Audio } from './audio/Audio.js';\r\nexport { VectorKeyframeTrack } from './animation/tracks/VectorKeyframeTrack.js';\r\nexport { StringKeyframeTrack } from './animation/tracks/StringKeyframeTrack.js';\r\nexport { QuaternionKeyframeTrack } from './animation/tracks/QuaternionKeyframeTrack.js';\r\nexport { NumberKeyframeTrack } from './animation/tracks/NumberKeyframeTrack.js';\r\nexport { ColorKeyframeTrack } from './animation/tracks/ColorKeyframeTrack.js';\r\nexport { BooleanKeyframeTrack } from './animation/tracks/BooleanKeyframeTrack.js';\r\nexport { PropertyMixer } from './animation/PropertyMixer.js';\r\nexport { PropertyBinding } from './animation/PropertyBinding.js';\r\nexport { KeyframeTrack } from './animation/KeyframeTrack.js';\r\nexport { AnimationUtils } from './animation/AnimationUtils.js';\r\nexport { AnimationObjectGroup } from './animation/AnimationObjectGroup.js';\r\nexport { AnimationMixer } from './animation/AnimationMixer.js';\r\nexport { AnimationClip } from './animation/AnimationClip.js';\r\nexport { Uniform } from './core/Uniform.js';\r\nexport { InstancedBufferGeometry } from './core/InstancedBufferGeometry.js';\r\nexport { BufferGeometry } from './core/BufferGeometry.js';\r\nexport { InterleavedBufferAttribute } from './core/InterleavedBufferAttribute.js';\r\nexport { InstancedInterleavedBuffer } from './core/InstancedInterleavedBuffer.js';\r\nexport { InterleavedBuffer } from './core/InterleavedBuffer.js';\r\nexport { InstancedBufferAttribute } from './core/InstancedBufferAttribute.js';\r\nexport { GLBufferAttribute } from './core/GLBufferAttribute.js';\r\nexport * from './core/BufferAttribute.js';\r\nexport { Object3D } from './core/Object3D.js';\r\nexport { Raycaster } from './core/Raycaster.js';\r\nexport { Layers } from './core/Layers.js';\r\nexport { EventDispatcher } from './core/EventDispatcher.js';\r\nexport { Clock } from './core/Clock.js';\r\nexport { QuaternionLinearInterpolant } from './math/interpolants/QuaternionLinearInterpolant.js';\r\nexport { LinearInterpolant } from './math/interpolants/LinearInterpolant.js';\r\nexport { DiscreteInterpolant } from './math/interpolants/DiscreteInterpolant.js';\r\nexport { CubicInterpolant } from './math/interpolants/CubicInterpolant.js';\r\nexport { Interpolant } from './math/Interpolant.js';\r\nexport { Triangle } from './math/Triangle.js';\r\nexport * as MathUtils from './math/MathUtils.js';\r\nexport { Spherical } from './math/Spherical.js';\r\nexport { Cylindrical } from './math/Cylindrical.js';\r\nexport { Plane } from './math/Plane.js';\r\nexport { Frustum } from './math/Frustum.js';\r\nexport { Sphere } from './math/Sphere.js';\r\nexport { Ray } from './math/Ray.js';\r\nexport { Matrix4 } from './math/Matrix4.js';\r\nexport { Matrix3 } from './math/Matrix3.js';\r\nexport { Box3 } from './math/Box3.js';\r\nexport { Box2 } from './math/Box2.js';\r\nexport { Line3 } from './math/Line3.js';\r\nexport { Euler } from './math/Euler.js';\r\nexport { Vector4 } from './math/Vector4.js';\r\nexport { Vector3 } from './math/Vector3.js';\r\nexport { Vector2 } from './math/Vector2.js';\r\nexport { Quaternion } from './math/Quaternion.js';\r\nexport { Color } from './math/Color.js';\r\nexport { SphericalHarmonics3 } from './math/SphericalHarmonics3.js';\r\nexport { ImmediateRenderObject } from './extras/objects/ImmediateRenderObject.js';\r\nexport { SpotLightHelper } from './helpers/SpotLightHelper.js';\r\nexport { SkeletonHelper } from './helpers/SkeletonHelper.js';\r\nexport { PointLightHelper } from './helpers/PointLightHelper.js';\r\nexport { HemisphereLightHelper } from './helpers/HemisphereLightHelper.js';\r\nexport { GridHelper } from './helpers/GridHelper.js';\r\nexport { PolarGridHelper } from './helpers/PolarGridHelper.js';\r\nexport { DirectionalLightHelper } from './helpers/DirectionalLightHelper.js';\r\nexport { CameraHelper } from './helpers/CameraHelper.js';\r\nexport { BoxHelper } from './helpers/BoxHelper.js';\r\nexport { Box3Helper } from './helpers/Box3Helper.js';\r\nexport { PlaneHelper } from './helpers/PlaneHelper.js';\r\nexport { ArrowHelper } from './helpers/ArrowHelper.js';\r\nexport { AxesHelper } from './helpers/AxesHelper.js';\r\nexport * from './extras/curves/Curves.js';\r\nexport { Shape } from './extras/core/Shape.js';\r\nexport { Path } from './extras/core/Path.js';\r\nexport { ShapePath } from './extras/core/ShapePath.js';\r\nexport { Font } from './extras/core/Font.js';\r\nexport { CurvePath } from './extras/core/CurvePath.js';\r\nexport { Curve } from './extras/core/Curve.js';\r\nexport { DataUtils } from './extras/DataUtils.js';\r\nexport { ImageUtils } from './extras/ImageUtils.js';\r\nexport { ShapeUtils } from './extras/ShapeUtils.js';\r\nexport { PMREMGenerator } from './extras/PMREMGenerator.js';\r\nexport { WebGLUtils } from './renderers/webgl/WebGLUtils.js';\r\nexport * from './constants.js';\r\nexport * from './Three.Legacy.js';\r\n\r\nif ( typeof __THREE_DEVTOOLS__ !== 'undefined' ) {\r\n\r\n\t/* eslint-disable no-undef */\r\n\t__THREE_DEVTOOLS__.dispatchEvent( new CustomEvent( 'register', { detail: {\r\n\t\trevision: REVISION,\r\n\t} } ) );\r\n\t/* eslint-enable no-undef */\r\n\r\n}\r\n\r\nif ( typeof window !== 'undefined' ) {\r\n\r\n\tif ( window.__THREE__ ) {\r\n\r\n\t\tconsole.warn( 'WARNING: Multiple instances of Three.js being imported.' );\r\n\r\n\t} else {\r\n\r\n\t\twindow.__THREE__ = REVISION;\r\n\r\n\t}\r\n\r\n}\r\n", "// import { EventDispatcher } from '../../../src/core/EventDispatcher.js';\r\n// import { Quaternion } from '../../../src/math/Quaternion.js';\r\n// import { Spherical } from '../../../src/math/Spherical.js';\r\n// import { Vector2 } from '../../../src/math/Vector2.js';\r\n// import { Vector3 } from '../../../src/math/Vector3.js';\r\n// import { MOUSE, TOUCH } from '../../../src/constants.js';\r\n\r\nimport {\r\n EventDispatcher,\r\n\tMOUSE,\r\n\tQuaternion,\r\n\tSpherical,\r\n\tTOUCH,\r\n\tVector2,\r\n\tVector3\r\n } from '../../../src/Three.js';\r\n// } from '../../../build/three.module.js';\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one-finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\r\n\r\nconst _changeEvent = { type: 'change' };\r\nconst _startEvent = { type: 'start' };\r\nconst _endEvent = { type: 'end' };\r\n\r\nclass OrbitControls extends EventDispatcher {\r\n\r\n\tconstructor( object, domElement ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tif ( domElement === undefined ) console.warn( 'THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.' );\r\n\t\tif ( domElement === document ) console.error( 'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.' );\r\n\r\n\t\tthis.object = object;\r\n\t\tthis.domElement = domElement;\r\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\r\n\r\n\t\t// Set to false to disable this control\r\n\t\tthis.enabled = true;\r\n\r\n\t\t// \"target\" sets the location of focus, where the object orbits around\r\n\t\tthis.target = new Vector3();\r\n\r\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\t\tthis.minDistance = 0;\r\n\t\tthis.maxDistance = Infinity;\r\n\r\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\t\tthis.minZoom = 0;\r\n\t\tthis.maxZoom = Infinity;\r\n\r\n\t\t// How far you can orbit vertically, upper and lower limits.\r\n\t\t// Range is 0 to Math.PI radians.\r\n\t\tthis.minPolarAngle = 0; // radians\r\n\t\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t\t// How far you can orbit horizontally, upper and lower limits.\r\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\r\n\t\tthis.minAzimuthAngle = - Infinity; // radians\r\n\t\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t\t// Set to true to enable damping (inertia)\r\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.enableDamping = false;\r\n\t\tthis.dampingFactor = 0.05;\r\n\r\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t\t// Set to false to disable zooming\r\n\t\tthis.enableZoom = true;\r\n\t\tthis.zoomSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable rotating\r\n\t\tthis.enableRotate = true;\r\n\t\tthis.rotateSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable panning\r\n\t\tthis.enablePan = true;\r\n\t\tthis.panSpeed = 1.0;\r\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\r\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\r\n\r\n\t\t// Set to true to automatically rotate around the target\r\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.autoRotate = false;\r\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\r\n\r\n\t\t// The four arrow keys\r\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\r\n\r\n\t\t// Mouse buttons\r\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\r\n\r\n\t\t// Touch fingers\r\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\r\n\r\n\t\t// for reset\r\n\t\tthis.target0 = this.target.clone();\r\n\t\tthis.position0 = this.object.position.clone();\r\n\t\tthis.zoom0 = this.object.zoom;\r\n\r\n\t\t// the target DOM element for key events\r\n\t\tthis._domElementKeyEvents = null;\r\n\r\n\t\t//\r\n\t\t// public methods\r\n\t\t//\r\n\r\n\t\tthis.getPolarAngle = function () {\r\n\r\n\t\t\treturn spherical.phi;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getAzimuthalAngle = function () {\r\n\r\n\t\t\treturn spherical.theta;\r\n\r\n\t\t};\r\n\r\n\t\tthis.getDistance = function () {\r\n\r\n\t\t\treturn this.object.position.distanceTo( this.target );\r\n\r\n\t\t};\r\n\r\n\t\tthis.listenToKeyEvents = function ( domElement ) {\r\n\r\n\t\t\tdomElement.addEventListener( 'keydown', onKeyDown );\r\n\t\t\tthis._domElementKeyEvents = domElement;\r\n\r\n\t\t};\r\n\r\n\t\tthis.saveState = function () {\r\n\r\n\t\t\tscope.target0.copy( scope.target );\r\n\t\t\tscope.position0.copy( scope.object.position );\r\n\t\t\tscope.zoom0 = scope.object.zoom;\r\n\r\n\t\t};\r\n\r\n\t\tthis.reset = function () {\r\n\r\n\t\t\tscope.target.copy( scope.target0 );\r\n\t\t\tscope.object.position.copy( scope.position0 );\r\n\t\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tscope.dispatchEvent( _changeEvent );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t};\r\n\r\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\t\tthis.update = function () {\r\n\r\n\t\t\tconst offset = new Vector3();\r\n\r\n\t\t\t// so camera.up is the orbit axis\r\n\t\t\tconst quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\r\n\t\t\tconst quatInverse = quat.clone().invert();\r\n\r\n\t\t\tconst lastPosition = new Vector3();\r\n\t\t\tconst lastQuaternion = new Quaternion();\r\n\r\n\t\t\tconst twoPI = 2 * Math.PI;\r\n\r\n\t\t\treturn function update() {\r\n\r\n\t\t\t\tconst position = scope.object.position;\r\n\r\n\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\r\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\t\toffset.applyQuaternion( quat );\r\n\r\n\t\t\t\t// angle from z-axis around y-axis\r\n\t\t\t\tspherical.setFromVector3( offset );\r\n\r\n\t\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\r\n\r\n\t\t\t\t\trotateLeft( getAutoRotationAngle() );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( scope.enableDamping ) {\r\n\r\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\r\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// restrict theta to be between desired limits\r\n\r\n\t\t\t\tlet min = scope.minAzimuthAngle;\r\n\t\t\t\tlet max = scope.maxAzimuthAngle;\r\n\r\n\t\t\t\tif ( isFinite( min ) && isFinite( max ) ) {\r\n\r\n\t\t\t\t\tif ( min < - Math.PI ) min += twoPI; else if ( min > Math.PI ) min -= twoPI;\r\n\r\n\t\t\t\t\tif ( max < - Math.PI ) max += twoPI; else if ( max > Math.PI ) max -= twoPI;\r\n\r\n\t\t\t\t\tif ( min <= max ) {\r\n\r\n\t\t\t\t\t\tspherical.theta = Math.max( min, Math.min( max, spherical.theta ) );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tspherical.theta = ( spherical.theta > ( min + max ) / 2 ) ?\r\n\t\t\t\t\t\t\tMath.max( min, spherical.theta ) :\r\n\t\t\t\t\t\t\tMath.min( max, spherical.theta );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// restrict phi to be between desired limits\r\n\t\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\r\n\r\n\t\t\t\tspherical.makeSafe();\r\n\r\n\r\n\t\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t\t// restrict radius to be between desired limits\r\n\t\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\r\n\r\n\t\t\t\t// move target to panned location\r\n\r\n\t\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\t\tscope.target.addScaledVector( panOffset, scope.dampingFactor );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tscope.target.add( panOffset );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\toffset.setFromSpherical( spherical );\r\n\r\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\t\toffset.applyQuaternion( quatInverse );\r\n\r\n\t\t\t\tposition.copy( scope.target ).add( offset );\r\n\r\n\t\t\t\tscope.object.lookAt( scope.target );\r\n\r\n\t\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\r\n\t\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\t\tpanOffset.multiplyScalar( 1 - scope.dampingFactor );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tsphericalDelta.set( 0, 0, 0 );\r\n\r\n\t\t\t\t\tpanOffset.set( 0, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscale = 1;\r\n\r\n\t\t\t\t// update condition is:\r\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\t\tif ( zoomChanged ||\r\n\t\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\r\n\t\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\r\n\r\n\t\t\t\t\tscope.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\tlastPosition.copy( scope.object.position );\r\n\t\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\r\n\t\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tthis.dispose = function () {\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu );\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'pointerdown', onPointerDown );\r\n\t\t\tscope.domElement.removeEventListener( 'pointercancel', onPointerCancel );\r\n\t\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel );\r\n\r\n\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\r\n\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\r\n\r\n\r\n\t\t\tif ( scope._domElementKeyEvents !== null ) {\r\n\r\n\t\t\t\tscope._domElementKeyEvents.removeEventListener( 'keydown', onKeyDown );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\r\n\t\t};\r\n\r\n\t\t//\r\n\t\t// internals\r\n\t\t//\r\n\r\n\t\tconst scope = this;\r\n\r\n\t\tconst STATE = {\r\n\t\t\tNONE: - 1,\r\n\t\t\tROTATE: 0,\r\n\t\t\tDOLLY: 1,\r\n\t\t\tPAN: 2,\r\n\t\t\tTOUCH_ROTATE: 3,\r\n\t\t\tTOUCH_PAN: 4,\r\n\t\t\tTOUCH_DOLLY_PAN: 5,\r\n\t\t\tTOUCH_DOLLY_ROTATE: 6\r\n\t\t};\r\n\r\n\t\tlet state = STATE.NONE;\r\n\r\n\t\tconst EPS = 0.000001;\r\n\r\n\t\t// current position in spherical coordinates\r\n\t\tconst spherical = new Spherical();\r\n\t\tconst sphericalDelta = new Spherical();\r\n\r\n\t\tlet scale = 1;\r\n\t\tconst panOffset = new Vector3();\r\n\t\tlet zoomChanged = false;\r\n\r\n\t\tconst rotateStart = new Vector2();\r\n\t\tconst rotateEnd = new Vector2();\r\n\t\tconst rotateDelta = new Vector2();\r\n\r\n\t\tconst panStart = new Vector2();\r\n\t\tconst panEnd = new Vector2();\r\n\t\tconst panDelta = new Vector2();\r\n\r\n\t\tconst dollyStart = new Vector2();\r\n\t\tconst dollyEnd = new Vector2();\r\n\t\tconst dollyDelta = new Vector2();\r\n\r\n\t\tconst pointers = [];\r\n\t\tconst pointerPositions = {};\r\n\r\n\t\tfunction getAutoRotationAngle() {\r\n\r\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\r\n\t\t}\r\n\r\n\t\tfunction getZoomScale() {\r\n\r\n\t\t\treturn Math.pow( 0.95, scope.zoomSpeed );\r\n\r\n\t\t}\r\n\r\n\t\tfunction rotateLeft( angle ) {\r\n\r\n\t\t\tsphericalDelta.theta -= angle;\r\n\r\n\t\t}\r\n\r\n\t\tfunction rotateUp( angle ) {\r\n\r\n\t\t\tsphericalDelta.phi -= angle;\r\n\r\n\t\t}\r\n\r\n\t\tconst panLeft = function () {\r\n\r\n\t\t\tconst v = new Vector3();\r\n\r\n\t\t\treturn function panLeft( distance, objectMatrix ) {\r\n\r\n\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\r\n\t\t\t\tv.multiplyScalar( - distance );\r\n\r\n\t\t\t\tpanOffset.add( v );\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tconst panUp = function () {\r\n\r\n\t\t\tconst v = new Vector3();\r\n\r\n\t\t\treturn function panUp( distance, objectMatrix ) {\r\n\r\n\t\t\t\tif ( scope.screenSpacePanning === true ) {\r\n\r\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 1 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tv.setFromMatrixColumn( objectMatrix, 0 );\r\n\t\t\t\t\tv.crossVectors( scope.object.up, v );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tv.multiplyScalar( distance );\r\n\r\n\t\t\t\tpanOffset.add( v );\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\t// deltaX and deltaY are in pixels; right and down are positive\r\n\t\tconst pan = function () {\r\n\r\n\t\t\tconst offset = new Vector3();\r\n\r\n\t\t\treturn function pan( deltaX, deltaY ) {\r\n\r\n\t\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t// perspective\r\n\t\t\t\t\tconst position = scope.object.position;\r\n\t\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\t\t\t\t\tlet targetDistance = offset.length();\r\n\r\n\t\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\r\n\r\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\r\n\t\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\r\n\t\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\t// orthographic\r\n\t\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\r\n\t\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\r\n\t\t\t\t\tscope.enablePan = false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t}();\r\n\r\n\t\tfunction dollyOut( dollyScale ) {\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tscale /= dollyScale;\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\t\tscope.enableZoom = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction dollyIn( dollyScale ) {\r\n\r\n\t\t\tif ( scope.object.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tscale *= dollyScale;\r\n\r\n\t\t\t} else if ( scope.object.isOrthographicCamera ) {\r\n\r\n\t\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\t\tscope.enableZoom = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// event callbacks - update the object state\r\n\t\t//\r\n\r\n\t\tfunction handleMouseDownRotate( event ) {\r\n\r\n\t\t\trotateStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseDownDolly( event ) {\r\n\r\n\t\t\tdollyStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseDownPan( event ) {\r\n\r\n\t\t\tpanStart.set( event.clientX, event.clientY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMoveRotate( event ) {\r\n\r\n\t\t\trotateEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMoveDolly( event ) {\r\n\r\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseMovePan( event ) {\r\n\r\n\t\t\tpanEnd.set( event.clientX, event.clientY );\r\n\r\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\t\tpanStart.copy( panEnd );\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseUp( /*event*/ ) {\r\n\r\n\t\t\t// no-op\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleMouseWheel( event ) {\r\n\r\n\t\t\tif ( event.deltaY < 0 ) {\r\n\r\n\t\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t\t} else if ( event.deltaY > 0 ) {\r\n\r\n\t\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscope.update();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleKeyDown( event ) {\r\n\r\n\t\t\tlet needsUpdate = false;\r\n\r\n\t\t\tswitch ( event.code ) {\r\n\r\n\t\t\t\tcase scope.keys.UP:\r\n\t\t\t\t\tpan( 0, scope.keyPanSpeed );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\t\tpan( 0, - scope.keyPanSpeed );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\t\tpan( scope.keyPanSpeed, 0 );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\t\tpan( - scope.keyPanSpeed, 0 );\r\n\t\t\t\t\tneedsUpdate = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( needsUpdate ) {\r\n\r\n\t\t\t\t// prevent the browser from scrolling on cursor keys\r\n\t\t\t\tevent.preventDefault();\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartRotate() {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\trotateStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\r\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\r\n\r\n\t\t\t\trotateStart.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartPan() {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\tpanStart.set( pointers[ 0 ].pageX, pointers[ 0 ].pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst x = 0.5 * ( pointers[ 0 ].pageX + pointers[ 1 ].pageX );\r\n\t\t\t\tconst y = 0.5 * ( pointers[ 0 ].pageY + pointers[ 1 ].pageY );\r\n\r\n\t\t\t\tpanStart.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDolly() {\r\n\r\n\t\t\tconst dx = pointers[ 0 ].pageX - pointers[ 1 ].pageX;\r\n\t\t\tconst dy = pointers[ 0 ].pageY - pointers[ 1 ].pageY;\r\n\r\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\tdollyStart.set( 0, distance );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDollyPan() {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\r\n\r\n\t\t\tif ( scope.enablePan ) handleTouchStartPan();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchStartDollyRotate() {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchStartDolly();\r\n\r\n\t\t\tif ( scope.enableRotate ) handleTouchStartRotate();\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveRotate( event ) {\r\n\r\n\t\t\tif ( pointers.length == 1 ) {\r\n\r\n\t\t\t\trotateEnd.set( event.pageX, event.pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\r\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\r\n\r\n\t\t\t\trotateEnd.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart ).multiplyScalar( scope.rotateSpeed );\r\n\r\n\t\t\tconst element = scope.domElement;\r\n\r\n\t\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientHeight ); // yes, height\r\n\r\n\t\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight );\r\n\r\n\t\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMovePan( event ) {\r\n\r\n\t\t\tif ( pointers.length === 1 ) {\r\n\r\n\t\t\t\tpanEnd.set( event.pageX, event.pageY );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\t\tconst x = 0.5 * ( event.pageX + position.x );\r\n\t\t\t\tconst y = 0.5 * ( event.pageY + position.y );\r\n\r\n\t\t\t\tpanEnd.set( x, y );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tpanDelta.subVectors( panEnd, panStart ).multiplyScalar( scope.panSpeed );\r\n\r\n\t\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\t\tpanStart.copy( panEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDolly( event ) {\r\n\r\n\t\t\tconst position = getSecondPointerPosition( event );\r\n\r\n\t\t\tconst dx = event.pageX - position.x;\r\n\t\t\tconst dy = event.pageY - position.y;\r\n\r\n\t\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\t\tdollyEnd.set( 0, distance );\r\n\r\n\t\t\tdollyDelta.set( 0, Math.pow( dollyEnd.y / dollyStart.y, scope.zoomSpeed ) );\r\n\r\n\t\t\tdollyOut( dollyDelta.y );\r\n\r\n\t\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDollyPan( event ) {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\t\tif ( scope.enablePan ) handleTouchMovePan( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchMoveDollyRotate( event ) {\r\n\r\n\t\t\tif ( scope.enableZoom ) handleTouchMoveDolly( event );\r\n\r\n\t\t\tif ( scope.enableRotate ) handleTouchMoveRotate( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction handleTouchEnd( /*event*/ ) {\r\n\r\n\t\t\t// no-op\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\t\t// event handlers - FSM: listen for events and reset state\r\n\t\t//\r\n\r\n\t\tfunction onPointerDown( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( pointers.length === 0 ) {\r\n\r\n\t\t\t\tscope.domElement.setPointerCapture( event.pointerId );\r\n\r\n\t\t\t\tscope.domElement.addEventListener( 'pointermove', onPointerMove );\r\n\t\t\t\tscope.domElement.addEventListener( 'pointerup', onPointerUp );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\taddPointer( event );\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchStart( event );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseDown( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerMove( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchMove( event );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseMove( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerUp( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tif ( event.pointerType === 'touch' ) {\r\n\r\n\t\t\t\tonTouchEnd();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tonMouseUp( event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tremovePointer( event );\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif ( pointers.length === 0 ) {\r\n\r\n\t\t\t\tscope.domElement.releasePointerCapture( event.pointerId );\r\n\r\n\t\t\t\tscope.domElement.removeEventListener( 'pointermove', onPointerMove );\r\n\t\t\t\tscope.domElement.removeEventListener( 'pointerup', onPointerUp );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onPointerCancel( event ) {\r\n\r\n\t\t\tremovePointer( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseDown( event ) {\r\n\r\n\t\t\tlet mouseAction;\r\n\r\n\t\t\tswitch ( event.button ) {\r\n\r\n\t\t\t\tcase 0:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\r\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tmouseAction = - 1;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( mouseAction ) {\r\n\r\n\t\t\t\tcase MOUSE.DOLLY:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\t\thandleMouseDownDolly( event );\r\n\r\n\t\t\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MOUSE.ROTATE:\r\n\r\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase MOUSE.PAN:\r\n\r\n\t\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\r\n\r\n\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseMove( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tswitch ( state ) {\r\n\r\n\t\t\t\tcase STATE.ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMoveRotate( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.DOLLY:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMoveDolly( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.PAN:\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleMouseMovePan( event );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseUp( event ) {\r\n\r\n\t\t\thandleMouseUp( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tfunction onMouseWheel( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\thandleMouseWheel( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onKeyDown( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false || scope.enablePan === false ) return;\r\n\r\n\t\t\thandleKeyDown( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchStart( event ) {\r\n\r\n\t\t\ttrackPointer( event );\r\n\r\n\t\t\tswitch ( pointers.length ) {\r\n\r\n\t\t\t\tcase 1:\r\n\r\n\t\t\t\t\tswitch ( scope.touches.ONE ) {\r\n\r\n\t\t\t\t\t\tcase TOUCH.ROTATE:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartRotate();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase TOUCH.PAN:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartPan();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\r\n\t\t\t\t\tswitch ( scope.touches.TWO ) {\r\n\r\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartDollyPan();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\r\n\r\n\t\t\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\t\t\thandleTouchStartDollyRotate();\r\n\r\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( _startEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchMove( event ) {\r\n\r\n\t\t\ttrackPointer( event );\r\n\r\n\t\t\tswitch ( state ) {\r\n\r\n\t\t\t\tcase STATE.TOUCH_ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveRotate( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_PAN:\r\n\r\n\t\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMovePan( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enablePan === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveDollyPan( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\r\n\r\n\t\t\t\t\tif ( scope.enableZoom === false && scope.enableRotate === false ) return;\r\n\r\n\t\t\t\t\thandleTouchMoveDollyRotate( event );\r\n\r\n\t\t\t\t\tscope.update();\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction onTouchEnd( event ) {\r\n\r\n\t\t\thandleTouchEnd( event );\r\n\r\n\t\t\tscope.dispatchEvent( _endEvent );\r\n\r\n\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tfunction onContextMenu( event ) {\r\n\r\n\t\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t}\r\n\r\n\t\tfunction addPointer( event ) {\r\n\r\n\t\t\tpointers.push( event );\r\n\r\n\t\t}\r\n\r\n\t\tfunction removePointer( event ) {\r\n\r\n\t\t\tdelete pointerPositions[ event.pointerId ];\r\n\r\n\t\t\tfor ( let i = 0; i < pointers.length; i ++ ) {\r\n\r\n\t\t\t\tif ( pointers[ i ].pointerId == event.pointerId ) {\r\n\r\n\t\t\t\t\tpointers.splice( i, 1 );\r\n\t\t\t\t\treturn;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction trackPointer( event ) {\r\n\r\n\t\t\tlet position = pointerPositions[ event.pointerId ];\r\n\r\n\t\t\tif ( position === undefined ) {\r\n\r\n\t\t\t\tposition = new Vector2();\r\n\t\t\t\tpointerPositions[ event.pointerId ] = position;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tposition.set( event.pageX, event.pageY );\r\n\r\n\t\t}\r\n\r\n\t\tfunction getSecondPointerPosition( event ) {\r\n\r\n\t\t\tconst pointer = ( event.pointerId === pointers[ 0 ].pointerId ) ? pointers[ 1 ] : pointers[ 0 ];\r\n\r\n\t\t\treturn pointerPositions[ pointer.pointerId ];\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tscope.domElement.addEventListener( 'contextmenu', onContextMenu );\r\n\r\n\t\tscope.domElement.addEventListener( 'pointerdown', onPointerDown );\r\n\t\tscope.domElement.addEventListener( 'pointercancel', onPointerCancel );\r\n\t\tscope.domElement.addEventListener( 'wheel', onMouseWheel, { passive: false } );\r\n\r\n\t\t// force an update at start\r\n\r\n\t\tthis.update();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n// This is very similar to OrbitControls, another set of touch behavior\r\n//\r\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - left mouse, or arrow keys / touch: one-finger move\r\n\r\nclass MapControls extends OrbitControls {\r\n\r\n\tconstructor( object, domElement ) {\r\n\r\n\t\tsuper( object, domElement );\r\n\r\n\t\tthis.screenSpacePanning = false; // pan orthogonal to world-space direction camera.up\r\n\r\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN;\r\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\r\n\r\n\t\tthis.touches.ONE = TOUCH.PAN;\r\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { OrbitControls, MapControls };\r\n", "import { Vector3 } from '../../../src/math/Vector3.js';\r\n\r\n/**\r\n * Usage:\r\n *  const exporter = new STLExporter();\r\n *\r\n *  // second argument is a list of options\r\n *  const data = exporter.parse( mesh, { binary: true } );\r\n *\r\n */\r\n\r\nclass STLExporter {\r\n\r\n\tparse( scene, options = {} ) {\r\n\r\n\t\tconst binary = options.binary !== undefined ? options.binary : false;\r\n\r\n\t\t//\r\n\r\n\t\tconst objects = [];\r\n\t\tlet triangles = 0;\r\n\r\n\t\tscene.traverse( function ( object ) {\r\n\r\n\t\t\tif ( object.isMesh ) {\r\n\r\n\t\t\t\tconst geometry = object.geometry;\r\n\r\n\t\t\t\tif ( geometry.isBufferGeometry !== true ) {\r\n\r\n\t\t\t\t\tthrow new Error( 'THREE.STLExporter: Geometry is not of type THREE.BufferGeometry.' );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst index = geometry.index;\r\n\t\t\t\tconst positionAttribute = geometry.getAttribute( 'position' );\r\n\r\n\t\t\t\ttriangles += ( index !== null ) ? ( index.count / 3 ) : ( positionAttribute.count / 3 );\r\n\r\n\t\t\t\tobjects.push( {\r\n\t\t\t\t\tobject3d: object,\r\n\t\t\t\t\tgeometry: geometry\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tlet output;\r\n\t\tlet offset = 80; // skip header\r\n\r\n\t\tif ( binary === true ) {\r\n\r\n\t\t\tconst bufferLength = triangles * 2 + triangles * 3 * 4 * 4 + 80 + 4;\r\n\t\t\tconst arrayBuffer = new ArrayBuffer( bufferLength );\r\n\t\t\toutput = new DataView( arrayBuffer );\r\n\t\t\toutput.setUint32( offset, triangles, true ); offset += 4;\r\n\r\n\t\t} else {\r\n\r\n\t\t\toutput = '';\r\n\t\t\toutput += 'solid exported\\n';\r\n\r\n\t\t}\r\n\r\n\t\tconst vA = new Vector3();\r\n\t\tconst vB = new Vector3();\r\n\t\tconst vC = new Vector3();\r\n\t\tconst cb = new Vector3();\r\n\t\tconst ab = new Vector3();\r\n\t\tconst normal = new Vector3();\r\n\r\n\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\r\n\r\n\t\t\tconst object = objects[ i ].object3d;\r\n\t\t\tconst geometry = objects[ i ].geometry;\r\n\r\n\t\t\tconst index = geometry.index;\r\n\t\t\tconst positionAttribute = geometry.getAttribute( 'position' );\r\n\r\n\t\t\tif ( index !== null ) {\r\n\r\n\t\t\t\t// indexed geometry\r\n\r\n\t\t\t\tfor ( let j = 0; j < index.count; j += 3 ) {\r\n\r\n\t\t\t\t\tconst a = index.getX( j + 0 );\r\n\t\t\t\t\tconst b = index.getX( j + 1 );\r\n\t\t\t\t\tconst c = index.getX( j + 2 );\r\n\r\n\t\t\t\t\twriteFace( a, b, c, positionAttribute, object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// non-indexed geometry\r\n\r\n\t\t\t\tfor ( let j = 0; j < positionAttribute.count; j += 3 ) {\r\n\r\n\t\t\t\t\tconst a = j + 0;\r\n\t\t\t\t\tconst b = j + 1;\r\n\t\t\t\t\tconst c = j + 2;\r\n\r\n\t\t\t\t\twriteFace( a, b, c, positionAttribute, object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( binary === false ) {\r\n\r\n\t\t\toutput += 'endsolid exported\\n';\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\r\n\t\tfunction writeFace( a, b, c, positionAttribute, object ) {\r\n\r\n\t\t\tvA.fromBufferAttribute( positionAttribute, a );\r\n\t\t\tvB.fromBufferAttribute( positionAttribute, b );\r\n\t\t\tvC.fromBufferAttribute( positionAttribute, c );\r\n\r\n\t\t\tif ( object.isSkinnedMesh === true ) {\r\n\r\n\t\t\t\tobject.boneTransform( a, vA );\r\n\t\t\t\tobject.boneTransform( b, vB );\r\n\t\t\t\tobject.boneTransform( c, vC );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tvA.applyMatrix4( object.matrixWorld );\r\n\t\t\tvB.applyMatrix4( object.matrixWorld );\r\n\t\t\tvC.applyMatrix4( object.matrixWorld );\r\n\r\n\t\t\twriteNormal( vA, vB, vC );\r\n\r\n\t\t\twriteVertex( vA );\r\n\t\t\twriteVertex( vB );\r\n\t\t\twriteVertex( vC );\r\n\r\n\t\t\tif ( binary === true ) {\r\n\r\n\t\t\t\toutput.setUint16( offset, 0, true ); offset += 2;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\toutput += '\\t\\tendloop\\n';\r\n\t\t\t\toutput += '\\tendfacet\\n';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction writeNormal( vA, vB, vC ) {\r\n\r\n\t\t\tcb.subVectors( vC, vB );\r\n\t\t\tab.subVectors( vA, vB );\r\n\t\t\tcb.cross( ab ).normalize();\r\n\r\n\t\t\tnormal.copy( cb ).normalize();\r\n\r\n\t\t\tif ( binary === true ) {\r\n\r\n\t\t\t\toutput.setFloat32( offset, normal.x, true ); offset += 4;\r\n\t\t\t\toutput.setFloat32( offset, normal.y, true ); offset += 4;\r\n\t\t\t\toutput.setFloat32( offset, normal.z, true ); offset += 4;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\toutput += '\\tfacet normal ' + normal.x + ' ' + normal.y + ' ' + normal.z + '\\n';\r\n\t\t\t\toutput += '\\t\\touter loop\\n';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tfunction writeVertex( vertex ) {\r\n\r\n\t\t\tif ( binary === true ) {\r\n\r\n\t\t\t\toutput.setFloat32( offset, vertex.x, true ); offset += 4;\r\n\t\t\t\toutput.setFloat32( offset, vertex.y, true ); offset += 4;\r\n\t\t\t\toutput.setFloat32( offset, vertex.z, true ); offset += 4;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\toutput += '\\t\\t\\tvertex ' + vertex.x + ' ' + vertex.y + ' ' + vertex.z + '\\n';\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { STLExporter };\r\n", "import {\r\n\tLinearFilter,\r\n\tMatrix3,\r\n\tMesh,\r\n\tNearestFilter,\r\n\tOrthographicCamera,\r\n\tPlaneGeometry,\r\n\tRGBAFormat,\r\n\tScene,\r\n\tShaderMaterial,\r\n\tStereoCamera,\r\n\tWebGLRenderTarget\r\n} from '../../../src/Three.js';\r\n\r\nclass AnaglyphEffect {\r\n\r\n\tconstructor( renderer, width = 512, height = 512 ) {\r\n\r\n\t\t// Dubois matrices from https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.7.6968&rep=rep1&type=pdf#page=4\r\n\r\n\t\tthis.colorMatrixLeft = new Matrix3().fromArray( [\r\n\t\t\t0.456100, - 0.0400822, - 0.0152161,\r\n\t\t\t0.500484, - 0.0378246, - 0.0205971,\r\n\t\t\t0.176381, - 0.0157589, - 0.00546856\r\n\t\t] );\r\n\r\n\t\tthis.colorMatrixRight = new Matrix3().fromArray( [\r\n\t\t\t- 0.0434706, 0.378476, - 0.0721527,\r\n\t\t\t- 0.0879388, 0.73364, - 0.112961,\r\n\t\t\t- 0.00155529, - 0.0184503, 1.2264\r\n\t\t] );\r\n\r\n\t\tconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\r\n\r\n\t\tconst _scene = new Scene();\r\n\r\n\t\tconst _stereo = new StereoCamera();\r\n\r\n\t\tconst _params = { minFilter: LinearFilter, magFilter: NearestFilter, format: RGBAFormat };\r\n\r\n\t\tconst _renderTargetL = new WebGLRenderTarget( width, height, _params );\r\n\t\tconst _renderTargetR = new WebGLRenderTarget( width, height, _params );\r\n\r\n\t\tconst _material = new ShaderMaterial( {\r\n\r\n\t\t\tuniforms: {\r\n\r\n\t\t\t\t'mapLeft': { value: _renderTargetL.texture },\r\n\t\t\t\t'mapRight': { value: _renderTargetR.texture },\r\n\r\n\t\t\t\t'colorMatrixLeft': { value: this.colorMatrixLeft },\r\n\t\t\t\t'colorMatrixRight': { value: this.colorMatrixRight }\r\n\r\n\t\t\t},\r\n\r\n\t\t\tvertexShader: [\r\n\r\n\t\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t\t'void main() {',\r\n\r\n\t\t\t\t'\tvUv = vec2( uv.x, uv.y );',\r\n\t\t\t\t'\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n\r\n\t\t\t\t'}'\r\n\r\n\t\t\t].join( '\\n' ),\r\n\r\n\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t'uniform sampler2D mapLeft;',\r\n\t\t\t\t'uniform sampler2D mapRight;',\r\n\t\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t\t'uniform mat3 colorMatrixLeft;',\r\n\t\t\t\t'uniform mat3 colorMatrixRight;',\r\n\r\n\t\t\t\t// These functions implement sRGB linearization and gamma correction\r\n\r\n\t\t\t\t'float lin( float c ) {',\r\n\t\t\t\t'\treturn c <= 0.04045 ? c * 0.0773993808 :',\r\n\t\t\t\t'\t\t\tpow( c * 0.9478672986 + 0.0521327014, 2.4 );',\r\n\t\t\t\t'}',\r\n\r\n\t\t\t\t'vec4 lin( vec4 c ) {',\r\n\t\t\t\t'\treturn vec4( lin( c.r ), lin( c.g ), lin( c.b ), c.a );',\r\n\t\t\t\t'}',\r\n\r\n\t\t\t\t'float dev( float c ) {',\r\n\t\t\t\t'\treturn c <= 0.0031308 ? c * 12.92',\r\n\t\t\t\t'\t\t\t: pow( c, 0.41666 ) * 1.055 - 0.055;',\r\n\t\t\t\t'}',\r\n\r\n\r\n\t\t\t\t'void main() {',\r\n\r\n\t\t\t\t'\tvec2 uv = vUv;',\r\n\r\n\t\t\t\t'\tvec4 colorL = lin( texture2D( mapLeft, uv ) );',\r\n\t\t\t\t'\tvec4 colorR = lin( texture2D( mapRight, uv ) );',\r\n\r\n\t\t\t\t'\tvec3 color = clamp(',\r\n\t\t\t\t'\t\t\tcolorMatrixLeft * colorL.rgb +',\r\n\t\t\t\t'\t\t\tcolorMatrixRight * colorR.rgb, 0., 1. );',\r\n\r\n\t\t\t\t'\tgl_FragColor = vec4(',\r\n\t\t\t\t'\t\t\tdev( color.r ), dev( color.g ), dev( color.b ),',\r\n\t\t\t\t'\t\t\tmax( colorL.a, colorR.a ) );',\r\n\r\n\t\t\t\t'}'\r\n\r\n\t\t\t].join( '\\n' )\r\n\r\n\t\t} );\r\n\r\n\t\tconst _mesh = new Mesh( new PlaneGeometry( 2, 2 ), _material );\r\n\t\t_scene.add( _mesh );\r\n\r\n\t\tthis.setSize = function ( width, height ) {\r\n\r\n\t\t\trenderer.setSize( width, height );\r\n\r\n\t\t\tconst pixelRatio = renderer.getPixelRatio();\r\n\r\n\t\t\t_renderTargetL.setSize( width * pixelRatio, height * pixelRatio );\r\n\t\t\t_renderTargetR.setSize( width * pixelRatio, height * pixelRatio );\r\n\r\n\t\t};\r\n\r\n\t\tthis.render = function ( scene, camera ) {\r\n\r\n\t\t\tconst currentRenderTarget = renderer.getRenderTarget();\r\n\r\n\t\t\tscene.updateMatrixWorld();\r\n\r\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\t\t_stereo.update( camera );\r\n\r\n\t\t\trenderer.setRenderTarget( _renderTargetL );\r\n\t\t\trenderer.clear();\r\n\t\t\trenderer.render( scene, _stereo.cameraL );\r\n\r\n\t\t\trenderer.setRenderTarget( _renderTargetR );\r\n\t\t\trenderer.clear();\r\n\t\t\trenderer.render( scene, _stereo.cameraR );\r\n\r\n\t\t\trenderer.setRenderTarget( null );\r\n\t\t\trenderer.render( _scene, _camera );\r\n\r\n\t\t\trenderer.setRenderTarget( currentRenderTarget );\r\n\r\n\t\t};\r\n\r\n\t\tthis.dispose = function () {\r\n\r\n\t\t\tif ( _renderTargetL ) _renderTargetL.dispose();\r\n\t\t\tif ( _renderTargetR ) _renderTargetR.dispose();\r\n\t\t\tif ( _mesh ) _mesh.geometry.dispose();\r\n\t\t\tif ( _material ) _material.dispose();\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { AnaglyphEffect };\r\n", "import {\r\n\tStereoCamera,\r\n\tVector2\r\n } from '../../../src/Three.js';\r\n\r\nclass StereoEffect {\r\n\r\n\tconstructor( renderer ) {\r\n\r\n\t\tconst _stereo = new StereoCamera();\r\n\t\t_stereo.aspect = 0.5;\r\n\t\tconst size = new Vector2();\r\n\r\n\t\tthis.setEyeSeparation = function ( eyeSep ) {\r\n\r\n\t\t\t_stereo.eyeSep = eyeSep;\r\n\r\n\t\t};\r\n\r\n\t\tthis.setSize = function ( width, height ) {\r\n\r\n\t\t\trenderer.setSize( width, height );\r\n\r\n\t\t};\r\n\r\n\t\tthis.render = function ( scene, camera ) {\r\n\r\n\t\t\tscene.updateMatrixWorld();\r\n\r\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\t\t_stereo.update( camera );\r\n\r\n\t\t\trenderer.getSize( size );\r\n\r\n\t\t\tif ( renderer.autoClear ) renderer.clear();\r\n\t\t\trenderer.setScissorTest( true );\r\n\r\n\t\t\trenderer.setScissor( 0, 0, size.width / 2, size.height );\r\n\t\t\trenderer.setViewport( 0, 0, size.width / 2, size.height );\r\n\t\t\trenderer.render( scene, _stereo.cameraL );\r\n\r\n\t\t\trenderer.setScissor( size.width / 2, 0, size.width / 2, size.height );\r\n\t\t\trenderer.setViewport( size.width / 2, 0, size.width / 2, size.height );\r\n\t\t\trenderer.render( scene, _stereo.cameraR );\r\n\r\n\t\t\trenderer.setScissorTest( false );\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { StereoEffect };\r\n", "import {\r\n\tLinearFilter,\r\n\tMesh,\r\n\tNearestFilter,\r\n\tOrthographicCamera,\r\n\tPlaneGeometry,\r\n\tRGBAFormat,\r\n\tScene,\r\n\tShaderMaterial,\r\n\tStereoCamera,\r\n\tWebGLRenderTarget\r\n } from '../../../src/Three.js';\r\n\r\nclass ParallaxBarrierEffect {\r\n\r\n\tconstructor( renderer ) {\r\n\r\n\t\tconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\r\n\r\n\t\tconst _scene = new Scene();\r\n\r\n\t\tconst _stereo = new StereoCamera();\r\n\r\n\t\tconst _params = { minFilter: LinearFilter, magFilter: NearestFilter, format: RGBAFormat };\r\n\r\n\t\tconst _renderTargetL = new WebGLRenderTarget( 512, 512, _params );\r\n\t\tconst _renderTargetR = new WebGLRenderTarget( 512, 512, _params );\r\n\r\n\t\tconst _material = new ShaderMaterial( {\r\n\r\n\t\t\tuniforms: {\r\n\r\n\t\t\t\t'mapLeft': { value: _renderTargetL.texture },\r\n\t\t\t\t'mapRight': { value: _renderTargetR.texture }\r\n\r\n\t\t\t},\r\n\r\n\t\t\tvertexShader: [\r\n\r\n\t\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t\t'void main() {',\r\n\r\n\t\t\t\t'\tvUv = vec2( uv.x, uv.y );',\r\n\t\t\t\t'\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );',\r\n\r\n\t\t\t\t'}'\r\n\r\n\t\t\t].join( '\\n' ),\r\n\r\n\t\t\tfragmentShader: [\r\n\r\n\t\t\t\t'uniform sampler2D mapLeft;',\r\n\t\t\t\t'uniform sampler2D mapRight;',\r\n\t\t\t\t'varying vec2 vUv;',\r\n\r\n\t\t\t\t'void main() {',\r\n\r\n\t\t\t\t'\tvec2 uv = vUv;',\r\n\r\n\t\t\t\t'\tif ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {',\r\n\r\n\t\t\t\t'\t\tgl_FragColor = texture2D( mapLeft, uv );',\r\n\r\n\t\t\t\t'\t} else {',\r\n\r\n\t\t\t\t'\t\tgl_FragColor = texture2D( mapRight, uv );',\r\n\r\n\t\t\t\t'\t}',\r\n\r\n\t\t\t\t'}'\r\n\r\n\t\t\t].join( '\\n' )\r\n\r\n\t\t} );\r\n\r\n\t\tconst mesh = new Mesh( new PlaneGeometry( 2, 2 ), _material );\r\n\t\t_scene.add( mesh );\r\n\r\n\t\tthis.setSize = function ( width, height ) {\r\n\r\n\t\t\trenderer.setSize( width, height );\r\n\r\n\t\t\tconst pixelRatio = renderer.getPixelRatio();\r\n\r\n\t\t\t_renderTargetL.setSize( width * pixelRatio, height * pixelRatio );\r\n\t\t\t_renderTargetR.setSize( width * pixelRatio, height * pixelRatio );\r\n\r\n\t\t};\r\n\r\n\t\tthis.render = function ( scene, camera ) {\r\n\r\n\t\t\tscene.updateMatrixWorld();\r\n\r\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\t\t_stereo.update( camera );\r\n\r\n\t\t\trenderer.setRenderTarget( _renderTargetL );\r\n\t\t\trenderer.clear();\r\n\t\t\trenderer.render( scene, _stereo.cameraL );\r\n\r\n\t\t\trenderer.setRenderTarget( _renderTargetR );\r\n\t\t\trenderer.clear();\r\n\t\t\trenderer.render( scene, _stereo.cameraR );\r\n\r\n\t\t\trenderer.setRenderTarget( null );\r\n\t\t\trenderer.render( _scene, _camera );\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ParallaxBarrierEffect };\r\n"],
  "mappings": "2JAAA,4oLCAO,GAAM,IAAW,SACX,GAAQ,CAAE,KAAM,EAAG,OAAQ,EAAG,MAAO,EAAG,OAAQ,EAAG,MAAO,EAAG,IAAK,GAClE,GAAQ,CAAE,OAAQ,EAAG,IAAK,EAAG,UAAW,EAAG,aAAc,GACzD,GAAe,EACf,GAAe,EACf,GAAgB,EAChB,GAAoB,EACpB,GAAiB,EACjB,GAAe,EACf,GAAmB,EACnB,GAAe,EACf,GAAY,EACZ,GAAW,EACX,GAAa,EACb,GAAc,EACd,GAAgB,EAChB,GAAa,EACb,GAAiB,EACjB,GAAmB,EACnB,GAAsB,EACtB,GAAmB,EACnB,GAAiB,EACjB,GAAc,IACd,GAAmB,IACnB,GAA0B,IAC1B,GAAc,IACd,GAAc,IACd,GAAa,IACb,GAAY,IACZ,GAAiB,IACjB,GAAyB,IACzB,GAAiB,IACjB,GAAyB,IACzB,GAAiB,IACjB,GAAyB,IACzB,GAAiB,IACjB,GAAyB,IACzB,GAAyB,IACzB,GAAa,EACb,GAAc,EACd,GAAY,EACZ,GAAiB,EACjB,GAAa,EACb,GAAoB,EACpB,GAAe,EACf,GAAgB,EAChB,GAAoB,EACpB,GAAe,EACf,GAAe,EACf,GAAgB,EAChB,GAAoB,EACpB,GAAsB,EACtB,GAAoB,EACpB,GAAwB,EACxB,GAAoB,EAEpB,GAAY,IACZ,GAAwB,IACxB,GAAwB,IACxB,GAAmC,IACnC,GAAmC,IACnC,GAA0B,IAC1B,GAA0B,IAC1B,GAAiB,IACjB,GAAsB,KACtB,GAAyB,KACzB,GAAgB,KAChB,GAA6B,KAC7B,GAA6B,KAC7B,GAA4B,KAC5B,GAA4B,KAC5B,GAAe,KACf,GAA4B,KAC5B,GAA4B,KAC5B,GAA2B,KAC3B,GAA2B,KAC3B,GAAmB,KACnB,GAAW,KACX,GAAY,KACZ,GAAoB,KACpB,GAAU,KACV,GAAkB,KAClB,GAAY,KACZ,GAAgB,KAChB,GAAwB,KACxB,GAAwB,KACxB,GAAuB,KACvB,GAAqB,KACrB,GAAc,KACd,GAAY,KACZ,GAAa,KACb,GAAkB,KAClB,GAAuB,KACvB,GAAa,GACb,GAAc,KACd,GAAqB,KACrB,GAAY,KACZ,GAAmB,KACnB,GAAW,KACX,GAAkB,KAClB,GAAmB,KACnB,GAAoB,KAEpB,GAAuB,MACvB,GAAwB,MACxB,GAAwB,MACxB,GAAwB,MACxB,GAA0B,MAC1B,GAA0B,MAC1B,GAA2B,MAC3B,GAA2B,MAC3B,GAAkB,MAClB,GAAkB,MAClB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAuB,MACvB,GAAwB,MACxB,GAAwB,MACxB,GAAwB,MACxB,GAAyB,MACzB,GAAyB,MACzB,GAAyB,MACzB,GAAmB,MACnB,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAA+B,MAC/B,GAAgC,MAChC,GAAgC,MAChC,GAAgC,MAChC,GAAiC,MACjC,GAAiC,MACjC,GAAiC,MACjC,GAAW,KACX,GAAa,KACb,GAAe,KACf,GAAsB,KACtB,GAAoB,KACpB,GAAoB,KACpB,GAAsB,KACtB,GAAkB,KAClB,GAAmB,KACnB,GAA2B,KAC3B,GAA6B,KAC7B,GAAoB,EACpB,GAAwB,EACxB,GAAsB,EACtB,GAAiB,IACjB,GAAe,KACf,GAAgB,KAChB,GAAe,KACf,GAAiB,KACjB,GAAgB,KAChB,GAAiB,KACjB,GAAe,KACf,GAAoB,KACpB,GAAmB,KACnB,GAAwB,EACxB,GAAuB,EAEvB,GAAgB,EAChB,GAAgB,KAChB,GAAmB,KACnB,GAAqB,KACrB,GAAqB,KACrB,GAAyB,MACzB,GAAyB,MACzB,GAAkB,KAElB,GAAmB,IACnB,GAAkB,IAClB,GAAmB,IACnB,GAAuB,IACvB,GAAqB,IACrB,GAAsB,IACtB,GAA0B,IAC1B,GAAoB,IAEpB,GAAkB,MAClB,GAAmB,MACnB,GAAkB,MAClB,GAAkB,MAClB,GAAmB,MACnB,GAAkB,MAClB,GAAkB,MAClB,GAAmB,MACnB,GAAkB,MAElB,GAAQ,MACR,GAAQ,SCvMrB,GAAM,IAAO,GAEb,OAAU,GAAI,EAAG,EAAI,IAAK,IAEzB,GAAM,GAAQ,GAAI,GAAK,IAAM,IAAS,EAAI,SAAU,IAOrD,GAAM,IAAU,KAAK,GAAK,IACpB,GAAU,IAAM,KAAK,GAG3B,aAAwB,CAEvB,GAAM,GAAK,KAAK,SAAW,WAAa,EAClC,EAAK,KAAK,SAAW,WAAa,EAClC,EAAK,KAAK,SAAW,WAAa,EAClC,EAAK,KAAK,SAAW,WAAa,EAOxC,MAAO,AANM,IAAM,EAAK,KAAS,GAAM,GAAM,EAAI,KAAS,GAAM,GAAM,GAAK,KAAS,GAAM,GAAM,GAAK,KAAS,IAC5G,GAAM,EAAK,KAAS,GAAM,GAAM,EAAI,KAAS,IAAM,GAAM,GAAM,GAAK,GAAO,IAAS,GAAM,GAAM,GAAK,KAAS,IAC9G,GAAM,EAAK,GAAO,KAAS,GAAM,GAAM,EAAI,KAAS,IAAM,GAAM,GAAM,GAAK,KAAS,GAAM,GAAM,GAAK,KACrG,GAAM,EAAK,KAAS,GAAM,GAAM,EAAI,KAAS,GAAM,GAAM,GAAK,KAAS,GAAM,GAAM,GAAK,MAG9E,cAIb,YAAgB,EAAO,EAAK,EAAM,CAEjC,MAAO,MAAK,IAAK,EAAK,KAAK,IAAK,EAAK,IAMtC,YAA0B,EAAG,EAAI,CAEhC,MAAW,GAAI,EAAM,GAAM,EA2B5B,YAAe,EAAG,EAAG,EAAI,CAExB,MAAS,GAAI,GAAM,EAAI,EAAI,EAuF5B,YAAuB,EAAQ,CAE9B,MAAS,GAAU,EAAQ,IAAU,GAAK,IAAU,EAUrD,YAA0B,EAAQ,CAEjC,MAAO,MAAK,IAAK,EAAG,KAAK,MAAO,KAAK,IAAK,GAAU,KAAK,MCzK1D,YAAiB,CAEhB,YAAa,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAI,CAEzC,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,QAIJ,OAAO,EAAI,EAAI,EAAI,EAAI,CAE7B,eAAQ,KAAM,wGACP,EAAG,iBAAkB,EAAI,EAAI,SAI9B,WAAW,EAAK,EAAW,EAAM,EAAY,EAAM,EAAY,EAAI,CAIzE,GAAI,GAAK,EAAM,EAAa,GAC3B,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GAEnB,EAAK,EAAM,EAAa,GAC7B,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GAEzB,GAAK,IAAM,EAAI,CAEd,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,OAID,GAAK,IAAM,EAAI,CAEd,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,OAID,GAAK,IAAO,GAAM,IAAO,GAAM,IAAO,GAAM,IAAO,EAAK,CAEvD,GAAI,GAAI,EAAI,EACN,EAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC9C,EAAQ,GAAO,EAAI,EAAI,GACvB,EAAS,EAAI,EAAM,EAGpB,GAAK,EAAS,OAAO,QAAU,CAE9B,GAAM,GAAM,KAAK,KAAM,GACtB,EAAM,KAAK,MAAO,EAAK,EAAM,GAE9B,EAAI,KAAK,IAAK,EAAI,GAAQ,EAC1B,EAAI,KAAK,IAAK,EAAI,GAAQ,EAI3B,GAAM,GAAO,EAAI,EAQjB,GANA,EAAK,EAAK,EAAI,EAAK,EACnB,EAAK,EAAK,EAAI,EAAK,EACnB,EAAK,EAAK,EAAI,EAAK,EACnB,EAAK,EAAK,EAAI,EAAK,EAGd,IAAM,EAAI,EAAI,CAElB,GAAM,GAAI,EAAI,KAAK,KAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAE5D,GAAM,EACN,GAAM,EACN,GAAM,EACN,GAAM,GAMR,EAAK,GAAc,EACnB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,EACvB,EAAK,EAAY,GAAM,QAIjB,yBAAyB,EAAK,EAAW,EAAM,EAAY,EAAM,EAAa,CAEpF,GAAM,GAAK,EAAM,GACX,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GAExB,EAAK,EAAM,GACX,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GACxB,EAAK,EAAM,EAAa,GAE9B,SAAK,GAAc,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACtD,EAAK,EAAY,GAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC1D,EAAK,EAAY,GAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAC1D,EAAK,EAAY,GAAM,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnD,KAIJ,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,oBAIN,IAAK,EAAG,EAAG,EAAG,EAAI,CAEjB,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEV,KAAK,oBAEE,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,GAAI,KAAK,GAAI,KAAK,GAAI,KAAK,IAI9D,KAAM,EAAa,CAElB,YAAK,GAAK,EAAW,EACrB,KAAK,GAAK,EAAW,EACrB,KAAK,GAAK,EAAW,EACrB,KAAK,GAAK,EAAW,EAErB,KAAK,oBAEE,KAIR,aAAc,EAAO,EAAS,CAE7B,GAAK,CAAI,IAAS,EAAM,SAEvB,KAAM,IAAI,OAAO,oGAIlB,GAAM,GAAI,EAAM,GAAI,EAAI,EAAM,GAAI,EAAI,EAAM,GAAI,EAAQ,EAAM,OAMxD,EAAM,KAAK,IACX,EAAM,KAAK,IAEX,EAAK,EAAK,EAAI,GACd,EAAK,EAAK,EAAI,GACd,EAAK,EAAK,EAAI,GAEd,EAAK,EAAK,EAAI,GACd,EAAK,EAAK,EAAI,GACd,EAAK,EAAK,EAAI,GAEpB,OAAS,OAEH,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,UAEI,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,UAEI,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,UAEI,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,UAEI,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,UAEI,MACJ,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,KAAK,GAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EACnC,cAGA,QAAQ,KAAM,mEAAqE,GAIrF,MAAK,KAAW,IAAQ,KAAK,oBAEtB,KAIR,iBAAkB,EAAM,EAAQ,CAM/B,GAAM,GAAY,EAAQ,EAAG,EAAI,KAAK,IAAK,GAE3C,YAAK,GAAK,EAAK,EAAI,EACnB,KAAK,GAAK,EAAK,EAAI,EACnB,KAAK,GAAK,EAAK,EAAI,EACnB,KAAK,GAAK,KAAK,IAAK,GAEpB,KAAK,oBAEE,KAIR,sBAAuB,EAAI,CAM1B,GAAM,GAAK,EAAE,SAEZ,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAExC,EAAQ,EAAM,EAAM,EAErB,GAAK,EAAQ,EAAI,CAEhB,GAAM,GAAI,GAAM,KAAK,KAAM,EAAQ,GAEnC,KAAK,GAAK,IAAO,EACjB,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,UAEf,EAAM,GAAO,EAAM,EAAM,CAEpC,GAAM,GAAI,EAAM,KAAK,KAAM,EAAM,EAAM,EAAM,GAE7C,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAK,IAAO,EACjB,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,UAEf,EAAM,EAAM,CAEvB,GAAM,GAAI,EAAM,KAAK,KAAM,EAAM,EAAM,EAAM,GAE7C,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAK,IAAO,EACjB,KAAK,GAAO,GAAM,GAAQ,MAEpB,CAEN,GAAM,GAAI,EAAM,KAAK,KAAM,EAAM,EAAM,EAAM,GAE7C,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAO,GAAM,GAAQ,EAC1B,KAAK,GAAK,IAAO,EAIlB,YAAK,oBAEE,KAIR,mBAAoB,EAAO,EAAM,CAIhC,GAAI,GAAI,EAAM,IAAK,GAAQ,EAE3B,MAAK,GAAI,OAAO,QAIf,GAAI,EAEJ,AAAK,KAAK,IAAK,EAAM,GAAM,KAAK,IAAK,EAAM,GAE1C,MAAK,GAAK,CAAE,EAAM,EAClB,KAAK,GAAK,EAAM,EAChB,KAAK,GAAK,EACV,KAAK,GAAK,GAIV,MAAK,GAAK,EACV,KAAK,GAAK,CAAE,EAAM,EAClB,KAAK,GAAK,EAAM,EAChB,KAAK,GAAK,IAQX,MAAK,GAAK,EAAM,EAAI,EAAI,EAAI,EAAM,EAAI,EAAI,EAC1C,KAAK,GAAK,EAAM,EAAI,EAAI,EAAI,EAAM,EAAI,EAAI,EAC1C,KAAK,GAAK,EAAM,EAAI,EAAI,EAAI,EAAM,EAAI,EAAI,EAC1C,KAAK,GAAK,GAIJ,KAAK,YAIb,QAAS,EAAI,CAEZ,MAAO,GAAI,KAAK,KAAM,KAAK,IAAK,AAAU,GAAO,KAAK,IAAK,GAAK,GAAK,KAItE,cAAe,EAAG,EAAO,CAExB,GAAM,GAAQ,KAAK,QAAS,GAE5B,GAAK,IAAU,EAAI,MAAO,MAE1B,GAAM,GAAI,KAAK,IAAK,EAAG,EAAO,GAE9B,YAAK,MAAO,EAAG,GAER,KAIR,UAAW,CAEV,MAAO,MAAK,IAAK,EAAG,EAAG,EAAG,GAI3B,QAAS,CAIR,MAAO,MAAK,YAIb,WAAY,CAEX,YAAK,IAAM,GACX,KAAK,IAAM,GACX,KAAK,IAAM,GAEX,KAAK,oBAEE,KAIR,IAAK,EAAI,CAER,MAAO,MAAK,GAAK,EAAE,GAAK,KAAK,GAAK,EAAE,GAAK,KAAK,GAAK,EAAE,GAAK,KAAK,GAAK,EAAE,GAIvE,UAAW,CAEV,MAAO,MAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAInF,QAAS,CAER,MAAO,MAAK,KAAM,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,GAAK,KAAK,IAI9F,WAAY,CAEX,GAAI,GAAI,KAAK,SAEb,MAAK,KAAM,EAEV,MAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,GAIV,GAAI,EAAI,EAER,KAAK,GAAK,KAAK,GAAK,EACpB,KAAK,GAAK,KAAK,GAAK,EACpB,KAAK,GAAK,KAAK,GAAK,EACpB,KAAK,GAAK,KAAK,GAAK,GAIrB,KAAK,oBAEE,KAIR,SAAU,EAAG,EAAI,CAEhB,MAAK,KAAM,OAEV,SAAQ,KAAM,0GACP,KAAK,oBAAqB,EAAG,IAI9B,KAAK,oBAAqB,KAAM,GAIxC,YAAa,EAAI,CAEhB,MAAO,MAAK,oBAAqB,EAAG,MAIrC,oBAAqB,EAAG,EAAI,CAI3B,GAAM,GAAM,EAAE,GAAI,EAAM,EAAE,GAAI,EAAM,EAAE,GAAI,EAAM,EAAE,GAC5C,EAAM,EAAE,GAAI,EAAM,EAAE,GAAI,EAAM,EAAE,GAAI,EAAM,EAAE,GAElD,YAAK,GAAK,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACpD,KAAK,GAAK,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACpD,KAAK,GAAK,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACpD,KAAK,GAAK,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAEpD,KAAK,oBAEE,KAIR,MAAO,EAAI,EAAI,CAEd,GAAK,IAAM,EAAI,MAAO,MACtB,GAAK,IAAM,EAAI,MAAO,MAAK,KAAM,GAEjC,GAAM,GAAI,KAAK,GAAI,EAAI,KAAK,GAAI,EAAI,KAAK,GAAI,EAAI,KAAK,GAIlD,EAAe,EAAI,EAAG,GAAK,EAAI,EAAG,GAAK,EAAI,EAAG,GAAK,EAAI,EAAG,GAiB9D,GAfA,AAAK,EAAe,EAEnB,MAAK,GAAK,CAAE,EAAG,GACf,KAAK,GAAK,CAAE,EAAG,GACf,KAAK,GAAK,CAAE,EAAG,GACf,KAAK,GAAK,CAAE,EAAG,GAEf,EAAe,CAAE,GAIjB,KAAK,KAAM,GAIP,GAAgB,EAEpB,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,GAAM,GAAkB,EAAM,EAAe,EAE7C,GAAK,GAAmB,OAAO,QAAU,CAExC,GAAM,GAAI,EAAI,EACd,YAAK,GAAK,EAAI,EAAI,EAAI,KAAK,GAC3B,KAAK,GAAK,EAAI,EAAI,EAAI,KAAK,GAC3B,KAAK,GAAK,EAAI,EAAI,EAAI,KAAK,GAC3B,KAAK,GAAK,EAAI,EAAI,EAAI,KAAK,GAE3B,KAAK,YACL,KAAK,oBAEE,KAIR,GAAM,GAAe,KAAK,KAAM,GAC1B,EAAY,KAAK,MAAO,EAAc,GACtC,EAAS,KAAK,IAAO,GAAI,GAAM,GAAc,EAClD,EAAS,KAAK,IAAK,EAAI,GAAc,EAEtC,YAAK,GAAO,EAAI,EAAS,KAAK,GAAK,EACnC,KAAK,GAAO,EAAI,EAAS,KAAK,GAAK,EACnC,KAAK,GAAO,EAAI,EAAS,KAAK,GAAK,EACnC,KAAK,GAAO,EAAI,EAAS,KAAK,GAAK,EAEnC,KAAK,oBAEE,KAIR,iBAAkB,EAAI,EAAI,EAAI,CAE7B,KAAK,KAAM,GAAK,MAAO,EAAI,GAI5B,OAAQ,EAAa,CAEpB,MAAS,GAAW,KAAO,KAAK,IAAU,EAAW,KAAO,KAAK,IAAU,EAAW,KAAO,KAAK,IAAU,EAAW,KAAO,KAAK,GAIpI,UAAW,EAAO,EAAS,EAAI,CAE9B,YAAK,GAAK,EAAO,GACjB,KAAK,GAAK,EAAO,EAAS,GAC1B,KAAK,GAAK,EAAO,EAAS,GAC1B,KAAK,GAAK,EAAO,EAAS,GAE1B,KAAK,oBAEE,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,GACvB,EAAO,EAAS,GAAM,KAAK,GAC3B,EAAO,EAAS,GAAM,KAAK,GAC3B,EAAO,EAAS,GAAM,KAAK,GAEpB,EAIR,oBAAqB,EAAW,EAAQ,CAEvC,YAAK,GAAK,EAAU,KAAM,GAC1B,KAAK,GAAK,EAAU,KAAM,GAC1B,KAAK,GAAK,EAAU,KAAM,GAC1B,KAAK,GAAK,EAAU,KAAM,GAEnB,KAIR,UAAW,EAAW,CAErB,YAAK,kBAAoB,EAElB,KAIR,mBAAoB,IAIrB,GAAW,UAAU,aAAe,GCppBpC,WAAc,CAEb,YAAa,EAAI,EAAG,EAAI,EAAG,EAAI,EAAI,CAElC,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAIV,IAAK,EAAG,EAAG,EAAI,CAEd,MAAK,KAAM,QAAY,GAAI,KAAK,GAEhC,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,UAAW,EAAS,CAEnB,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,aAAc,EAAO,EAAQ,CAE5B,OAAS,OAEH,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,cACf,KAAM,IAAI,OAAO,0BAA4B,GAIvD,MAAO,MAIR,aAAc,EAAQ,CAErB,OAAS,OAEH,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,UACX,KAAM,IAAI,OAAO,0BAA4B,IAMxD,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,EAAG,KAAK,EAAG,KAAK,GAInD,KAAM,EAAI,CAET,YAAK,EAAI,EAAE,EACX,KAAK,EAAI,EAAE,EACX,KAAK,EAAI,EAAE,EAEJ,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,gBAAiB,EAAG,EAAI,CAEvB,YAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAET,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,SAAU,EAAG,EAAI,CAEhB,MAAK,KAAM,OAEV,SAAQ,KAAM,mGACP,KAAK,gBAAiB,EAAG,IAIjC,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,eAAgB,EAAS,CAExB,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,gBAAiB,EAAG,EAAI,CAEvB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,WAAY,EAAQ,CAEnB,MAAS,IAAS,EAAM,SAEvB,QAAQ,MAAO,+FAIT,KAAK,gBAAiB,GAAY,aAAc,IAIxD,eAAgB,EAAM,EAAQ,CAE7B,MAAO,MAAK,gBAAiB,GAAY,iBAAkB,EAAM,IAIlE,aAAc,EAAI,CAEjB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EACjC,EAAI,EAAE,SAEZ,YAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAC5C,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAC5C,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAErC,KAIR,kBAAmB,EAAI,CAEtB,MAAO,MAAK,aAAc,GAAI,YAI/B,aAAc,EAAI,CAEjB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EACjC,EAAI,EAAE,SAEN,EAAI,EAAM,GAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAAI,EAAG,KAE3D,YAAK,EAAM,GAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,KAAS,EAC9D,KAAK,EAAM,GAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,KAAS,EAC9D,KAAK,EAAM,GAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAAI,EAAG,KAAS,EAExD,KAIR,gBAAiB,EAAI,CAEpB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EACjC,EAAK,EAAE,EAAG,EAAK,EAAE,EAAG,EAAK,EAAE,EAAG,EAAK,EAAE,EAIrC,EAAK,EAAK,EAAI,EAAK,EAAI,EAAK,EAC5B,EAAK,EAAK,EAAI,EAAK,EAAI,EAAK,EAC5B,EAAK,EAAK,EAAI,EAAK,EAAI,EAAK,EAC5B,EAAK,CAAE,EAAK,EAAI,EAAK,EAAI,EAAK,EAIpC,YAAK,EAAI,EAAK,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAClD,KAAK,EAAI,EAAK,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAClD,KAAK,EAAI,EAAK,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAAK,EAAK,CAAE,EAE3C,KAIR,QAAS,EAAS,CAEjB,MAAO,MAAK,aAAc,EAAO,oBAAqB,aAAc,EAAO,kBAI5E,UAAW,EAAS,CAEnB,MAAO,MAAK,aAAc,EAAO,yBAA0B,aAAc,EAAO,aAIjF,mBAAoB,EAAI,CAKvB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EACjC,EAAI,EAAE,SAEZ,YAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAC5C,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAC5C,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAEtC,KAAK,YAIb,OAAQ,EAAI,CAEX,YAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,KAIR,aAAc,EAAS,CAEtB,MAAO,MAAK,eAAgB,EAAI,GAIjC,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,MAAO,EAAK,EAAM,CAIjB,YAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAEzC,KAIR,YAAa,EAAQ,EAAS,CAE7B,YAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAE3C,KAIR,YAAa,EAAK,EAAM,CAEvB,GAAM,GAAS,KAAK,SAEpB,MAAO,MAAK,aAAc,GAAU,GAAI,eAAgB,KAAK,IAAK,EAAK,KAAK,IAAK,EAAK,KAIvF,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,MAAO,CAEN,YAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GAElB,KAIR,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,aAAc,CAEb,YAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GAE1D,KAIR,QAAS,CAER,YAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAET,KAIR,IAAK,EAAI,CAER,MAAO,MAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAMjD,UAAW,CAEV,MAAO,MAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAI1D,QAAS,CAER,MAAO,MAAK,KAAM,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,GAIrE,iBAAkB,CAEjB,MAAO,MAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAIjE,WAAY,CAEX,MAAO,MAAK,aAAc,KAAK,UAAY,GAI5C,UAAW,EAAS,CAEnB,MAAO,MAAK,YAAY,eAAgB,GAIzC,KAAM,EAAG,EAAQ,CAEhB,YAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAEtB,KAIR,YAAa,EAAI,EAAI,EAAQ,CAE5B,YAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAE3B,KAIR,MAAO,EAAG,EAAI,CAEb,MAAK,KAAM,OAEV,SAAQ,KAAM,6FACP,KAAK,aAAc,EAAG,IAIvB,KAAK,aAAc,KAAM,GAIjC,aAAc,EAAG,EAAI,CAEpB,GAAM,GAAK,EAAE,EAAG,EAAK,EAAE,EAAG,EAAK,EAAE,EAC3B,EAAK,EAAE,EAAG,EAAK,EAAE,EAAG,EAAK,EAAE,EAEjC,YAAK,EAAI,EAAK,EAAK,EAAK,EACxB,KAAK,EAAI,EAAK,EAAK,EAAK,EACxB,KAAK,EAAI,EAAK,EAAK,EAAK,EAEjB,KAIR,gBAAiB,EAAI,CAEpB,GAAM,GAAc,EAAE,WAEtB,GAAK,IAAgB,EAAI,MAAO,MAAK,IAAK,EAAG,EAAG,GAEhD,GAAM,GAAS,EAAE,IAAK,MAAS,EAE/B,MAAO,MAAK,KAAM,GAAI,eAAgB,GAIvC,eAAgB,EAAc,CAE7B,UAAQ,KAAM,MAAO,gBAAiB,GAE/B,KAAK,IAAK,IAIlB,QAAS,EAAS,CAKjB,MAAO,MAAK,IAAK,GAAQ,KAAM,GAAS,eAAgB,EAAI,KAAK,IAAK,KAIvE,QAAS,EAAI,CAEZ,GAAM,GAAc,KAAK,KAAM,KAAK,WAAa,EAAE,YAEnD,GAAK,IAAgB,EAAI,MAAO,MAAK,GAAK,EAE1C,GAAM,GAAQ,KAAK,IAAK,GAAM,EAI9B,MAAO,MAAK,KAAM,AAAU,GAAO,EAAO,GAAK,IAIhD,WAAY,EAAI,CAEf,MAAO,MAAK,KAAM,KAAK,kBAAmB,IAI3C,kBAAmB,EAAI,CAEtB,GAAM,GAAK,KAAK,EAAI,EAAE,EAAG,EAAK,KAAK,EAAI,EAAE,EAAG,EAAK,KAAK,EAAI,EAAE,EAE5D,MAAO,GAAK,EAAK,EAAK,EAAK,EAAK,EAIjC,oBAAqB,EAAI,CAExB,MAAO,MAAK,IAAK,KAAK,EAAI,EAAE,GAAM,KAAK,IAAK,KAAK,EAAI,EAAE,GAAM,KAAK,IAAK,KAAK,EAAI,EAAE,GAInF,iBAAkB,EAAI,CAErB,MAAO,MAAK,uBAAwB,EAAE,OAAQ,EAAE,IAAK,EAAE,OAIxD,uBAAwB,EAAQ,EAAK,EAAQ,CAE5C,GAAM,GAAe,KAAK,IAAK,GAAQ,EAEvC,YAAK,EAAI,EAAe,KAAK,IAAK,GAClC,KAAK,EAAI,KAAK,IAAK,GAAQ,EAC3B,KAAK,EAAI,EAAe,KAAK,IAAK,GAE3B,KAIR,mBAAoB,EAAI,CAEvB,MAAO,MAAK,yBAA0B,EAAE,OAAQ,EAAE,MAAO,EAAE,GAI5D,yBAA0B,EAAQ,EAAO,EAAI,CAE5C,YAAK,EAAI,EAAS,KAAK,IAAK,GAC5B,KAAK,EAAI,EACT,KAAK,EAAI,EAAS,KAAK,IAAK,GAErB,KAIR,sBAAuB,EAAI,CAE1B,GAAM,GAAI,EAAE,SAEZ,YAAK,EAAI,EAAG,IACZ,KAAK,EAAI,EAAG,IACZ,KAAK,EAAI,EAAG,IAEL,KAIR,mBAAoB,EAAI,CAEvB,GAAM,GAAK,KAAK,oBAAqB,EAAG,GAAI,SACtC,EAAK,KAAK,oBAAqB,EAAG,GAAI,SACtC,EAAK,KAAK,oBAAqB,EAAG,GAAI,SAE5C,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,oBAAqB,EAAG,EAAQ,CAE/B,MAAO,MAAK,UAAW,EAAE,SAAU,EAAQ,GAI5C,qBAAsB,EAAG,EAAQ,CAEhC,MAAO,MAAK,UAAW,EAAE,SAAU,EAAQ,GAI5C,OAAQ,EAAI,CAEX,MAAW,GAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,EAIrE,UAAW,EAAO,EAAS,EAAI,CAE9B,YAAK,EAAI,EAAO,GAChB,KAAK,EAAI,EAAO,EAAS,GACzB,KAAK,EAAI,EAAO,EAAS,GAElB,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,EACvB,EAAO,EAAS,GAAM,KAAK,EAC3B,EAAO,EAAS,GAAM,KAAK,EAEpB,EAIR,oBAAqB,EAAW,EAAO,EAAS,CAE/C,MAAK,KAAW,QAEf,QAAQ,KAAM,uEAIf,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GAElB,KAIR,QAAS,CAER,YAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SAEP,OAMT,EAAQ,UAAU,UAAY,GAE9B,GAAM,IAAwB,GAAI,GAC5B,GAA4B,GAAI,IC5sBtC,YAAc,CAEb,aAAc,CAEb,KAAK,SAAW,CAEf,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIL,UAAU,OAAS,GAEvB,QAAQ,MAAO,iFAMjB,IAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAM,CAErF,GAAM,GAAK,KAAK,SAEhB,SAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,IAAO,EACxD,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,IAAO,EACxD,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,IAAO,EAAK,EAAI,IAAO,EACzD,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,IAAO,EAAK,EAAI,IAAO,EAElD,KAIR,UAAW,CAEV,YAAK,IAEJ,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIH,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAU,UAAW,KAAK,UAItC,KAAM,EAAI,CAET,GAAM,GAAK,KAAK,SACV,EAAK,EAAE,SAEb,SAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GACvE,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GACvE,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,IAAO,EAAI,IAAM,EAAI,IAAO,EAAI,IAC1E,EAAI,IAAO,EAAI,IAAM,EAAI,IAAO,EAAI,IAAM,EAAI,IAAO,EAAI,IAAM,EAAI,IAAO,EAAI,IAEvE,KAIR,aAAc,EAAI,CAEjB,GAAM,GAAK,KAAK,SAAU,EAAK,EAAE,SAEjC,SAAI,IAAO,EAAI,IACf,EAAI,IAAO,EAAI,IACf,EAAI,IAAO,EAAI,IAER,KAIR,eAAgB,EAAI,CAEnB,GAAM,GAAK,EAAE,SAEb,YAAK,IAEJ,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAC3B,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAC3B,EAAI,GAAK,EAAI,GAAK,EAAI,GAAK,EAC3B,EAAG,EAAG,EAAG,GAIH,KAIR,aAAc,EAAO,EAAO,EAAQ,CAEnC,SAAM,oBAAqB,KAAM,GACjC,EAAM,oBAAqB,KAAM,GACjC,EAAM,oBAAqB,KAAM,GAE1B,KAIR,UAAW,EAAO,EAAO,EAAQ,CAEhC,YAAK,IACJ,EAAM,EAAG,EAAM,EAAG,EAAM,EAAG,EAC3B,EAAM,EAAG,EAAM,EAAG,EAAM,EAAG,EAC3B,EAAM,EAAG,EAAM,EAAG,EAAM,EAAG,EAC3B,EAAG,EAAG,EAAG,GAGH,KAIR,gBAAiB,EAAI,CAIpB,GAAM,GAAK,KAAK,SACV,EAAK,EAAE,SAEP,EAAS,EAAI,GAAI,oBAAqB,EAAG,GAAI,SAC7C,EAAS,EAAI,GAAI,oBAAqB,EAAG,GAAI,SAC7C,EAAS,EAAI,GAAI,oBAAqB,EAAG,GAAI,SAEnD,SAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAEV,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAEV,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,GAAM,EAAI,GAAM,EACpB,EAAI,IAAO,EAAI,IAAO,EACtB,EAAI,IAAO,EAEX,EAAI,IAAO,EACX,EAAI,IAAO,EACX,EAAI,IAAO,EACX,EAAI,IAAO,EAEJ,KAIR,sBAAuB,EAAQ,CAE9B,AAAS,GAAS,EAAM,SAEvB,QAAQ,MAAO,yGAIhB,GAAM,GAAK,KAAK,SAEV,EAAI,EAAM,EAAG,EAAI,EAAM,EAAG,EAAI,EAAM,EACpC,EAAI,KAAK,IAAK,GAAK,EAAI,KAAK,IAAK,GACjC,EAAI,KAAK,IAAK,GAAK,EAAI,KAAK,IAAK,GACjC,EAAI,KAAK,IAAK,GAAK,EAAI,KAAK,IAAK,GAEvC,GAAK,EAAM,QAAU,MAAQ,CAE5B,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,CAAE,EAAI,EAChB,EAAI,GAAM,EAEV,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,CAAE,EAAI,EAEhB,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,IAAO,EAAI,UAEJ,EAAM,QAAU,MAAQ,CAEnC,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAI,EAEd,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,CAAE,EAEZ,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,IAAO,EAAI,UAEJ,EAAM,QAAU,MAAQ,CAEnC,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,CAAE,EAAI,EAChB,EAAI,GAAM,EAAK,EAAK,EAEpB,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAK,EAAK,EAEpB,EAAI,GAAM,CAAE,EAAI,EAChB,EAAI,GAAM,EACV,EAAI,IAAO,EAAI,UAEJ,EAAM,QAAU,MAAQ,CAEnC,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAK,EAAI,EAEnB,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAK,EAAI,EAEnB,EAAI,GAAM,CAAE,EACZ,EAAI,GAAM,EAAI,EACd,EAAI,IAAO,EAAI,UAEJ,EAAM,QAAU,MAAQ,CAEnC,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAK,EAAK,EACpB,EAAI,GAAM,EAAK,EAAI,EAEnB,EAAI,GAAM,EACV,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,CAAE,EAAI,EAEhB,EAAI,GAAM,CAAE,EAAI,EAChB,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,IAAO,EAAK,EAAK,UAEV,EAAM,QAAU,MAAQ,CAEnC,GAAM,GAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAEnD,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,CAAE,EACZ,EAAI,GAAM,EAAI,EAEd,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAI,EACd,EAAI,GAAM,EAAK,EAAI,EAEnB,EAAI,GAAM,EAAK,EAAI,EACnB,EAAI,GAAM,EAAI,EACd,EAAI,IAAO,EAAK,EAAI,EAKrB,SAAI,GAAM,EACV,EAAI,GAAM,EACV,EAAI,IAAO,EAGX,EAAI,IAAO,EACX,EAAI,IAAO,EACX,EAAI,IAAO,EACX,EAAI,IAAO,EAEJ,KAIR,2BAA4B,EAAI,CAE/B,MAAO,MAAK,QAAS,GAAO,EAAG,IAIhC,OAAQ,EAAK,EAAQ,EAAK,CAEzB,GAAM,GAAK,KAAK,SAEhB,UAAG,WAAY,EAAK,GAEf,GAAG,aAAe,GAItB,IAAG,EAAI,GAIR,GAAG,YACH,GAAG,aAAc,EAAI,IAEhB,GAAG,aAAe,GAItB,CAAK,KAAK,IAAK,EAAG,KAAQ,EAEzB,GAAG,GAAK,KAIR,GAAG,GAAK,KAIT,GAAG,YACH,GAAG,aAAc,EAAI,KAItB,GAAG,YACH,GAAG,aAAc,GAAI,IAErB,EAAI,GAAM,GAAG,EAAG,EAAI,GAAM,GAAG,EAAG,EAAI,GAAM,GAAG,EAC7C,EAAI,GAAM,GAAG,EAAG,EAAI,GAAM,GAAG,EAAG,EAAI,GAAM,GAAG,EAC7C,EAAI,GAAM,GAAG,EAAG,EAAI,GAAM,GAAG,EAAG,EAAI,IAAO,GAAG,EAEvC,KAIR,SAAU,EAAG,EAAI,CAEhB,MAAK,KAAM,OAEV,SAAQ,KAAM,oGACP,KAAK,iBAAkB,EAAG,IAI3B,KAAK,iBAAkB,KAAM,GAIrC,YAAa,EAAI,CAEhB,MAAO,MAAK,iBAAkB,EAAG,MAIlC,iBAAkB,EAAG,EAAI,CAExB,GAAM,GAAK,EAAE,SACP,EAAK,EAAE,SACP,EAAK,KAAK,SAEV,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IACxD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IAExD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IACxD,GAAM,EAAI,GAAK,GAAM,EAAI,GAAK,GAAM,EAAI,IAAM,GAAM,EAAI,IAE9D,SAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAErD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAErD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACrD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAErD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACpD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GACrD,EAAI,IAAO,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAE9C,KAIR,eAAgB,EAAI,CAEnB,GAAM,GAAK,KAAK,SAEhB,SAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EACtD,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EACtD,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EAAG,EAAI,KAAQ,EACvD,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EAAG,EAAI,KAAQ,EAEhD,KAIR,aAAc,CAEb,GAAM,GAAK,KAAK,SAEV,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IACxD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IAK9D,MACC,GACC,EAAE,EAAM,EAAM,EACX,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,GAEhB,EACC,EAAE,EAAM,EAAM,EACX,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,GAEhB,EACC,EAAE,EAAM,EAAM,EACX,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,GAEhB,EACC,EAAE,EAAM,EAAM,EACX,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,EACZ,EAAM,EAAM,GAOlB,WAAY,CAEX,GAAM,GAAK,KAAK,SACZ,EAEJ,SAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAC5C,EAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAC5C,EAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAE5C,EAAM,EAAI,GAAK,EAAI,GAAM,EAAI,IAAM,EAAI,IAAO,EAC9C,EAAM,EAAI,GAAK,EAAI,GAAM,EAAI,IAAM,EAAI,IAAO,EAC9C,EAAM,EAAI,IAAM,EAAI,IAAO,EAAI,IAAM,EAAI,IAAO,EAEzC,KAIR,YAAa,EAAG,EAAG,EAAI,CAEtB,GAAM,GAAK,KAAK,SAEhB,MAAK,GAAE,UAEN,GAAI,IAAO,EAAE,EACb,EAAI,IAAO,EAAE,EACb,EAAI,IAAO,EAAE,GAIb,GAAI,IAAO,EACX,EAAI,IAAO,EACX,EAAI,IAAO,GAIL,KAIR,QAAS,CAGR,GAAM,GAAK,KAAK,SAEf,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAAM,EAAM,EAAI,IACxD,EAAM,EAAI,IAAM,EAAM,EAAI,IAAM,EAAM,EAAI,IAAM,EAAM,EAAI,IAE1D,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAC5G,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAC5G,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAC5G,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAEvG,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAEtD,GAAK,IAAQ,EAAI,MAAO,MAAK,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE/E,GAAM,GAAS,EAAI,EAEnB,SAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC1H,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC1H,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAE1H,EAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC1H,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC1H,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAE1H,EAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC1H,EAAI,IAAS,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC3H,EAAI,IAAS,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAE3H,EAAI,IAAO,EAAM,EACjB,EAAI,IAAS,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC3H,EAAI,IAAS,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAC3H,EAAI,IAAS,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,GAAQ,EAEpH,KAIR,MAAO,EAAI,CAEV,GAAM,GAAK,KAAK,SACV,EAAI,EAAE,EAAG,EAAI,EAAE,EAAG,EAAI,EAAE,EAE9B,SAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EACvC,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EACvC,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EACxC,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,KAAQ,EAEjC,KAIR,mBAAoB,CAEnB,GAAM,GAAK,KAAK,SAEV,EAAW,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GACjE,EAAW,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GACjE,EAAW,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,GAAM,EAAI,IAAO,EAAI,IAExE,MAAO,MAAK,KAAM,KAAK,IAAK,EAAU,EAAU,IAIjD,gBAAiB,EAAG,EAAG,EAAI,CAE1B,YAAK,IAEJ,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIH,KAIR,cAAe,EAAQ,CAEtB,GAAM,GAAI,KAAK,IAAK,GAAS,EAAI,KAAK,IAAK,GAE3C,YAAK,IAEJ,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,CAAE,EAAG,EACX,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIH,KAIR,cAAe,EAAQ,CAEtB,GAAM,GAAI,KAAK,IAAK,GAAS,EAAI,KAAK,IAAK,GAE3C,YAAK,IAEH,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACV,CAAE,EAAG,EAAG,EAAG,EACV,EAAG,EAAG,EAAG,GAIJ,KAIR,cAAe,EAAQ,CAEtB,GAAM,GAAI,KAAK,IAAK,GAAS,EAAI,KAAK,IAAK,GAE3C,YAAK,IAEJ,EAAG,CAAE,EAAG,EAAG,EACX,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIH,KAIR,iBAAkB,EAAM,EAAQ,CAI/B,GAAM,GAAI,KAAK,IAAK,GACd,EAAI,KAAK,IAAK,GACd,EAAI,EAAI,EACR,EAAI,EAAK,EAAG,EAAI,EAAK,EAAG,EAAI,EAAK,EACjC,EAAK,EAAI,EAAG,EAAK,EAAI,EAE3B,YAAK,IAEJ,EAAK,EAAI,EAAG,EAAK,EAAI,EAAI,EAAG,EAAK,EAAI,EAAI,EAAG,EAC5C,EAAK,EAAI,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EAAI,EAAG,EAC5C,EAAK,EAAI,EAAI,EAAG,EAAK,EAAI,EAAI,EAAG,EAAI,EAAI,EAAI,EAAG,EAC/C,EAAG,EAAG,EAAG,GAIH,KAIR,UAAW,EAAG,EAAG,EAAI,CAEpB,YAAK,IAEJ,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,GAIH,KAIR,UAAW,EAAI,EAAI,EAAI,EAAI,EAAI,EAAK,CAEnC,YAAK,IAEJ,EAAG,EAAI,EAAI,EACX,EAAI,EAAG,EAAI,EACX,EAAI,EAAI,EAAG,EACX,EAAG,EAAG,EAAG,GAIH,KAIR,QAAS,EAAU,EAAY,EAAQ,CAEtC,GAAM,GAAK,KAAK,SAEV,EAAI,EAAW,GAAI,EAAI,EAAW,GAAI,EAAI,EAAW,GAAI,EAAI,EAAW,GACxE,EAAK,EAAI,EAAG,EAAK,EAAI,EAAG,EAAK,EAAI,EACjC,EAAK,EAAI,EAAI,EAAK,EAAI,EAAI,EAAK,EAAI,EACnC,EAAK,EAAI,EAAI,EAAK,EAAI,EAAI,EAAK,EAAI,EACnC,EAAK,EAAI,EAAI,EAAK,EAAI,EAAI,EAAK,EAAI,EAEnC,EAAK,EAAM,EAAG,EAAK,EAAM,EAAG,EAAK,EAAM,EAE7C,SAAI,GAAQ,GAAM,GAAK,IAAS,EAChC,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,GAAM,EAEV,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,GAAQ,GAAM,GAAK,IAAS,EAChC,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,GAAM,EAEV,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,GAAQ,GAAK,GAAO,EACxB,EAAI,IAAS,GAAM,GAAK,IAAS,EACjC,EAAI,IAAO,EAEX,EAAI,IAAO,EAAS,EACpB,EAAI,IAAO,EAAS,EACpB,EAAI,IAAO,EAAS,EACpB,EAAI,IAAO,EAEJ,KAIR,UAAW,EAAU,EAAY,EAAQ,CAExC,GAAM,GAAK,KAAK,SAEZ,EAAK,GAAI,IAAK,EAAI,GAAK,EAAI,GAAK,EAAI,IAAM,SACxC,EAAK,GAAI,IAAK,EAAI,GAAK,EAAI,GAAK,EAAI,IAAM,SAC1C,EAAK,GAAI,IAAK,EAAI,GAAK,EAAI,GAAK,EAAI,KAAO,SAIjD,AAAK,AADO,KAAK,cACN,GAAI,GAAK,CAAE,GAEtB,EAAS,EAAI,EAAI,IACjB,EAAS,EAAI,EAAI,IACjB,EAAS,EAAI,EAAI,IAGjB,GAAI,KAAM,MAEV,GAAM,GAAQ,EAAI,EACZ,EAAQ,EAAI,EACZ,EAAQ,EAAI,EAElB,UAAI,SAAU,IAAO,EACrB,GAAI,SAAU,IAAO,EACrB,GAAI,SAAU,IAAO,EAErB,GAAI,SAAU,IAAO,EACrB,GAAI,SAAU,IAAO,EACrB,GAAI,SAAU,IAAO,EAErB,GAAI,SAAU,IAAO,EACrB,GAAI,SAAU,IAAO,EACrB,GAAI,SAAU,KAAQ,EAEtB,EAAW,sBAAuB,IAElC,EAAM,EAAI,EACV,EAAM,EAAI,EACV,EAAM,EAAI,EAEH,KAIR,gBAAiB,EAAM,EAAO,EAAK,EAAQ,EAAM,EAAM,CAEtD,AAAK,IAAQ,QAEZ,QAAQ,KAAM,wGAIf,GAAM,GAAK,KAAK,SACV,EAAI,EAAI,EAAS,GAAQ,GACzB,EAAI,EAAI,EAAS,GAAM,GAEvB,EAAM,GAAQ,GAAW,GAAQ,GACjC,EAAM,GAAM,GAAa,GAAM,GAC/B,EAAI,CAAI,GAAM,GAAW,GAAM,GAC/B,EAAI,GAAM,EAAM,EAAS,GAAM,GAErC,SAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,EAClD,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,EAClD,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EACnD,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,GAAK,EAAI,IAAO,EAE9C,KAIR,iBAAkB,EAAM,EAAO,EAAK,EAAQ,EAAM,EAAM,CAEvD,GAAM,GAAK,KAAK,SACV,EAAI,EAAQ,GAAQ,GACpB,EAAI,EAAQ,GAAM,GAClB,EAAI,EAAQ,GAAM,GAElB,EAAM,GAAQ,GAAS,EACvB,EAAM,GAAM,GAAW,EACvB,EAAM,GAAM,GAAS,EAE3B,SAAI,GAAM,EAAI,EAAG,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,CAAE,EACxD,EAAI,GAAM,EAAG,EAAI,GAAM,EAAI,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,CAAE,EACxD,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,GAAM,EAAG,EAAI,IAAO,CAAE,EAC3D,EAAI,GAAM,EAAG,EAAI,GAAM,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EAE5C,KAIR,OAAQ,EAAS,CAEhB,GAAM,GAAK,KAAK,SACV,EAAK,EAAO,SAElB,OAAU,GAAI,EAAG,EAAI,GAAI,IAExB,GAAK,EAAI,KAAQ,EAAI,GAAM,MAAO,GAInC,MAAO,GAIR,UAAW,EAAO,EAAS,EAAI,CAE9B,OAAU,GAAI,EAAG,EAAI,GAAI,IAExB,KAAK,SAAU,GAAM,EAAO,EAAI,GAIjC,MAAO,MAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,GAAM,GAAK,KAAK,SAEhB,SAAO,GAAW,EAAI,GACtB,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAE1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAE1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,IAAO,EAAI,IAC3B,EAAO,EAAS,IAAO,EAAI,IAE3B,EAAO,EAAS,IAAO,EAAI,IAC3B,EAAO,EAAS,IAAO,EAAI,IAC3B,EAAO,EAAS,IAAO,EAAI,IAC3B,EAAO,EAAS,IAAO,EAAI,IAEpB,IAMT,GAAQ,UAAU,UAAY,GAE9B,GAAM,IAAoB,GAAI,GACxB,GAAoB,GAAI,IACxB,GAAsB,GAAI,GAAS,EAAG,EAAG,GACzC,GAAqB,GAAI,GAAS,EAAG,EAAG,GACxC,GAAmB,GAAI,GACvB,GAAmB,GAAI,GACvB,GAAmB,GAAI,GC92B7B,YAAsB,CAErB,iBAAkB,EAAM,EAAW,CAElC,AAAK,KAAK,aAAe,QAAY,MAAK,WAAa,IAEvD,GAAM,GAAY,KAAK,WAEvB,AAAK,EAAW,KAAW,QAE1B,GAAW,GAAS,IAIhB,EAAW,GAAO,QAAS,KAAe,IAE9C,EAAW,GAAO,KAAM,GAM1B,iBAAkB,EAAM,EAAW,CAElC,GAAK,KAAK,aAAe,OAAY,MAAO,GAE5C,GAAM,GAAY,KAAK,WAEvB,MAAO,GAAW,KAAW,QAAa,EAAW,GAAO,QAAS,KAAe,GAIrF,oBAAqB,EAAM,EAAW,CAErC,GAAK,KAAK,aAAe,OAAY,OAGrC,GAAM,GAAgB,AADJ,KAAK,WACU,GAEjC,GAAK,IAAkB,OAAY,CAElC,GAAM,GAAQ,EAAc,QAAS,GAErC,AAAK,IAAU,IAEd,EAAc,OAAQ,EAAO,IAQhC,cAAe,EAAQ,CAEtB,GAAK,KAAK,aAAe,OAAY,OAGrC,GAAM,GAAgB,AADJ,KAAK,WACU,EAAM,MAEvC,GAAK,IAAkB,OAAY,CAElC,EAAM,OAAS,KAGf,GAAM,GAAQ,EAAc,MAAO,GAEnC,OAAU,GAAI,EAAG,EAAI,EAAM,OAAQ,EAAI,EAAG,IAEzC,EAAO,GAAI,KAAM,KAAM,GAIxB,EAAM,OAAS,QCxElB,GAAM,IAAwB,GAAI,IAC5B,GAA4B,GAAI,IAEtC,QAAY,CAEX,YAAa,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAQ,GAAM,aAAe,CAE9D,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,OAAS,KAIX,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,IAAI,CAEP,MAAO,MAAK,MAIT,GAAG,EAAQ,CAEd,KAAK,GAAK,EACV,KAAK,uBAIF,QAAQ,CAEX,MAAO,MAAK,UAIT,OAAO,EAAQ,CAElB,KAAK,OAAS,EACd,KAAK,oBAIN,IAAK,EAAG,EAAG,EAAG,EAAQ,KAAK,OAAS,CAEnC,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,OAAS,EAEd,KAAK,oBAEE,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,GAAI,KAAK,GAAI,KAAK,GAAI,KAAK,QAI9D,KAAM,EAAQ,CAEb,YAAK,GAAK,EAAM,GAChB,KAAK,GAAK,EAAM,GAChB,KAAK,GAAK,EAAM,GAChB,KAAK,OAAS,EAAM,OAEpB,KAAK,oBAEE,KAIR,sBAAuB,EAAG,EAAQ,KAAK,OAAQ,EAAS,GAAO,CAI9D,GAAM,GAAK,EAAE,SACP,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAE9C,OAAS,OAEH,MAEJ,KAAK,GAAK,KAAK,KAAM,GAAO,EAAK,GAAK,IAEtC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,CAAE,EAAK,GAC7B,KAAK,GAAK,KAAK,MAAO,CAAE,EAAK,IAI7B,MAAK,GAAK,KAAK,MAAO,EAAK,GAC3B,KAAK,GAAK,GAIX,UAEI,MAEJ,KAAK,GAAK,KAAK,KAAM,CAAE,GAAO,EAAK,GAAK,IAExC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,EAAK,GAC3B,KAAK,GAAK,KAAK,MAAO,EAAK,IAI3B,MAAK,GAAK,KAAK,MAAO,CAAE,EAAK,GAC7B,KAAK,GAAK,GAIX,UAEI,MAEJ,KAAK,GAAK,KAAK,KAAM,GAAO,EAAK,GAAK,IAEtC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,CAAE,EAAK,GAC7B,KAAK,GAAK,KAAK,MAAO,CAAE,EAAK,IAI7B,MAAK,GAAK,EACV,KAAK,GAAK,KAAK,MAAO,EAAK,IAI5B,UAEI,MAEJ,KAAK,GAAK,KAAK,KAAM,CAAE,GAAO,EAAK,GAAK,IAExC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,EAAK,GAC3B,KAAK,GAAK,KAAK,MAAO,EAAK,IAI3B,MAAK,GAAK,EACV,KAAK,GAAK,KAAK,MAAO,CAAE,EAAK,IAI9B,UAEI,MAEJ,KAAK,GAAK,KAAK,KAAM,GAAO,EAAK,GAAK,IAEtC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,CAAE,EAAK,GAC7B,KAAK,GAAK,KAAK,MAAO,CAAE,EAAK,IAI7B,MAAK,GAAK,EACV,KAAK,GAAK,KAAK,MAAO,EAAK,IAI5B,UAEI,MAEJ,KAAK,GAAK,KAAK,KAAM,CAAE,GAAO,EAAK,GAAK,IAExC,AAAK,KAAK,IAAK,GAAQ,SAEtB,MAAK,GAAK,KAAK,MAAO,EAAK,GAC3B,KAAK,GAAK,KAAK,MAAO,EAAK,IAI3B,MAAK,GAAK,KAAK,MAAO,CAAE,EAAK,GAC7B,KAAK,GAAK,GAIX,cAIA,QAAQ,KAAM,uEAAyE,GAIzF,YAAK,OAAS,EAET,IAAW,IAAO,KAAK,oBAErB,KAIR,kBAAmB,EAAG,EAAO,EAAS,CAErC,UAAQ,2BAA4B,GAE7B,KAAK,sBAAuB,GAAS,EAAO,GAIpD,eAAgB,EAAG,EAAQ,KAAK,OAAS,CAExC,MAAO,MAAK,IAAK,EAAE,EAAG,EAAE,EAAG,EAAE,EAAG,GAIjC,QAAS,EAAW,CAInB,UAAY,aAAc,MAEnB,KAAK,kBAAmB,GAAa,GAI7C,OAAQ,EAAQ,CAEf,MAAS,GAAM,KAAO,KAAK,IAAU,EAAM,KAAO,KAAK,IAAU,EAAM,KAAO,KAAK,IAAU,EAAM,SAAW,KAAK,OAIpH,UAAW,EAAQ,CAElB,YAAK,GAAK,EAAO,GACjB,KAAK,GAAK,EAAO,GACjB,KAAK,GAAK,EAAO,GACZ,EAAO,KAAQ,QAAY,MAAK,OAAS,EAAO,IAErD,KAAK,oBAEE,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,GACvB,EAAO,EAAS,GAAM,KAAK,GAC3B,EAAO,EAAS,GAAM,KAAK,GAC3B,EAAO,EAAS,GAAM,KAAK,OAEpB,EAIR,UAAW,EAAiB,CAE3B,MAAK,GAEG,EAAe,IAAK,KAAK,GAAI,KAAK,GAAI,KAAK,IAI3C,GAAI,GAAS,KAAK,GAAI,KAAK,GAAI,KAAK,IAM7C,UAAW,EAAW,CAErB,YAAK,kBAAoB,EAElB,KAIR,mBAAoB,IAIrB,GAAM,UAAU,QAAU,GAE1B,GAAM,aAAe,MACrB,GAAM,eAAiB,CAAE,MAAO,MAAO,MAAO,MAAO,MAAO,OC/T5D,YAAa,CAEZ,aAAc,CAEb,KAAK,KAAO,EAAI,EAIjB,IAAK,EAAU,CAEd,KAAK,KAAO,GAAK,EAAU,EAI5B,OAAQ,EAAU,CAEjB,KAAK,MAAQ,GAAK,EAAU,EAI7B,WAAY,CAEX,KAAK,KAAO,WAAa,EAI1B,OAAQ,EAAU,CAEjB,KAAK,MAAQ,GAAK,EAAU,EAI7B,QAAS,EAAU,CAElB,KAAK,MAAQ,CAAI,IAAK,EAAU,GAIjC,YAAa,CAEZ,KAAK,KAAO,EAIb,KAAM,EAAS,CAEd,MAAS,MAAK,KAAO,EAAO,OAAW,IC9CzC,YAAc,CAEb,aAAc,CAEb,KAAK,SAAW,CAEf,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAIF,UAAU,OAAS,GAEvB,QAAQ,MAAO,iFAMjB,IAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAM,CAElD,GAAM,GAAK,KAAK,SAEhB,SAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,GAAM,EACxC,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,GAAM,EACxC,EAAI,GAAM,EAAK,EAAI,GAAM,EAAK,EAAI,GAAM,EAEjC,KAIR,UAAW,CAEV,YAAK,IAEJ,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GAIA,KAIR,KAAM,EAAI,CAET,GAAM,GAAK,KAAK,SACV,EAAK,EAAE,SAEb,SAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GACpD,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GACpD,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAAK,EAAI,GAAM,EAAI,GAE7C,KAIR,aAAc,EAAO,EAAO,EAAQ,CAEnC,SAAM,qBAAsB,KAAM,GAClC,EAAM,qBAAsB,KAAM,GAClC,EAAM,qBAAsB,KAAM,GAE3B,KAIR,eAAgB,EAAI,CAEnB,GAAM,GAAK,EAAE,SAEb,YAAK,IAEJ,EAAI,GAAK,EAAI,GAAK,EAAI,GACtB,EAAI,GAAK,EAAI,GAAK,EAAI,GACtB,EAAI,GAAK,EAAI,GAAK,EAAI,KAIhB,KAIR,SAAU,EAAI,CAEb,MAAO,MAAK,iBAAkB,KAAM,GAIrC,YAAa,EAAI,CAEhB,MAAO,MAAK,iBAAkB,EAAG,MAIlC,iBAAkB,EAAG,EAAI,CAExB,GAAM,GAAK,EAAE,SACP,EAAK,EAAE,SACP,EAAK,KAAK,SAEV,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAExC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAE9C,SAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAExC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAExC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EACxC,EAAI,GAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAEjC,KAIR,eAAgB,EAAI,CAEnB,GAAM,GAAK,KAAK,SAEhB,SAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EACvC,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EACvC,EAAI,IAAO,EAAG,EAAI,IAAO,EAAG,EAAI,IAAO,EAEhC,KAIR,aAAc,CAEb,GAAM,GAAK,KAAK,SAEV,EAAI,EAAI,GAAK,EAAI,EAAI,GAAK,EAAI,EAAI,GACvC,EAAI,EAAI,GAAK,EAAI,EAAI,GAAK,EAAI,EAAI,GAClC,EAAI,EAAI,GAAK,EAAI,EAAI,GAAK,EAAI,EAAI,GAEnC,MAAO,GAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAI5E,QAAS,CAER,GAAM,GAAK,KAAK,SAEf,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAExC,EAAM,EAAM,EAAM,EAAM,EACxB,EAAM,EAAM,EAAM,EAAM,EACxB,EAAM,EAAM,EAAM,EAAM,EAExB,EAAM,EAAM,EAAM,EAAM,EAAM,EAAM,EAErC,GAAK,IAAQ,EAAI,MAAO,MAAK,IAAK,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAE1D,GAAM,GAAS,EAAI,EAEnB,SAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EACtC,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EAEtC,EAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EACtC,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EAEtC,EAAI,GAAM,EAAM,EAChB,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EACtC,EAAI,GAAQ,GAAM,EAAM,EAAM,GAAQ,EAE/B,KAIR,WAAY,CAEX,GAAI,GACE,EAAI,KAAK,SAEf,SAAM,EAAG,GAAK,EAAG,GAAM,EAAG,GAAK,EAAG,GAAM,EACxC,EAAM,EAAG,GAAK,EAAG,GAAM,EAAG,GAAK,EAAG,GAAM,EACxC,EAAM,EAAG,GAAK,EAAG,GAAM,EAAG,GAAK,EAAG,GAAM,EAEjC,KAIR,gBAAiB,EAAU,CAE1B,MAAO,MAAK,eAAgB,GAAU,SAAS,YAIhD,mBAAoB,EAAI,CAEvB,GAAM,GAAI,KAAK,SAEf,SAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GACZ,EAAG,GAAM,EAAG,GAEL,KAIR,eAAgB,EAAI,EAAI,EAAI,EAAI,EAAU,EAAI,EAAK,CAElD,GAAM,GAAI,KAAK,IAAK,GACd,EAAI,KAAK,IAAK,GAEpB,YAAK,IACJ,EAAK,EAAG,EAAK,EAAG,CAAE,EAAO,GAAI,EAAK,EAAI,GAAO,EAAK,EAClD,CAAE,EAAK,EAAG,EAAK,EAAG,CAAE,EAAO,EAAE,EAAI,EAAK,EAAI,GAAO,EAAK,EACtD,EAAG,EAAG,GAGA,KAIR,MAAO,EAAI,EAAK,CAEf,GAAM,GAAK,KAAK,SAEhB,SAAI,IAAO,EAAI,EAAI,IAAO,EAAI,EAAI,IAAO,EACzC,EAAI,IAAO,EAAI,EAAI,IAAO,EAAI,EAAI,IAAO,EAElC,KAIR,OAAQ,EAAQ,CAEf,GAAM,GAAI,KAAK,IAAK,GACd,EAAI,KAAK,IAAK,GAEd,EAAK,KAAK,SAEV,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAE9C,SAAI,GAAM,EAAI,EAAM,EAAI,EACxB,EAAI,GAAM,EAAI,EAAM,EAAI,EACxB,EAAI,GAAM,EAAI,EAAM,EAAI,EAExB,EAAI,GAAM,CAAE,EAAI,EAAM,EAAI,EAC1B,EAAI,GAAM,CAAE,EAAI,EAAM,EAAI,EAC1B,EAAI,GAAM,CAAE,EAAI,EAAM,EAAI,EAEnB,KAIR,UAAW,EAAI,EAAK,CAEnB,GAAM,GAAK,KAAK,SAEhB,SAAI,IAAO,EAAK,EAAI,GAAK,EAAI,IAAO,EAAK,EAAI,GAAK,EAAI,IAAO,EAAK,EAAI,GACtE,EAAI,IAAO,EAAK,EAAI,GAAK,EAAI,IAAO,EAAK,EAAI,GAAK,EAAI,IAAO,EAAK,EAAI,GAE/D,KAIR,OAAQ,EAAS,CAEhB,GAAM,GAAK,KAAK,SACV,EAAK,EAAO,SAElB,OAAU,GAAI,EAAG,EAAI,EAAG,IAEvB,GAAK,EAAI,KAAQ,EAAI,GAAM,MAAO,GAInC,MAAO,GAIR,UAAW,EAAO,EAAS,EAAI,CAE9B,OAAU,GAAI,EAAG,EAAI,EAAG,IAEvB,KAAK,SAAU,GAAM,EAAO,EAAI,GAIjC,MAAO,MAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,GAAM,GAAK,KAAK,SAEhB,SAAO,GAAW,EAAI,GACtB,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAE1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAE1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAC1B,EAAO,EAAS,GAAM,EAAI,GAEnB,EAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,UAAW,KAAK,YAMhD,GAAQ,UAAU,UAAY,GCvU9B,GAAI,IAAc,EAEZ,GAAoB,GAAI,GACxB,GAAoB,GAAI,IACxB,GAAoB,GAAI,IACxB,GAAwB,GAAI,GAE5B,GAA0B,GAAI,GAC9B,GAAuB,GAAI,GAC3B,GAA4B,GAAI,IAEhC,GAAuB,GAAI,GAAS,EAAG,EAAG,GAC1C,GAAuB,GAAI,GAAS,EAAG,EAAG,GAC1C,GAAuB,GAAI,GAAS,EAAG,EAAG,GAE1C,GAAc,CAAE,KAAM,SACtB,GAAgB,CAAE,KAAM,WAE9B,gBAAuB,GAAgB,CAEtC,aAAc,CAEb,QAEA,OAAO,eAAgB,KAAM,KAAM,CAAE,MAAO,OAE5C,KAAK,KAAO,AAAU,KAEtB,KAAK,KAAO,GACZ,KAAK,KAAO,WAEZ,KAAK,OAAS,KACd,KAAK,SAAW,GAEhB,KAAK,GAAK,GAAS,UAAU,QAE7B,GAAM,GAAW,GAAI,GACf,EAAW,GAAI,IACf,EAAa,GAAI,IACjB,EAAQ,GAAI,GAAS,EAAG,EAAG,GAEjC,YAA4B,CAE3B,EAAW,aAAc,EAAU,IAIpC,YAA8B,CAE7B,EAAS,kBAAmB,EAAY,OAAW,IAIpD,EAAS,UAAW,GACpB,EAAW,UAAW,GAEtB,OAAO,iBAAkB,KAAM,CAC9B,SAAU,CACT,aAAc,GACd,WAAY,GACZ,MAAO,GAER,SAAU,CACT,aAAc,GACd,WAAY,GACZ,MAAO,GAER,WAAY,CACX,aAAc,GACd,WAAY,GACZ,MAAO,GAER,MAAO,CACN,aAAc,GACd,WAAY,GACZ,MAAO,GAER,gBAAiB,CAChB,MAAO,GAAI,KAEZ,aAAc,CACb,MAAO,GAAI,OAIb,KAAK,OAAS,GAAI,IAClB,KAAK,YAAc,GAAI,IAEvB,KAAK,iBAAmB,GAAS,wBACjC,KAAK,uBAAyB,GAE9B,KAAK,OAAS,GAAI,IAClB,KAAK,QAAU,GAEf,KAAK,WAAa,GAClB,KAAK,cAAgB,GAErB,KAAK,cAAgB,GACrB,KAAK,YAAc,EAEnB,KAAK,WAAa,GAElB,KAAK,SAAW,GAIjB,gBAAiB,EACjB,eAAgB,EAEhB,aAAc,EAAS,CAEtB,AAAK,KAAK,kBAAmB,KAAK,eAElC,KAAK,OAAO,YAAa,GAEzB,KAAK,OAAO,UAAW,KAAK,SAAU,KAAK,WAAY,KAAK,OAI7D,gBAAiB,EAAI,CAEpB,YAAK,WAAW,YAAa,GAEtB,KAIR,yBAA0B,EAAM,EAAQ,CAIvC,KAAK,WAAW,iBAAkB,EAAM,GAIzC,qBAAsB,EAAQ,CAE7B,KAAK,WAAW,aAAc,EAAO,IAItC,sBAAuB,EAAI,CAI1B,KAAK,WAAW,sBAAuB,GAIxC,0BAA2B,EAAI,CAI9B,KAAK,WAAW,KAAM,GAIvB,aAAc,EAAM,EAAQ,CAK3B,UAAI,iBAAkB,EAAM,GAE5B,KAAK,WAAW,SAAU,IAEnB,KAIR,kBAAmB,EAAM,EAAQ,CAMhC,UAAI,iBAAkB,EAAM,GAE5B,KAAK,WAAW,YAAa,IAEtB,KAIR,QAAS,EAAQ,CAEhB,MAAO,MAAK,aAAc,GAAQ,GAInC,QAAS,EAAQ,CAEhB,MAAO,MAAK,aAAc,GAAQ,GAInC,QAAS,EAAQ,CAEhB,MAAO,MAAK,aAAc,GAAQ,GAInC,gBAAiB,EAAM,EAAW,CAKjC,UAAI,KAAM,GAAO,gBAAiB,KAAK,YAEvC,KAAK,SAAS,IAAK,GAAI,eAAgB,IAEhC,KAIR,WAAY,EAAW,CAEtB,MAAO,MAAK,gBAAiB,GAAQ,GAItC,WAAY,EAAW,CAEtB,MAAO,MAAK,gBAAiB,GAAQ,GAItC,WAAY,EAAW,CAEtB,MAAO,MAAK,gBAAiB,GAAQ,GAItC,aAAc,EAAS,CAEtB,MAAO,GAAO,aAAc,KAAK,aAIlC,aAAc,EAAS,CAEtB,MAAO,GAAO,aAAc,GAAI,KAAM,KAAK,aAAc,UAI1D,OAAQ,EAAG,EAAG,EAAI,CAIjB,AAAK,EAAE,UAEN,GAAQ,KAAM,GAId,GAAQ,IAAK,EAAG,EAAG,GAIpB,GAAM,GAAS,KAAK,OAEpB,KAAK,kBAAmB,GAAM,IAE9B,GAAU,sBAAuB,KAAK,aAEtC,AAAK,KAAK,UAAY,KAAK,QAE1B,GAAI,OAAQ,GAAW,GAAS,KAAK,IAIrC,GAAI,OAAQ,GAAS,GAAW,KAAK,IAItC,KAAK,WAAW,sBAAuB,IAElC,GAEJ,IAAI,gBAAiB,EAAO,aAC5B,GAAI,sBAAuB,IAC3B,KAAK,WAAW,YAAa,GAAI,WAMnC,IAAK,EAAS,CAEb,GAAK,UAAU,OAAS,EAAI,CAE3B,OAAU,GAAI,EAAG,EAAI,UAAU,OAAQ,IAEtC,KAAK,IAAK,UAAW,IAItB,MAAO,MAIR,MAAK,KAAW,KAEf,SAAQ,MAAO,kEAAoE,GAC5E,MAIR,CAAK,GAAU,EAAO,WAEhB,GAAO,SAAW,MAEtB,EAAO,OAAO,OAAQ,GAIvB,EAAO,OAAS,KAChB,KAAK,SAAS,KAAM,GAEpB,EAAO,cAAe,KAItB,QAAQ,MAAO,gEAAiE,GAI1E,MAIR,OAAQ,EAAS,CAEhB,GAAK,UAAU,OAAS,EAAI,CAE3B,OAAU,GAAI,EAAG,EAAI,UAAU,OAAQ,IAEtC,KAAK,OAAQ,UAAW,IAIzB,MAAO,MAIR,GAAM,GAAQ,KAAK,SAAS,QAAS,GAErC,MAAK,KAAU,IAEd,GAAO,OAAS,KAChB,KAAK,SAAS,OAAQ,EAAO,GAE7B,EAAO,cAAe,KAIhB,KAIR,kBAAmB,CAElB,GAAM,GAAS,KAAK,OAEpB,MAAK,KAAW,MAEf,EAAO,OAAQ,MAIT,KAIR,OAAQ,CAEP,OAAU,GAAI,EAAG,EAAI,KAAK,SAAS,OAAQ,IAAO,CAEjD,GAAM,GAAS,KAAK,SAAU,GAE9B,EAAO,OAAS,KAEhB,EAAO,cAAe,IAIvB,YAAK,SAAS,OAAS,EAEhB,KAKR,OAAQ,EAAS,CAIhB,YAAK,kBAAmB,GAAM,IAE9B,GAAI,KAAM,KAAK,aAAc,SAExB,EAAO,SAAW,MAEtB,GAAO,OAAO,kBAAmB,GAAM,IAEvC,GAAI,SAAU,EAAO,OAAO,cAI7B,EAAO,aAAc,IAErB,KAAK,IAAK,GAEV,EAAO,kBAAmB,GAAO,IAE1B,KAIR,cAAe,EAAK,CAEnB,MAAO,MAAK,oBAAqB,KAAM,GAIxC,gBAAiB,EAAO,CAEvB,MAAO,MAAK,oBAAqB,OAAQ,GAI1C,oBAAqB,EAAM,EAAQ,CAElC,GAAK,KAAM,KAAW,EAAQ,MAAO,MAErC,OAAU,GAAI,EAAG,EAAI,KAAK,SAAS,OAAQ,EAAI,EAAG,IAAO,CAGxD,GAAM,GAAS,AADD,KAAK,SAAU,GACR,oBAAqB,EAAM,GAEhD,GAAK,IAAW,OAEf,MAAO,IAUV,iBAAkB,EAAS,CAE1B,YAAK,kBAAmB,GAAM,IAEvB,EAAO,sBAAuB,KAAK,aAI3C,mBAAoB,EAAS,CAE5B,YAAK,kBAAmB,GAAM,IAE9B,KAAK,YAAY,UAAW,GAAW,EAAQ,IAExC,EAIR,cAAe,EAAS,CAEvB,YAAK,kBAAmB,GAAM,IAE9B,KAAK,YAAY,UAAW,GAAW,GAAa,GAE7C,EAIR,kBAAmB,EAAS,CAE3B,KAAK,kBAAmB,GAAM,IAE9B,GAAM,GAAI,KAAK,YAAY,SAE3B,MAAO,GAAO,IAAK,EAAG,GAAK,EAAG,GAAK,EAAG,KAAO,YAI9C,SAAU,EAEV,SAAU,EAAW,CAEpB,EAAU,MAEV,GAAM,GAAW,KAAK,SAEtB,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAI,EAAG,IAE5C,EAAU,GAAI,SAAU,GAM1B,gBAAiB,EAAW,CAE3B,GAAK,KAAK,UAAY,GAAQ,OAE9B,EAAU,MAEV,GAAM,GAAW,KAAK,SAEtB,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAI,EAAG,IAE5C,EAAU,GAAI,gBAAiB,GAMjC,kBAAmB,EAAW,CAE7B,GAAM,GAAS,KAAK,OAEpB,AAAK,IAAW,MAEf,GAAU,GAEV,EAAO,kBAAmB,IAM5B,cAAe,CAEd,KAAK,OAAO,QAAS,KAAK,SAAU,KAAK,WAAY,KAAK,OAE1D,KAAK,uBAAyB,GAI/B,kBAAmB,EAAQ,CAE1B,AAAK,KAAK,kBAAmB,KAAK,eAE7B,MAAK,wBAA0B,IAEnC,CAAK,KAAK,SAAW,KAEpB,KAAK,YAAY,KAAM,KAAK,QAI5B,KAAK,YAAY,iBAAkB,KAAK,OAAO,YAAa,KAAK,QAIlE,KAAK,uBAAyB,GAE9B,EAAQ,IAMT,GAAM,GAAW,KAAK,SAEtB,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAI,EAAG,IAE5C,EAAU,GAAI,kBAAmB,GAMnC,kBAAmB,EAAe,EAAiB,CAElD,GAAM,GAAS,KAAK,OAsBpB,GApBK,IAAkB,IAAQ,IAAW,MAEzC,EAAO,kBAAmB,GAAM,IAI5B,KAAK,kBAAmB,KAAK,eAElC,AAAK,KAAK,SAAW,KAEpB,KAAK,YAAY,KAAM,KAAK,QAI5B,KAAK,YAAY,iBAAkB,KAAK,OAAO,YAAa,KAAK,QAM7D,IAAmB,GAAO,CAE9B,GAAM,GAAW,KAAK,SAEtB,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAI,EAAG,IAE5C,EAAU,GAAI,kBAAmB,GAAO,KAQ3C,OAAQ,EAAO,CAGd,GAAM,GAAiB,IAAS,QAAa,MAAO,IAAS,SAEvD,EAAS,GAKf,AAAK,GAGJ,GAAO,CACN,WAAY,GACZ,UAAW,GACX,SAAU,GACV,OAAQ,GACR,OAAQ,GACR,UAAW,GACX,WAAY,IAGb,EAAO,SAAW,CACjB,QAAS,IACT,KAAM,SACN,UAAW,oBAOb,GAAM,GAAS,GAEf,EAAO,KAAO,KAAK,KACnB,EAAO,KAAO,KAAK,KAEd,KAAK,OAAS,IAAK,GAAO,KAAO,KAAK,MACtC,KAAK,aAAe,IAAO,GAAO,WAAa,IAC/C,KAAK,gBAAkB,IAAO,GAAO,cAAgB,IACrD,KAAK,UAAY,IAAQ,GAAO,QAAU,IAC1C,KAAK,gBAAkB,IAAQ,GAAO,cAAgB,IACtD,KAAK,cAAgB,GAAI,GAAO,YAAc,KAAK,aACnD,KAAK,UAAW,KAAK,YAAe,MAAO,GAAO,SAAW,KAAK,UAEvE,EAAO,OAAS,KAAK,OAAO,KAC5B,EAAO,OAAS,KAAK,OAAO,UAEvB,KAAK,mBAAqB,IAAQ,GAAO,iBAAmB,IAI5D,KAAK,iBAET,GAAO,KAAO,gBACd,EAAO,MAAQ,KAAK,MACpB,EAAO,eAAiB,KAAK,eAAe,SACvC,KAAK,gBAAkB,MAAO,GAAO,cAAgB,KAAK,cAAc,WAM9E,WAAoB,EAAS,EAAU,CAEtC,MAAK,GAAS,EAAQ,QAAW,QAEhC,GAAS,EAAQ,MAAS,EAAQ,OAAQ,IAIpC,EAAQ,KAIhB,GAAK,KAAK,QAET,AAAK,KAAK,YAET,CAAK,KAAK,WAAW,QAEpB,EAAO,WAAa,KAAK,WAAW,SAEzB,KAAK,WAAW,WAE3B,GAAO,WAAa,KAAK,WAAW,OAAQ,GAAO,OAMhD,KAAK,aAAe,KAAK,YAAY,WAEzC,GAAO,YAAc,KAAK,YAAY,OAAQ,GAAO,cAI3C,KAAK,QAAU,KAAK,QAAU,KAAK,SAAW,CAEzD,EAAO,SAAW,EAAW,EAAK,WAAY,KAAK,UAEnD,GAAM,GAAa,KAAK,SAAS,WAEjC,GAAK,IAAe,QAAa,EAAW,SAAW,OAAY,CAElE,GAAM,GAAS,EAAW,OAE1B,GAAK,MAAM,QAAS,GAEnB,OAAU,GAAI,EAAG,EAAI,EAAO,OAAQ,EAAI,EAAG,IAAO,CAEjD,GAAM,GAAQ,EAAQ,GAEtB,EAAW,EAAK,OAAQ,OAMzB,GAAW,EAAK,OAAQ,IAuB3B,GAfK,KAAK,eAET,GAAO,SAAW,KAAK,SACvB,EAAO,WAAa,KAAK,WAAW,UAE/B,KAAK,WAAa,QAEtB,GAAW,EAAK,UAAW,KAAK,UAEhC,EAAO,SAAW,KAAK,SAAS,OAM7B,KAAK,WAAa,OAEtB,GAAK,MAAM,QAAS,KAAK,UAAa,CAErC,GAAM,GAAQ,GAEd,OAAU,GAAI,EAAG,EAAI,KAAK,SAAS,OAAQ,EAAI,EAAG,IAEjD,EAAM,KAAM,EAAW,EAAK,UAAW,KAAK,SAAU,KAIvD,EAAO,SAAW,MAIlB,GAAO,SAAW,EAAW,EAAK,UAAW,KAAK,UAQpD,GAAK,KAAK,SAAS,OAAS,EAAI,CAE/B,EAAO,SAAW,GAElB,OAAU,GAAI,EAAG,EAAI,KAAK,SAAS,OAAQ,IAE1C,EAAO,SAAS,KAAM,KAAK,SAAU,GAAI,OAAQ,GAAO,QAQ1D,GAAK,KAAK,WAAW,OAAS,EAAI,CAEjC,EAAO,WAAa,GAEpB,OAAU,GAAI,EAAG,EAAI,KAAK,WAAW,OAAQ,IAAO,CAEnD,GAAM,GAAY,KAAK,WAAY,GAEnC,EAAO,WAAW,KAAM,EAAW,EAAK,WAAY,KAMtD,GAAK,EAAe,CAEnB,GAAM,GAAa,EAAkB,EAAK,YACpC,EAAY,EAAkB,EAAK,WACnC,EAAW,EAAkB,EAAK,UAClC,EAAS,EAAkB,EAAK,QAChC,EAAS,EAAkB,EAAK,QAChC,EAAY,EAAkB,EAAK,WACnC,EAAa,EAAkB,EAAK,YAE1C,AAAK,EAAW,OAAS,GAAI,GAAO,WAAa,GAC5C,EAAU,OAAS,GAAI,GAAO,UAAY,GAC1C,EAAS,OAAS,GAAI,GAAO,SAAW,GACxC,EAAO,OAAS,GAAI,GAAO,OAAS,GACpC,EAAO,OAAS,GAAI,GAAO,OAAS,GACpC,EAAU,OAAS,GAAI,GAAO,UAAY,GAC1C,EAAW,OAAS,GAAI,GAAO,WAAa,GAIlD,SAAO,OAAS,EAET,EAKP,WAA2B,EAAQ,CAElC,GAAM,GAAS,GACf,OAAY,KAAO,GAAQ,CAE1B,GAAM,GAAO,EAAO,GACpB,MAAO,GAAK,SACZ,EAAO,KAAM,GAId,MAAO,IAMT,MAAO,EAAY,CAElB,MAAO,IAAI,MAAK,cAAc,KAAM,KAAM,GAI3C,KAAM,EAAQ,EAAY,GAAO,CA4BhC,GA1BA,KAAK,KAAO,EAAO,KAEnB,KAAK,GAAG,KAAM,EAAO,IAErB,KAAK,SAAS,KAAM,EAAO,UAC3B,KAAK,SAAS,MAAQ,EAAO,SAAS,MACtC,KAAK,WAAW,KAAM,EAAO,YAC7B,KAAK,MAAM,KAAM,EAAO,OAExB,KAAK,OAAO,KAAM,EAAO,QACzB,KAAK,YAAY,KAAM,EAAO,aAE9B,KAAK,iBAAmB,EAAO,iBAC/B,KAAK,uBAAyB,EAAO,uBAErC,KAAK,OAAO,KAAO,EAAO,OAAO,KACjC,KAAK,QAAU,EAAO,QAEtB,KAAK,WAAa,EAAO,WACzB,KAAK,cAAgB,EAAO,cAE5B,KAAK,cAAgB,EAAO,cAC5B,KAAK,YAAc,EAAO,YAE1B,KAAK,SAAW,KAAK,MAAO,KAAK,UAAW,EAAO,WAE9C,IAAc,GAElB,OAAU,GAAI,EAAG,EAAI,EAAO,SAAS,OAAQ,IAAO,CAEnD,GAAM,GAAQ,EAAO,SAAU,GAC/B,KAAK,IAAK,EAAM,SAMlB,MAAO,QAMT,GAAS,UAAY,GAAI,GAAS,EAAG,EAAG,GACxC,GAAS,wBAA0B,GAEnC,GAAS,UAAU,WAAa,GCn5BhC,oBAAqB,GAAS,CAE7B,aAAc,CAEb,QAEA,KAAK,KAAO,SAEZ,KAAK,mBAAqB,GAAI,IAE9B,KAAK,iBAAmB,GAAI,IAC5B,KAAK,wBAA0B,GAAI,IAIpC,KAAM,EAAQ,EAAY,CAEzB,aAAM,KAAM,EAAQ,GAEpB,KAAK,mBAAmB,KAAM,EAAO,oBAErC,KAAK,iBAAiB,KAAM,EAAO,kBACnC,KAAK,wBAAwB,KAAM,EAAO,yBAEnC,KAIR,kBAAmB,EAAS,CAE3B,KAAK,kBAAmB,GAAM,IAE9B,GAAM,GAAI,KAAK,YAAY,SAE3B,MAAO,GAAO,IAAK,CAAE,EAAG,GAAK,CAAE,EAAG,GAAK,CAAE,EAAG,KAAO,YAIpD,kBAAmB,EAAQ,CAE1B,MAAM,kBAAmB,GAEzB,KAAK,mBAAmB,KAAM,KAAK,aAAc,SAIlD,kBAAmB,EAAe,EAAiB,CAElD,MAAM,kBAAmB,EAAe,GAExC,KAAK,mBAAmB,KAAM,KAAK,aAAc,SAIlD,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,QAMtC,GAAO,UAAU,SAAW,GC9D5B,oBAAgC,GAAO,CAEtC,YAAa,EAAM,GAAI,EAAS,EAAG,EAAO,GAAK,EAAM,IAAO,CAE3D,QAEA,KAAK,KAAO,oBAEZ,KAAK,IAAM,EACX,KAAK,KAAO,EAEZ,KAAK,KAAO,EACZ,KAAK,IAAM,EACX,KAAK,MAAQ,GAEb,KAAK,OAAS,EACd,KAAK,KAAO,KAEZ,KAAK,UAAY,GACjB,KAAK,WAAa,EAElB,KAAK,yBAIN,KAAM,EAAQ,EAAY,CAEzB,aAAM,KAAM,EAAQ,GAEpB,KAAK,IAAM,EAAO,IAClB,KAAK,KAAO,EAAO,KAEnB,KAAK,KAAO,EAAO,KACnB,KAAK,IAAM,EAAO,IAClB,KAAK,MAAQ,EAAO,MAEpB,KAAK,OAAS,EAAO,OACrB,KAAK,KAAO,EAAO,OAAS,KAAO,KAAO,OAAO,OAAQ,GAAI,EAAO,MAEpE,KAAK,UAAY,EAAO,UACxB,KAAK,WAAa,EAAO,WAElB,KAYR,eAAgB,EAAc,CAG7B,GAAM,GAAe,GAAM,KAAK,gBAAkB,EAElD,KAAK,IAAM,AAAU,GAAU,EAAI,KAAK,KAAM,GAC9C,KAAK,yBAON,gBAAiB,CAEhB,GAAM,GAAe,KAAK,IAAK,AAAU,GAAU,GAAM,KAAK,KAE9D,MAAO,IAAM,KAAK,gBAAkB,EAIrC,iBAAkB,CAEjB,MAAO,AAAU,IAAU,EAAI,KAAK,KACnC,KAAK,IAAK,AAAU,GAAU,GAAM,KAAK,KAAQ,KAAK,MAIxD,cAAe,CAGd,MAAO,MAAK,UAAY,KAAK,IAAK,KAAK,OAAQ,GAIhD,eAAgB,CAGf,MAAO,MAAK,UAAY,KAAK,IAAK,KAAK,OAAQ,GAuChD,cAAe,EAAW,EAAY,EAAG,EAAG,EAAO,EAAS,CAE3D,KAAK,OAAS,EAAY,EAErB,KAAK,OAAS,MAElB,MAAK,KAAO,CACX,QAAS,GACT,UAAW,EACX,WAAY,EACZ,QAAS,EACT,QAAS,EACT,MAAO,EACP,OAAQ,IAKV,KAAK,KAAK,QAAU,GACpB,KAAK,KAAK,UAAY,EACtB,KAAK,KAAK,WAAa,EACvB,KAAK,KAAK,QAAU,EACpB,KAAK,KAAK,QAAU,EACpB,KAAK,KAAK,MAAQ,EAClB,KAAK,KAAK,OAAS,EAEnB,KAAK,yBAIN,iBAAkB,CAEjB,AAAK,KAAK,OAAS,MAElB,MAAK,KAAK,QAAU,IAIrB,KAAK,yBAIN,wBAAyB,CAExB,GAAM,GAAO,KAAK,KACd,EAAM,EAAO,KAAK,IAAK,AAAU,GAAU,GAAM,KAAK,KAAQ,KAAK,KACnE,EAAS,EAAI,EACb,EAAQ,KAAK,OAAS,EACtB,EAAO,IAAQ,EACb,EAAO,KAAK,KAElB,GAAK,KAAK,OAAS,MAAQ,KAAK,KAAK,QAAU,CAE9C,GAAM,GAAY,EAAK,UACtB,EAAa,EAAK,WAEnB,GAAQ,EAAK,QAAU,EAAQ,EAC/B,GAAO,EAAK,QAAU,EAAS,EAC/B,GAAS,EAAK,MAAQ,EACtB,GAAU,EAAK,OAAS,EAIzB,GAAM,GAAO,KAAK,WAClB,AAAK,IAAS,GAAI,IAAQ,EAAO,EAAO,KAAK,gBAE7C,KAAK,iBAAiB,gBAAiB,EAAM,EAAO,EAAO,EAAK,EAAM,EAAQ,EAAM,KAAK,KAEzF,KAAK,wBAAwB,KAAM,KAAK,kBAAmB,SAI5D,OAAQ,EAAO,CAEd,GAAM,GAAO,MAAM,OAAQ,GAE3B,SAAK,OAAO,IAAM,KAAK,IACvB,EAAK,OAAO,KAAO,KAAK,KAExB,EAAK,OAAO,KAAO,KAAK,KACxB,EAAK,OAAO,IAAM,KAAK,IACvB,EAAK,OAAO,MAAQ,KAAK,MAEzB,EAAK,OAAO,OAAS,KAAK,OAErB,KAAK,OAAS,MAAO,GAAK,OAAO,KAAO,OAAO,OAAQ,GAAI,KAAK,OAErE,EAAK,OAAO,UAAY,KAAK,UAC7B,EAAK,OAAO,WAAa,KAAK,WAEvB,IAMT,GAAkB,UAAU,oBAAsB,GClOlD,GAAM,IAA0B,GAAI,IAC9B,GAAyB,GAAI,IAEnC,QAAmB,CAElB,aAAc,CAEb,KAAK,KAAO,eAEZ,KAAK,OAAS,EAEd,KAAK,OAAS,KAEd,KAAK,QAAU,GAAI,IACnB,KAAK,QAAQ,OAAO,OAAQ,GAC5B,KAAK,QAAQ,iBAAmB,GAEhC,KAAK,QAAU,GAAI,IACnB,KAAK,QAAQ,OAAO,OAAQ,GAC5B,KAAK,QAAQ,iBAAmB,GAEhC,KAAK,OAAS,CACb,MAAO,KACP,IAAK,KACL,OAAQ,KACR,KAAM,KACN,IAAK,KACL,KAAM,KACN,OAAQ,MAKV,OAAQ,EAAS,CAEhB,GAAM,GAAQ,KAAK,OAMnB,GAJoB,EAAM,QAAU,EAAO,OAAS,EAAM,MAAQ,EAAO,KACxE,EAAM,SAAW,EAAO,OAAS,KAAK,QAAU,EAAM,OAAS,EAAO,MACtE,EAAM,MAAQ,EAAO,KAAO,EAAM,OAAS,EAAO,MAAQ,EAAM,SAAW,KAAK,OAE9D,CAElB,EAAM,MAAQ,EAAO,MACrB,EAAM,IAAM,EAAO,IACnB,EAAM,OAAS,EAAO,OAAS,KAAK,OACpC,EAAM,KAAO,EAAO,KACpB,EAAM,IAAM,EAAO,IACnB,EAAM,KAAO,EAAO,KACpB,EAAM,OAAS,KAAK,OAKpB,GAAM,GAAmB,EAAO,iBAAiB,QAC3C,EAAa,EAAM,OAAS,EAC5B,EAAqB,EAAa,EAAM,KAAO,EAAM,MACrD,EAAS,EAAM,KAAO,KAAK,IAAK,AAAU,GAAU,EAAM,IAAM,IAAU,EAAM,KAClF,EAAM,EAIV,GAAS,SAAU,IAAO,CAAE,EAC5B,GAAU,SAAU,IAAO,EAI3B,EAAO,CAAE,EAAO,EAAM,OAAS,EAC/B,EAAO,EAAO,EAAM,OAAS,EAE7B,EAAiB,SAAU,GAAM,EAAI,EAAM,KAAS,GAAO,GAC3D,EAAiB,SAAU,GAAQ,GAAO,GAAW,GAAO,GAE5D,KAAK,QAAQ,iBAAiB,KAAM,GAIpC,EAAO,CAAE,EAAO,EAAM,OAAS,EAC/B,EAAO,EAAO,EAAM,OAAS,EAE7B,EAAiB,SAAU,GAAM,EAAI,EAAM,KAAS,GAAO,GAC3D,EAAiB,SAAU,GAAQ,GAAO,GAAW,GAAO,GAE5D,KAAK,QAAQ,iBAAiB,KAAM,GAIrC,KAAK,QAAQ,YAAY,KAAM,EAAO,aAAc,SAAU,IAC9D,KAAK,QAAQ,YAAY,KAAM,EAAO,aAAc,SAAU,MC1FhE,oBAAoB,GAAS,CAE5B,aAAc,CAEb,QAEA,KAAK,KAAO,QAEZ,KAAK,WAAa,KAClB,KAAK,YAAc,KACnB,KAAK,IAAM,KAEX,KAAK,iBAAmB,KAExB,KAAK,WAAa,GAEb,MAAO,qBAAuB,aAElC,mBAAmB,cAAe,GAAI,aAAa,UAAW,CAAE,OAAQ,QAM1E,KAAM,EAAQ,EAAY,CAEzB,aAAM,KAAM,EAAQ,GAEf,EAAO,aAAe,MAAO,MAAK,WAAa,EAAO,WAAW,SACjE,EAAO,cAAgB,MAAO,MAAK,YAAc,EAAO,YAAY,SACpE,EAAO,MAAQ,MAAO,MAAK,IAAM,EAAO,IAAI,SAE5C,EAAO,mBAAqB,MAAO,MAAK,iBAAmB,EAAO,iBAAiB,SAExF,KAAK,WAAa,EAAO,WACzB,KAAK,iBAAmB,EAAO,iBAExB,KAIR,OAAQ,EAAO,CAEd,GAAM,GAAO,MAAM,OAAQ,GAE3B,MAAK,MAAK,MAAQ,MAAO,GAAK,OAAO,IAAM,KAAK,IAAI,UAE7C,IAMT,GAAM,UAAU,QAAU,GCrD1B,GAAM,IAAiB,CAAE,UAAa,SAAU,aAAgB,SAAU,KAAQ,MAAU,WAAc,QAAU,MAAS,SAC5H,MAAS,SAAU,OAAU,SAAU,MAAS,EAAU,eAAkB,SAAU,KAAQ,IAAU,WAAc,QACtH,MAAS,SAAU,UAAa,SAAU,UAAa,QAAU,WAAc,QAAU,UAAa,SAAU,MAAS,SACzH,eAAkB,QAAU,SAAY,SAAU,QAAW,SAAU,KAAQ,MAAU,SAAY,IAAU,SAAY,MAC3H,cAAiB,SAAU,SAAY,SAAU,UAAa,MAAU,SAAY,SAAU,UAAa,SAAU,YAAe,QACpI,eAAkB,QAAU,WAAc,SAAU,WAAc,SAAU,QAAW,QAAU,WAAc,SAAU,aAAgB,QACzI,cAAiB,QAAU,cAAiB,QAAU,cAAiB,QAAU,cAAiB,MAAU,WAAc,QAC1H,SAAY,SAAU,YAAe,MAAU,QAAW,QAAU,QAAW,QAAU,WAAc,QAAU,UAAa,SAC9H,YAAe,SAAU,YAAe,QAAU,QAAW,SAAU,UAAa,SAAU,WAAc,SAAU,KAAQ,SAC9H,UAAa,SAAU,KAAQ,QAAU,MAAS,MAAU,YAAe,SAAU,KAAQ,QAAU,SAAY,SAAU,QAAW,SACxI,UAAa,SAAU,OAAU,QAAU,MAAS,SAAU,MAAS,SAAU,SAAY,SAAU,cAAiB,SAAU,UAAa,QAC/I,aAAgB,SAAU,UAAa,SAAU,WAAc,SAAU,UAAa,SAAU,qBAAwB,SAAU,UAAa,SAC/I,WAAc,QAAU,UAAa,SAAU,UAAa,SAAU,YAAe,SAAU,cAAiB,QAAU,aAAgB,QAC1I,eAAkB,QAAU,eAAkB,QAAU,eAAkB,SAAU,YAAe,SAAU,KAAQ,MAAU,UAAa,QAC5I,MAAS,SAAU,QAAW,SAAU,OAAU,QAAU,iBAAoB,QAAU,WAAc,IAAU,aAAgB,SAClI,aAAgB,QAAU,eAAkB,QAAU,gBAAmB,QAAU,kBAAqB,MAAU,gBAAmB,QACrI,gBAAmB,SAAU,aAAgB,QAAU,UAAa,SAAU,UAAa,SAAU,SAAY,SAAU,YAAe,SAC1I,KAAQ,IAAU,QAAW,SAAU,MAAS,QAAU,UAAa,QAAU,OAAU,SAAU,UAAa,SAAU,OAAU,SACtI,cAAiB,SAAU,UAAa,SAAU,cAAiB,SAAU,cAAiB,SAAU,WAAc,SAAU,UAAa,SAC7I,KAAQ,SAAU,KAAQ,SAAU,KAAQ,SAAU,WAAc,SAAU,OAAU,QAAU,cAAiB,QAAU,IAAO,SAAU,UAAa,SAC3J,UAAa,QAAU,YAAe,QAAU,OAAU,SAAU,WAAc,SAAU,SAAY,QAAU,SAAY,SAC9H,OAAU,SAAU,OAAU,SAAU,QAAW,QAAU,UAAa,QAAU,UAAa,QAAU,UAAa,QAAU,KAAQ,SAC1I,YAAe,MAAU,UAAa,QAAU,IAAO,SAAU,KAAQ,MAAU,QAAW,SAAU,OAAU,SAAU,UAAa,QACzI,OAAU,SAAU,MAAS,SAAU,MAAS,SAAU,WAAc,SAAU,OAAU,SAAU,YAAe,UAEhH,GAAQ,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,GACzB,GAAQ,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,GAE/B,YAAkB,EAAG,EAAG,EAAI,CAI3B,MAFK,GAAI,GAAI,IAAK,GACb,EAAI,GAAI,IAAK,GACb,EAAI,EAAI,EAAW,EAAM,GAAI,GAAM,EAAI,EACvC,EAAI,EAAI,EAAW,EACnB,EAAI,EAAI,EAAW,EAAM,GAAI,GAAM,EAAM,GAAI,EAAI,GAC/C,EAIR,YAAuB,EAAI,CAE1B,MAAS,GAAI,OAAY,EAAI,YAAe,KAAK,IAAK,EAAI,YAAe,YAAc,KAIxF,YAAuB,EAAI,CAE1B,MAAS,GAAI,SAAc,EAAI,MAAQ,MAAU,KAAK,IAAK,EAAG,QAAc,KAI7E,YAAY,CAEX,YAAa,EAAG,EAAG,EAAI,CAEtB,MAAK,KAAM,QAAa,IAAM,OAGtB,KAAK,IAAK,GAIX,KAAK,OAAQ,EAAG,EAAG,GAI3B,IAAK,EAAQ,CAEZ,MAAK,IAAS,EAAM,QAEnB,KAAK,KAAM,GAEL,AAAK,MAAO,IAAU,SAE5B,KAAK,OAAQ,GAEF,MAAO,IAAU,UAE5B,KAAK,SAAU,GAIT,KAIR,UAAW,EAAS,CAEnB,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,OAAQ,EAAM,CAEb,SAAM,KAAK,MAAO,GAElB,KAAK,EAAM,IAAO,GAAK,KAAQ,IAC/B,KAAK,EAAM,IAAO,EAAI,KAAQ,IAC9B,KAAK,EAAM,GAAM,KAAQ,IAElB,KAIR,OAAQ,EAAG,EAAG,EAAI,CAEjB,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,OAAQ,EAAG,EAAG,EAAI,CAOjB,GAJA,EAAI,AAAU,GAAiB,EAAG,GAClC,EAAI,AAAU,GAAO,EAAG,EAAG,GAC3B,EAAI,AAAU,GAAO,EAAG,EAAG,GAEtB,IAAM,EAEV,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,MAErB,CAEN,GAAM,GAAI,GAAK,GAAM,EAAM,GAAI,GAAM,EAAI,EAAM,EAAI,EAC7C,EAAM,EAAI,EAAM,EAEtB,KAAK,EAAI,GAAS,EAAG,EAAG,EAAI,EAAI,GAChC,KAAK,EAAI,GAAS,EAAG,EAAG,GACxB,KAAK,EAAI,GAAS,EAAG,EAAG,EAAI,EAAI,GAIjC,MAAO,MAIR,SAAU,EAAQ,CAEjB,WAAsB,EAAS,CAE9B,AAAK,IAAW,QAEX,WAAY,GAAW,GAE3B,QAAQ,KAAM,mCAAqC,EAAQ,qBAO7D,GAAI,GAEJ,GAAK,EAAI,+BAA+B,KAAM,GAAU,CAIvD,GAAI,GACE,EAAO,EAAG,GACV,EAAa,EAAG,GAEtB,OAAS,OAEH,UACA,OAEJ,GAAK,EAAQ,+DAA+D,KAAM,GAGjF,YAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IACvD,KAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IACvD,KAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IAEvD,EAAa,EAAO,IAEb,KAIR,GAAK,EAAQ,qEAAqE,KAAM,GAGvF,YAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IACvD,KAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IACvD,KAAK,EAAI,KAAK,IAAK,IAAK,SAAU,EAAO,GAAK,KAAS,IAEvD,EAAa,EAAO,IAEb,KAIR,UAEI,UACA,OAEJ,GAAK,EAAQ,yEAAyE,KAAM,GAAe,CAG1G,GAAM,GAAI,WAAY,EAAO,IAAQ,IAC/B,EAAI,SAAU,EAAO,GAAK,IAAO,IACjC,EAAI,SAAU,EAAO,GAAK,IAAO,IAEvC,SAAa,EAAO,IAEb,KAAK,OAAQ,EAAG,EAAG,GAI3B,eAIS,EAAI,oBAAoB,KAAM,GAAU,CAInD,GAAM,GAAM,EAAG,GACT,EAAO,EAAI,OAEjB,GAAK,IAAS,EAGb,YAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAC7D,KAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAC7D,KAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAEtD,KAED,GAAK,IAAS,EAGpB,YAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAC7D,KAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAC7D,KAAK,EAAI,SAAU,EAAI,OAAQ,GAAM,EAAI,OAAQ,GAAK,IAAO,IAEtD,KAMT,MAAK,IAAS,EAAM,OAAS,EAErB,KAAK,aAAc,GAIpB,KAIR,aAAc,EAAQ,CAGrB,GAAM,GAAM,GAAgB,EAAM,eAElC,MAAK,KAAQ,OAGZ,KAAK,OAAQ,GAKb,QAAQ,KAAM,8BAAgC,GAIxC,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,EAAG,KAAK,EAAG,KAAK,GAInD,KAAM,EAAQ,CAEb,YAAK,EAAI,EAAM,EACf,KAAK,EAAI,EAAM,EACf,KAAK,EAAI,EAAM,EAER,KAIR,kBAAmB,EAAO,EAAc,EAAM,CAE7C,YAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAC5B,KAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAC5B,KAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAErB,KAIR,kBAAmB,EAAO,EAAc,EAAM,CAE7C,GAAM,GAAgB,EAAc,EAAQ,EAAM,EAAgB,EAElE,YAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAC5B,KAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAC5B,KAAK,EAAI,KAAK,IAAK,EAAM,EAAG,GAErB,KAIR,qBAAsB,EAAc,CAEnC,YAAK,kBAAmB,KAAM,GAEvB,KAIR,qBAAsB,EAAc,CAEnC,YAAK,kBAAmB,KAAM,GAEvB,KAIR,iBAAkB,EAAQ,CAEzB,YAAK,EAAI,GAAc,EAAM,GAC7B,KAAK,EAAI,GAAc,EAAM,GAC7B,KAAK,EAAI,GAAc,EAAM,GAEtB,KAIR,iBAAkB,EAAQ,CAEzB,YAAK,EAAI,GAAc,EAAM,GAC7B,KAAK,EAAI,GAAc,EAAM,GAC7B,KAAK,EAAI,GAAc,EAAM,GAEtB,KAIR,qBAAsB,CAErB,YAAK,iBAAkB,MAEhB,KAIR,qBAAsB,CAErB,YAAK,iBAAkB,MAEhB,KAIR,QAAS,CAER,MAAS,MAAK,EAAI,KAAS,GAAO,KAAK,EAAI,KAAS,EAAM,KAAK,EAAI,KAAS,EAI7E,cAAe,CAEd,MAAS,UAAW,KAAK,SAAS,SAAU,KAAO,MAAO,IAI3D,OAAQ,EAAS,CAIhB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EAEjC,EAAM,KAAK,IAAK,EAAG,EAAG,GACtB,EAAM,KAAK,IAAK,EAAG,EAAG,GAExB,EAAK,EACH,EAAc,GAAM,GAAQ,EAElC,GAAK,IAAQ,EAEZ,EAAM,EACN,EAAa,MAEP,CAEN,GAAM,GAAQ,EAAM,EAIpB,OAFA,EAAa,GAAa,GAAM,EAAU,GAAM,GAAQ,EAAU,GAAI,EAAM,GAEnE,OAEH,GAAG,EAAQ,GAAI,GAAM,EAAU,GAAI,EAAI,EAAI,GAAK,UAChD,GAAG,EAAQ,GAAI,GAAM,EAAQ,EAAG,UAChC,GAAG,EAAQ,GAAI,GAAM,EAAQ,EAAG,MAItC,GAAO,EAIR,SAAO,EAAI,EACX,EAAO,EAAI,EACX,EAAO,EAAI,EAEJ,EAIR,UAAW,CAEV,MAAO,OAAa,MAAK,EAAI,IAAQ,GAAM,IAAU,MAAK,EAAI,IAAQ,GAAM,IAAU,MAAK,EAAI,IAAQ,GAAM,IAI9G,UAAW,EAAG,EAAG,EAAI,CAEpB,YAAK,OAAQ,IAEb,GAAM,GAAK,EAAG,GAAM,GAAK,EAAG,GAAM,GAAK,EAEvC,KAAK,OAAQ,GAAM,EAAG,GAAM,EAAG,GAAM,GAE9B,KAIR,IAAK,EAAQ,CAEZ,YAAK,GAAK,EAAM,EAChB,KAAK,GAAK,EAAM,EAChB,KAAK,GAAK,EAAM,EAET,KAIR,UAAW,EAAQ,EAAS,CAE3B,YAAK,EAAI,EAAO,EAAI,EAAO,EAC3B,KAAK,EAAI,EAAO,EAAI,EAAO,EAC3B,KAAK,EAAI,EAAO,EAAI,EAAO,EAEpB,KAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,IAAK,EAAQ,CAEZ,YAAK,EAAI,KAAK,IAAK,EAAG,KAAK,EAAI,EAAM,GACrC,KAAK,EAAI,KAAK,IAAK,EAAG,KAAK,EAAI,EAAM,GACrC,KAAK,EAAI,KAAK,IAAK,EAAG,KAAK,EAAI,EAAM,GAE9B,KAIR,SAAU,EAAQ,CAEjB,YAAK,GAAK,EAAM,EAChB,KAAK,GAAK,EAAM,EAChB,KAAK,GAAK,EAAM,EAET,KAIR,eAAgB,EAAI,CAEnB,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,KAAM,EAAO,EAAQ,CAEpB,YAAK,GAAO,GAAM,EAAI,KAAK,GAAM,EACjC,KAAK,GAAO,GAAM,EAAI,KAAK,GAAM,EACjC,KAAK,GAAO,GAAM,EAAI,KAAK,GAAM,EAE1B,KAIR,WAAY,EAAQ,EAAQ,EAAQ,CAEnC,YAAK,EAAI,EAAO,EAAM,GAAO,EAAI,EAAO,GAAM,EAC9C,KAAK,EAAI,EAAO,EAAM,GAAO,EAAI,EAAO,GAAM,EAC9C,KAAK,EAAI,EAAO,EAAM,GAAO,EAAI,EAAO,GAAM,EAEvC,KAIR,QAAS,EAAO,EAAQ,CAEvB,KAAK,OAAQ,IACb,EAAM,OAAQ,IAEd,GAAM,GAAI,AAAU,GAAM,GAAM,EAAG,GAAM,EAAG,GACtC,EAAI,AAAU,GAAM,GAAM,EAAG,GAAM,EAAG,GACtC,EAAI,AAAU,GAAM,GAAM,EAAG,GAAM,EAAG,GAE5C,YAAK,OAAQ,EAAG,EAAG,GAEZ,KAIR,OAAQ,EAAI,CAEX,MAAS,GAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,EAInE,UAAW,EAAO,EAAS,EAAI,CAE9B,YAAK,EAAI,EAAO,GAChB,KAAK,EAAI,EAAO,EAAS,GACzB,KAAK,EAAI,EAAO,EAAS,GAElB,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,EACvB,EAAO,EAAS,GAAM,KAAK,EAC3B,EAAO,EAAS,GAAM,KAAK,EAEpB,EAIR,oBAAqB,EAAW,EAAQ,CAEvC,YAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GAEpB,EAAU,aAAe,IAI7B,MAAK,GAAK,IACV,KAAK,GAAK,IACV,KAAK,GAAK,KAIJ,KAIR,QAAS,CAER,MAAO,MAAK,WAMd,GAAM,MAAQ,GAEd,GAAM,UAAU,QAAU,GAC1B,GAAM,UAAU,EAAI,EACpB,GAAM,UAAU,EAAI,EACpB,GAAM,UAAU,EAAI,ECtlBpB,oBAAoB,GAAS,CAE5B,YAAa,EAAO,EAAY,EAAI,CAEnC,QAEA,KAAK,KAAO,QAEZ,KAAK,MAAQ,GAAI,IAAO,GACxB,KAAK,UAAY,EAIlB,SAAU,EAMV,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,MAAM,KAAM,EAAO,OACxB,KAAK,UAAY,EAAO,UAEjB,KAIR,OAAQ,EAAO,CAEd,GAAM,GAAO,MAAM,OAAQ,GAE3B,SAAK,OAAO,MAAQ,KAAK,MAAM,SAC/B,EAAK,OAAO,UAAY,KAAK,UAExB,KAAK,cAAgB,QAAY,GAAK,OAAO,YAAc,KAAK,YAAY,UAE5E,KAAK,WAAa,QAAY,GAAK,OAAO,SAAW,KAAK,UAC1D,KAAK,QAAU,QAAY,GAAK,OAAO,MAAQ,KAAK,OACpD,KAAK,QAAU,QAAY,GAAK,OAAO,MAAQ,KAAK,OACpD,KAAK,WAAa,QAAY,GAAK,OAAO,SAAW,KAAK,UAE1D,KAAK,SAAW,QAAY,GAAK,OAAO,OAAS,KAAK,OAAO,UAE3D,IAMT,GAAM,UAAU,QAAU,GCnD1B,oBAA8B,GAAM,CAEnC,YAAa,EAAU,EAAa,EAAY,CAE/C,MAAO,EAAU,GAEjB,KAAK,KAAO,kBAEZ,KAAK,SAAS,KAAM,GAAS,WAC7B,KAAK,eAEL,KAAK,YAAc,GAAI,IAAO,GAI/B,KAAM,EAAS,CAEd,UAAM,UAAU,KAAK,KAAM,KAAM,GAEjC,KAAK,YAAY,KAAM,EAAO,aAEvB,OAMT,GAAgB,UAAU,kBAAoB,GC/B9C,YAAc,CAEb,YAAa,EAAI,EAAG,EAAI,EAAI,CAE3B,KAAK,EAAI,EACT,KAAK,EAAI,KAIN,QAAQ,CAEX,MAAO,MAAK,KAIT,OAAO,EAAQ,CAElB,KAAK,EAAI,KAIN,SAAS,CAEZ,MAAO,MAAK,KAIT,QAAQ,EAAQ,CAEnB,KAAK,EAAI,EAIV,IAAK,EAAG,EAAI,CAEX,YAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,UAAW,EAAS,CAEnB,YAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,aAAc,EAAO,EAAQ,CAE5B,OAAS,OAEH,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,cACf,KAAM,IAAI,OAAO,0BAA4B,GAIvD,MAAO,MAIR,aAAc,EAAQ,CAErB,OAAS,OAEH,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,UACX,KAAM,IAAI,OAAO,0BAA4B,IAMxD,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,EAAG,KAAK,GAI3C,KAAM,EAAI,CAET,YAAK,EAAI,EAAE,EACX,KAAK,EAAI,EAAE,EAEJ,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,gBAAiB,EAAG,EAAI,CAEvB,YAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAET,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,SAAU,EAAI,CAEb,YAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,KAIR,eAAgB,EAAS,CAExB,YAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,OAAQ,EAAI,CAEX,YAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,KAIR,aAAc,EAAS,CAEtB,MAAO,MAAK,eAAgB,EAAI,GAIjC,aAAc,EAAI,CAEjB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EACrB,EAAI,EAAE,SAEZ,YAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GACtC,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAE/B,KAIR,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,MAAO,EAAK,EAAM,CAIjB,YAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAEzC,KAIR,YAAa,EAAQ,EAAS,CAE7B,YAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAE3C,KAIR,YAAa,EAAK,EAAM,CAEvB,GAAM,GAAS,KAAK,SAEpB,MAAO,MAAK,aAAc,GAAU,GAAI,eAAgB,KAAK,IAAK,EAAK,KAAK,IAAK,EAAK,KAIvF,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,MAAO,CAEN,YAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GAElB,KAIR,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,aAAc,CAEb,YAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GAE1D,KAIR,QAAS,CAER,YAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAET,KAIR,IAAK,EAAI,CAER,MAAO,MAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAIlC,MAAO,EAAI,CAEV,MAAO,MAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAIlC,UAAW,CAEV,MAAO,MAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAIxC,QAAS,CAER,MAAO,MAAK,KAAM,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,GAInD,iBAAkB,CAEjB,MAAO,MAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAI5C,WAAY,CAEX,MAAO,MAAK,aAAc,KAAK,UAAY,GAI5C,OAAQ,CAMP,MAFc,MAAK,MAAO,CAAE,KAAK,EAAG,CAAE,KAAK,GAAM,KAAK,GAMvD,WAAY,EAAI,CAEf,MAAO,MAAK,KAAM,KAAK,kBAAmB,IAI3C,kBAAmB,EAAI,CAEtB,GAAM,GAAK,KAAK,EAAI,EAAE,EAAG,EAAK,KAAK,EAAI,EAAE,EACzC,MAAO,GAAK,EAAK,EAAK,EAIvB,oBAAqB,EAAI,CAExB,MAAO,MAAK,IAAK,KAAK,EAAI,EAAE,GAAM,KAAK,IAAK,KAAK,EAAI,EAAE,GAIxD,UAAW,EAAS,CAEnB,MAAO,MAAK,YAAY,eAAgB,GAIzC,KAAM,EAAG,EAAQ,CAEhB,YAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAEtB,KAIR,YAAa,EAAI,EAAI,EAAQ,CAE5B,YAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAE3B,KAIR,OAAQ,EAAI,CAEX,MAAW,GAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,EAI/C,UAAW,EAAO,EAAS,EAAI,CAE9B,YAAK,EAAI,EAAO,GAChB,KAAK,EAAI,EAAO,EAAS,GAElB,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,EACvB,EAAO,EAAS,GAAM,KAAK,EAEpB,EAIR,oBAAqB,EAAW,EAAO,EAAS,CAE/C,MAAK,KAAW,QAEf,QAAQ,KAAM,uEAIf,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GAElB,KAIR,aAAc,EAAQ,EAAQ,CAE7B,GAAM,GAAI,KAAK,IAAK,GAAS,EAAI,KAAK,IAAK,GAErC,EAAI,KAAK,EAAI,EAAO,EACpB,EAAI,KAAK,EAAI,EAAO,EAE1B,YAAK,EAAI,EAAI,EAAI,EAAI,EAAI,EAAO,EAChC,KAAK,EAAI,EAAI,EAAI,EAAI,EAAI,EAAO,EAEzB,KAIR,QAAS,CAER,YAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SAEP,OAMT,GAAQ,UAAU,UAAY,GC1d9B,YAAc,CAEb,YAAa,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,EAAI,CAEzC,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,KAIN,QAAQ,CAEX,MAAO,MAAK,KAIT,OAAO,EAAQ,CAElB,KAAK,EAAI,KAIN,SAAS,CAEZ,MAAO,MAAK,KAIT,QAAQ,EAAQ,CAEnB,KAAK,EAAI,EAIV,IAAK,EAAG,EAAG,EAAG,EAAI,CAEjB,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,UAAW,EAAS,CAEnB,YAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,KAAM,EAAI,CAET,YAAK,EAAI,EAEF,KAIR,aAAc,EAAO,EAAQ,CAE5B,OAAS,OAEH,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,UACnB,GAAG,KAAK,EAAI,EAAO,cACf,KAAM,IAAI,OAAO,0BAA4B,GAIvD,MAAO,MAIR,aAAc,EAAQ,CAErB,OAAS,OAEH,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,MACf,GAAG,MAAO,MAAK,UACX,KAAM,IAAI,OAAO,0BAA4B,IAMxD,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,KAAK,GAI3D,KAAM,EAAI,CAET,YAAK,EAAI,EAAE,EACX,KAAK,EAAI,EAAE,EACX,KAAK,EAAI,EAAE,EACX,KAAK,EAAM,EAAE,IAAM,OAAc,EAAE,EAAI,EAEhC,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,gBAAiB,EAAG,EAAI,CAEvB,YAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAChB,KAAK,GAAK,EAAE,EAAI,EAET,KAIR,IAAK,EAAG,EAAI,CAEX,MAAK,KAAM,OAEV,SAAQ,KAAM,yFACP,KAAK,WAAY,EAAG,IAI5B,MAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,MAIR,UAAW,EAAI,CAEd,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,WAAY,EAAG,EAAI,CAElB,YAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EACjB,KAAK,EAAI,EAAE,EAAI,EAAE,EAEV,KAIR,SAAU,EAAI,CAEb,YAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EACZ,KAAK,GAAK,EAAE,EAEL,KAIR,eAAgB,EAAS,CAExB,YAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EACV,KAAK,GAAK,EAEH,KAIR,aAAc,EAAI,CAEjB,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EAC7C,EAAI,EAAE,SAEZ,YAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAC1D,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAC1D,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAAI,EAAG,IAAO,EAC3D,KAAK,EAAI,EAAG,GAAM,EAAI,EAAG,GAAM,EAAI,EAAG,IAAO,EAAI,EAAG,IAAO,EAEpD,KAIR,aAAc,EAAS,CAEtB,MAAO,MAAK,eAAgB,EAAI,GAIjC,2BAA4B,EAAI,CAM/B,KAAK,EAAI,EAAI,KAAK,KAAM,EAAE,GAE1B,GAAM,GAAI,KAAK,KAAM,EAAI,EAAE,EAAI,EAAE,GAEjC,MAAK,GAAI,KAER,MAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,GAIT,MAAK,EAAI,EAAE,EAAI,EACf,KAAK,EAAI,EAAE,EAAI,EACf,KAAK,EAAI,EAAE,EAAI,GAIT,KAIR,+BAAgC,EAAI,CAMnC,GAAI,GAAO,EAAG,EAAG,EACX,EAAU,IACf,EAAW,GAEX,EAAK,EAAE,SAEP,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACxC,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,IAEzC,GAAO,KAAK,IAAK,EAAM,GAAQ,GACxB,KAAK,IAAK,EAAM,GAAQ,GACxB,KAAK,IAAK,EAAM,GAAQ,EAAY,CAM1C,GAAO,KAAK,IAAK,EAAM,GAAQ,GACxB,KAAK,IAAK,EAAM,GAAQ,GACxB,KAAK,IAAK,EAAM,GAAQ,GACxB,KAAK,IAAK,EAAM,EAAM,EAAM,GAAM,EAIxC,YAAK,IAAK,EAAG,EAAG,EAAG,GAEZ,KAMR,EAAQ,KAAK,GAEb,GAAM,GAAO,GAAM,GAAM,EACnB,EAAO,GAAM,GAAM,EACnB,EAAO,GAAM,GAAM,EACnB,EAAO,GAAM,GAAQ,EACrB,EAAO,GAAM,GAAQ,EACrB,EAAO,GAAM,GAAQ,EAE3B,MAAO,GAAK,GAAU,EAAK,EAI1B,AAAK,EAAK,EAET,GAAI,EACJ,EAAI,WACJ,EAAI,YAIJ,GAAI,KAAK,KAAM,GACf,EAAI,EAAK,EACT,EAAI,EAAK,GAIJ,AAAK,EAAK,EAIhB,AAAK,EAAK,EAET,GAAI,WACJ,EAAI,EACJ,EAAI,YAIJ,GAAI,KAAK,KAAM,GACf,EAAI,EAAK,EACT,EAAI,EAAK,GAQV,AAAK,EAAK,EAET,GAAI,WACJ,EAAI,WACJ,EAAI,GAIJ,GAAI,KAAK,KAAM,GACf,EAAI,EAAK,EACT,EAAI,EAAK,GAMX,KAAK,IAAK,EAAG,EAAG,EAAG,GAEZ,KAMR,GAAI,GAAI,KAAK,KAAQ,GAAM,GAAU,GAAM,GACxC,GAAM,GAAU,GAAM,GACtB,GAAM,GAAU,GAAM,IAEzB,MAAK,MAAK,IAAK,GAAM,MAAQ,GAAI,GAKjC,KAAK,EAAM,GAAM,GAAQ,EACzB,KAAK,EAAM,GAAM,GAAQ,EACzB,KAAK,EAAM,GAAM,GAAQ,EACzB,KAAK,EAAI,KAAK,KAAQ,GAAM,EAAM,EAAM,GAAM,GAEvC,KAIR,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,IAAK,EAAI,CAER,YAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAC7B,KAAK,EAAI,KAAK,IAAK,KAAK,EAAG,EAAE,GAEtB,KAIR,MAAO,EAAK,EAAM,CAIjB,YAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAChD,KAAK,EAAI,KAAK,IAAK,EAAI,EAAG,KAAK,IAAK,EAAI,EAAG,KAAK,IAEzC,KAIR,YAAa,EAAQ,EAAS,CAE7B,YAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAClD,KAAK,EAAI,KAAK,IAAK,EAAQ,KAAK,IAAK,EAAQ,KAAK,IAE3C,KAIR,YAAa,EAAK,EAAM,CAEvB,GAAM,GAAS,KAAK,SAEpB,MAAO,MAAK,aAAc,GAAU,GAAI,eAAgB,KAAK,IAAK,EAAK,KAAK,IAAK,EAAK,KAIvF,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,MAAO,CAEN,YAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GACzB,KAAK,EAAI,KAAK,KAAM,KAAK,GAElB,KAIR,OAAQ,CAEP,YAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAC1B,KAAK,EAAI,KAAK,MAAO,KAAK,GAEnB,KAIR,aAAc,CAEb,YAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GACjE,KAAK,EAAM,KAAK,EAAI,EAAM,KAAK,KAAM,KAAK,GAAM,KAAK,MAAO,KAAK,GAE1D,KAIR,QAAS,CAER,YAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAChB,KAAK,EAAI,CAAE,KAAK,EAET,KAIR,IAAK,EAAI,CAER,MAAO,MAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAAI,KAAK,EAAI,EAAE,EAIhE,UAAW,CAEV,MAAO,MAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAI5E,QAAS,CAER,MAAO,MAAK,KAAM,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,GAIvF,iBAAkB,CAEjB,MAAO,MAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAAM,KAAK,IAAK,KAAK,GAItF,WAAY,CAEX,MAAO,MAAK,aAAc,KAAK,UAAY,GAI5C,UAAW,EAAS,CAEnB,MAAO,MAAK,YAAY,eAAgB,GAIzC,KAAM,EAAG,EAAQ,CAEhB,YAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAC7B,KAAK,GAAO,GAAE,EAAI,KAAK,GAAM,EAEtB,KAIR,YAAa,EAAI,EAAI,EAAQ,CAE5B,YAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAClC,KAAK,EAAI,EAAG,EAAM,GAAG,EAAI,EAAG,GAAM,EAE3B,KAIR,OAAQ,EAAI,CAEX,MAAW,GAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,GAAS,EAAE,IAAM,KAAK,EAI3F,UAAW,EAAO,EAAS,EAAI,CAE9B,YAAK,EAAI,EAAO,GAChB,KAAK,EAAI,EAAO,EAAS,GACzB,KAAK,EAAI,EAAO,EAAS,GACzB,KAAK,EAAI,EAAO,EAAS,GAElB,KAIR,QAAS,EAAQ,GAAI,EAAS,EAAI,CAEjC,SAAO,GAAW,KAAK,EACvB,EAAO,EAAS,GAAM,KAAK,EAC3B,EAAO,EAAS,GAAM,KAAK,EAC3B,EAAO,EAAS,GAAM,KAAK,EAEpB,EAIR,oBAAqB,EAAW,EAAO,EAAS,CAE/C,MAAK,KAAW,QAEf,QAAQ,KAAM,uEAIf,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GACzB,KAAK,EAAI,EAAU,KAAM,GAElB,KAIR,QAAS,CAER,YAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SACd,KAAK,EAAI,KAAK,SAEP,OAMT,GAAQ,UAAU,UAAY,GC1oB9B,YAAW,CAEV,YAAa,EAAM,GAAI,GAAS,IAAY,IAAY,KAAc,EAAM,GAAI,GAAS,KAAY,KAAY,MAAe,CAE/H,KAAK,IAAM,EACX,KAAK,IAAM,EAIZ,IAAK,EAAK,EAAM,CAEf,YAAK,IAAI,KAAM,GACf,KAAK,IAAI,KAAM,GAER,KAIR,aAAc,EAAQ,CAErB,GAAI,GAAO,IACP,EAAO,IACP,EAAO,IAEP,EAAO,KACP,EAAO,KACP,EAAO,KAEX,OAAU,GAAI,EAAG,EAAI,EAAM,OAAQ,EAAI,EAAG,GAAK,EAAI,CAElD,GAAM,GAAI,EAAO,GACX,EAAI,EAAO,EAAI,GACf,EAAI,EAAO,EAAI,GAErB,AAAK,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAElB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAIxB,YAAK,IAAI,IAAK,EAAM,EAAM,GAC1B,KAAK,IAAI,IAAK,EAAM,EAAM,GAEnB,KAIR,uBAAwB,EAAY,CAEnC,GAAI,GAAO,IACP,EAAO,IACP,EAAO,IAEP,EAAO,KACP,EAAO,KACP,EAAO,KAEX,OAAU,GAAI,EAAG,EAAI,EAAU,MAAO,EAAI,EAAG,IAAO,CAEnD,GAAM,GAAI,EAAU,KAAM,GACpB,EAAI,EAAU,KAAM,GACpB,EAAI,EAAU,KAAM,GAE1B,AAAK,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAElB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAClB,EAAI,GAAO,GAAO,GAIxB,YAAK,IAAI,IAAK,EAAM,EAAM,GAC1B,KAAK,IAAI,IAAK,EAAM,EAAM,GAEnB,KAIR,cAAe,EAAS,CAEvB,KAAK,YAEL,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,IAE5C,KAAK,cAAe,EAAQ,IAI7B,MAAO,MAIR,qBAAsB,EAAQ,EAAO,CAEpC,GAAM,GAAW,GAAQ,KAAM,GAAO,eAAgB,IAEtD,YAAK,IAAI,KAAM,GAAS,IAAK,GAC7B,KAAK,IAAI,KAAM,GAAS,IAAK,GAEtB,KAIR,cAAe,EAAS,CAEvB,YAAK,YAEE,KAAK,eAAgB,GAI7B,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,MAIrC,KAAM,EAAM,CAEX,YAAK,IAAI,KAAM,EAAI,KACnB,KAAK,IAAI,KAAM,EAAI,KAEZ,KAIR,WAAY,CAEX,YAAK,IAAI,EAAI,KAAK,IAAI,EAAI,KAAK,IAAI,EAAI,IACvC,KAAK,IAAI,EAAI,KAAK,IAAI,EAAI,KAAK,IAAI,EAAI,KAEhC,KAIR,SAAU,CAIT,MAAS,MAAK,IAAI,EAAI,KAAK,IAAI,GAAS,KAAK,IAAI,EAAI,KAAK,IAAI,GAAS,KAAK,IAAI,EAAI,KAAK,IAAI,EAI9F,UAAW,EAAS,CAEnB,MAAO,MAAK,UAAY,EAAO,IAAK,EAAG,EAAG,GAAM,EAAO,WAAY,KAAK,IAAK,KAAK,KAAM,eAAgB,IAIzG,QAAS,EAAS,CAEjB,MAAO,MAAK,UAAY,EAAO,IAAK,EAAG,EAAG,GAAM,EAAO,WAAY,KAAK,IAAK,KAAK,KAInF,cAAe,EAAQ,CAEtB,YAAK,IAAI,IAAK,GACd,KAAK,IAAI,IAAK,GAEP,KAIR,eAAgB,EAAS,CAExB,YAAK,IAAI,IAAK,GACd,KAAK,IAAI,IAAK,GAEP,KAIR,eAAgB,EAAS,CAExB,YAAK,IAAI,UAAW,CAAE,GACtB,KAAK,IAAI,UAAW,GAEb,KAIR,eAAgB,EAAS,CAKxB,EAAO,kBAAmB,GAAO,IAEjC,GAAM,GAAW,EAAO,SAExB,AAAK,IAAa,QAEZ,GAAS,cAAgB,MAE7B,EAAS,qBAIV,GAAK,KAAM,EAAS,aACpB,GAAK,aAAc,EAAO,aAE1B,KAAK,MAAO,KAIb,GAAM,GAAW,EAAO,SAExB,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,EAAI,EAAG,IAE5C,KAAK,eAAgB,EAAU,IAIhC,MAAO,MAIR,cAAe,EAAQ,CAEtB,MAAO,IAAM,EAAI,KAAK,IAAI,GAAK,EAAM,EAAI,KAAK,IAAI,GACjD,EAAM,EAAI,KAAK,IAAI,GAAK,EAAM,EAAI,KAAK,IAAI,GAC3C,EAAM,EAAI,KAAK,IAAI,GAAK,EAAM,EAAI,KAAK,IAAI,GAI7C,YAAa,EAAM,CAElB,MAAO,MAAK,IAAI,GAAK,EAAI,IAAI,GAAK,EAAI,IAAI,GAAK,KAAK,IAAI,GACvD,KAAK,IAAI,GAAK,EAAI,IAAI,GAAK,EAAI,IAAI,GAAK,KAAK,IAAI,GACjD,KAAK,IAAI,GAAK,EAAI,IAAI,GAAK,EAAI,IAAI,GAAK,KAAK,IAAI,EAInD,aAAc,EAAO,EAAS,CAK7B,MAAO,GAAO,IACX,GAAM,EAAI,KAAK,IAAI,GAAQ,MAAK,IAAI,EAAI,KAAK,IAAI,GACjD,GAAM,EAAI,KAAK,IAAI,GAAQ,MAAK,IAAI,EAAI,KAAK,IAAI,GACjD,GAAM,EAAI,KAAK,IAAI,GAAQ,MAAK,IAAI,EAAI,KAAK,IAAI,IAKrD,cAAe,EAAM,CAGpB,MAAO,IAAI,IAAI,EAAI,KAAK,IAAI,GAAK,EAAI,IAAI,EAAI,KAAK,IAAI,GACrD,EAAI,IAAI,EAAI,KAAK,IAAI,GAAK,EAAI,IAAI,EAAI,KAAK,IAAI,GAC/C,EAAI,IAAI,EAAI,KAAK,IAAI,GAAK,EAAI,IAAI,EAAI,KAAK,IAAI,GAIjD,iBAAkB,EAAS,CAG1B,YAAK,WAAY,EAAO,OAAQ,IAGzB,GAAQ,kBAAmB,EAAO,SAAc,EAAO,OAAS,EAAO,OAI/E,gBAAiB,EAAQ,CAKxB,GAAI,GAAK,EAET,MAAK,GAAM,OAAO,EAAI,EAErB,GAAM,EAAM,OAAO,EAAI,KAAK,IAAI,EAChC,EAAM,EAAM,OAAO,EAAI,KAAK,IAAI,GAIhC,GAAM,EAAM,OAAO,EAAI,KAAK,IAAI,EAChC,EAAM,EAAM,OAAO,EAAI,KAAK,IAAI,GAIjC,AAAK,EAAM,OAAO,EAAI,EAErB,IAAO,EAAM,OAAO,EAAI,KAAK,IAAI,EACjC,GAAO,EAAM,OAAO,EAAI,KAAK,IAAI,GAIjC,IAAO,EAAM,OAAO,EAAI,KAAK,IAAI,EACjC,GAAO,EAAM,OAAO,EAAI,KAAK,IAAI,GAIlC,AAAK,EAAM,OAAO,EAAI,EAErB,IAAO,EAAM,OAAO,EAAI,KAAK,IAAI,EACjC,GAAO,EAAM,OAAO,EAAI,KAAK,IAAI,GAIjC,IAAO,EAAM,OAAO,EAAI,KAAK,IAAI,EACjC,GAAO,EAAM,OAAO,EAAI,KAAK,IAAI,GAIzB,GAAO,CAAE,EAAM,UAAY,GAAO,CAAE,EAAM,SAIpD,mBAAoB,EAAW,CAE9B,GAAK,KAAK,UAET,MAAO,GAKR,KAAK,UAAW,IAChB,GAAS,WAAY,KAAK,IAAK,IAG/B,GAAI,WAAY,EAAS,EAAG,IAC5B,GAAI,WAAY,EAAS,EAAG,IAC5B,GAAI,WAAY,EAAS,EAAG,IAG5B,GAAI,WAAY,GAAK,IACrB,GAAI,WAAY,GAAK,IACrB,GAAI,WAAY,GAAK,IAKrB,GAAI,GAAO,CACV,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EACtD,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EACtD,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,EAAG,CAAE,GAAI,EAAG,GAAI,EAAG,GAUvD,MARK,CAAE,GAAY,EAAM,GAAK,GAAK,GAAK,KAOxC,GAAO,CAAE,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC5B,CAAE,GAAY,EAAM,GAAK,GAAK,GAAK,KAEhC,GAMR,IAAgB,aAAc,GAAK,IACnC,EAAO,CAAE,GAAgB,EAAG,GAAgB,EAAG,GAAgB,GAExD,GAAY,EAAM,GAAK,GAAK,GAAK,KAIzC,WAAY,EAAO,EAAS,CAE3B,MAAO,GAAO,KAAM,GAAQ,MAAO,KAAK,IAAK,KAAK,KAInD,gBAAiB,EAAQ,CAIxB,MAAO,AAFc,IAAQ,KAAM,GAAQ,MAAO,KAAK,IAAK,KAAK,KAE7C,IAAK,GAAQ,SAIlC,kBAAmB,EAAS,CAE3B,YAAK,UAAW,EAAO,QAEvB,EAAO,OAAS,KAAK,QAAS,IAAU,SAAW,GAE5C,EAIR,UAAW,EAAM,CAEhB,YAAK,IAAI,IAAK,EAAI,KAClB,KAAK,IAAI,IAAK,EAAI,KAGb,KAAK,WAAY,KAAK,YAEpB,KAIR,MAAO,EAAM,CAEZ,YAAK,IAAI,IAAK,EAAI,KAClB,KAAK,IAAI,IAAK,EAAI,KAEX,KAIR,aAAc,EAAS,CAGtB,MAAK,MAAK,UAAmB,KAG7B,IAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GACrE,GAAS,GAAI,IAAK,KAAK,IAAI,EAAG,KAAK,IAAI,EAAG,KAAK,IAAI,GAAI,aAAc,GAErE,KAAK,cAAe,IAEb,MAIR,UAAW,EAAS,CAEnB,YAAK,IAAI,IAAK,GACd,KAAK,IAAI,IAAK,GAEP,KAIR,OAAQ,EAAM,CAEb,MAAO,GAAI,IAAI,OAAQ,KAAK,MAAS,EAAI,IAAI,OAAQ,KAAK,OAM5D,GAAK,UAAU,OAAS,GAExB,GAAM,IAAU,CACD,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,GACJ,GAAI,IAGb,GAAwB,GAAI,GAE5B,GAAqB,GAAI,IAIzB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GAIxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GAExB,GAAwB,GAAI,GAC5B,GAAyB,GAAI,GAC7B,GAAgC,GAAI,GACpC,GAA0B,GAAI,GAEpC,YAAqB,EAAM,EAAI,EAAI,EAAI,EAAU,CAEhD,OAAU,GAAI,EAAG,EAAI,EAAK,OAAS,EAAG,GAAK,EAAG,GAAK,EAAI,CAEtD,GAAU,UAAW,EAAM,GAE3B,GAAM,GAAI,EAAQ,EAAI,KAAK,IAAK,GAAU,GAAM,EAAQ,EAAI,KAAK,IAAK,GAAU,GAAM,EAAQ,EAAI,KAAK,IAAK,GAAU,GAEhH,EAAK,EAAG,IAAK,IACb,EAAK,EAAG,IAAK,IACb,EAAK,EAAG,IAAK,IAEnB,GAAK,KAAK,IAAK,CAAE,KAAK,IAAK,EAAI,EAAI,GAAM,KAAK,IAAK,EAAI,EAAI,IAAS,EAInE,MAAO,GAMT,MAAO,GC9fR,GAAM,IAAqB,GAAI,IACzB,GAAoB,GAAI,GACxB,GAAiC,GAAI,GACrC,GAAyB,GAAI,GAEnC,QAAa,CAEZ,YAAa,EAAS,GAAI,GAAW,EAAS,GAAM,CAEnD,KAAK,OAAS,EACd,KAAK,OAAS,EAIf,IAAK,EAAQ,EAAS,CAErB,YAAK,OAAO,KAAM,GAClB,KAAK,OAAS,EAEP,KAIR,cAAe,EAAQ,EAAiB,CAEvC,GAAM,GAAS,KAAK,OAEpB,AAAK,IAAmB,OAEvB,EAAO,KAAM,GAIb,GAAK,cAAe,GAAS,UAAW,GAIzC,GAAI,GAAc,EAElB,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,IAE5C,EAAc,KAAK,IAAK,EAAa,EAAO,kBAAmB,EAAQ,KAIxE,YAAK,OAAS,KAAK,KAAM,GAElB,KAIR,KAAM,EAAS,CAEd,YAAK,OAAO,KAAM,EAAO,QACzB,KAAK,OAAS,EAAO,OAEd,KAIR,SAAU,CAET,MAAS,MAAK,OAAS,EAIxB,WAAY,CAEX,YAAK,OAAO,IAAK,EAAG,EAAG,GACvB,KAAK,OAAS,GAEP,KAIR,cAAe,EAAQ,CAEtB,MAAS,GAAM,kBAAmB,KAAK,SAAc,KAAK,OAAS,KAAK,OAIzE,gBAAiB,EAAQ,CAExB,MAAS,GAAM,WAAY,KAAK,QAAW,KAAK,OAIjD,iBAAkB,EAAS,CAE1B,GAAM,GAAY,KAAK,OAAS,EAAO,OAEvC,MAAO,GAAO,OAAO,kBAAmB,KAAK,SAAc,EAAY,EAIxE,cAAe,EAAM,CAEpB,MAAO,GAAI,iBAAkB,MAI9B,gBAAiB,EAAQ,CAExB,MAAO,MAAK,IAAK,EAAM,gBAAiB,KAAK,UAAc,KAAK,OAIjE,WAAY,EAAO,EAAS,CAE3B,GAAM,GAAgB,KAAK,OAAO,kBAAmB,GAErD,SAAO,KAAM,GAER,EAAkB,KAAK,OAAS,KAAK,QAEzC,GAAO,IAAK,KAAK,QAAS,YAC1B,EAAO,eAAgB,KAAK,QAAS,IAAK,KAAK,SAIzC,EAIR,eAAgB,EAAS,CAExB,MAAK,MAAK,UAGT,GAAO,YACA,GAIR,GAAO,IAAK,KAAK,OAAQ,KAAK,QAC9B,EAAO,eAAgB,KAAK,QAErB,GAIR,aAAc,EAAS,CAEtB,YAAK,OAAO,aAAc,GAC1B,KAAK,OAAS,KAAK,OAAS,EAAO,oBAE5B,KAIR,UAAW,EAAS,CAEnB,YAAK,OAAO,IAAK,GAEV,KAIR,cAAe,EAAQ,CAItB,GAAS,WAAY,EAAO,KAAK,QAEjC,GAAM,GAAW,GAAS,WAE1B,GAAK,EAAa,KAAK,OAAS,KAAK,OAAW,CAE/C,GAAM,GAAS,KAAK,KAAM,GACpB,EAAsB,GAAS,KAAK,QAAW,GAMrD,KAAK,OAAO,IAAK,GAAS,eAAgB,EAAoB,IAC9D,KAAK,QAAU,EAIhB,MAAO,MAIR,MAAO,EAAS,CAQf,UAAiB,WAAY,EAAO,OAAQ,KAAK,QAAS,YAAY,eAAgB,EAAO,QAE7F,KAAK,cAAe,GAAI,KAAM,EAAO,QAAS,IAAK,KACnD,KAAK,cAAe,GAAI,KAAM,EAAO,QAAS,IAAK,KAE5C,KAIR,OAAQ,EAAS,CAEhB,MAAO,GAAO,OAAO,OAAQ,KAAK,SAAc,EAAO,SAAW,KAAK,OAIxE,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,QCjNtC,GAAM,IAAyB,GAAI,GAC7B,GAAyB,GAAI,GAC7B,GAA8B,GAAI,IAExC,QAAY,CAEX,YAAa,EAAS,GAAI,GAAS,EAAG,EAAG,GAAK,EAAW,EAAI,CAI5D,KAAK,OAAS,EACd,KAAK,SAAW,EAIjB,IAAK,EAAQ,EAAW,CAEvB,YAAK,OAAO,KAAM,GAClB,KAAK,SAAW,EAET,KAIR,cAAe,EAAG,EAAG,EAAG,EAAI,CAE3B,YAAK,OAAO,IAAK,EAAG,EAAG,GACvB,KAAK,SAAW,EAET,KAIR,8BAA+B,EAAQ,EAAQ,CAE9C,YAAK,OAAO,KAAM,GAClB,KAAK,SAAW,CAAE,EAAM,IAAK,KAAK,QAE3B,KAIR,sBAAuB,EAAG,EAAG,EAAI,CAEhC,GAAM,GAAS,GAAS,WAAY,EAAG,GAAI,MAAO,GAAS,WAAY,EAAG,IAAM,YAIhF,YAAK,8BAA+B,EAAQ,GAErC,KAIR,KAAM,EAAQ,CAEb,YAAK,OAAO,KAAM,EAAM,QACxB,KAAK,SAAW,EAAM,SAEf,KAIR,WAAY,CAIX,GAAM,GAAsB,EAAM,KAAK,OAAO,SAC9C,YAAK,OAAO,eAAgB,GAC5B,KAAK,UAAY,EAEV,KAIR,QAAS,CAER,YAAK,UAAY,GACjB,KAAK,OAAO,SAEL,KAIR,gBAAiB,EAAQ,CAExB,MAAO,MAAK,OAAO,IAAK,GAAU,KAAK,SAIxC,iBAAkB,EAAS,CAE1B,MAAO,MAAK,gBAAiB,EAAO,QAAW,EAAO,OAIvD,aAAc,EAAO,EAAS,CAE7B,MAAO,GAAO,KAAM,KAAK,QAAS,eAAgB,CAAE,KAAK,gBAAiB,IAAU,IAAK,GAI1F,cAAe,EAAM,EAAS,CAE7B,GAAM,GAAY,EAAK,MAAO,IAExB,EAAc,KAAK,OAAO,IAAK,GAErC,GAAK,IAAgB,EAGpB,MAAK,MAAK,gBAAiB,EAAK,SAAY,EAEpC,EAAO,KAAM,EAAK,OAKnB,KAIR,GAAM,GAAI,CAAI,GAAK,MAAM,IAAK,KAAK,QAAW,KAAK,UAAa,EAEhE,MAAK,GAAI,GAAK,EAAI,EAEV,KAID,EAAO,KAAM,GAAY,eAAgB,GAAI,IAAK,EAAK,OAI/D,eAAgB,EAAO,CAItB,GAAM,GAAY,KAAK,gBAAiB,EAAK,OACvC,EAAU,KAAK,gBAAiB,EAAK,KAE3C,MAAS,GAAY,GAAK,EAAU,GAAS,EAAU,GAAK,EAAY,EAIzE,cAAe,EAAM,CAEpB,MAAO,GAAI,gBAAiB,MAI7B,iBAAkB,EAAS,CAE1B,MAAO,GAAO,gBAAiB,MAIhC,cAAe,EAAS,CAEvB,MAAO,GAAO,KAAM,KAAK,QAAS,eAAgB,CAAE,KAAK,UAI1D,aAAc,EAAQ,EAAuB,CAE5C,GAAM,GAAe,GAAwB,GAAc,gBAAiB,GAEtE,EAAiB,KAAK,cAAe,IAAW,aAAc,GAE9D,EAAS,KAAK,OAAO,aAAc,GAAe,YAExD,YAAK,SAAW,CAAE,EAAe,IAAK,GAE/B,KAIR,UAAW,EAAS,CAEnB,YAAK,UAAY,EAAO,IAAK,KAAK,QAE3B,KAIR,OAAQ,EAAQ,CAEf,MAAO,GAAM,OAAO,OAAQ,KAAK,SAAc,EAAM,WAAa,KAAK,SAIxE,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,QAMtC,GAAM,UAAU,QAAU,GCtM1B,GAAM,IAAwB,GAAI,IAC5B,GAAwB,GAAI,GAElC,QAAc,CAEb,YAAa,EAAK,GAAI,IAAS,EAAK,GAAI,IAAS,EAAK,GAAI,IAAS,EAAK,GAAI,IAAS,EAAK,GAAI,IAAS,EAAK,GAAI,IAAU,CAEzH,KAAK,OAAS,CAAE,EAAI,EAAI,EAAI,EAAI,EAAI,GAIrC,IAAK,EAAI,EAAI,EAAI,EAAI,EAAI,EAAK,CAE7B,GAAM,GAAS,KAAK,OAEpB,SAAQ,GAAI,KAAM,GAClB,EAAQ,GAAI,KAAM,GAClB,EAAQ,GAAI,KAAM,GAClB,EAAQ,GAAI,KAAM,GAClB,EAAQ,GAAI,KAAM,GAClB,EAAQ,GAAI,KAAM,GAEX,KAIR,KAAM,EAAU,CAEf,GAAM,GAAS,KAAK,OAEpB,OAAU,GAAI,EAAG,EAAI,EAAG,IAEvB,EAAQ,GAAI,KAAM,EAAQ,OAAQ,IAInC,MAAO,MAIR,wBAAyB,EAAI,CAE5B,GAAM,GAAS,KAAK,OACd,EAAK,EAAE,SACP,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAM,EAAI,GACvD,EAAM,EAAI,GAAK,EAAM,EAAI,GAAK,EAAO,EAAI,IAAM,EAAO,EAAI,IAC1D,EAAO,EAAI,IAAM,EAAO,EAAI,IAAM,EAAO,EAAI,IAAM,EAAO,EAAI,IAEpE,SAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAK,EAAO,GAAO,YAC3E,EAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAK,EAAO,GAAO,YAC3E,EAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAK,EAAO,GAAO,YAC3E,EAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAK,EAAO,GAAO,YAC3E,EAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAM,EAAO,GAAO,YAC5E,EAAQ,GAAI,cAAe,EAAM,EAAK,EAAM,EAAK,EAAO,EAAM,EAAO,GAAO,YAErE,KAIR,iBAAkB,EAAS,CAE1B,GAAM,GAAW,EAAO,SAExB,MAAK,GAAS,iBAAmB,MAAO,EAAS,wBAEjD,GAAQ,KAAM,EAAS,gBAAiB,aAAc,EAAO,aAEtD,KAAK,iBAAkB,IAI/B,iBAAkB,EAAS,CAE1B,UAAQ,OAAO,IAAK,EAAG,EAAG,GAC1B,GAAQ,OAAS,kBACjB,GAAQ,aAAc,EAAO,aAEtB,KAAK,iBAAkB,IAI/B,iBAAkB,EAAS,CAE1B,GAAM,GAAS,KAAK,OACd,EAAS,EAAO,OAChB,EAAY,CAAE,EAAO,OAE3B,OAAU,GAAI,EAAG,EAAI,EAAG,IAIvB,GAAK,AAFY,EAAQ,GAAI,gBAAiB,GAE9B,EAEf,MAAO,GAMT,MAAO,GAIR,cAAe,EAAM,CAEpB,GAAM,GAAS,KAAK,OAEpB,OAAU,GAAI,EAAG,EAAI,EAAG,IAAO,CAE9B,GAAM,GAAQ,EAAQ,GAQtB,GAJA,GAAQ,EAAI,EAAM,OAAO,EAAI,EAAI,EAAI,IAAI,EAAI,EAAI,IAAI,EACrD,GAAQ,EAAI,EAAM,OAAO,EAAI,EAAI,EAAI,IAAI,EAAI,EAAI,IAAI,EACrD,GAAQ,EAAI,EAAM,OAAO,EAAI,EAAI,EAAI,IAAI,EAAI,EAAI,IAAI,EAEhD,EAAM,gBAAiB,IAAY,EAEvC,MAAO,GAMT,MAAO,GAIR,cAAe,EAAQ,CAEtB,GAAM,GAAS,KAAK,OAEpB,OAAU,GAAI,EAAG,EAAI,EAAG,IAEvB,GAAK,EAAQ,GAAI,gBAAiB,GAAU,EAE3C,MAAO,GAMT,MAAO,GAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,QCpJtC,GAAM,IAAkC,GAAI,IACtC,GAAoC,GAAI,GACxC,GAA4B,GAAI,GAEtC,QAAkB,CAEjB,YAAa,EAAS,CAErB,KAAK,OAAS,EAEd,KAAK,KAAO,EACZ,KAAK,WAAa,EAClB,KAAK,OAAS,EACd,KAAK,YAAc,EAEnB,KAAK,QAAU,GAAI,IAAS,IAAK,KAEjC,KAAK,IAAM,KACX,KAAK,QAAU,KACf,KAAK,OAAS,GAAI,IAElB,KAAK,WAAa,GAClB,KAAK,YAAc,GAEnB,KAAK,SAAW,GAAI,IACpB,KAAK,cAAgB,GAAI,IAAS,EAAG,GAErC,KAAK,eAAiB,EAEtB,KAAK,WAAa,CAEjB,GAAI,IAAS,EAAG,EAAG,EAAG,IAMxB,kBAAmB,CAElB,MAAO,MAAK,eAIb,YAAa,CAEZ,MAAO,MAAK,SAIb,eAAgB,EAAQ,CAEvB,GAAM,GAAe,KAAK,OACpB,EAAe,KAAK,OAE1B,GAAoB,sBAAuB,EAAM,aACjD,EAAa,SAAS,KAAM,IAE5B,GAAY,sBAAuB,EAAM,OAAO,aAChD,EAAa,OAAQ,IACrB,EAAa,oBAEb,GAAkB,iBAAkB,EAAa,iBAAkB,EAAa,oBAChF,KAAK,SAAS,wBAAyB,IAEvC,EAAa,IACZ,GAAK,EAAK,EAAK,GACf,EAAK,GAAK,EAAK,GACf,EAAK,EAAK,GAAK,GACf,EAAK,EAAK,EAAK,GAGhB,EAAa,SAAU,EAAa,kBACpC,EAAa,SAAU,EAAa,oBAIrC,YAAa,EAAgB,CAE5B,MAAO,MAAK,WAAY,GAIzB,iBAAkB,CAEjB,MAAO,MAAK,cAIb,SAAU,CAET,AAAK,KAAK,KAET,KAAK,IAAI,UAIL,KAAK,SAET,KAAK,QAAQ,UAMf,KAAM,EAAS,CAEd,YAAK,OAAS,EAAO,OAAO,QAE5B,KAAK,KAAO,EAAO,KACnB,KAAK,OAAS,EAAO,OAErB,KAAK,QAAQ,KAAM,EAAO,SAEnB,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,MAIrC,QAAS,CAER,GAAM,GAAS,GAEf,MAAK,MAAK,OAAS,GAAI,GAAO,KAAO,KAAK,MACrC,KAAK,aAAe,GAAI,GAAO,WAAa,KAAK,YACjD,KAAK,SAAW,GAAI,GAAO,OAAS,KAAK,QACzC,MAAK,QAAQ,IAAM,KAAO,KAAK,QAAQ,IAAM,MAAM,GAAO,QAAU,KAAK,QAAQ,WAEtF,EAAO,OAAS,KAAK,OAAO,OAAQ,IAAQ,OAC5C,MAAO,GAAO,OAAO,OAEd,IC3IT,oBAAiC,GAAO,CAEvC,YAAa,EAAO,GAAK,EAAQ,EAAG,EAAM,EAAG,EAAS,GAAK,EAAO,GAAK,EAAM,IAAO,CAEnF,QAEA,KAAK,KAAO,qBAEZ,KAAK,KAAO,EACZ,KAAK,KAAO,KAEZ,KAAK,KAAO,EACZ,KAAK,MAAQ,EACb,KAAK,IAAM,EACX,KAAK,OAAS,EAEd,KAAK,KAAO,EACZ,KAAK,IAAM,EAEX,KAAK,yBAIN,KAAM,EAAQ,EAAY,CAEzB,aAAM,KAAM,EAAQ,GAEpB,KAAK,KAAO,EAAO,KACnB,KAAK,MAAQ,EAAO,MACpB,KAAK,IAAM,EAAO,IAClB,KAAK,OAAS,EAAO,OACrB,KAAK,KAAO,EAAO,KACnB,KAAK,IAAM,EAAO,IAElB,KAAK,KAAO,EAAO,KACnB,KAAK,KAAO,EAAO,OAAS,KAAO,KAAO,OAAO,OAAQ,GAAI,EAAO,MAE7D,KAIR,cAAe,EAAW,EAAY,EAAG,EAAG,EAAO,EAAS,CAE3D,AAAK,KAAK,OAAS,MAElB,MAAK,KAAO,CACX,QAAS,GACT,UAAW,EACX,WAAY,EACZ,QAAS,EACT,QAAS,EACT,MAAO,EACP,OAAQ,IAKV,KAAK,KAAK,QAAU,GACpB,KAAK,KAAK,UAAY,EACtB,KAAK,KAAK,WAAa,EACvB,KAAK,KAAK,QAAU,EACpB,KAAK,KAAK,QAAU,EACpB,KAAK,KAAK,MAAQ,EAClB,KAAK,KAAK,OAAS,EAEnB,KAAK,yBAIN,iBAAkB,CAEjB,AAAK,KAAK,OAAS,MAElB,MAAK,KAAK,QAAU,IAIrB,KAAK,yBAIN,wBAAyB,CAExB,GAAM,GAAO,MAAK,MAAQ,KAAK,MAAW,GAAI,KAAK,MAC7C,EAAO,MAAK,IAAM,KAAK,QAAa,GAAI,KAAK,MAC7C,EAAO,MAAK,MAAQ,KAAK,MAAS,EAClC,EAAO,MAAK,IAAM,KAAK,QAAW,EAEpC,EAAO,EAAK,EACZ,EAAQ,EAAK,EACb,EAAM,EAAK,EACX,EAAS,EAAK,EAElB,GAAK,KAAK,OAAS,MAAQ,KAAK,KAAK,QAAU,CAE9C,GAAM,GAAW,MAAK,MAAQ,KAAK,MAAS,KAAK,KAAK,UAAY,KAAK,KACjE,EAAW,MAAK,IAAM,KAAK,QAAW,KAAK,KAAK,WAAa,KAAK,KAExE,GAAQ,EAAS,KAAK,KAAK,QAC3B,EAAQ,EAAO,EAAS,KAAK,KAAK,MAClC,GAAO,EAAS,KAAK,KAAK,QAC1B,EAAS,EAAM,EAAS,KAAK,KAAK,OAInC,KAAK,iBAAiB,iBAAkB,EAAM,EAAO,EAAK,EAAQ,KAAK,KAAM,KAAK,KAElF,KAAK,wBAAwB,KAAM,KAAK,kBAAmB,SAI5D,OAAQ,EAAO,CAEd,GAAM,GAAO,MAAM,OAAQ,GAE3B,SAAK,OAAO,KAAO,KAAK,KACxB,EAAK,OAAO,KAAO,KAAK,KACxB,EAAK,OAAO,MAAQ,KAAK,MACzB,EAAK,OAAO,IAAM,KAAK,IACvB,EAAK,OAAO,OAAS,KAAK,OAC1B,EAAK,OAAO,KAAO,KAAK,KACxB,EAAK,OAAO,IAAM,KAAK,IAElB,KAAK,OAAS,MAAO,GAAK,OAAO,KAAO,OAAO,OAAQ,GAAI,KAAK,OAE9D,IAMT,GAAmB,UAAU,qBAAuB,GClIpD,oBAAqC,GAAY,CAEhD,aAAc,CAEb,MAAO,GAAI,IAAoB,GAAK,EAAG,EAAG,GAAK,GAAK,QAMtD,GAAuB,UAAU,yBAA2B,GCT5D,oBAA+B,GAAM,CAEpC,YAAa,EAAO,EAAY,CAE/B,MAAO,EAAO,GAEd,KAAK,KAAO,mBAEZ,KAAK,SAAS,KAAM,GAAS,WAC7B,KAAK,eAEL,KAAK,OAAS,GAAI,IAElB,KAAK,OAAS,GAAI,IAInB,SAAU,CAET,KAAK,OAAO,UAIb,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,OAAS,EAAO,OAAO,QAC5B,KAAK,OAAS,EAAO,OAAO,QAErB,OAMT,GAAiB,UAAU,mBAAqB,GClChD,GAAM,IAAwB,GAAI,GAC5B,GAAyB,GAAI,IAEnC,QAAsB,CAErB,YAAa,EAAO,EAAU,EAAa,CAE1C,GAAK,MAAM,QAAS,GAEnB,KAAM,IAAI,WAAW,yDAItB,KAAK,KAAO,GAEZ,KAAK,MAAQ,EACb,KAAK,SAAW,EAChB,KAAK,MAAQ,IAAU,OAAY,EAAM,OAAS,EAAW,EAC7D,KAAK,WAAa,IAAe,GAEjC,KAAK,MAAQ,GACb,KAAK,YAAc,CAAE,OAAQ,EAAG,MAAO,IAEvC,KAAK,QAAU,EAIhB,kBAAmB,KAEf,aAAa,EAAQ,CAExB,AAAK,IAAU,IAAO,KAAK,UAI5B,SAAU,EAAQ,CAEjB,YAAK,MAAQ,EAEN,KAIR,KAAM,EAAS,CAEd,YAAK,KAAO,EAAO,KACnB,KAAK,MAAQ,GAAI,GAAO,MAAM,YAAa,EAAO,OAClD,KAAK,SAAW,EAAO,SACvB,KAAK,MAAQ,EAAO,MACpB,KAAK,WAAa,EAAO,WAEzB,KAAK,MAAQ,EAAO,MAEb,KAIR,OAAQ,EAAQ,EAAW,EAAS,CAEnC,GAAU,KAAK,SACf,GAAU,EAAU,SAEpB,OAAU,GAAI,EAAG,EAAI,KAAK,SAAU,EAAI,EAAG,IAE1C,KAAK,MAAO,EAAS,GAAM,EAAU,MAAO,EAAS,GAItD,MAAO,MAIR,UAAW,EAAQ,CAElB,YAAK,MAAM,IAAK,GAET,KAIR,gBAAiB,EAAS,CAEzB,GAAM,GAAQ,KAAK,MACf,EAAS,EAEb,OAAU,GAAI,EAAG,EAAI,EAAO,OAAQ,EAAI,EAAG,IAAO,CAEjD,GAAI,GAAQ,EAAQ,GAEpB,AAAK,IAAU,QAEd,SAAQ,KAAM,8DAA+D,GAC7E,EAAQ,GAAI,KAIb,EAAO,KAAc,EAAM,EAC3B,EAAO,KAAc,EAAM,EAC3B,EAAO,KAAc,EAAM,EAI5B,MAAO,MAIR,kBAAmB,EAAU,CAE5B,GAAM,GAAQ,KAAK,MACf,EAAS,EAEb,OAAU,GAAI,EAAG,EAAI,EAAQ,OAAQ,EAAI,EAAG,IAAO,CAElD,GAAI,GAAS,EAAS,GAEtB,AAAK,IAAW,QAEf,SAAQ,KAAM,iEAAkE,GAChF,EAAS,GAAI,KAId,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAI7B,MAAO,MAIR,kBAAmB,EAAU,CAE5B,GAAM,GAAQ,KAAK,MACf,EAAS,EAEb,OAAU,GAAI,EAAG,EAAI,EAAQ,OAAQ,EAAI,EAAG,IAAO,CAElD,GAAI,GAAS,EAAS,GAEtB,AAAK,IAAW,QAEf,SAAQ,KAAM,iEAAkE,GAChF,EAAS,GAAI,IAId,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAI7B,MAAO,MAIR,kBAAmB,EAAU,CAE5B,GAAM,GAAQ,KAAK,MACf,EAAS,EAEb,OAAU,GAAI,EAAG,EAAI,EAAQ,OAAQ,EAAI,EAAG,IAAO,CAElD,GAAI,GAAS,EAAS,GAEtB,AAAK,IAAW,QAEf,SAAQ,KAAM,iEAAkE,GAChF,EAAS,GAAI,KAId,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAC5B,EAAO,KAAc,EAAO,EAI7B,MAAO,MAIR,aAAc,EAAI,CAEjB,GAAK,KAAK,WAAa,EAEtB,OAAU,GAAI,EAAG,EAAI,KAAK,MAAO,EAAI,EAAG,IAEvC,GAAS,oBAAqB,KAAM,GACpC,GAAS,aAAc,GAEvB,KAAK,MAAO,EAAG,GAAS,EAAG,GAAS,WAI1B,KAAK,WAAa,EAE7B,OAAU,GAAI,EAAG,EAAI,KAAK,MAAO,EAAI,EAAG,IAEvC,GAAQ,oBAAqB,KAAM,GACnC,GAAQ,aAAc,GAEtB,KAAK,OAAQ,EAAG,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAMhD,MAAO,MAIR,aAAc,EAAI,CAEjB,OAAU,GAAI,EAAG,EAAI,KAAK,MAAO,EAAI,EAAG,IAEvC,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GAEvB,GAAQ,aAAc,GAEtB,KAAK,OAAQ,EAAG,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAI/C,MAAO,MAIR,kBAAmB,EAAI,CAEtB,OAAU,GAAI,EAAG,EAAI,KAAK,MAAO,EAAI,EAAG,IAEvC,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GAEvB,GAAQ,kBAAmB,GAE3B,KAAK,OAAQ,EAAG,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAI/C,MAAO,MAIR,mBAAoB,EAAI,CAEvB,OAAU,GAAI,EAAG,EAAI,KAAK,MAAO,EAAI,EAAG,IAEvC,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GACvB,GAAQ,EAAI,KAAK,KAAM,GAEvB,GAAQ,mBAAoB,GAE5B,KAAK,OAAQ,EAAG,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAI/C,MAAO,MAIR,IAAK,EAAO,EAAS,EAAI,CAExB,YAAK,MAAM,IAAK,EAAO,GAEhB,KAIR,KAAM,EAAQ,CAEb,MAAO,MAAK,MAAO,EAAQ,KAAK,UAIjC,KAAM,EAAO,EAAI,CAEhB,YAAK,MAAO,EAAQ,KAAK,UAAa,EAE/B,KAIR,KAAM,EAAQ,CAEb,MAAO,MAAK,MAAO,EAAQ,KAAK,SAAW,GAI5C,KAAM,EAAO,EAAI,CAEhB,YAAK,MAAO,EAAQ,KAAK,SAAW,GAAM,EAEnC,KAIR,KAAM,EAAQ,CAEb,MAAO,MAAK,MAAO,EAAQ,KAAK,SAAW,GAI5C,KAAM,EAAO,EAAI,CAEhB,YAAK,MAAO,EAAQ,KAAK,SAAW,GAAM,EAEnC,KAIR,KAAM,EAAQ,CAEb,MAAO,MAAK,MAAO,EAAQ,KAAK,SAAW,GAI5C,KAAM,EAAO,EAAI,CAEhB,YAAK,MAAO,EAAQ,KAAK,SAAW,GAAM,EAEnC,KAIR,MAAO,EAAO,EAAG,EAAI,CAEpB,UAAS,KAAK,SAEd,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAEnB,KAIR,OAAQ,EAAO,EAAG,EAAG,EAAI,CAExB,UAAS,KAAK,SAEd,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAEnB,KAIR,QAAS,EAAO,EAAG,EAAG,EAAG,EAAI,CAE5B,UAAS,KAAK,SAEd,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAC1B,KAAK,MAAO,EAAQ,GAAM,EAEnB,KAIR,SAAU,EAAW,CAEpB,YAAK,iBAAmB,EAEjB,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,YAAa,KAAK,MAAO,KAAK,UAAW,KAAM,MAIhE,QAAS,CAER,GAAM,GAAO,CACZ,SAAU,KAAK,SACf,KAAM,KAAK,MAAM,YAAY,KAC7B,MAAO,MAAM,UAAU,MAAM,KAAM,KAAK,OACxC,WAAY,KAAK,YAGlB,MAAK,MAAK,OAAS,IAAK,GAAK,KAAO,KAAK,MACpC,KAAK,QAAU,IAAkB,GAAK,MAAQ,KAAK,OACnD,MAAK,YAAY,SAAW,GAAK,KAAK,YAAY,QAAU,KAAM,GAAK,YAAc,KAAK,aAExF,IAMT,GAAgB,UAAU,kBAAoB,GAI9C,oBAAkC,GAAgB,CAEjD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,WAAW,GAAS,EAAU,KAM3C,gBAAmC,GAAgB,CAElD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,YAAY,GAAS,EAAU,KAM5C,gBAA0C,GAAgB,CAEzD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,mBAAmB,GAAS,EAAU,KAMnD,gBAAmC,GAAgB,CAElD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,YAAY,GAAS,EAAU,KAM5C,gBAAoC,GAAgB,CAEnD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,aAAa,GAAS,EAAU,KAM7C,gBAAmC,GAAgB,CAElD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,YAAY,GAAS,EAAU,KAM5C,gBAAoC,GAAgB,CAEnD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,aAAa,GAAS,EAAU,KAM7C,gBAAqC,GAAgB,CAEpD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,aAAa,GAAS,EAAU,KAM7C,GAAuB,UAAU,yBAA2B,GAE5D,oBAAqC,GAAgB,CAEpD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,cAAc,GAAS,EAAU,KAM9C,gBAAqC,GAAgB,CAEpD,YAAa,EAAO,EAAU,EAAa,CAE1C,MAAO,GAAI,cAAc,GAAS,EAAU,KC3e9C,YAAmB,EAAQ,CAE1B,GAAK,EAAM,SAAW,EAAI,MAAO,KAEjC,GAAI,GAAM,EAAO,GAEjB,OAAU,GAAI,EAAG,EAAI,EAAM,OAAQ,EAAI,EAAG,EAAG,EAE5C,AAAK,EAAO,GAAM,GAAM,GAAM,EAAO,IAItC,MAAO,GChBR,GAAI,IAAM,EAEJ,GAAoB,GAAI,IACxB,GAAqB,GAAI,IACzB,GAAwB,GAAI,GAC5B,GAAqB,GAAI,IACzB,GAAiC,GAAI,IACrC,GAAwB,GAAI,GAElC,gBAA6B,GAAgB,CAE5C,aAAc,CAEb,QAEA,OAAO,eAAgB,KAAM,KAAM,CAAE,MAAO,OAE5C,KAAK,KAAO,AAAU,KAEtB,KAAK,KAAO,GACZ,KAAK,KAAO,iBAEZ,KAAK,MAAQ,KACb,KAAK,WAAa,GAElB,KAAK,gBAAkB,GACvB,KAAK,qBAAuB,GAE5B,KAAK,OAAS,GAEd,KAAK,YAAc,KACnB,KAAK,eAAiB,KAEtB,KAAK,UAAY,CAAE,MAAO,EAAG,MAAO,KAEpC,KAAK,SAAW,GAIjB,UAAW,CAEV,MAAO,MAAK,MAIb,SAAU,EAAQ,CAEjB,MAAK,OAAM,QAAS,GAEnB,KAAK,MAAQ,GAAM,IAAU,GAAU,MAAQ,GAAwB,IAAyB,EAAO,GAIvG,KAAK,MAAQ,EAIP,KAIR,aAAc,EAAO,CAEpB,MAAO,MAAK,WAAY,GAIzB,aAAc,EAAM,EAAY,CAE/B,YAAK,WAAY,GAAS,EAEnB,KAIR,gBAAiB,EAAO,CAEvB,aAAO,MAAK,WAAY,GAEjB,KAIR,aAAc,EAAO,CAEpB,MAAO,MAAK,WAAY,KAAW,OAIpC,SAAU,EAAO,EAAO,EAAgB,EAAI,CAE3C,KAAK,OAAO,KAAM,CAEjB,MAAO,EACP,MAAO,EACP,cAAe,IAMjB,aAAc,CAEb,KAAK,OAAS,GAIf,aAAc,EAAO,EAAQ,CAE5B,KAAK,UAAU,MAAQ,EACvB,KAAK,UAAU,MAAQ,EAIxB,aAAc,EAAS,CAEtB,GAAM,GAAW,KAAK,WAAW,SAEjC,AAAK,IAAa,QAEjB,GAAS,aAAc,GAEvB,EAAS,YAAc,IAIxB,GAAM,GAAS,KAAK,WAAW,OAE/B,GAAK,IAAW,OAAY,CAE3B,GAAM,GAAe,GAAI,MAAU,gBAAiB,GAEpD,EAAO,kBAAmB,GAE1B,EAAO,YAAc,GAItB,GAAM,GAAU,KAAK,WAAW,QAEhC,MAAK,KAAY,QAEhB,GAAQ,mBAAoB,GAE5B,EAAQ,YAAc,IAIlB,KAAK,cAAgB,MAEzB,KAAK,qBAID,KAAK,iBAAmB,MAE5B,KAAK,wBAIC,KAIR,gBAAiB,EAAI,CAEpB,UAAI,2BAA4B,GAEhC,KAAK,aAAc,IAEZ,KAIR,QAAS,EAAQ,CAIhB,UAAI,cAAe,GAEnB,KAAK,aAAc,IAEZ,KAIR,QAAS,EAAQ,CAIhB,UAAI,cAAe,GAEnB,KAAK,aAAc,IAEZ,KAIR,QAAS,EAAQ,CAIhB,UAAI,cAAe,GAEnB,KAAK,aAAc,IAEZ,KAIR,UAAW,EAAG,EAAG,EAAI,CAIpB,UAAI,gBAAiB,EAAG,EAAG,GAE3B,KAAK,aAAc,IAEZ,KAIR,MAAO,EAAG,EAAG,EAAI,CAIhB,UAAI,UAAW,EAAG,EAAG,GAErB,KAAK,aAAc,IAEZ,KAIR,OAAQ,EAAS,CAEhB,UAAK,OAAQ,GAEb,GAAK,eAEL,KAAK,aAAc,GAAK,QAEjB,KAIR,QAAS,CAER,YAAK,qBAEL,KAAK,YAAY,UAAW,IAAU,SAEtC,KAAK,UAAW,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAEvC,KAIR,cAAe,EAAS,CAEvB,GAAM,GAAW,GAEjB,OAAU,GAAI,EAAG,EAAI,EAAO,OAAQ,EAAI,EAAG,IAAO,CAEjD,GAAM,GAAQ,EAAQ,GACtB,EAAS,KAAM,EAAM,EAAG,EAAM,EAAG,EAAM,GAAK,GAI7C,YAAK,aAAc,WAAY,GAAI,IAAwB,EAAU,IAE9D,KAIR,oBAAqB,CAEpB,AAAK,KAAK,cAAgB,MAEzB,MAAK,YAAc,GAAI,KAIxB,GAAM,GAAW,KAAK,WAAW,SAC3B,EAA0B,KAAK,gBAAgB,SAErD,GAAK,GAAY,EAAS,oBAAsB,CAE/C,QAAQ,MAAO,kJAAmJ,MAElK,KAAK,YAAY,IAChB,GAAI,GAAS,KAAY,KAAY,MACrC,GAAI,GAAS,IAAY,IAAY,MAGtC,OAID,GAAK,IAAa,QAMjB,GAJA,KAAK,YAAY,uBAAwB,GAIpC,EAEJ,OAAU,GAAI,EAAG,EAAK,EAAwB,OAAQ,EAAI,EAAI,IAAO,CAEpE,GAAM,GAAiB,EAAyB,GAChD,GAAK,uBAAwB,GAE7B,AAAK,KAAK,qBAET,IAAQ,WAAY,KAAK,YAAY,IAAK,GAAK,KAC/C,KAAK,YAAY,cAAe,IAEhC,GAAQ,WAAY,KAAK,YAAY,IAAK,GAAK,KAC/C,KAAK,YAAY,cAAe,KAIhC,MAAK,YAAY,cAAe,GAAK,KACrC,KAAK,YAAY,cAAe,GAAK,WAUxC,MAAK,YAAY,YAIlB,AAAK,OAAO,KAAK,YAAY,IAAI,IAAO,MAAO,KAAK,YAAY,IAAI,IAAO,MAAO,KAAK,YAAY,IAAI,KAEtG,QAAQ,MAAO,sIAAuI,MAMxJ,uBAAwB,CAEvB,AAAK,KAAK,iBAAmB,MAE5B,MAAK,eAAiB,GAAI,KAI3B,GAAM,GAAW,KAAK,WAAW,SAC3B,EAA0B,KAAK,gBAAgB,SAErD,GAAK,GAAY,EAAS,oBAAsB,CAE/C,QAAQ,MAAO,wJAAyJ,MAExK,KAAK,eAAe,IAAK,GAAI,GAAW,KAExC,OAID,GAAK,EAAW,CAIf,GAAM,GAAS,KAAK,eAAe,OAMnC,GAJA,GAAK,uBAAwB,GAIxB,EAEJ,OAAU,GAAI,EAAG,EAAK,EAAwB,OAAQ,EAAI,EAAI,IAAO,CAEpE,GAAM,GAAiB,EAAyB,GAChD,GAAiB,uBAAwB,GAEzC,AAAK,KAAK,qBAET,IAAQ,WAAY,GAAK,IAAK,GAAiB,KAC/C,GAAK,cAAe,IAEpB,GAAQ,WAAY,GAAK,IAAK,GAAiB,KAC/C,GAAK,cAAe,KAIpB,IAAK,cAAe,GAAiB,KACrC,GAAK,cAAe,GAAiB,MAQxC,GAAK,UAAW,GAKhB,GAAI,GAAc,EAElB,OAAU,GAAI,EAAG,EAAK,EAAS,MAAO,EAAI,EAAI,IAE7C,GAAQ,oBAAqB,EAAU,GAEvC,EAAc,KAAK,IAAK,EAAa,EAAO,kBAAmB,KAMhE,GAAK,EAEJ,OAAU,GAAI,EAAG,EAAK,EAAwB,OAAQ,EAAI,EAAI,IAAO,CAEpE,GAAM,GAAiB,EAAyB,GAC1C,EAAuB,KAAK,qBAElC,OAAU,GAAI,EAAG,EAAK,EAAe,MAAO,EAAI,EAAI,IAEnD,GAAQ,oBAAqB,EAAgB,GAExC,GAEJ,IAAQ,oBAAqB,EAAU,GACvC,GAAQ,IAAK,KAId,EAAc,KAAK,IAAK,EAAa,EAAO,kBAAmB,KAQlE,KAAK,eAAe,OAAS,KAAK,KAAM,GAEnC,MAAO,KAAK,eAAe,SAE/B,QAAQ,MAAO,+HAAgI,OAQlJ,oBAAqB,EAMrB,iBAAkB,CAEjB,GAAM,GAAQ,KAAK,MACb,EAAa,KAAK,WAKxB,GAAK,IAAU,MACb,EAAW,WAAa,QACxB,EAAW,SAAW,QACtB,EAAW,KAAO,OAAY,CAE/B,QAAQ,MAAO,gHACf,OAID,GAAM,GAAU,EAAM,MAChB,EAAY,EAAW,SAAS,MAChC,EAAU,EAAW,OAAO,MAC5B,EAAM,EAAW,GAAG,MAEpB,EAAY,EAAU,OAAS,EAErC,AAAK,EAAW,UAAY,QAE3B,KAAK,aAAc,UAAW,GAAI,IAAiB,GAAI,cAAc,EAAI,GAAa,IAIvF,GAAM,GAAW,EAAW,QAAQ,MAE9B,EAAO,GAAI,EAAO,GAExB,OAAU,GAAI,EAAG,EAAI,EAAW,IAE/B,EAAM,GAAM,GAAI,GAChB,EAAM,GAAM,GAAI,GAIjB,GAAM,GAAK,GAAI,GACd,EAAK,GAAI,GACT,EAAK,GAAI,GAET,EAAM,GAAI,IACV,EAAM,GAAI,IACV,EAAM,GAAI,IAEV,EAAO,GAAI,GACX,EAAO,GAAI,GAEZ,WAAyB,EAAG,EAAG,EAAI,CAElC,EAAG,UAAW,EAAW,EAAI,GAC7B,EAAG,UAAW,EAAW,EAAI,GAC7B,EAAG,UAAW,EAAW,EAAI,GAE7B,EAAI,UAAW,EAAK,EAAI,GACxB,EAAI,UAAW,EAAK,EAAI,GACxB,EAAI,UAAW,EAAK,EAAI,GAExB,EAAG,IAAK,GACR,EAAG,IAAK,GAER,EAAI,IAAK,GACT,EAAI,IAAK,GAET,GAAM,GAAI,EAAQ,GAAI,EAAI,EAAI,EAAI,EAAI,EAAI,EAAI,GAI9C,AAAK,CAAE,SAAU,IAEjB,GAAK,KAAM,GAAK,eAAgB,EAAI,GAAI,gBAAiB,EAAI,CAAE,EAAI,GAAI,eAAgB,GACvF,EAAK,KAAM,GAAK,eAAgB,EAAI,GAAI,gBAAiB,EAAI,CAAE,EAAI,GAAI,eAAgB,GAEvF,EAAM,GAAI,IAAK,GACf,EAAM,GAAI,IAAK,GACf,EAAM,GAAI,IAAK,GAEf,EAAM,GAAI,IAAK,GACf,EAAM,GAAI,IAAK,GACf,EAAM,GAAI,IAAK,IAIhB,GAAI,GAAS,KAAK,OAElB,AAAK,EAAO,SAAW,GAEtB,GAAS,CAAE,CACV,MAAO,EACP,MAAO,EAAQ,UAKjB,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,EAAG,EAAI,CAEnD,GAAM,GAAQ,EAAQ,GAEhB,EAAQ,EAAM,MACd,EAAQ,EAAM,MAEpB,OAAU,GAAI,EAAO,EAAK,EAAQ,EAAO,EAAI,EAAI,GAAK,EAErD,EACC,EAAS,EAAI,GACb,EAAS,EAAI,GACb,EAAS,EAAI,IAOhB,GAAM,GAAM,GAAI,GAAW,EAAO,GAAI,GAChC,EAAI,GAAI,GAAW,EAAK,GAAI,GAElC,WAAuB,EAAI,CAE1B,EAAE,UAAW,EAAS,EAAI,GAC1B,EAAG,KAAM,GAET,GAAM,GAAI,EAAM,GAIhB,EAAI,KAAM,GACV,EAAI,IAAK,EAAE,eAAgB,EAAE,IAAK,KAAQ,YAI1C,EAAK,aAAc,EAAI,GAEvB,GAAM,GAAM,AADC,EAAK,IAAK,EAAM,IACV,EAAQ,GAAQ,EAEnC,EAAU,EAAI,GAAM,EAAI,EACxB,EAAU,EAAI,EAAI,GAAM,EAAI,EAC5B,EAAU,EAAI,EAAI,GAAM,EAAI,EAC5B,EAAU,EAAI,EAAI,GAAM,EAIzB,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,EAAG,EAAI,CAEnD,GAAM,GAAQ,EAAQ,GAEhB,EAAQ,EAAM,MACd,EAAQ,EAAM,MAEpB,OAAU,GAAI,EAAO,EAAK,EAAQ,EAAO,EAAI,EAAI,GAAK,EAErD,EAAc,EAAS,EAAI,IAC3B,EAAc,EAAS,EAAI,IAC3B,EAAc,EAAS,EAAI,KAQ9B,sBAAuB,CAEtB,GAAM,GAAQ,KAAK,MACb,EAAoB,KAAK,aAAc,YAE7C,GAAK,IAAsB,OAAY,CAEtC,GAAI,GAAkB,KAAK,aAAc,UAEzC,GAAK,IAAoB,OAExB,EAAkB,GAAI,IAAiB,GAAI,cAAc,EAAkB,MAAQ,GAAK,GACxF,KAAK,aAAc,SAAU,OAM7B,QAAU,GAAI,EAAG,EAAK,EAAgB,MAAO,EAAI,EAAI,IAEpD,EAAgB,OAAQ,EAAG,EAAG,EAAG,GAMnC,GAAM,GAAK,GAAI,GAAW,EAAK,GAAI,GAAW,EAAK,GAAI,GACjD,EAAK,GAAI,GAAW,EAAK,GAAI,GAAW,EAAK,GAAI,GACjD,EAAK,GAAI,GAAW,EAAK,GAAI,GAInC,GAAK,EAEJ,OAAU,GAAI,EAAG,EAAK,EAAM,MAAO,EAAI,EAAI,GAAK,EAAI,CAEnD,GAAM,GAAK,EAAM,KAAM,EAAI,GACrB,EAAK,EAAM,KAAM,EAAI,GACrB,EAAK,EAAM,KAAM,EAAI,GAE3B,EAAG,oBAAqB,EAAmB,GAC3C,EAAG,oBAAqB,EAAmB,GAC3C,EAAG,oBAAqB,EAAmB,GAE3C,EAAG,WAAY,EAAI,GACnB,EAAG,WAAY,EAAI,GACnB,EAAG,MAAO,GAEV,EAAG,oBAAqB,EAAiB,GACzC,EAAG,oBAAqB,EAAiB,GACzC,EAAG,oBAAqB,EAAiB,GAEzC,EAAG,IAAK,GACR,EAAG,IAAK,GACR,EAAG,IAAK,GAER,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAC3C,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,GAC3C,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,OAQ5C,QAAU,GAAI,EAAG,EAAK,EAAkB,MAAO,EAAI,EAAI,GAAK,EAE3D,EAAG,oBAAqB,EAAmB,EAAI,GAC/C,EAAG,oBAAqB,EAAmB,EAAI,GAC/C,EAAG,oBAAqB,EAAmB,EAAI,GAE/C,EAAG,WAAY,EAAI,GACnB,EAAG,WAAY,EAAI,GACnB,EAAG,MAAO,GAEV,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC9C,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC9C,EAAgB,OAAQ,EAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAMhD,KAAK,mBAEL,EAAgB,YAAc,IAMhC,MAAO,EAAU,EAAS,CAEzB,GAAK,CAAI,IAAY,EAAS,kBAAqB,CAElD,QAAQ,MAAO,kFAAmF,GAClG,OAID,AAAK,IAAW,QAEf,GAAS,EAET,QAAQ,KACP,2JAMF,GAAM,GAAa,KAAK,WAExB,OAAY,KAAO,GAAa,CAE/B,GAAK,EAAS,WAAY,KAAU,OAAY,SAGhD,GAAM,GAAkB,AADL,EAAY,GACI,MAE7B,EAAa,EAAS,WAAY,GAClC,EAAkB,EAAW,MAE7B,EAAkB,EAAW,SAAW,EACxC,EAAS,KAAK,IAAK,EAAgB,OAAQ,EAAgB,OAAS,GAE1E,OAAU,GAAI,EAAG,EAAI,EAAiB,EAAI,EAAQ,IAAM,IAEvD,EAAiB,GAAM,EAAiB,GAM1C,MAAO,MAIR,kBAAmB,CAElB,GAAM,GAAU,KAAK,WAAW,OAEhC,OAAU,GAAI,EAAG,EAAK,EAAQ,MAAO,EAAI,EAAI,IAE5C,GAAQ,oBAAqB,EAAS,GAEtC,GAAQ,YAER,EAAQ,OAAQ,EAAG,GAAQ,EAAG,GAAQ,EAAG,GAAQ,GAMnD,cAAe,CAEd,WAAiC,EAAW,EAAU,CAErD,GAAM,GAAQ,EAAU,MAClB,EAAW,EAAU,SACrB,EAAa,EAAU,WAEvB,EAAS,GAAI,GAAM,YAAa,EAAQ,OAAS,GAEnD,EAAQ,EAAG,EAAS,EAExB,OAAU,GAAI,EAAG,EAAI,EAAQ,OAAQ,EAAI,EAAG,IAAO,CAElD,AAAK,EAAU,6BAEd,EAAQ,EAAS,GAAM,EAAU,KAAK,OAAS,EAAU,OAIzD,EAAQ,EAAS,GAAM,EAIxB,OAAU,GAAI,EAAG,EAAI,EAAU,IAE9B,EAAQ,KAAc,EAAO,KAM/B,MAAO,IAAI,IAAiB,EAAQ,EAAU,GAM/C,GAAK,KAAK,QAAU,KAEnB,eAAQ,KAAM,+EACP,KAIR,GAAM,GAAY,GAAI,IAEhB,EAAU,KAAK,MAAM,MACrB,EAAa,KAAK,WAIxB,OAAY,KAAQ,GAAa,CAEhC,GAAM,GAAY,EAAY,GAExB,EAAe,EAAwB,EAAW,GAExD,EAAU,aAAc,EAAM,GAM/B,GAAM,GAAkB,KAAK,gBAE7B,OAAY,KAAQ,GAAkB,CAErC,GAAM,GAAa,GACb,EAAiB,EAAiB,GAExC,OAAU,GAAI,EAAG,EAAK,EAAe,OAAQ,EAAI,EAAI,IAAO,CAE3D,GAAM,GAAY,EAAgB,GAE5B,EAAe,EAAwB,EAAW,GAExD,EAAW,KAAM,GAIlB,EAAU,gBAAiB,GAAS,EAIrC,EAAU,qBAAuB,KAAK,qBAItC,GAAM,GAAS,KAAK,OAEpB,OAAU,GAAI,EAAG,EAAI,EAAO,OAAQ,EAAI,EAAG,IAAO,CAEjD,GAAM,GAAQ,EAAQ,GACtB,EAAU,SAAU,EAAM,MAAO,EAAM,MAAO,EAAM,eAIrD,MAAO,GAIR,QAAS,CAER,GAAM,GAAO,CACZ,SAAU,CACT,QAAS,IACT,KAAM,iBACN,UAAW,0BAWb,GALA,EAAK,KAAO,KAAK,KACjB,EAAK,KAAO,KAAK,KACZ,KAAK,OAAS,IAAK,GAAK,KAAO,KAAK,MACpC,OAAO,KAAM,KAAK,UAAW,OAAS,GAAI,GAAK,SAAW,KAAK,UAE/D,KAAK,aAAe,OAAY,CAEpC,GAAM,GAAa,KAAK,WAExB,OAAY,KAAO,GAElB,AAAK,EAAY,KAAU,QAAY,GAAM,GAAQ,EAAY,IAIlE,MAAO,GAMR,EAAK,KAAO,CAAE,WAAY,IAE1B,GAAM,GAAQ,KAAK,MAEnB,AAAK,IAAU,MAEd,GAAK,KAAK,MAAQ,CACjB,KAAM,EAAM,MAAM,YAAY,KAC9B,MAAO,MAAM,UAAU,MAAM,KAAM,EAAM,SAK3C,GAAM,GAAa,KAAK,WAExB,OAAY,KAAO,GAAa,CAE/B,GAAM,GAAY,EAAY,GAE9B,EAAK,KAAK,WAAY,GAAQ,EAAU,OAAQ,EAAK,MAItD,GAAM,GAAkB,GACpB,EAAqB,GAEzB,OAAY,KAAO,MAAK,gBAAkB,CAEzC,GAAM,GAAiB,KAAK,gBAAiB,GAEvC,EAAQ,GAEd,OAAU,GAAI,EAAG,EAAK,EAAe,OAAQ,EAAI,EAAI,IAAO,CAE3D,GAAM,GAAY,EAAgB,GAElC,EAAM,KAAM,EAAU,OAAQ,EAAK,OAIpC,AAAK,EAAM,OAAS,GAEnB,GAAiB,GAAQ,EAEzB,EAAqB,IAMvB,AAAK,GAEJ,GAAK,KAAK,gBAAkB,EAC5B,EAAK,KAAK,qBAAuB,KAAK,sBAIvC,GAAM,GAAS,KAAK,OAEpB,AAAK,EAAO,OAAS,GAEpB,GAAK,KAAK,OAAS,KAAK,MAAO,KAAK,UAAW,KAIhD,GAAM,GAAiB,KAAK,eAE5B,MAAK,KAAmB,MAEvB,GAAK,KAAK,eAAiB,CAC1B,OAAQ,EAAe,OAAO,UAC9B,OAAQ,EAAe,SAKlB,EAIR,OAAQ,CA0BP,MAAO,IAAI,MAAiB,KAAM,MAInC,KAAM,EAAS,CAId,KAAK,MAAQ,KACb,KAAK,WAAa,GAClB,KAAK,gBAAkB,GACvB,KAAK,OAAS,GACd,KAAK,YAAc,KACnB,KAAK,eAAiB,KAItB,GAAM,GAAO,GAIb,KAAK,KAAO,EAAO,KAInB,GAAM,GAAQ,EAAO,MAErB,AAAK,IAAU,MAEd,KAAK,SAAU,EAAM,MAAO,IAM7B,GAAM,GAAa,EAAO,WAE1B,OAAY,KAAQ,GAAa,CAEhC,GAAM,GAAY,EAAY,GAC9B,KAAK,aAAc,EAAM,EAAU,MAAO,IAM3C,GAAM,GAAkB,EAAO,gBAE/B,OAAY,KAAQ,GAAkB,CAErC,GAAM,GAAQ,GACR,EAAiB,EAAiB,GAExC,OAAU,GAAI,EAAG,EAAI,EAAe,OAAQ,EAAI,EAAG,IAElD,EAAM,KAAM,EAAgB,GAAI,MAAO,IAIxC,KAAK,gBAAiB,GAAS,EAIhC,KAAK,qBAAuB,EAAO,qBAInC,GAAM,GAAS,EAAO,OAEtB,OAAU,GAAI,EAAG,EAAI,EAAO,OAAQ,EAAI,EAAG,IAAO,CAEjD,GAAM,GAAQ,EAAQ,GACtB,KAAK,SAAU,EAAM,MAAO,EAAM,MAAO,EAAM,eAMhD,GAAM,GAAc,EAAO,YAE3B,AAAK,IAAgB,MAEpB,MAAK,YAAc,EAAY,SAMhC,GAAM,GAAiB,EAAO,eAE9B,MAAK,KAAmB,MAEvB,MAAK,eAAiB,EAAe,SAMtC,KAAK,UAAU,MAAQ,EAAO,UAAU,MACxC,KAAK,UAAU,MAAQ,EAAO,UAAU,MAIxC,KAAK,SAAW,EAAO,SAEhB,KAIR,SAAU,CAET,KAAK,cAAe,CAAE,KAAM,cAM9B,GAAe,UAAU,iBAAmB,GC9nC5C,oBAA4B,GAAe,CAE1C,YAAa,EAAQ,EAAG,EAAS,EAAG,EAAgB,EAAG,EAAiB,EAAI,CAE3E,QACA,KAAK,KAAO,gBAEZ,KAAK,WAAa,CACjB,MAAO,EACP,OAAQ,EACR,cAAe,EACf,eAAgB,GAGjB,GAAM,GAAa,EAAQ,EACrB,EAAc,EAAS,EAEvB,EAAQ,KAAK,MAAO,GACpB,EAAQ,KAAK,MAAO,GAEpB,EAAS,EAAQ,EACjB,EAAS,EAAQ,EAEjB,EAAgB,EAAQ,EACxB,EAAiB,EAAS,EAI1B,EAAU,GACV,EAAW,GACX,EAAU,GACV,EAAM,GAEZ,OAAU,GAAK,EAAG,EAAK,EAAQ,IAAQ,CAEtC,GAAM,GAAI,EAAK,EAAiB,EAEhC,OAAU,GAAK,EAAG,EAAK,EAAQ,IAAQ,CAEtC,GAAM,GAAI,EAAK,EAAgB,EAE/B,EAAS,KAAM,EAAG,CAAE,EAAG,GAEvB,EAAQ,KAAM,EAAG,EAAG,GAEpB,EAAI,KAAM,EAAK,GACf,EAAI,KAAM,EAAM,EAAK,IAMvB,OAAU,GAAK,EAAG,EAAK,EAAO,IAE7B,OAAU,GAAK,EAAG,EAAK,EAAO,IAAQ,CAErC,GAAM,GAAI,EAAK,EAAS,EAClB,EAAI,EAAK,EAAW,GAAK,GACzB,EAAM,EAAK,EAAM,EAAW,GAAK,GACjC,EAAM,EAAK,EAAM,EAAS,EAEhC,EAAQ,KAAM,EAAG,EAAG,GACpB,EAAQ,KAAM,EAAG,EAAG,GAMtB,KAAK,SAAU,GACf,KAAK,aAAc,WAAY,GAAI,IAAwB,EAAU,IACrE,KAAK,aAAc,SAAU,GAAI,IAAwB,EAAS,IAClE,KAAK,aAAc,KAAM,GAAI,IAAwB,EAAK,UAIpD,UAAU,EAAO,CAEvB,MAAO,IAAI,IAAe,EAAK,MAAO,EAAK,OAAQ,EAAK,cAAe,EAAK,kBC5E9E,GAAI,IAAa,EAEjB,gBAAuB,GAAgB,CAEtC,aAAc,CAEb,QAEA,OAAO,eAAgB,KAAM,KAAM,CAAE,MAAO,OAE5C,KAAK,KAAO,AAAU,KAEtB,KAAK,KAAO,GACZ,KAAK,KAAO,WAEZ,KAAK,IAAM,GAEX,KAAK,SAAW,GAChB,KAAK,KAAO,GACZ,KAAK,aAAe,GAEpB,KAAK,QAAU,EACf,KAAK,YAAc,GAEnB,KAAK,SAAW,GAChB,KAAK,SAAW,GAChB,KAAK,cAAgB,GACrB,KAAK,cAAgB,KACrB,KAAK,cAAgB,KACrB,KAAK,mBAAqB,KAE1B,KAAK,UAAY,GACjB,KAAK,UAAY,GACjB,KAAK,WAAa,GAElB,KAAK,iBAAmB,IACxB,KAAK,YAAc,GACnB,KAAK,WAAa,EAClB,KAAK,gBAAkB,IACvB,KAAK,YAAc,GACnB,KAAK,aAAe,GACpB,KAAK,aAAe,GACpB,KAAK,aAAe,GAEpB,KAAK,eAAiB,KACtB,KAAK,iBAAmB,GACxB,KAAK,YAAc,GAEnB,KAAK,WAAa,KAElB,KAAK,WAAa,GAElB,KAAK,UAAY,KAEjB,KAAK,cAAgB,GACrB,KAAK,oBAAsB,EAC3B,KAAK,mBAAqB,EAE1B,KAAK,UAAY,GAEjB,KAAK,UAAY,EACjB,KAAK,gBAAkB,GACvB,KAAK,mBAAqB,GAE1B,KAAK,QAAU,GAEf,KAAK,WAAa,GAElB,KAAK,SAAW,GAEhB,KAAK,QAAU,EAIhB,SAAwC,EAExC,iBAAgD,EAEhD,uBAAwB,CAEvB,MAAO,MAAK,gBAAgB,WAI7B,UAAW,EAAS,CAEnB,GAAK,IAAW,OAEhB,OAAY,KAAO,GAAS,CAE3B,GAAM,GAAW,EAAQ,GAEzB,GAAK,IAAa,OAAY,CAE7B,QAAQ,KAAM,oBAAuB,EAAM,6BAC3C,SAKD,GAAK,IAAQ,UAAY,CAExB,QAAQ,KAAM,SAAW,KAAK,KAAO,sEACrC,KAAK,YAAgB,IAAa,GAClC,SAID,GAAM,GAAe,KAAM,GAE3B,GAAK,IAAiB,OAAY,CAEjC,QAAQ,KAAM,SAAW,KAAK,KAAO,MAAS,EAAM,yCACpD,SAID,AAAK,GAAgB,EAAa,QAEjC,EAAa,IAAK,GAEZ,AAAO,GAAgB,EAAa,WAAiB,GAAY,EAAS,UAEhF,EAAa,KAAM,GAInB,KAAM,GAAQ,GAQjB,OAAQ,EAAO,CAEd,GAAM,GAAW,IAAS,QAAa,MAAO,IAAS,SAEvD,AAAK,GAEJ,GAAO,CACN,SAAU,GACV,OAAQ,KAKV,GAAM,GAAO,CACZ,SAAU,CACT,QAAS,IACT,KAAM,WACN,UAAW,oBAKb,EAAK,KAAO,KAAK,KACjB,EAAK,KAAO,KAAK,KAEZ,KAAK,OAAS,IAAK,GAAK,KAAO,KAAK,MAEpC,KAAK,OAAS,KAAK,MAAM,SAAU,GAAK,MAAQ,KAAK,MAAM,UAE3D,KAAK,YAAc,QAAY,GAAK,UAAY,KAAK,WACrD,KAAK,YAAc,QAAY,GAAK,UAAY,KAAK,WAErD,KAAK,OAAS,KAAK,MAAM,SAAU,GAAK,MAAQ,KAAK,MAAM,UAC3D,KAAK,UAAY,KAAK,SAAS,SAAU,GAAK,SAAW,KAAK,SAAS,UACvE,KAAK,mBAAqB,KAAK,oBAAsB,GAAI,GAAK,kBAAoB,KAAK,mBAEvF,KAAK,UAAY,KAAK,SAAS,SAAU,GAAK,SAAW,KAAK,SAAS,UACvE,KAAK,oBAAsB,QAAY,GAAK,kBAAoB,KAAK,mBACrE,KAAK,cAAgB,KAAK,aAAa,SAAU,GAAK,aAAe,KAAK,aAAa,UACvF,KAAK,YAAc,QAAY,GAAK,UAAY,KAAK,WACrD,KAAK,YAAc,QAAY,GAAK,UAAY,KAAK,WACrD,KAAK,qBAAuB,QAAY,GAAK,mBAAqB,KAAK,oBAEvE,KAAK,cAAgB,KAAK,aAAa,WAE3C,GAAK,aAAe,KAAK,aAAa,OAAQ,GAAO,MAIjD,KAAK,uBAAyB,KAAK,sBAAsB,WAE7D,GAAK,sBAAwB,KAAK,sBAAsB,OAAQ,GAAO,MAInE,KAAK,oBAAsB,KAAK,mBAAmB,WAEvD,GAAK,mBAAqB,KAAK,mBAAmB,OAAQ,GAAO,KACjE,EAAK,qBAAuB,KAAK,qBAAqB,WAIlD,KAAK,KAAO,KAAK,IAAI,WAAY,GAAK,IAAM,KAAK,IAAI,OAAQ,GAAO,MACpE,KAAK,QAAU,KAAK,OAAO,WAAY,GAAK,OAAS,KAAK,OAAO,OAAQ,GAAO,MAChF,KAAK,UAAY,KAAK,SAAS,WAAY,GAAK,SAAW,KAAK,SAAS,OAAQ,GAAO,MAExF,KAAK,UAAY,KAAK,SAAS,WAEnC,GAAK,SAAW,KAAK,SAAS,OAAQ,GAAO,KAC7C,EAAK,kBAAoB,KAAK,mBAI1B,KAAK,OAAS,KAAK,MAAM,WAE7B,GAAK,MAAQ,KAAK,MAAM,OAAQ,GAAO,KACvC,EAAK,eAAiB,KAAK,gBAIvB,KAAK,SAAW,KAAK,QAAQ,WAEjC,GAAK,QAAU,KAAK,QAAQ,OAAQ,GAAO,KAC3C,EAAK,UAAY,KAAK,WAIlB,KAAK,WAAa,KAAK,UAAU,WAErC,GAAK,UAAY,KAAK,UAAU,OAAQ,GAAO,KAC/C,EAAK,cAAgB,KAAK,cAC1B,EAAK,YAAc,KAAK,YAAY,WAIhC,KAAK,iBAAmB,KAAK,gBAAgB,WAEjD,GAAK,gBAAkB,KAAK,gBAAgB,OAAQ,GAAO,KAC3D,EAAK,kBAAoB,KAAK,kBAC9B,EAAK,iBAAmB,KAAK,kBAIzB,KAAK,cAAgB,KAAK,aAAa,WAAY,GAAK,aAAe,KAAK,aAAa,OAAQ,GAAO,MACxG,KAAK,cAAgB,KAAK,aAAa,WAAY,GAAK,aAAe,KAAK,aAAa,OAAQ,GAAO,MAExG,KAAK,aAAe,KAAK,YAAY,WAAY,GAAK,YAAc,KAAK,YAAY,OAAQ,GAAO,MACpG,KAAK,aAAe,KAAK,YAAY,WAAY,GAAK,YAAc,KAAK,YAAY,OAAQ,GAAO,MACpG,KAAK,sBAAwB,KAAK,qBAAqB,WAAY,GAAK,qBAAuB,KAAK,qBAAqB,OAAQ,GAAO,MACxI,KAAK,iBAAmB,KAAK,gBAAgB,WAAY,GAAK,gBAAkB,KAAK,gBAAgB,OAAQ,GAAO,MAEpH,KAAK,QAAU,KAAK,OAAO,WAE/B,GAAK,OAAS,KAAK,OAAO,OAAQ,GAAO,KAEpC,KAAK,UAAY,QAAY,GAAK,QAAU,KAAK,UAIlD,KAAK,kBAAoB,QAAY,GAAK,gBAAkB,KAAK,iBACjE,KAAK,eAAiB,QAAY,GAAK,aAAe,KAAK,cAC3D,KAAK,kBAAoB,QAAY,GAAK,gBAAkB,KAAK,iBAEjE,KAAK,aAAe,KAAK,YAAY,WAEzC,GAAK,YAAc,KAAK,YAAY,OAAQ,GAAO,MAI/C,KAAK,eAAiB,QAAY,GAAK,aAAe,KAAK,cAC3D,KAAK,iBAAmB,KAAK,gBAAgB,WAAY,GAAK,gBAAkB,KAAK,gBAAgB,OAAQ,GAAO,MACpH,KAAK,YAAc,QAAY,GAAK,UAAY,KAAK,WACrD,KAAK,cAAgB,KAAK,aAAa,WAAY,GAAK,aAAe,KAAK,aAAa,OAAQ,GAAO,MACxG,KAAK,sBAAwB,QAAY,GAAK,oBAAsB,KAAK,qBACzE,KAAK,kBAAoB,QAAY,GAAK,gBAAkB,KAAK,gBAAgB,UAEjF,KAAK,OAAS,QAAY,GAAK,KAAO,KAAK,MAC3C,KAAK,aAAe,MAAO,GAAK,WAAa,KAAK,YAClD,KAAK,kBAAoB,QAAY,GAAK,gBAAkB,KAAK,iBAEjE,KAAK,WAAa,IAAiB,GAAK,SAAW,KAAK,UACxD,KAAK,OAAS,IAAY,GAAK,KAAO,KAAK,MAC3C,KAAK,cAAe,GAAK,aAAe,IAExC,KAAK,QAAU,GAAI,GAAK,QAAU,KAAK,SACvC,KAAK,cAAgB,IAAO,GAAK,YAAc,KAAK,aAEzD,EAAK,UAAY,KAAK,UACtB,EAAK,UAAY,KAAK,UACtB,EAAK,WAAa,KAAK,WACvB,EAAK,WAAa,KAAK,WAEvB,EAAK,aAAe,KAAK,aACzB,EAAK,iBAAmB,KAAK,iBAC7B,EAAK,YAAc,KAAK,YACxB,EAAK,WAAa,KAAK,WACvB,EAAK,gBAAkB,KAAK,gBAC5B,EAAK,YAAc,KAAK,YACxB,EAAK,aAAe,KAAK,aACzB,EAAK,aAAe,KAAK,aAGpB,KAAK,UAAY,KAAK,WAAa,GAAI,GAAK,SAAW,KAAK,UAE5D,KAAK,gBAAkB,IAAO,GAAK,cAAgB,IACnD,KAAK,sBAAwB,GAAI,GAAK,oBAAsB,KAAK,qBACjE,KAAK,qBAAuB,GAAI,GAAK,mBAAqB,KAAK,oBAE/D,KAAK,WAAa,KAAK,YAAc,GAAI,GAAK,UAAY,KAAK,WAC/D,KAAK,WAAa,QAAY,GAAK,SAAW,KAAK,UACnD,KAAK,UAAY,QAAY,GAAK,QAAU,KAAK,SACjD,KAAK,QAAU,QAAY,GAAK,MAAQ,KAAK,OAE7C,KAAK,YAAc,IAAO,GAAK,UAAY,IAE3C,KAAK,UAAY,GAAI,GAAK,UAAY,KAAK,WAC3C,KAAK,kBAAoB,IAAO,GAAK,gBAAkB,KAAK,iBAC5D,KAAK,qBAAuB,IAAO,GAAK,mBAAqB,KAAK,oBAElE,KAAK,YAAc,IAAO,GAAK,UAAY,KAAK,WAChD,KAAK,mBAAqB,GAAI,GAAK,mBAAqB,KAAK,oBAC7D,KAAK,mBAAqB,SAAU,GAAK,iBAAmB,KAAK,kBACjE,KAAK,oBAAsB,SAAU,GAAK,kBAAoB,KAAK,mBAEnE,KAAK,cAAgB,IAAO,GAAK,YAAc,KAAK,aAEpD,KAAK,UAAY,IAAQ,GAAK,QAAU,IAExC,KAAK,aAAe,IAAQ,GAAK,WAAa,IAE9C,KAAK,UAAW,KAAK,YAAe,MAAO,GAAK,SAAW,KAAK,UAIrE,WAA2B,EAAQ,CAElC,GAAM,GAAS,GAEf,OAAY,KAAO,GAAQ,CAE1B,GAAM,GAAO,EAAO,GACpB,MAAO,GAAK,SACZ,EAAO,KAAM,GAId,MAAO,GAIR,GAAK,EAAS,CAEb,GAAM,GAAW,EAAkB,EAAK,UAClC,EAAS,EAAkB,EAAK,QAEtC,AAAK,EAAS,OAAS,GAAI,GAAK,SAAW,GACtC,EAAO,OAAS,GAAI,GAAK,OAAS,GAIxC,MAAO,GAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,MAIrC,KAAM,EAAS,CAEd,KAAK,KAAO,EAAO,KAEnB,KAAK,IAAM,EAAO,IAElB,KAAK,SAAW,EAAO,SACvB,KAAK,KAAO,EAAO,KACnB,KAAK,aAAe,EAAO,aAE3B,KAAK,QAAU,EAAO,QACtB,KAAK,YAAc,EAAO,YAE1B,KAAK,SAAW,EAAO,SACvB,KAAK,SAAW,EAAO,SACvB,KAAK,cAAgB,EAAO,cAC5B,KAAK,cAAgB,EAAO,cAC5B,KAAK,cAAgB,EAAO,cAC5B,KAAK,mBAAqB,EAAO,mBAEjC,KAAK,UAAY,EAAO,UACxB,KAAK,UAAY,EAAO,UACxB,KAAK,WAAa,EAAO,WAEzB,KAAK,iBAAmB,EAAO,iBAC/B,KAAK,YAAc,EAAO,YAC1B,KAAK,WAAa,EAAO,WACzB,KAAK,gBAAkB,EAAO,gBAC9B,KAAK,YAAc,EAAO,YAC1B,KAAK,aAAe,EAAO,aAC3B,KAAK,aAAe,EAAO,aAC3B,KAAK,aAAe,EAAO,aAE3B,GAAM,GAAY,EAAO,eACrB,EAAY,KAEhB,GAAK,IAAc,KAAO,CAEzB,GAAM,GAAI,EAAU,OACpB,EAAY,GAAI,OAAO,GAEvB,OAAU,GAAI,EAAG,IAAM,EAAG,EAAG,EAE5B,EAAW,GAAM,EAAW,GAAI,QAMlC,YAAK,eAAiB,EACtB,KAAK,iBAAmB,EAAO,iBAC/B,KAAK,YAAc,EAAO,YAE1B,KAAK,WAAa,EAAO,WAEzB,KAAK,WAAa,EAAO,WAEzB,KAAK,UAAY,EAAO,UAExB,KAAK,cAAgB,EAAO,cAC5B,KAAK,oBAAsB,EAAO,oBAClC,KAAK,mBAAqB,EAAO,mBAEjC,KAAK,UAAY,EAAO,UAExB,KAAK,UAAY,EAAO,UACxB,KAAK,gBAAkB,EAAO,gBAC9B,KAAK,mBAAqB,EAAO,mBAEjC,KAAK,QAAU,EAAO,QAEtB,KAAK,WAAa,EAAO,WAEzB,KAAK,SAAW,KAAK,MAAO,KAAK,UAAW,EAAO,WAE5C,KAIR,SAAU,CAET,KAAK,cAAe,CAAE,KAAM,eAIzB,aAAa,EAAQ,CAExB,AAAK,IAAU,IAAO,KAAK,YAM7B,GAAS,UAAU,WAAa,GC3ZhC,oBAAgC,GAAS,CAExC,YAAa,EAAa,CAEzB,QAEA,KAAK,KAAO,oBAEZ,KAAK,MAAQ,GAAI,IAAO,UACxB,KAAK,SAAW,GAAI,IAAO,SAC3B,KAAK,UAAY,GAEjB,KAAK,IAAM,KAEX,KAAK,SAAW,KAChB,KAAK,kBAAoB,EAEzB,KAAK,MAAQ,KACb,KAAK,eAAiB,EAEtB,KAAK,SAAW,GAAI,IAAO,GAC3B,KAAK,kBAAoB,EACzB,KAAK,YAAc,KAEnB,KAAK,QAAU,KACf,KAAK,UAAY,EAEjB,KAAK,UAAY,KACjB,KAAK,cAAgB,GACrB,KAAK,YAAc,GAAI,IAAS,EAAG,GAEnC,KAAK,gBAAkB,KACvB,KAAK,kBAAoB,EACzB,KAAK,iBAAmB,EAExB,KAAK,YAAc,KAEnB,KAAK,SAAW,KAEhB,KAAK,OAAS,KACd,KAAK,QAAU,GACf,KAAK,aAAe,EACpB,KAAK,gBAAkB,IAEvB,KAAK,UAAY,GACjB,KAAK,mBAAqB,EAC1B,KAAK,iBAAmB,QACxB,KAAK,kBAAoB,QAEzB,KAAK,YAAc,GAEnB,KAAK,UAAW,GAIjB,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,MAAM,KAAM,EAAO,OACxB,KAAK,SAAS,KAAM,EAAO,UAC3B,KAAK,UAAY,EAAO,UAExB,KAAK,IAAM,EAAO,IAElB,KAAK,SAAW,EAAO,SACvB,KAAK,kBAAoB,EAAO,kBAEhC,KAAK,MAAQ,EAAO,MACpB,KAAK,eAAiB,EAAO,eAE7B,KAAK,SAAS,KAAM,EAAO,UAC3B,KAAK,YAAc,EAAO,YAC1B,KAAK,kBAAoB,EAAO,kBAEhC,KAAK,QAAU,EAAO,QACtB,KAAK,UAAY,EAAO,UAExB,KAAK,UAAY,EAAO,UACxB,KAAK,cAAgB,EAAO,cAC5B,KAAK,YAAY,KAAM,EAAO,aAE9B,KAAK,gBAAkB,EAAO,gBAC9B,KAAK,kBAAoB,EAAO,kBAChC,KAAK,iBAAmB,EAAO,iBAE/B,KAAK,YAAc,EAAO,YAE1B,KAAK,SAAW,EAAO,SAEvB,KAAK,OAAS,EAAO,OACrB,KAAK,QAAU,EAAO,QACtB,KAAK,aAAe,EAAO,aAC3B,KAAK,gBAAkB,EAAO,gBAE9B,KAAK,UAAY,EAAO,UACxB,KAAK,mBAAqB,EAAO,mBACjC,KAAK,iBAAmB,EAAO,iBAC/B,KAAK,kBAAoB,EAAO,kBAEhC,KAAK,YAAc,EAAO,YAEnB,OAMT,GAAkB,UAAU,oBAAsB,GCjJlD,oBAAgC,GAAS,CAExC,YAAa,EAAa,CAEzB,QAEA,KAAK,KAAO,oBAEZ,KAAK,MAAQ,GAAI,IAAO,UAExB,KAAK,UAAY,EACjB,KAAK,QAAU,QACf,KAAK,SAAW,QAEhB,KAAK,UAAW,GAKjB,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,MAAM,KAAM,EAAO,OAExB,KAAK,UAAY,EAAO,UACxB,KAAK,QAAU,EAAO,QACtB,KAAK,SAAW,EAAO,SAEhB,OAMT,GAAkB,UAAU,oBAAsB,GCjDlD,aAA0B,CAEzB,GAAI,GAAU,KACV,EAAc,GACd,EAAgB,KAChB,EAAY,KAEhB,WAA2B,EAAM,EAAQ,CAExC,EAAe,EAAM,GAErB,EAAY,EAAQ,sBAAuB,GAI5C,MAAO,CAEN,MAAO,UAAY,CAElB,AAAK,IAAgB,IAChB,IAAkB,MAEvB,GAAY,EAAQ,sBAAuB,GAE3C,EAAc,KAIf,KAAM,UAAY,CAEjB,EAAQ,qBAAsB,GAE9B,EAAc,IAIf,iBAAkB,SAAW,EAAW,CAEvC,EAAgB,GAIjB,WAAY,SAAW,EAAQ,CAE9B,EAAU,IC5Cb,YAA0B,EAAI,EAAe,CAE5C,GAAM,GAAW,EAAa,SAExB,EAAU,GAAI,SAEpB,WAAuB,EAAW,EAAa,CAE9C,GAAM,GAAQ,EAAU,MAClB,EAAQ,EAAU,MAElB,EAAS,EAAG,eAElB,EAAG,WAAY,EAAY,GAC3B,EAAG,WAAY,EAAY,EAAO,GAElC,EAAU,mBAEV,GAAI,GAAO,EAAG,MAEd,MAAK,aAAiB,cAErB,EAAO,EAAG,MAEJ,AAAK,YAAiB,cAE5B,QAAQ,KAAM,wEAER,AAAK,YAAiB,aAE5B,AAAK,EAAU,yBAEd,AAAK,EAEJ,EAAO,EAAG,WAIV,QAAQ,KAAM,2EAMf,EAAO,EAAG,eAIL,AAAK,YAAiB,YAE5B,EAAO,EAAG,MAEJ,AAAK,YAAiB,aAE5B,EAAO,EAAG,aAEJ,AAAK,YAAiB,YAE5B,EAAO,EAAG,IAEJ,AAAK,YAAiB,WAE5B,EAAO,EAAG,KAEJ,AAAK,aAAiB,aAIjB,YAAiB,qBAE5B,GAAO,EAAG,eAIJ,CACN,OAAQ,EACR,KAAM,EACN,gBAAiB,EAAM,kBACvB,QAAS,EAAU,SAKrB,WAAuB,EAAQ,EAAW,EAAa,CAEtD,GAAM,GAAQ,EAAU,MAClB,EAAc,EAAU,YAE9B,EAAG,WAAY,EAAY,GAE3B,AAAK,EAAY,QAAU,GAI1B,EAAG,cAAe,EAAY,EAAG,GAIjC,CAAK,EAEJ,EAAG,cAAe,EAAY,EAAY,OAAS,EAAM,kBACxD,EAAO,EAAY,OAAQ,EAAY,OAIxC,EAAG,cAAe,EAAY,EAAY,OAAS,EAAM,kBACxD,EAAM,SAAU,EAAY,OAAQ,EAAY,OAAS,EAAY,QAIvE,EAAY,MAAQ,IAQtB,WAAc,EAAY,CAEzB,MAAK,GAAU,8BAA+B,GAAY,EAAU,MAE7D,EAAQ,IAAK,GAIrB,WAAiB,EAAY,CAE5B,AAAK,EAAU,8BAA+B,GAAY,EAAU,MAEpE,GAAM,GAAO,EAAQ,IAAK,GAE1B,AAAK,GAEJ,GAAG,aAAc,EAAK,QAEtB,EAAQ,OAAQ,IAMlB,WAAiB,EAAW,EAAa,CAExC,GAAK,EAAU,oBAAsB,CAEpC,GAAM,GAAS,EAAQ,IAAK,GAE5B,AAAK,EAAE,GAAU,EAAO,QAAU,EAAU,UAE3C,EAAQ,IAAK,EAAW,CACvB,OAAQ,EAAU,OAClB,KAAM,EAAU,KAChB,gBAAiB,EAAU,YAC3B,QAAS,EAAU,UAKrB,OAID,AAAK,EAAU,8BAA+B,GAAY,EAAU,MAEpE,GAAM,GAAO,EAAQ,IAAK,GAE1B,AAAK,IAAS,OAEb,EAAQ,IAAK,EAAW,EAAc,EAAW,IAEtC,EAAK,QAAU,EAAU,SAEpC,GAAc,EAAK,OAAQ,EAAW,GAEtC,EAAK,QAAU,EAAU,SAM3B,MAAO,CAEN,IAAK,EACL,OAAQ,EACR,OAAQ,GCrLV,oBAA0B,GAAe,CAExC,YAAa,EAAQ,EAAG,EAAS,EAAG,EAAQ,EAAG,EAAgB,EAAG,EAAiB,EAAG,EAAgB,EAAI,CAEzG,QAEA,KAAK,KAAO,cAEZ,KAAK,WAAa,CACjB,MAAO,EACP,OAAQ,EACR,MAAO,EACP,cAAe,EACf,eAAgB,EAChB,cAAe,GAGhB,GAAM,GAAQ,KAId,EAAgB,KAAK,MAAO,GAC5B,EAAiB,KAAK,MAAO,GAC7B,EAAgB,KAAK,MAAO,GAI5B,GAAM,GAAU,GACV,EAAW,GACX,EAAU,GACV,EAAM,GAIR,EAAmB,EACnB,EAAa,EAIjB,EAAY,IAAK,IAAK,IAAK,GAAK,GAAK,EAAO,EAAQ,EAAO,EAAe,EAAgB,GAC1F,EAAY,IAAK,IAAK,IAAK,EAAG,GAAK,EAAO,EAAQ,CAAE,EAAO,EAAe,EAAgB,GAC1F,EAAY,IAAK,IAAK,IAAK,EAAG,EAAG,EAAO,EAAO,EAAQ,EAAe,EAAe,GACrF,EAAY,IAAK,IAAK,IAAK,EAAG,GAAK,EAAO,EAAO,CAAE,EAAQ,EAAe,EAAe,GACzF,EAAY,IAAK,IAAK,IAAK,EAAG,GAAK,EAAO,EAAQ,EAAO,EAAe,EAAgB,GACxF,EAAY,IAAK,IAAK,IAAK,GAAK,GAAK,EAAO,EAAQ,CAAE,EAAO,EAAe,EAAgB,GAI5F,KAAK,SAAU,GACf,KAAK,aAAc,WAAY,GAAI,IAAwB,EAAU,IACrE,KAAK,aAAc,SAAU,GAAI,IAAwB,EAAS,IAClE,KAAK,aAAc,KAAM,GAAI,IAAwB,EAAK,IAE1D,WAAqB,EAAG,EAAG,EAAG,EAAM,EAAM,EAAO,EAAQ,EAAO,EAAO,EAAO,EAAgB,CAE7F,GAAM,GAAe,EAAQ,EACvB,EAAgB,EAAS,EAEzB,EAAY,EAAQ,EACpB,EAAa,EAAS,EACtB,EAAY,EAAQ,EAEpB,EAAS,EAAQ,EACjB,EAAS,EAAQ,EAEnB,EAAgB,EAChB,GAAa,EAEX,GAAS,GAAI,GAInB,OAAU,IAAK,EAAG,GAAK,EAAQ,KAAQ,CAEtC,GAAM,IAAI,GAAK,EAAgB,EAE/B,OAAU,IAAK,EAAG,GAAK,EAAQ,KAAQ,CAEtC,GAAM,GAAI,GAAK,EAAe,EAI9B,GAAQ,GAAM,EAAI,EAClB,GAAQ,GAAM,GAAI,EAClB,GAAQ,GAAM,EAId,EAAS,KAAM,GAAO,EAAG,GAAO,EAAG,GAAO,GAI1C,GAAQ,GAAM,EACd,GAAQ,GAAM,EACd,GAAQ,GAAM,EAAQ,EAAI,EAAI,GAI9B,EAAQ,KAAM,GAAO,EAAG,GAAO,EAAG,GAAO,GAIzC,EAAI,KAAM,GAAK,GACf,EAAI,KAAM,EAAM,GAAK,GAIrB,GAAiB,GAYnB,OAAU,IAAK,EAAG,GAAK,EAAO,KAE7B,OAAU,IAAK,EAAG,GAAK,EAAO,KAAQ,CAErC,GAAM,IAAI,EAAmB,GAAK,EAAS,GACrC,EAAI,EAAmB,GAAK,EAAW,IAAK,GAC5C,EAAI,EAAqB,IAAK,GAAM,EAAW,IAAK,GACpD,EAAI,EAAqB,IAAK,GAAM,EAAS,GAInD,EAAQ,KAAM,GAAG,EAAG,GACpB,EAAQ,KAAM,EAAG,EAAG,GAIpB,IAAc,EAQhB,EAAM,SAAU,EAAY,GAAY,GAIxC,GAAc,GAId,GAAoB,SAMf,UAAU,EAAO,CAEvB,MAAO,IAAI,IAAa,EAAK,MAAO,EAAK,OAAQ,EAAK,MAAO,EAAK,cAAe,EAAK,eAAgB,EAAK,iBC/JtG,YAAwB,EAAM,CAEpC,GAAM,GAAM,GAEZ,OAAY,KAAK,GAAM,CAEtB,EAAK,GAAM,GAEX,OAAY,KAAK,GAAK,GAAM,CAE3B,GAAM,GAAW,EAAK,GAAK,GAE3B,AAAK,GAAc,GAAS,SAC3B,EAAS,WAAa,EAAS,WAC/B,EAAS,WAAa,EAAS,WAAa,EAAS,WACrD,EAAS,WAAa,EAAS,cAE/B,EAAK,GAAK,GAAM,EAAS,QAEnB,AAAK,MAAM,QAAS,GAE1B,EAAK,GAAK,GAAM,EAAS,QAIzB,EAAK,GAAK,GAAM,GAQnB,MAAO,GAID,YAAwB,EAAW,CAEzC,GAAM,GAAS,GAEf,OAAU,GAAI,EAAG,EAAI,EAAS,OAAQ,IAAO,CAE5C,GAAM,GAAM,GAAe,EAAU,IAErC,OAAY,KAAK,GAEhB,EAAQ,GAAM,EAAK,GAMrB,MAAO,GAMR,GAAM,IAAgB,CAAE,MAAO,GAAe,MAAO,IC/DrD,GAAO,IAAkB;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;ECqBzB,oBAA6B,GAAS,CAErC,YAAa,EAAa,CAEzB,QAEA,KAAK,KAAO,iBAEZ,KAAK,QAAU,GACf,KAAK,SAAW,GAEhB,KAAK,aAAe,GACpB,KAAK,eAAiB,GAEtB,KAAK,UAAY,EAEjB,KAAK,UAAY,GACjB,KAAK,mBAAqB,EAE1B,KAAK,IAAM,GACX,KAAK,OAAS,GACd,KAAK,SAAW,GAEhB,KAAK,WAAa,CACjB,YAAa,GACb,UAAW,GACX,YAAa,GACb,iBAAkB,IAKnB,KAAK,uBAAyB,CAC7B,MAAS,CAAE,EAAG,EAAG,GACjB,GAAM,CAAE,EAAG,GACX,IAAO,CAAE,EAAG,IAGb,KAAK,oBAAsB,OAC3B,KAAK,mBAAqB,GAE1B,KAAK,YAAc,KAEd,IAAe,QAEd,GAAW,aAAe,QAE9B,QAAQ,MAAO,2FAIhB,KAAK,UAAW,IAMlB,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,eAAiB,EAAO,eAC7B,KAAK,aAAe,EAAO,aAE3B,KAAK,SAAW,GAAe,EAAO,UAEtC,KAAK,QAAU,OAAO,OAAQ,GAAI,EAAO,SAEzC,KAAK,UAAY,EAAO,UACxB,KAAK,mBAAqB,EAAO,mBAEjC,KAAK,OAAS,EAAO,OACrB,KAAK,SAAW,EAAO,SAEvB,KAAK,WAAa,OAAO,OAAQ,GAAI,EAAO,YAE5C,KAAK,YAAc,EAAO,YAEnB,KAIR,OAAQ,EAAO,CAEd,GAAM,GAAO,MAAM,OAAQ,GAE3B,EAAK,YAAc,KAAK,YACxB,EAAK,SAAW,GAEhB,OAAY,KAAQ,MAAK,SAAW,CAGnC,GAAM,GAAQ,AADE,KAAK,SAAU,GACT,MAEtB,AAAK,GAAS,EAAM,UAEnB,EAAK,SAAU,GAAS,CACvB,KAAM,IACN,MAAO,EAAM,OAAQ,GAAO,MAGvB,AAAK,GAAS,EAAM,QAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,IACN,MAAO,EAAM,UAGR,AAAK,GAAS,EAAM,UAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,KACN,MAAO,EAAM,WAGR,AAAK,GAAS,EAAM,UAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,KACN,MAAO,EAAM,WAGR,AAAK,GAAS,EAAM,UAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,KACN,MAAO,EAAM,WAGR,AAAK,GAAS,EAAM,UAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,KACN,MAAO,EAAM,WAGR,AAAK,GAAS,EAAM,UAE1B,EAAK,SAAU,GAAS,CACvB,KAAM,KACN,MAAO,EAAM,WAKd,EAAK,SAAU,GAAS,CACvB,MAAO,GASV,AAAK,OAAO,KAAM,KAAK,SAAU,OAAS,GAAI,GAAK,QAAU,KAAK,SAElE,EAAK,aAAe,KAAK,aACzB,EAAK,eAAiB,KAAK,eAE3B,GAAM,GAAa,GAEnB,OAAY,KAAO,MAAK,WAEvB,AAAK,KAAK,WAAY,KAAU,IAAO,GAAY,GAAQ,IAI5D,MAAK,QAAO,KAAM,GAAa,OAAS,GAAI,GAAK,WAAa,GAEvD,IAMT,GAAe,UAAU,iBAAmB,GCnM5C,GAAM,IAAwB,GAAI,GAC5B,GAA2B,GAAI,GAC/B,GAAwB,GAAI,GAC5B,GAAsB,GAAI,GAE1B,GAAuB,GAAI,GAC3B,GAAuB,GAAI,GAC3B,GAAwB,GAAI,GAElC,QAAU,CAET,YAAa,EAAS,GAAI,GAAW,EAAY,GAAI,GAAS,EAAG,EAAG,IAAQ,CAE3E,KAAK,OAAS,EACd,KAAK,UAAY,EAIlB,IAAK,EAAQ,EAAY,CAExB,YAAK,OAAO,KAAM,GAClB,KAAK,UAAU,KAAM,GAEd,KAIR,KAAM,EAAM,CAEX,YAAK,OAAO,KAAM,EAAI,QACtB,KAAK,UAAU,KAAM,EAAI,WAElB,KAIR,GAAI,EAAG,EAAS,CAEf,MAAO,GAAO,KAAM,KAAK,WAAY,eAAgB,GAAI,IAAK,KAAK,QAIpE,OAAQ,EAAI,CAEX,YAAK,UAAU,KAAM,GAAI,IAAK,KAAK,QAAS,YAErC,KAIR,OAAQ,EAAI,CAEX,YAAK,OAAO,KAAM,KAAK,GAAI,EAAG,KAEvB,KAIR,oBAAqB,EAAO,EAAS,CAEpC,EAAO,WAAY,EAAO,KAAK,QAE/B,GAAM,GAAoB,EAAO,IAAK,KAAK,WAE3C,MAAK,GAAoB,EAEjB,EAAO,KAAM,KAAK,QAInB,EAAO,KAAM,KAAK,WAAY,eAAgB,GAAoB,IAAK,KAAK,QAIpF,gBAAiB,EAAQ,CAExB,MAAO,MAAK,KAAM,KAAK,kBAAmB,IAI3C,kBAAmB,EAAQ,CAE1B,GAAM,GAAoB,GAAQ,WAAY,EAAO,KAAK,QAAS,IAAK,KAAK,WAI7E,MAAK,GAAoB,EAEjB,KAAK,OAAO,kBAAmB,GAIvC,IAAQ,KAAM,KAAK,WAAY,eAAgB,GAAoB,IAAK,KAAK,QAEtE,GAAQ,kBAAmB,IAInC,oBAAqB,EAAI,EAAI,EAAoB,EAAyB,CASzE,GAAW,KAAM,GAAK,IAAK,GAAK,eAAgB,IAChD,GAAQ,KAAM,GAAK,IAAK,GAAK,YAC7B,GAAM,KAAM,KAAK,QAAS,IAAK,IAE/B,GAAM,GAAY,EAAG,WAAY,GAAO,GAClC,EAAM,CAAE,KAAK,UAAU,IAAK,IAC5B,EAAK,GAAM,IAAK,KAAK,WACrB,EAAK,CAAE,GAAM,IAAK,IAClB,EAAI,GAAM,WACV,EAAM,KAAK,IAAK,EAAI,EAAM,GAC5B,EAAI,EAAI,EAAS,EAErB,GAAK,EAAM,EAQV,GAJA,EAAK,EAAM,EAAK,EAChB,EAAK,EAAM,EAAK,EAChB,EAAS,EAAY,EAEhB,GAAM,EAEV,GAAK,GAAM,CAAE,EAEZ,GAAK,GAAM,EAAS,CAKnB,GAAM,GAAS,EAAI,EACnB,GAAM,EACN,GAAM,EACN,EAAU,EAAO,GAAK,EAAM,EAAK,EAAI,GAAO,EAAO,GAAM,EAAK,EAAK,EAAI,GAAO,MAM9E,GAAK,EACL,EAAK,KAAK,IAAK,EAAG,CAAI,GAAM,EAAK,IACjC,EAAU,CAAE,EAAK,EAAK,EAAO,GAAK,EAAI,GAAO,MAQ9C,GAAK,CAAE,EACP,EAAK,KAAK,IAAK,EAAG,CAAI,GAAM,EAAK,IACjC,EAAU,CAAE,EAAK,EAAK,EAAO,GAAK,EAAI,GAAO,MAM9C,AAAK,IAAM,CAAE,EAIZ,GAAK,KAAK,IAAK,EAAG,CAAI,EAAE,EAAM,EAAY,IAC1C,EAAO,EAAK,EAAM,CAAE,EAAY,KAAK,IAAK,KAAK,IAAK,CAAE,EAAW,CAAE,GAAM,GACzE,EAAU,CAAE,EAAK,EAAK,EAAO,GAAK,EAAI,GAAO,GAEvC,AAAK,GAAM,EAIjB,GAAK,EACL,EAAK,KAAK,IAAK,KAAK,IAAK,CAAE,EAAW,CAAE,GAAM,GAC9C,EAAU,EAAO,GAAK,EAAI,GAAO,GAMjC,GAAK,KAAK,IAAK,EAAG,CAAI,GAAM,EAAY,IACxC,EAAO,EAAK,EAAM,EAAY,KAAK,IAAK,KAAK,IAAK,CAAE,EAAW,CAAE,GAAM,GACvE,EAAU,CAAE,EAAK,EAAK,EAAO,GAAK,EAAI,GAAO,OAU/C,GAAO,EAAM,EAAM,CAAE,EAAY,EACjC,EAAK,KAAK,IAAK,EAAG,CAAI,GAAM,EAAK,IACjC,EAAU,CAAE,EAAK,EAAK,EAAO,GAAK,EAAI,GAAO,EAI9C,MAAK,IAEJ,EAAmB,KAAM,KAAK,WAAY,eAAgB,GAAK,IAAK,KAAK,QAIrE,GAEJ,EAAuB,KAAM,IAAU,eAAgB,GAAK,IAAK,IAI3D,EAIR,gBAAiB,EAAQ,EAAS,CAEjC,GAAQ,WAAY,EAAO,OAAQ,KAAK,QACxC,GAAM,GAAM,GAAQ,IAAK,KAAK,WACxB,EAAK,GAAQ,IAAK,IAAY,EAAM,EACpC,EAAU,EAAO,OAAS,EAAO,OAEvC,GAAK,EAAK,EAAU,MAAO,MAE3B,GAAM,GAAM,KAAK,KAAM,EAAU,GAG3B,EAAK,EAAM,EAGX,EAAK,EAAM,EAGjB,MAAK,GAAK,GAAK,EAAK,EAAW,KAK1B,EAAK,EAAW,KAAK,GAAI,EAAI,GAG3B,KAAK,GAAI,EAAI,GAIrB,iBAAkB,EAAS,CAE1B,MAAO,MAAK,kBAAmB,EAAO,SAAc,EAAO,OAAS,EAAO,OAI5E,gBAAiB,EAAQ,CAExB,GAAM,GAAc,EAAM,OAAO,IAAK,KAAK,WAE3C,GAAK,IAAgB,EAGpB,MAAK,GAAM,gBAAiB,KAAK,UAAa,EAEtC,EAMD,KAIR,GAAM,GAAI,CAAI,MAAK,OAAO,IAAK,EAAM,QAAW,EAAM,UAAa,EAInE,MAAO,IAAK,EAAI,EAAI,KAIrB,eAAgB,EAAO,EAAS,CAE/B,GAAM,GAAI,KAAK,gBAAiB,GAEhC,MAAK,KAAM,KAEH,KAID,KAAK,GAAI,EAAG,GAIpB,gBAAiB,EAAQ,CAIxB,GAAM,GAAc,EAAM,gBAAiB,KAAK,QAUhD,MARK,KAAgB,GAQhB,AAFe,EAAM,OAAO,IAAK,KAAK,WAExB,EAAc,EAYlC,aAAc,EAAK,EAAS,CAE3B,GAAI,GAAM,EAAM,EAAO,EAAO,EAAO,EAE/B,EAAU,EAAI,KAAK,UAAU,EAClC,EAAU,EAAI,KAAK,UAAU,EAC7B,EAAU,EAAI,KAAK,UAAU,EAExB,EAAS,KAAK,OAuDpB,MArDA,AAAK,IAAW,EAEf,GAAS,GAAI,IAAI,EAAI,EAAO,GAAM,EAClC,EAAS,GAAI,IAAI,EAAI,EAAO,GAAM,GAIlC,GAAS,GAAI,IAAI,EAAI,EAAO,GAAM,EAClC,EAAS,GAAI,IAAI,EAAI,EAAO,GAAM,GAInC,AAAK,GAAW,EAEf,GAAU,GAAI,IAAI,EAAI,EAAO,GAAM,EACnC,EAAU,GAAI,IAAI,EAAI,EAAO,GAAM,GAInC,GAAU,GAAI,IAAI,EAAI,EAAO,GAAM,EACnC,EAAU,GAAI,IAAI,EAAI,EAAO,GAAM,GAI7B,EAAO,GAAa,EAAQ,GAK9B,IAAQ,GAAQ,IAAS,IAAO,GAAO,GAEvC,GAAQ,GAAQ,IAAS,IAAO,GAAO,GAE5C,AAAK,GAAW,EAEf,GAAU,GAAI,IAAI,EAAI,EAAO,GAAM,EACnC,EAAU,GAAI,IAAI,EAAI,EAAO,GAAM,GAInC,GAAU,GAAI,IAAI,EAAI,EAAO,GAAM,EACnC,EAAU,GAAI,IAAI,EAAI,EAAO,GAAM,GAI7B,EAAO,GAAa,EAAQ,IAE9B,IAAQ,GAAQ,IAAS,IAAO,GAAO,GAEvC,GAAQ,GAAQ,IAAS,IAAO,GAAO,GAIvC,EAAO,GAAW,KAEhB,KAAK,GAAI,GAAQ,EAAI,EAAO,EAAM,GAI1C,cAAe,EAAM,CAEpB,MAAO,MAAK,aAAc,EAAK,MAAc,KAI9C,kBAAmB,EAAG,EAAG,EAAG,EAAiB,EAAS,CAMrD,GAAO,WAAY,EAAG,GACtB,GAAO,WAAY,EAAG,GACtB,GAAQ,aAAc,GAAQ,IAO9B,GAAI,GAAM,KAAK,UAAU,IAAK,IAC1B,EAEJ,GAAK,EAAM,EAAI,CAEd,GAAK,EAAkB,MAAO,MAC9B,EAAO,UAEI,EAAM,EAEjB,EAAO,GACP,EAAM,CAAE,MAIR,OAAO,MAIR,GAAM,WAAY,KAAK,OAAQ,GAC/B,GAAM,GAAS,EAAO,KAAK,UAAU,IAAK,GAAO,aAAc,GAAO,KAGtE,GAAK,EAAS,EAEb,MAAO,MAIR,GAAM,GAAS,EAAO,KAAK,UAAU,IAAK,GAAO,MAAO,KAUxD,GAPK,EAAS,GAOT,EAAS,EAAS,EAEtB,MAAO,MAKR,GAAM,GAAM,CAAE,EAAO,GAAM,IAAK,IAGhC,MAAK,GAAM,EAEH,KAKD,KAAK,GAAI,EAAM,EAAK,GAI5B,aAAc,EAAU,CAEvB,YAAK,OAAO,aAAc,GAC1B,KAAK,UAAU,mBAAoB,GAE5B,KAIR,OAAQ,EAAM,CAEb,MAAO,GAAI,OAAO,OAAQ,KAAK,SAAY,EAAI,UAAU,OAAQ,KAAK,WAIvE,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,QCvetC,GAAM,IAAoB,GAAI,GACxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GAExB,GAAqB,GAAI,GACzB,GAAqB,GAAI,GACzB,GAAqB,GAAI,GACzB,GAAqB,GAAI,GACzB,GAAqB,GAAI,GACzB,GAAqB,GAAI,GAE/B,QAAe,CAEd,YAAa,EAAI,GAAI,GAAW,EAAI,GAAI,GAAW,EAAI,GAAI,GAAY,CAEtE,KAAK,EAAI,EACT,KAAK,EAAI,EACT,KAAK,EAAI,QAIH,WAAW,EAAG,EAAG,EAAG,EAAS,CAEnC,EAAO,WAAY,EAAG,GACtB,GAAI,WAAY,EAAG,GACnB,EAAO,MAAO,IAEd,GAAM,GAAiB,EAAO,WAC9B,MAAK,GAAiB,EAEd,EAAO,eAAgB,EAAI,KAAK,KAAM,IAIvC,EAAO,IAAK,EAAG,EAAG,SAMnB,cAAc,EAAO,EAAG,EAAG,EAAG,EAAS,CAE7C,GAAI,WAAY,EAAG,GACnB,GAAI,WAAY,EAAG,GACnB,GAAI,WAAY,EAAO,GAEvB,GAAM,GAAQ,GAAI,IAAK,IACjB,EAAQ,GAAI,IAAK,IACjB,EAAQ,GAAI,IAAK,IACjB,EAAQ,GAAI,IAAK,IACjB,EAAQ,GAAI,IAAK,IAEjB,EAAU,EAAQ,EAAQ,EAAQ,EAGxC,GAAK,IAAU,EAId,MAAO,GAAO,IAAK,GAAK,GAAK,IAI9B,GAAM,GAAW,EAAI,EACf,EAAM,GAAQ,EAAQ,EAAQ,GAAU,EACxC,EAAM,GAAQ,EAAQ,EAAQ,GAAU,EAG9C,MAAO,GAAO,IAAK,EAAI,EAAI,EAAG,EAAG,SAI3B,eAAe,EAAO,EAAG,EAAG,EAAI,CAEtC,YAAK,aAAc,EAAO,EAAG,EAAG,EAAG,IAE1B,GAAI,GAAK,GAAS,GAAI,GAAK,GAAW,GAAI,EAAI,GAAI,GAAO,QAI5D,OAAO,EAAO,EAAI,EAAI,EAAI,EAAK,EAAK,EAAK,EAAS,CAExD,YAAK,aAAc,EAAO,EAAI,EAAI,EAAI,IAEtC,EAAO,IAAK,EAAG,GACf,EAAO,gBAAiB,EAAK,GAAI,GACjC,EAAO,gBAAiB,EAAK,GAAI,GACjC,EAAO,gBAAiB,EAAK,GAAI,GAE1B,QAID,eAAe,EAAG,EAAG,EAAG,EAAY,CAE1C,UAAI,WAAY,EAAG,GACnB,GAAI,WAAY,EAAG,GAGV,GAAI,MAAO,IAAM,IAAK,GAAc,EAI9C,IAAK,EAAG,EAAG,EAAI,CAEd,YAAK,EAAE,KAAM,GACb,KAAK,EAAE,KAAM,GACb,KAAK,EAAE,KAAM,GAEN,KAIR,wBAAyB,EAAQ,EAAI,EAAI,EAAK,CAE7C,YAAK,EAAE,KAAM,EAAQ,IACrB,KAAK,EAAE,KAAM,EAAQ,IACrB,KAAK,EAAE,KAAM,EAAQ,IAEd,KAIR,OAAQ,CAEP,MAAO,IAAI,MAAK,cAAc,KAAM,MAIrC,KAAM,EAAW,CAEhB,YAAK,EAAE,KAAM,EAAS,GACtB,KAAK,EAAE,KAAM,EAAS,GACtB,KAAK,EAAE,KAAM,EAAS,GAEf,KAIR,SAAU,CAET,UAAI,WAAY,KAAK,EAAG,KAAK,GAC7B,GAAI,WAAY,KAAK,EAAG,KAAK,GAEtB,GAAI,MAAO,IAAM,SAAW,GAIpC,YAAa,EAAS,CAErB,MAAO,GAAO,WAAY,KAAK,EAAG,KAAK,GAAI,IAAK,KAAK,GAAI,eAAgB,EAAI,GAI9E,UAAW,EAAS,CAEnB,MAAO,IAAS,UAAW,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,GAIpD,SAAU,EAAS,CAElB,MAAO,GAAO,sBAAuB,KAAK,EAAG,KAAK,EAAG,KAAK,GAI3D,aAAc,EAAO,EAAS,CAE7B,MAAO,IAAS,aAAc,EAAO,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,GAI9D,MAAO,EAAO,EAAK,EAAK,EAAK,EAAS,CAErC,MAAO,IAAS,MAAO,EAAO,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,EAAK,EAAK,EAAK,GAItE,cAAe,EAAQ,CAEtB,MAAO,IAAS,cAAe,EAAO,KAAK,EAAG,KAAK,EAAG,KAAK,GAI5D,cAAe,EAAY,CAE1B,MAAO,IAAS,cAAe,KAAK,EAAG,KAAK,EAAG,KAAK,EAAG,GAIxD,cAAe,EAAM,CAEpB,MAAO,GAAI,mBAAoB,MAIhC,oBAAqB,EAAG,EAAS,CAEhC,GAAM,GAAI,KAAK,EAAG,EAAI,KAAK,EAAG,EAAI,KAAK,EACnC,EAAG,EAQP,GAAK,WAAY,EAAG,GACpB,GAAK,WAAY,EAAG,GACpB,GAAK,WAAY,EAAG,GACpB,GAAM,GAAK,GAAK,IAAK,IACf,EAAK,GAAK,IAAK,IACrB,GAAK,GAAM,GAAK,GAAM,EAGrB,MAAO,GAAO,KAAM,GAIrB,GAAK,WAAY,EAAG,GACpB,GAAM,GAAK,GAAK,IAAK,IACf,EAAK,GAAK,IAAK,IACrB,GAAK,GAAM,GAAK,GAAM,EAGrB,MAAO,GAAO,KAAM,GAIrB,GAAM,GAAK,EAAK,EAAK,EAAK,EAC1B,GAAK,GAAM,GAAK,GAAM,GAAK,GAAM,EAEhC,SAAI,EAAO,GAAK,GAET,EAAO,KAAM,GAAI,gBAAiB,GAAM,GAIhD,GAAK,WAAY,EAAG,GACpB,GAAM,GAAK,GAAK,IAAK,IACf,EAAK,GAAK,IAAK,IACrB,GAAK,GAAM,GAAK,GAAM,EAGrB,MAAO,GAAO,KAAM,GAIrB,GAAM,GAAK,EAAK,EAAK,EAAK,EAC1B,GAAK,GAAM,GAAK,GAAM,GAAK,GAAM,EAEhC,SAAI,EAAO,GAAK,GAET,EAAO,KAAM,GAAI,gBAAiB,GAAM,GAIhD,GAAM,GAAK,EAAK,EAAK,EAAK,EAC1B,GAAK,GAAM,GAAO,EAAK,GAAQ,GAAO,EAAK,GAAQ,EAElD,UAAK,WAAY,EAAG,GACpB,EAAM,GAAK,GAAW,GAAK,EAAS,GAAK,IAElC,EAAO,KAAM,GAAI,gBAAiB,GAAM,GAKhD,GAAM,GAAQ,EAAM,GAAK,EAAK,GAE9B,SAAI,EAAK,EACT,EAAI,EAAK,EAEF,EAAO,KAAM,GAAI,gBAAiB,GAAM,GAAI,gBAAiB,GAAM,GAI3E,OAAQ,EAAW,CAElB,MAAO,GAAS,EAAE,OAAQ,KAAK,IAAO,EAAS,EAAE,OAAQ,KAAK,IAAO,EAAS,EAAE,OAAQ,KAAK,KCzP/F,oBAAgC,GAAS,CAExC,YAAa,EAAa,CAEzB,QAEA,KAAK,KAAO,oBAEZ,KAAK,MAAQ,GAAI,IAAO,UAExB,KAAK,IAAM,KAEX,KAAK,SAAW,KAChB,KAAK,kBAAoB,EAEzB,KAAK,MAAQ,KACb,KAAK,eAAiB,EAEtB,KAAK,YAAc,KAEnB,KAAK,SAAW,KAEhB,KAAK,OAAS,KACd,KAAK,QAAU,GACf,KAAK,aAAe,EACpB,KAAK,gBAAkB,IAEvB,KAAK,UAAY,GACjB,KAAK,mBAAqB,EAC1B,KAAK,iBAAmB,QACxB,KAAK,kBAAoB,QAEzB,KAAK,UAAW,GAIjB,KAAM,EAAS,CAEd,aAAM,KAAM,GAEZ,KAAK,MAAM,KAAM,EAAO,OAExB,KAAK,IAAM,EAAO,IAElB,KAAK,SAAW,EAAO,SACvB,KAAK,kBAAoB,EAAO,kBAEhC,KAAK,MAAQ,EAAO,MACpB,KAAK,eAAiB,EAAO,eAE7B,KAAK,YAAc,EAAO,YAE1B,KAAK,SAAW,EAAO,SAEvB,KAAK,OAAS,EAAO,OACrB,KAAK,QAAU,EAAO,QACtB,KAAK,aAAe,EAAO,aAC3B,KAAK,gBAAkB,EAAO,gBAE9B,KAAK,UAAY,EAAO,UACxB,KAAK,mBAAqB,EAAO,mBACjC,KAAK,iBAAmB,EAAO,iBAC/B,KAAK,kBAAoB,EAAO,kBAEzB,OAMT,GAAkB,UAAU,oBAAsB,GC5FlD,GAAM,IAA+B,GAAI,IACnC,GAAqB,GAAI,IACzB,GAAwB,GAAI,IAE5B,GAAoB,GAAI,GACxB,GAAoB,GAAI,GACxB,GAAoB,GAAI,GAExB,GAAuB,GAAI,GAC3B,GAAuB,GAAI,GAC3B,GAAuB,GAAI,GAE3B,GAAwB,GAAI,GAC5B,GAAwB,GAAI,GAC5B,GAAwB,GAAI,GAE5B,GAAqB,GAAI,IACzB,GAAqB,GAAI,IACzB,GAAqB,GAAI,IAEzB,GAAmC,GAAI,GACvC,GAAwC,GAAI,GAElD,gBAAmB,GAAS,CAE3B,YAAa,EAAW,GAAI,IAAkB,EAAW,GAAI,IAAsB,CAElF,QAEA,KAAK,KAAO,OAEZ,KAAK,SAAW,EAChB,KAAK,SAAW,EAEhB,KAAK,qBAIN,KAAM,EAAS,CAEd,aAAM,KAAM,GAEP,EAAO,wBAA0B,QAErC,MAAK,sBAAwB,EAAO,sBAAsB,SAItD,EAAO,wBAA0B,QAErC,MAAK,sBAAwB,OAAO,OAAQ,GAAI,EAAO,wBAIxD,KAAK,SAAW,EAAO,SACvB,KAAK,SAAW,EAAO,SAEhB,KAIR,oBAAqB,CAEpB,GAAM,GAAW,KAAK,SAEtB,GAAK,EAAS,iBAAmB,CAEhC,GAAM,GAAkB,EAAS,gBAC3B,EAAO,OAAO,KAAM,GAE1B,GAAK,EAAK,OAAS,EAAI,CAEtB,GAAM,GAAiB,EAAiB,EAAM,IAE9C,GAAK,IAAmB,OAAY,CAEnC,KAAK,sBAAwB,GAC7B,KAAK,sBAAwB,GAE7B,OAAU,GAAI,EAAG,EAAK,EAAe,OAAQ,EAAI,EAAI,IAAO,CAE3D,GAAM,GAAO,EAAgB,GAAI,MAAQ,OAAQ,GAEjD,KAAK,sBAAsB,KAAM,GACjC,KAAK,sBAAuB,GAAS,SAQlC,CAEN,GAAM,GAAe,EAAS,aAE9B,AAAK,IAAiB,QAAa,EAAa,OAAS,GAExD,QAAQ,MAAO,yGAQlB,QAAS,EAAW,EAAa,CAEhC,GAAM,GAAW,KAAK,SAChB,EAAW,KAAK,SAChB,EAAc,KAAK,YAoBzB,GAlBK,IAAa,QAIb,GAAS,iBAAmB,MAAO,EAAS,wBAEjD,GAAQ,KAAM,EAAS,gBACvB,GAAQ,aAAc,GAEjB,EAAU,IAAI,iBAAkB,MAAc,KAInD,IAAe,KAAM,GAAc,SACnC,GAAK,KAAM,EAAU,KAAM,aAAc,IAIpC,EAAS,cAAgB,MAExB,GAAK,cAAe,EAAS,eAAkB,IAAQ,OAI7D,GAAI,GAEJ,GAAK,EAAS,iBAAmB,CAEhC,GAAM,GAAQ,EAAS,MACjB,EAAW,EAAS,WAAW,SAC/B,EAAgB,EAAS,gBAAgB,SACzC,EAAuB,EAAS,qBAChC,EAAK,EAAS,WAAW,GACzB,EAAM,EAAS,WAAW,IAC1B,EAAS,EAAS,OAClB,EAAY,EAAS,UAE3B,GAAK,IAAU,KAId,GAAK,MAAM,QAAS,GAEnB,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,IAAO,CAEnD,GAAM,GAAQ,EAAQ,GAChB,EAAgB,EAAU,EAAM,eAEhC,EAAQ,KAAK,IAAK,EAAM,MAAO,EAAU,OACzC,EAAM,KAAK,IAAO,EAAM,MAAQ,EAAM,MAAW,EAAU,MAAQ,EAAU,OAEnF,OAAU,GAAI,EAAO,EAAK,EAAK,EAAI,EAAI,GAAK,EAAI,CAE/C,GAAM,GAAI,EAAM,KAAM,GAChB,EAAI,EAAM,KAAM,EAAI,GACpB,EAAI,EAAM,KAAM,EAAI,GAE1B,EAAe,GAAiC,KAAM,EAAe,EAAW,GAAM,EAAU,EAAe,EAAsB,EAAI,EAAK,EAAG,EAAG,GAE/I,GAEJ,GAAa,UAAY,KAAK,MAAO,EAAI,GACzC,EAAa,KAAK,cAAgB,EAAM,cACxC,EAAW,KAAM,SAQd,CAEN,GAAM,GAAQ,KAAK,IAAK,EAAG,EAAU,OAC/B,EAAM,KAAK,IAAK,EAAM,MAAS,EAAU,MAAQ,EAAU,OAEjE,OAAU,GAAI,EAAO,EAAK,EAAK,EAAI,EAAI,GAAK,EAAI,CAE/C,GAAM,GAAI,EAAM,KAAM,GAChB,EAAI,EAAM,KAAM,EAAI,GACpB,EAAI,EAAM,KAAM,EAAI,GAE1B,EAAe,GAAiC,KAAM,EAAU,EAAW,GAAM,EAAU,EAAe,EAAsB,EAAI,EAAK,EAAG,EAAG,GAE1I,GAEJ,GAAa,UAAY,KAAK,MAAO,EAAI,GACzC,EAAW,KAAM,aAQT,IAAa,OAIxB,GAAK,MAAM,QAAS,GAEnB,OAAU,GAAI,EAAG,EAAK,EAAO,OAAQ,EAAI,EAAI,IAAO,CAEnD,GAAM,GAAQ,EAAQ,GAChB,EAAgB,EAAU,EAAM,eAEhC,EAAQ,KAAK,IAAK,EAAM,MAAO,EAAU,OACzC,EAAM,KAAK,IAAO,EAAM,MAAQ,EAAM,MAAW,EAAU,MAAQ,EAAU,OAEnF,OAAU,GAAI,EAAO,EAAK,EAAK,EAAI,EAAI,GAAK,EAAI,CAE/C,GAAM,GAAI,EACJ,EAAI,EAAI,EACR,EAAI,EAAI,EAEd,EAAe,GAAiC,KAAM,EAAe,EAAW,GAAM,EAAU,EAAe,EAAsB,EAAI,EAAK,EAAG,EAAG,GAE/I,GAEJ,GAAa,UAAY,KAAK,MAAO,EAAI,GACzC,EAAa,KAAK,cAAgB,EAAM,cACxC,EAAW,KAAM,SAQd,CAEN,GAAM,GAAQ,KAAK,IAAK,EAAG,EAAU,OAC/B,EAAM,KAAK,IAAK,EAAS,MAAS,EAAU,MAAQ,EAAU,OAEpE,OAAU,GAAI,EAAO,EAAK,EAAK,EAAI,EAAI,GAAK,EAAI,CAE/C,GAAM,GAAI,EACJ,EAAI,EAAI,EACR,EAAI,EAAI,EAEd,EAAe,GAAiC,KAAM,EAAU,EAAW,GAAM,EAAU,EAAe,EAAsB,EAAI,EAAK,EAAG,EAAG,GAE1I,GAEJ,GAAa,UAAY,KAAK,MAAO,EAAI,GACzC,EAAW,KAAM,UAUf,AAAK,GAAS,YAEpB,QAAQ,MAAO,+FAQlB,GAAK,UAAU,OAAS,GAExB,YAA4B,EAAQ,EAAU,EAAW,EAAK,EAAI,EAAI,EAAI,EAAQ,CAEjF,GAAI,GAYJ,GAVA,AAAK,EAAS,OAAS,GAEtB,EAAY,EAAI,kBAAmB,EAAI,EAAI,EAAI,GAAM,GAIrD,EAAY,EAAI,kBAAmB,EAAI,EAAI,EAAI,EAAS,OAAS,GAAY,GAIzE,IAAc,KAAO,MAAO,MAEjC,GAAwB,KAAM,GAC9B,GAAwB,aAAc,EAAO,aAE7C,GAAM,GAAW,EAAU,IAAI,OAAO,WAAY,IAElD,MAAK,GAAW,EAAU,MAAQ,EAAW,EAAU,IAAa,KAE7D,CACN,SAAU,EACV,MAAO,GAAwB,QAC/B,OAAQ,GAKV,YAA0C,EAAQ,EAAU,EAAW,EAAK,EAAU,EAAe,EAAsB,EAAI,EAAK,EAAG,EAAG,EAAI,CAE7I,GAAI,oBAAqB,EAAU,GACnC,GAAI,oBAAqB,EAAU,GACnC,GAAI,oBAAqB,EAAU,GAEnC,GAAM,GAAkB,EAAO,sBAE/B,GAAK,GAAiB,EAAkB,CAEvC,GAAQ,IAAK,EAAG,EAAG,GACnB,GAAQ,IAAK,EAAG,EAAG,GACnB,GAAQ,IAAK,EAAG,EAAG,GAEnB,OAAU,GAAI,EAAG,EAAK,EAAc,OAAQ,EAAI,EAAI,IAAO,CAE1D,GAAM,GAAY,EAAiB,GAC7B,EAAiB,EAAe,GAEtC,AAAK,IAAc,GAEnB,IAAO,oBAAqB,EAAgB,GAC5C,GAAO,oBAAqB,EAAgB,GAC5C,GAAO,oBAAqB,EAAgB,GAE5C,AAAK,EAEJ,IAAQ,gBAAiB,GAAQ,GACjC,GAAQ,gBAAiB,GAAQ,GACjC,GAAQ,gBAAiB,GAAQ,IAIjC,IAAQ,gBAAiB,GAAO,IAAK,IAAO,GAC5C,GAAQ,gBAAiB,GAAO,IAAK,IAAO,GAC5C,GAAQ,gBAAiB,GAAO,IAAK,IAAO,KAM9C,GAAI,IAAK,IACT,GAAI,IAAK,IACT,GAAI,IAAK,IAIV,AAAK,EAAO,eAEX,GAAO,cAAe,EAAG,IACzB,EAAO,cAAe,EAAG,IACzB,EAAO,cAAe,EAAG,KAI1B,GAAM,GAAe,GAAmB,EAAQ,EAAU,EAAW,EAAK,GAAK,GAAK,GAAK,IAEzF,GAAK,EAAe,CAEnB,AAAK,GAEJ,IAAK,oBAAqB,EAAI,GAC9B,GAAK,oBAAqB,EAAI,GAC9B,GAAK,oBAAqB,EAAI,GAE9B,EAAa,GAAK,GAAS,MAAO,GAAoB,GAAK,GAAK,GAAK,GAAM,GAAM,GAAM,GAAI,MAIvF,GAEJ,IAAK,oBAAqB,EAAK,GAC/B,GAAK,oBAAqB,EAAK,GAC/B,GAAK,oBAAqB,EAAK,GAE/B,EAAa,IAAM,GAAS,MAAO,GAAoB,GAAK,GAAK,GAAK,GAAM,GAAM,GAAM,GAAI,MAI7F,GAAM,GAAO,CACZ,EAAG,EACH,EAAG,EACH,EAAG,EACH,OAAQ,GAAI,GACZ,cAAe,GAGhB,GAAS,UAAW,GAAK,GAAK,GAAK,EAAK,QAExC,EAAa,KAAO,EAIrB,MAAO,GC9ZR,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;ECAzB,GAAO,IAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": []
}
