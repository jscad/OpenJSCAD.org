const test = require('ava')

const { deserialize } = require('../index')

//
// Test suite for DXF deserialization (import)
//
test('ASCII DXF 3D Polyline Entities translated to JSCAD Scripts', (t) => {
  // DXF 3D POLYLINE with mesh, translates to script with CSG.fromPolygons
  const dxf3 = `0
SECTION
2
ENTITIES
0
POLYLINE
66
1
10
0
20
0
30
0
70
16
71
6
72
3
62
7
0
VERTEX
10
-144
20
-684
30
240
70
64
0
VERTEX
10
-160
20
-720
30
0
70
64
0
VERTEX
10
-160
20
-720
30
0
70
64
0
VERTEX
10
-444
20
-684
30
240
70
64
0
VERTEX
10
-480
20
-720
30
0
70
64
0
VERTEX
10
-480
20
-720
30
0
70
64
0
VERTEX
10
-444
20
-432
30
240
70
64
0
VERTEX
10
-480
20
-432
30
0
70
64
0
VERTEX
10
-480
20
-720
30
0
70
64
0
VERTEX
10
-144
20
-432
30
240
70
64
0
VERTEX
10
-160
20
-432
30
0
70
64
0
VERTEX
10
-160
20
-720
30
0
70
64
0
VERTEX
10
-144
20
-432
30
240
70
64
0
VERTEX
10
-144
20
-432
30
240
70
64
0
VERTEX
10
-144
20
-684
30
240
70
64
0
VERTEX
10
-444
20
-432
30
240
70
64
0
VERTEX
10
-444
20
-432
30
240
70
64
0
VERTEX
10
-444
20
-684
30
240
70
64
0
SEQEND
0
ENDSEC`
  const src3 = deserialize({ filename: 'dxf3-test', output: 'script' }, dxf3)
  const ss3 = src3.split('\n')
  t.is(ss3.length, 28)
  t.true(src3.indexOf('geom3.create') > 0)

  // DXF 3D POLYLINE with faces, translates to script with CSG
})

test('ASCII DXF 3D FACE Entities translated to JSCAD Scripts', (t) => {
  const dxf1 = `0
SECTION
2
ENTITIES
0
3DFACE
8
1
62
1
10
-0.5
20
-0.5
30
-0.5
11
-0.5
21
0.5
31
-0.5
12
0.5
22
0.5
32
-0.5
13
0.5
23
-0.5
33
-0.5
0
3DFACE
8
1
62
1
10
-0.5
20
-0.5
30
-0.5
11
0.5
21
-0.5
31
-0.5
12
0
22
-0.5
32
0.5
13
0
23
-0.5
33
0.5
0
ENDSEC`
  // expect a script which calls createPolygon for each 3DFACE, and creates a new 3D geometry
  const src1 = deserialize({ filename: 'dxf1-test', output: 'script' }, dxf1)
  const ss1 = src1.split('\n')
  t.is(ss1.length, 24)
  t.true(src1.indexOf('createPolygon(') > 0)
  t.true(src1.indexOf('geom3.create(') > 0)
})
