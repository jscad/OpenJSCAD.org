import test from 'ava'

import { geom3 } from '../geometries/index.js'

import { measureArea, measureVolume } from '../measurements/index.js'

import { roundedCuboid } from './index.js'

import { comparePolygonsAsPoints } from '../../test/helpers/index.js'

test('roundedCuboid (defaults)', (t) => {
  const obs = roundedCuboid()
  const pts = geom3.toVertices(obs)

  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 21.87859958298585)
  t.is(measureVolume(obs), 7.800061070935406)
  t.is(pts.length, 614)
})

test('roundedCuboid (zero size)', (t) => {
  const obs = roundedCuboid({ size: [1, 1, 0] })
  const pts = geom3.toVertices(obs)
  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 0)
  t.is(measureVolume(obs), 0)
  t.is(pts.length, 0)
})

test('roundedCuboid (zero radius)', (t) => {
  const obs = roundedCuboid({ roundRadius: 0 })
  const pts = geom3.toVertices(obs)
  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 24)
  t.is(measureVolume(obs), 7.999999999999999)
  t.is(pts.length, 6)
})

test('roundedCuboid (options)', (t) => {
  // test segments
  let obs = roundedCuboid({ segments: 8 })
  let pts = geom3.toVertices(obs)
  let exp = []

  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 21.65472758198208)
  t.is(measureVolume(obs), 7.734600480283937)
  t.is(pts.length, 62)

  // test center
  obs = roundedCuboid({ center: [4, 5, 6], segments: 8 })
  pts = geom3.toVertices(obs)
  exp = [
  ]

  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 21.65472758198207)
  t.is(measureVolume(obs), 7.73460048028392)
  t.is(pts.length, 62)

  // test size
  obs = roundedCuboid({ size: [8, 10, 12], segments: 8 })
  pts = geom3.toVertices(obs)
  exp = [
    [[4, 4.8, -5.8], [3.9414213562373095, 4.941421356237309, -5.8],
      [3.9414213562373095, 4.941421356237309, 5.8], [4, 4.8, 5.8]],
    [[3.9414213562373095, 4.941421356237309, -5.8], [3.8, 5, -5.8],
      [3.8, 5, 5.8], [3.9414213562373095, 4.941421356237309, 5.8]],
    [[3.8, 5, -5.8], [-3.8, 5, -5.8],
      [-3.8, 5, 5.8], [3.8, 5, 5.8]],
    [[-3.8, 5, -5.8], [-3.9414213562373095, 4.941421356237309, -5.8],
      [-3.9414213562373095, 4.941421356237309, 5.8], [-3.8, 5, 5.8]],
    [[-3.9414213562373095, 4.941421356237309, -5.8], [-4, 4.8, -5.8],
      [-4, 4.8, 5.8], [-3.9414213562373095, 4.941421356237309, 5.8]],
    [[-4, 4.8, -5.8], [-4, -4.8, -5.8],
      [-4, -4.8, 5.8], [-4, 4.8, 5.8]],
    [[-4, -4.8, -5.8], [-3.9414213562373095, -4.941421356237309, -5.8],
      [-3.9414213562373095, -4.941421356237309, 5.8], [-4, -4.8, 5.8]],
    [[-3.9414213562373095, -4.941421356237309, -5.8], [-3.8, -5, -5.8],
      [-3.8, -5, 5.8], [-3.9414213562373095, -4.941421356237309, 5.8]],
    [[-3.8, -5, -5.8], [3.8, -5, -5.8],
      [3.8, -5, 5.8], [-3.8, -5, 5.8]],
    [[3.8, -5, -5.8], [3.9414213562373095, -4.941421356237309, -5.8],
      [3.9414213562373095, -4.941421356237309, 5.8], [3.8, -5, 5.8]],
    [[3.9414213562373095, -4.941421356237309, -5.8], [4, -4.8, -5.8],
      [4, -4.8, 5.8], [3.9414213562373095, -4.941421356237309, 5.8]],
    [[4, -4.8, -5.8], [4, 4.8, -5.8],
      [4, 4.8, 5.8], [4, -4.8, 5.8]],
    [[4, 4.8, 5.8], [3.9414213562373095, 4.941421356237309, 5.8], [3.9414213562373095, 4.8, 5.94142135623731]],
    [[3.9414213562373095, 4.8, 5.94142135623731], [3.9414213562373095, 4.941421356237309, 5.8], [3.8, 4.941421356237309, 5.94142135623731]],
    [[3.9414213562373095, 4.941421356237309, 5.8], [3.8, 5, 5.8], [3.8, 4.941421356237309, 5.94142135623731]],
    [[-3.8, 5, 5.8], [-3.9414213562373095, 4.941421356237309, 5.8], [-3.8, 4.941421356237309, 5.94142135623731]],
    [[-3.8, 4.941421356237309, 5.94142135623731], [-3.9414213562373095, 4.941421356237309, 5.8], [-3.9414213562373095, 4.8, 5.94142135623731]],
    [[-3.9414213562373095, 4.941421356237309, 5.8], [-4, 4.8, 5.8], [-3.9414213562373095, 4.8, 5.94142135623731]],
    [[-4, -4.8, 5.8], [-3.9414213562373095, -4.941421356237309, 5.8], [-3.9414213562373095, -4.8, 5.94142135623731]],
    [[-3.9414213562373095, -4.8, 5.94142135623731], [-3.9414213562373095, -4.941421356237309, 5.8], [-3.8, -4.941421356237309, 5.94142135623731]],
    [[-3.9414213562373095, -4.941421356237309, 5.8], [-3.8, -5, 5.8], [-3.8, -4.941421356237309, 5.94142135623731]],
    [[3.8, -5, 5.8], [3.9414213562373095, -4.941421356237309, 5.8], [3.8, -4.941421356237309, 5.94142135623731]],
    [[3.8, -4.941421356237309, 5.94142135623731], [3.9414213562373095, -4.941421356237309, 5.8], [3.9414213562373095, -4.8, 5.94142135623731]],
    [[3.9414213562373095, -4.941421356237309, 5.8], [4, -4.8, 5.8], [3.9414213562373095, -4.8, 5.94142135623731]],
    [[3.8, 5, 5.8], [-3.8, 5, 5.8],
      [-3.8, 4.941421356237309, 5.94142135623731], [3.8, 4.941421356237309, 5.94142135623731]],
    [[-4, 4.8, 5.8], [-4, -4.8, 5.8],
      [-3.9414213562373095, -4.8, 5.94142135623731], [-3.9414213562373095, 4.8, 5.94142135623731]],
    [[-3.8, -5, 5.8], [3.8, -5, 5.8],
      [3.8, -4.941421356237309, 5.94142135623731], [-3.8, -4.941421356237309, 5.94142135623731]],
    [[4, -4.8, 5.8], [4, 4.8, 5.8],
      [3.9414213562373095, 4.8, 5.94142135623731], [3.9414213562373095, -4.8, 5.94142135623731]],
    [[4, -4.8, -5.8], [3.9414213562373095, -4.941421356237309, -5.8], [3.9414213562373095, -4.8, -5.94142135623731]],
    [[3.9414213562373095, -4.8, -5.94142135623731], [3.9414213562373095, -4.941421356237309, -5.8], [3.8, -4.941421356237309, -5.94142135623731]],
    [[3.9414213562373095, -4.941421356237309, -5.8], [3.8, -5, -5.8], [3.8, -4.941421356237309, -5.94142135623731]],
    [[-3.8, -5, -5.8], [-3.9414213562373095, -4.941421356237309, -5.8], [-3.8, -4.941421356237309, -5.94142135623731]],
    [[-3.8, -4.941421356237309, -5.94142135623731], [-3.9414213562373095, -4.941421356237309, -5.8], [-3.9414213562373095, -4.8, -5.94142135623731]],
    [[-3.9414213562373095, -4.941421356237309, -5.8], [-4, -4.8, -5.8], [-3.9414213562373095, -4.8, -5.94142135623731]],
    [[-4, 4.8, -5.8], [-3.9414213562373095, 4.941421356237309, -5.8], [-3.9414213562373095, 4.8, -5.94142135623731]],
    [[-3.9414213562373095, 4.8, -5.94142135623731], [-3.9414213562373095, 4.941421356237309, -5.8], [-3.8, 4.941421356237309, -5.94142135623731]],
    [[-3.9414213562373095, 4.941421356237309, -5.8], [-3.8, 5, -5.8], [-3.8, 4.941421356237309, -5.94142135623731]],
    [[3.8, 5, -5.8], [3.9414213562373095, 4.941421356237309, -5.8], [3.8, 4.941421356237309, -5.94142135623731]],
    [[3.8, 4.941421356237309, -5.94142135623731], [3.9414213562373095, 4.941421356237309, -5.8], [3.9414213562373095, 4.8, -5.94142135623731]],
    [[3.9414213562373095, 4.941421356237309, -5.8], [4, 4.8, -5.8], [3.9414213562373095, 4.8, -5.94142135623731]],
    [[3.8, -5, -5.8], [-3.8, -5, -5.8],
      [-3.8, -4.941421356237309, -5.94142135623731], [3.8, -4.941421356237309, -5.94142135623731]],
    [[-4, -4.8, -5.8], [-4, 4.8, -5.8],
      [-3.9414213562373095, 4.8, -5.94142135623731], [-3.9414213562373095, -4.8, -5.94142135623731]],
    [[-3.8, 5, -5.8], [3.8, 5, -5.8],
      [3.8, 4.941421356237309, -5.94142135623731], [-3.8, 4.941421356237309, -5.94142135623731]],
    [[4, 4.8, -5.8], [4, -4.8, -5.8],
      [3.9414213562373095, -4.8, -5.94142135623731], [3.9414213562373095, 4.8, -5.94142135623731]],
    [[3.9414213562373095, 4.8, 5.94142135623731], [3.8, 4.941421356237309, 5.94142135623731], [3.8, 4.8, 6]],
    [[-3.8, 4.941421356237309, 5.94142135623731], [-3.9414213562373095, 4.8, 5.94142135623731], [-3.8, 4.8, 6]],
    [[-3.9414213562373095, -4.8, 5.94142135623731], [-3.8, -4.941421356237309, 5.94142135623731], [-3.8, -4.8, 6]],
    [[3.8, -4.941421356237309, 5.94142135623731], [3.9414213562373095, -4.8, 5.94142135623731], [3.8, -4.8, 6]],
    [[3.8, 4.941421356237309, 5.94142135623731], [-3.8, 4.941421356237309, 5.94142135623731],
      [-3.8, 4.8, 6], [3.8, 4.8, 6]],
    [[-3.9414213562373095, 4.8, 5.94142135623731], [-3.9414213562373095, -4.8, 5.94142135623731],
      [-3.8, -4.8, 6], [-3.8, 4.8, 6]],
    [[-3.8, -4.941421356237309, 5.94142135623731], [3.8, -4.941421356237309, 5.94142135623731],
      [3.8, -4.8, 6], [-3.8, -4.8, 6]],
    [[3.9414213562373095, -4.8, 5.94142135623731], [3.9414213562373095, 4.8, 5.94142135623731],
      [3.8, 4.8, 6], [3.8, -4.8, 6]],
    [[3.9414213562373095, -4.8, -5.94142135623731], [3.8, -4.941421356237309, -5.94142135623731], [3.8, -4.8, -6]],
    [[-3.8, -4.941421356237309, -5.94142135623731], [-3.9414213562373095, -4.8, -5.94142135623731], [-3.8, -4.8, -6]],
    [[-3.9414213562373095, 4.8, -5.94142135623731], [-3.8, 4.941421356237309, -5.94142135623731], [-3.8, 4.8, -6]],
    [[3.8, 4.941421356237309, -5.94142135623731], [3.9414213562373095, 4.8, -5.94142135623731], [3.8, 4.8, -6]],
    [[3.8, -4.941421356237309, -5.94142135623731], [-3.8, -4.941421356237309, -5.94142135623731],
      [-3.8, -4.8, -6], [3.8, -4.8, -6]],
    [[-3.9414213562373095, -4.8, -5.94142135623731], [-3.9414213562373095, 4.8, -5.94142135623731],
      [-3.8, 4.8, -6], [-3.8, -4.8, -6]],
    [[-3.8, 4.941421356237309, -5.94142135623731], [3.8, 4.941421356237309, -5.94142135623731],
      [3.8, 4.8, -6], [-3.8, 4.8, -6]],
    [[3.9414213562373095, 4.8, -5.94142135623731], [3.9414213562373095, -4.8, -5.94142135623731],
      [3.8, -4.8, -6], [3.8, 4.8, -6]],
    [[3.8, 4.8, 6], [-3.8, 4.8, 6],
      [-3.8, -4.8, 6], [3.8, -4.8, 6]],
    [[3.8, -4.8, -6], [-3.8, -4.8, -6],
      [-3.8, 4.8, -6], [3.8, 4.8, -6]]
  ]
  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 580.6448151876211)
  t.is(measureVolume(obs), 958.6098905200406)
  t.is(pts.length, 62)
  t.true(comparePolygonsAsPoints(pts, exp))

  // test roundRadius
  obs = roundedCuboid({ size: [8, 10, 12], roundRadius: 2, segments: 8 })
  pts = geom3.toVertices(obs)
  exp = [
    [[4, 3, -4], [3.414213562373095, 4.414213562373095, -4],
      [3.414213562373095, 4.414213562373095, 4], [4, 3, 4]],
    [[3.414213562373095, 4.414213562373095, -4], [2, 5, -4],
      [2, 5, 4], [3.414213562373095, 4.414213562373095, 4]],
    [[2, 5, -4], [-1.9999999999999998, 5, -4],
      [-1.9999999999999998, 5, 4], [2, 5, 4]],
    [[-1.9999999999999998, 5, -4], [-3.414213562373095, 4.414213562373095, -4],
      [-3.414213562373095, 4.414213562373095, 4], [-1.9999999999999998, 5, 4]],
    [[-3.414213562373095, 4.414213562373095, -4], [-4, 3.0000000000000004, -4],
      [-4, 3.0000000000000004, 4], [-3.414213562373095, 4.414213562373095, 4]],
    [[-4, 3.0000000000000004, -4], [-4, -2.9999999999999996, -4],
      [-4, -2.9999999999999996, 4], [-4, 3.0000000000000004, 4]],
    [[-4, -2.9999999999999996, -4], [-3.414213562373095, -4.414213562373095, -4],
      [-3.414213562373095, -4.414213562373095, 4], [-4, -2.9999999999999996, 4]],
    [[-3.414213562373095, -4.414213562373095, -4], [-2.0000000000000004, -5, -4],
      [-2.0000000000000004, -5, 4], [-3.414213562373095, -4.414213562373095, 4]],
    [[-2.0000000000000004, -5, -4], [1.9999999999999996, -5, -4],
      [1.9999999999999996, -5, 4], [-2.0000000000000004, -5, 4]],
    [[1.9999999999999996, -5, -4], [3.414213562373095, -4.414213562373095, -4],
      [3.414213562373095, -4.414213562373095, 4], [1.9999999999999996, -5, 4]],
    [[3.414213562373095, -4.414213562373095, -4], [4, -3.0000000000000004, -4],
      [4, -3.0000000000000004, 4], [3.414213562373095, -4.414213562373095, 4]],
    [[4, -3.0000000000000004, -4], [4, 3, -4],
      [4, 3, 4], [4, -3.0000000000000004, 4]],
    [[4, 3, 4], [3.414213562373095, 4.414213562373095, 4], [3.414213562373095, 3, 5.414213562373095]],
    [[3.414213562373095, 3, 5.414213562373095], [3.414213562373095, 4.414213562373095, 4], [2, 4.414213562373095, 5.414213562373095]],
    [[3.414213562373095, 4.414213562373095, 4], [2, 5, 4], [2, 4.414213562373095, 5.414213562373095]],
    [[-1.9999999999999998, 5, 4], [-3.414213562373095, 4.414213562373095, 4], [-2, 4.414213562373095, 5.414213562373095]],
    [[-2, 4.414213562373095, 5.414213562373095], [-3.414213562373095, 4.414213562373095, 4], [-3.414213562373095, 3, 5.414213562373095]],
    [[-3.414213562373095, 4.414213562373095, 4], [-4, 3.0000000000000004, 4], [-3.414213562373095, 3, 5.414213562373095]],
    [[-4, -2.9999999999999996, 4], [-3.414213562373095, -4.414213562373095, 4], [-3.414213562373095, -3, 5.414213562373095]],
    [[-3.414213562373095, -3, 5.414213562373095], [-3.414213562373095, -4.414213562373095, 4], [-2.0000000000000004, -4.414213562373095, 5.414213562373095]],
    [[-3.414213562373095, -4.414213562373095, 4], [-2.0000000000000004, -5, 4], [-2.0000000000000004, -4.414213562373095, 5.414213562373095]],
    [[1.9999999999999996, -5, 4], [3.414213562373095, -4.414213562373095, 4], [1.9999999999999998, -4.414213562373095, 5.414213562373095]],
    [[1.9999999999999998, -4.414213562373095, 5.414213562373095], [3.414213562373095, -4.414213562373095, 4], [3.414213562373095, -3.0000000000000004, 5.414213562373095]],
    [[3.414213562373095, -4.414213562373095, 4], [4, -3.0000000000000004, 4], [3.414213562373095, -3.0000000000000004, 5.414213562373095]],
    [[2, 5, 4], [-1.9999999999999998, 5, 4],
      [-2, 4.414213562373095, 5.414213562373095], [2, 4.414213562373095, 5.414213562373095]],
    [[-4, 3.0000000000000004, 4], [-4, -2.9999999999999996, 4],
      [-3.414213562373095, -3, 5.414213562373095], [-3.414213562373095, 3, 5.414213562373095]],
    [[-2.0000000000000004, -5, 4], [1.9999999999999996, -5, 4],
      [1.9999999999999998, -4.414213562373095, 5.414213562373095], [-2.0000000000000004, -4.414213562373095, 5.414213562373095]],
    [[4, -3.0000000000000004, 4], [4, 3, 4],
      [3.414213562373095, 3, 5.414213562373095], [3.414213562373095, -3.0000000000000004, 5.414213562373095]],
    [[4, -3.0000000000000004, -4], [3.414213562373095, -4.414213562373095, -4], [3.414213562373095, -3.0000000000000004, -5.414213562373095]],
    [[3.414213562373095, -3.0000000000000004, -5.414213562373095], [3.414213562373095, -4.414213562373095, -4], [1.9999999999999998, -4.414213562373095, -5.414213562373095]],
    [[3.414213562373095, -4.414213562373095, -4], [1.9999999999999996, -5, -4], [1.9999999999999998, -4.414213562373095, -5.414213562373095]],
    [[-2.0000000000000004, -5, -4], [-3.414213562373095, -4.414213562373095, -4], [-2.0000000000000004, -4.414213562373095, -5.414213562373095]],
    [[-2.0000000000000004, -4.414213562373095, -5.414213562373095], [-3.414213562373095, -4.414213562373095, -4], [-3.414213562373095, -3, -5.414213562373095]],
    [[-3.414213562373095, -4.414213562373095, -4], [-4, -2.9999999999999996, -4], [-3.414213562373095, -3, -5.414213562373095]],
    [[-4, 3.0000000000000004, -4], [-3.414213562373095, 4.414213562373095, -4], [-3.414213562373095, 3, -5.414213562373095]],
    [[-3.414213562373095, 3, -5.414213562373095], [-3.414213562373095, 4.414213562373095, -4], [-2, 4.414213562373095, -5.414213562373095]],
    [[-3.414213562373095, 4.414213562373095, -4], [-1.9999999999999998, 5, -4], [-2, 4.414213562373095, -5.414213562373095]],
    [[2, 5, -4], [3.414213562373095, 4.414213562373095, -4], [2, 4.414213562373095, -5.414213562373095]],
    [[2, 4.414213562373095, -5.414213562373095], [3.414213562373095, 4.414213562373095, -4], [3.414213562373095, 3, -5.414213562373095]],
    [[3.414213562373095, 4.414213562373095, -4], [4, 3, -4], [3.414213562373095, 3, -5.414213562373095]],
    [[1.9999999999999996, -5, -4], [-2.0000000000000004, -5, -4],
      [-2.0000000000000004, -4.414213562373095, -5.414213562373095], [1.9999999999999998, -4.414213562373095, -5.414213562373095]],
    [[-4, -2.9999999999999996, -4], [-4, 3.0000000000000004, -4],
      [-3.414213562373095, 3, -5.414213562373095], [-3.414213562373095, -3, -5.414213562373095]],
    [[-1.9999999999999998, 5, -4], [2, 5, -4],
      [2, 4.414213562373095, -5.414213562373095], [-2, 4.414213562373095, -5.414213562373095]],
    [[4, 3, -4], [4, -3.0000000000000004, -4],
      [3.414213562373095, -3.0000000000000004, -5.414213562373095], [3.414213562373095, 3, -5.414213562373095]],
    [[3.414213562373095, 3, 5.414213562373095], [2, 4.414213562373095, 5.414213562373095], [2, 3, 6]],
    [[-2, 4.414213562373095, 5.414213562373095], [-3.414213562373095, 3, 5.414213562373095], [-2, 3, 6]],
    [[-3.414213562373095, -3, 5.414213562373095], [-2.0000000000000004, -4.414213562373095, 5.414213562373095], [-2, -3, 6]],
    [[1.9999999999999998, -4.414213562373095, 5.414213562373095], [3.414213562373095, -3.0000000000000004, 5.414213562373095], [2, -3, 6]],
    [[2, 4.414213562373095, 5.414213562373095], [-2, 4.414213562373095, 5.414213562373095],
      [-2, 3, 6], [2, 3, 6]],
    [[-3.414213562373095, 3, 5.414213562373095], [-3.414213562373095, -3, 5.414213562373095],
      [-2, -3, 6], [-2, 3, 6]],
    [[-2.0000000000000004, -4.414213562373095, 5.414213562373095], [1.9999999999999998, -4.414213562373095, 5.414213562373095],
      [2, -3, 6], [-2, -3, 6]],
    [[3.414213562373095, -3.0000000000000004, 5.414213562373095], [3.414213562373095, 3, 5.414213562373095],
      [2, 3, 6], [2, -3, 6]],
    [[3.414213562373095, -3.0000000000000004, -5.414213562373095], [1.9999999999999998, -4.414213562373095, -5.414213562373095], [2, -3, -6]],
    [[-2.0000000000000004, -4.414213562373095, -5.414213562373095], [-3.414213562373095, -3, -5.414213562373095], [-2, -3, -6]],
    [[-3.414213562373095, 3, -5.414213562373095], [-2, 4.414213562373095, -5.414213562373095], [-2, 3, -6]],
    [[2, 4.414213562373095, -5.414213562373095], [3.414213562373095, 3, -5.414213562373095], [2, 3, -6]],
    [[1.9999999999999998, -4.414213562373095, -5.414213562373095], [-2.0000000000000004, -4.414213562373095, -5.414213562373095],
      [-2, -3, -6], [2, -3, -6]],
    [[-3.414213562373095, -3, -5.414213562373095], [-3.414213562373095, 3, -5.414213562373095],
      [-2, 3, -6], [-2, -3, -6]],
    [[-2, 4.414213562373095, -5.414213562373095], [2, 4.414213562373095, -5.414213562373095],
      [2, 3, -6], [-2, 3, -6]],
    [[3.414213562373095, 3, -5.414213562373095], [3.414213562373095, -3.0000000000000004, -5.414213562373095],
      [2, -3, -6], [2, 3, -6]],
    [[2, 3, 6], [-2, 3, 6], [-2, -3, 6], [2, -3, 6]],
    [[2, -3, -6], [-2, -3, -6], [-2, 3, -6], [2, 3, -6]]
  ]
  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 470.09666312772333)
  t.is(measureVolume(obs), 835.1892253143822)
  t.is(pts.length, 62)
  t.true(comparePolygonsAsPoints(pts, exp))
})
