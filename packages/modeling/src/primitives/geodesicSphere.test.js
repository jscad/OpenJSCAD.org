import test from 'ava'

import { geom3 } from '../geometries/index.js'

import { measureArea, measureVolume } from '../measurements/index.js'

import { geodesicSphere } from './index.js'

import { comparePolygonsAsPoints } from '../../test/helpers/index.js'

test('geodesicSphere (defaults)', (t) => {
  const obs = geodesicSphere()
  const pts = geom3.toVertices(obs)
  t.notThrows(() => geom3.validate(obs))
  t.is(pts.length, 20)
})

test('geodesicSphere (options)', (t) => {
  // test radius
  let obs = geodesicSphere({ radius: 5 })
  let pts = geom3.toVertices(obs)
  const exp = [
    [[4.253254557317035, 0, 2.628654726407001], [2.628654726407001, -4.253254557317035, 0], [4.253254557317035, 0, -2.628654726407001]],
    [[4.253254557317035, 0, -2.628654726407001], [2.628654726407001, 4.253254557317035, 0], [4.253254557317035, 0, 2.628654726407001]],
    [[4.253254557317035, 0, -2.628654726407001], [0, -2.628654726407001, -4.253254557317035], [0, 2.628654726407001, -4.253254557317035]],
    [[4.253254557317035, 0, -2.628654726407001], [0, 2.628654726407001, -4.253254557317035], [2.628654726407001, 4.253254557317035, 0]],
    [[4.253254557317035, 0, -2.628654726407001], [2.628654726407001, -4.253254557317035, 0], [0, -2.628654726407001, -4.253254557317035]],
    [[0, -2.628654726407001, 4.253254557317035], [4.253254557317035, 0, 2.628654726407001], [0, 2.628654726407001, 4.253254557317035]],
    [[2.628654726407001, -4.253254557317035, 0], [4.253254557317035, 0, 2.628654726407001], [0, -2.628654726407001, 4.253254557317035]],
    [[4.253254557317035, 0, 2.628654726407001], [2.628654726407001, 4.253254557317035, 0], [0, 2.628654726407001, 4.253254557317035]],
    [[-4.253254557317035, 0, -2.628654726407001], [-2.628654726407001, -4.253254557317035, 0], [-4.253254557317035, 0, 2.628654726407001]],
    [[-4.253254557317035, 0, 2.628654726407001], [-2.628654726407001, 4.253254557317035, 0], [-4.253254557317035, 0, -2.628654726407001]],
    [[0, -2.628654726407001, 4.253254557317035], [0, 2.628654726407001, 4.253254557317035], [-4.253254557317035, 0, 2.628654726407001]],
    [[-4.253254557317035, 0, 2.628654726407001], [-2.628654726407001, -4.253254557317035, 0], [0, -2.628654726407001, 4.253254557317035]],
    [[0, 2.628654726407001, 4.253254557317035], [-2.628654726407001, 4.253254557317035, 0], [-4.253254557317035, 0, 2.628654726407001]],
    [[0, 2.628654726407001, -4.253254557317035], [0, -2.628654726407001, -4.253254557317035], [-4.253254557317035, 0, -2.628654726407001]],
    [[-4.253254557317035, 0, -2.628654726407001], [-2.628654726407001, 4.253254557317035, 0], [0, 2.628654726407001, -4.253254557317035]],
    [[-4.253254557317035, 0, -2.628654726407001], [0, -2.628654726407001, -4.253254557317035], [-2.628654726407001, -4.253254557317035, 0]],
    [[0, -2.628654726407001, 4.253254557317035], [-2.628654726407001, -4.253254557317035, 0], [2.628654726407001, -4.253254557317035, 0]],
    [[0, 2.628654726407001, 4.253254557317035], [2.628654726407001, 4.253254557317035, 0], [-2.628654726407001, 4.253254557317035, 0]],
    [[0, 2.628654726407001, -4.253254557317035], [-2.628654726407001, 4.253254557317035, 0], [2.628654726407001, 4.253254557317035, 0]],
    [[0, -2.628654726407001, -4.253254557317035], [2.628654726407001, -4.253254557317035, 0], [-2.628654726407001, -4.253254557317035, 0]]
  ]

  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 239.3635345818432)
  t.is(measureVolume(obs), 317.0188387650327)
  t.is(pts.length, 20)
  t.true(comparePolygonsAsPoints(pts, exp))

  // test frequency
  obs = geodesicSphere({ radius: 5, frequency: 18 })
  pts = geom3.toVertices(obs)

  t.notThrows.skip(() => geom3.validate(obs))
  t.is(measureArea(obs), 303.76605423529395)
  t.is(measureVolume(obs), 492.6739732379337)
  t.is(pts.length, 180)
})

test('geodesicSphere (zero radius)', (t) => {
  const obs = geodesicSphere({ radius: 0 })
  const pts = geom3.toVertices(obs)
  t.notThrows(() => geom3.validate(obs))
  t.is(measureArea(obs), 0)
  t.is(measureVolume(obs), 0)
  t.is(pts.length, 0)
})
